{"posts":[{"title":"The True Placeholder Symbol in C++","text":"In many programming language, the common way to indicate that the symbol is not important, is to use _ for the symbol. It was just a convention in C++, but it will become a language feature start from C++26. Wellâ€¦ whatâ€™s the difference? We use _ when there is some declaration but we do not care the name / have no good name for the variable. For example, a common trick to preserve the life time of RAII lock is 12345void doJob() { static std::mutex mutex; std::lock_guard _(mutex); // give it a name so it won't unlock immediately // some jobs ...} Or in structure-binding statement. 12345678template &lt;std::regular T&gt;std::tuple&lt;T, bool&gt; someJob() { return { {}, true };}void foo() { auto [_, done] = someJob&lt;int&gt;();} The problem isâ€¦ in C++, this style is just a convention, _ is still a regular variable. So if we want to ignore two value with different type, it does not work since the type mismatch. 12345void foo() { auto [_1, done1] = someJob&lt;int&gt;(); auto [_2, done2] = someJob&lt;std::string&gt;(); // we need to separate _2 from _1} Thatâ€™s frustrating, especially for people with experience of pattern-matching expression in other languages. So in C++26 (proposed by P2169), now we can new way to interpret the semantic of _. The rule is simple. If there is only one declaration of _ in some scope, everything is same as before. A we can reference it later if we wanâ€™t, although itâ€™s probably a bad smell to use _ in this case. If there are more declarations of _, they all refer to different objects respectively. In this case, they can only be assigned to. Try to use them is a compiling error. And we can finally write something that looks more natural. 1234void foo() { auto [_, done1] = someJob&lt;int&gt;(); auto [_, done2] = someJob&lt;std::string&gt;();} Golang has this feature from the beginning, is called blank identifier. For Python, although being a dynamic-type language, there is no problem to do use _ for different type value. _ is defined as a wildcard when pattern-matching is introduced to Python (PEP 634). Itâ€™s happy to see this came to C++ now. :D","link":"/2024/11/25/cpp-blank-identifier.html"},{"title":"Easier Iteration with Generator","text":"In Python, we can make a container type iterable by implement __iter__ method. For example, if we want to provide all value in a range [lo, hi) â€¦ 1234567class TwoTillSix: def __iter__(self): for val in range(2, 6): yield vallist(TwoTillSix()) # [2, 3, 4, 5] With the help of this generator function, we donâ€™t need a separate iterator type. Just keep the state during iteration directly in some local variable. In this post, letâ€™s see how we can do this in C++, with the help of std::generator&lt;T&gt;. A shorter version of this post can be found in Gist and Compiler Explorer. https://gist.github.com/wdhongtw/aa61b9b4dd132ffeae64d9189e9ba2cc https://godbolt.org/z/K57Enfhcr Coroutine and Concurrent ProgrammingWhat happens in the example above is that Python interpreter binds the execution state of that function to a generator object. Every time we want a value from that generator, the execution resumes until the function yields the next value (or returns). This is doable because Python provide a builtin support for coroutine, an interruptible/resumable function, so the control flow can interleave between callee and caller functions. And thatâ€™s the primitive building block of concurrent programming. 1234567values = TwoTillSix()for val in values: print(val) if val == 3: break# Print 2 and 3. The body of `TwoTillSix.__iter__` is only executed twice. As we can see here, the generator makes it possible that some values are evaluated lazily, and we can even stop the evaluation any time when we lost the interest. All of this is possible because the support of coroutine. C++ Coroutine and std::generatorFortunately, C++ has language level support for coroutine since C++20. When compiler see a function using new keywords co_await / co_yield and co_return, it will generate corresponding code to provide the ability of partial execution, and the storage of state for that function when itâ€™s interrupted. Also, starting from C++23, std::generator is included in standard library. As the coroutine (promise-)type that capture the common usage ofâ€¦ yes, generator!! (Actually Iâ€™m surprised that there is no any high-level coroutine type in standard library when coroutine is accepted as a language feature when C++20 is finalized.) 12345678910111213141516std::generator&lt;int&gt; fibonacci() { int a = 1, b = 0; while (true) { co_yield a; b = std::exchange(a, a + b); }}int main() { for (int num : fibonacci()) { if (num &gt; 10) break; std::println(&quot;{}&quot;, num); // prints 1 1 2 3 5 8 } return 0;} When fibonacci is called here, an interruptible function is created, and wrapped in the std::generator return value. Every time we take next value out in the for-loop, the function resumes and yield next value (and is interrupted again). So now we have the ability to interleave control flow, just like the example in Python earlier!! Butâ€¦ thatâ€™s a free function, usually what we encounter is a container class. A class must has begin/end method, and corresponding increment/dereference operator on the returned iterator type, in order to be iterable. (Itâ€™s modeled as named requirements Container in standard.) If a class need another method call to be iterated on, it just looksâ€¦ not like C++. 12345678910111213141516171819struct Factorial { // a virtual container for factorial series std::generator&lt;int&gt; generate() { int product = 1; int val = 1; while (true) { co_yield product; product *= val++; } }};int main() { Factorial fac {}; for (int num : fac.generate()) { // well.. can we iterate on fac directly? if (num &gt; 10) break; std::println(&quot;{}&quot;, num); }} Soâ€¦ can we keep the implementation simple (using std::generator coroutine type), while keeping the container being iterated in usual way? CRTP: Curiously Recurring Template PatternNow our goal become clear: How can we make a class be used as before, if the class only provides a method that return a std::generator?â€ Thatâ€™s the place where we adopt CRTP to solve problem. 123456789101112131415161718192021222324252627282930313233343536373839/// @brief HasGenerator identifies the customization point of CRTP base AutoContainer./// @tparam C the child class type./// @tparam T the value type.template &lt;typename C, typename T&gt;concept HasGenerator = requires(C c) { { c.generate() } -&gt; std::same_as&lt;std::generator&lt;T&gt;&gt;;};/// @brief A CRTP base type that allow easy iteration implementation./// @tparam T the value type of element being iterated. Not child class type./// @details Child class must provide std::generator&lt;T&gt; generate() member function.template &lt;std::semiregular T&gt;struct AutoContainer { class Iter { std::generator&lt;T&gt; gen_; std::ranges::iterator_t&lt;std::generator&lt;T&gt;&gt; iter_; public: Iter(std::generator&lt;T&gt;&amp;&amp; gen) : gen_ { std::move(gen) } // ensure generator being alive , iter_ { gen_.begin() } { } bool operator==(const std::default_sentinel_t&amp;) const { return iter_ == gen_.end(); } Iter&amp; operator++() { return ++iter_, *this; } T operator*() const { return *iter_; } }; // deducing-this so that we can do CRTP. // Also use concept to give better error message when doing mistake. Iter begin(this HasGenerator&lt;T&gt; auto&amp;&amp; self) { return Iter(self.generate()); } // deducing-this not required, just be symmetric with begin. std::default_sentinel_t end(this auto&amp;&amp; self) { return std::default_sentinel; };}; AutoContainer can inherited by any class that want the all the implementation for iteration. The base class here provides an iterator type to capture the generator, and forwards the increment/dereference operation to it. With this iterator type, the remain effort is on the begin method, just construct the iterator from self.generate(). Here self is typed by deducing-this so generate() can be provided later by child class. And thatâ€™s the place where the base class connects to itâ€™s child. Also at the begin method, we add concept constrain HasGenerator. This way we can avoid error waterfall when using templated library. And the interesting thing here is: â€œThe thing to be templated so that we achieve CRTP, is the templated begin method, not the AutoContainer class itself. If there are two child class both inherit from AuthContainer&lt;int&gt;, only one AuthContainer type is instantiated, but two different begin are instantiated. (See also: Curiously Recurring Template Pattern - cppreference.com) 12345678910111213141516171819202122232425int main() { /// @brief Factorial sequence generator. struct Factorial : public AutoContainer&lt;int&gt; { // Implement `generate` so this class can be iterated like a container. std::generator&lt;int&gt; generate() const { // The mutable state is the local variable of this coroutine, // so the method receiver can be const. int product = 1; int val = 1; while (true) { co_yield product; product *= val++; } } }; const Factorial fac {}; for (int value : fac) { // noticed that we don't call generate() here if (value &gt; 10) break; std::println(&quot;{}&quot;, value); // prints 1, 1, 2, 6 }} Now we can use the AutoContainer by inherit it in any child class. In the example above, Factorial inherit from AutoContainer&lt;int&gt; (since it generates integers). All we need to do is implement the generate method. Being a coroutine, the logic is clean. Now everything works and looks nice!! :D To make this class recognized as a std::ranges::input_range, that is, to make this class works with &lt;ranges&gt; library, the base AutoContainer actually need more stuffs, like value_type/difference_type on itâ€™s iterator, support of post-increment operator, and so onâ€¦ But thatâ€™s probably too much in a tutorial, so letâ€™s stop here. More Standard Library Support, Maybe?We describe the minimal concept about coroutine, one important application of coroutine as Generator (std::generator), and how to use it in a beautiful way. But there is another important application of coroutine: Promise (with Event Loop). JS developers already get used to the Promise type (or maybe the async/await keyword). Python also support this kind of usage since Python 3.5. But unfortunately, there is still no such thing in C++ standard library, even if the coroutine is standardized in C++20. The good news is that there is already a proposal P2300 and a reference implementation NVIDIA/stdexec. (They donâ€™t use the term Promise, probably because promise_type already have other meaning in the context of C++ coroutine) Hope we can see more usage about these in the future.","link":"/2025/02/26/cpp-generator-crtp.html"},{"title":"There is No Unit Type in C++","text":"There is NO unit type in C++. (Not in core language spec, at least.) A StoryAssuming we are define a abstract interface for storage to get name / set name for some user. 1234567class Storage {public: virtual ~Storage() = default; virtual std::string GetName(int id) const = 0; virtual void SetName(int id, std::string name) const = 0;}; Simple and straightforward. But itâ€™s intended to be a storage accessed through network, so any operation on it is inherently going to fail at some time. Also, We are 2024 now, loving FP, preferring expression over statement, monadic operation being so cool. Thus we decide to wrap all return type in std::optional to indicate these actions may fail. 1234567class Storage {public: virtual ~Storage() = default; virtual std::optional&lt;std::string&gt; GetName(int id) const = 0; virtual std::optional&lt;void&gt; SetName(int id, std::string name) const = 0;}; Looks good! But now it fails to be compiled. 1...\\include\\optional(100,26): error C2182: '_Value': this use of 'void' is not valid Well. template stuff. What Happened?The problem is that void is an incomplete type in C/C++, and always to be treat specially when we are trying to use them. By incomplete in C/C++, we mean a type that the size of which is not (yet) known. For example, if we forward declare a struct type, and later define itâ€™s member. The struct type is incomplete before the definition. 123456789struct Item;Item item; // &lt;- invalid usage, since that the size of Item is unknown yet.struct Item { int price;};Item item; // &lt;- valid usage here. And void is a type that is impossible to be complete by specification. But we can have a function that return void? Well, we return nothing 123void foo() { }void foo() { return; } // Or explicit return, both equivalent. BTW, C before C23 prefer putting a void in parameter list to indicate that a function takes nothing, e.g. int bar(void), but isâ€™s kinda broken design here. Since that we can not evaluate bar(foo()). There is no such thing that is a void and exists. 1234567void foo() { }int bar(void) { return 0; }int main() { return bar(foo()); // &lt;- invalid expression here.} So back to our problem here std::optional&lt;void&gt; Conceptually, std::optional&lt;T&gt; is just a some T with additional information of value-existence. 12345template &lt;typename T&gt;struct MyOptional { T value; bool hasValue;}; Because that there is impossible to have a member void value, std::optional&lt;void&gt; is not going to be a valid type at first place. (Well, we can make a specialization for void, but thatâ€™s another story.) So, How can We Fix?The problem here is that there is no a valid value for void in C/C++. At some level, program can be though of a bunch of expressions. An running a program is just the evaluation of these expressions. (Also the side effects, for real products / services) The atom of expression is value. If there is a concept thatâ€™s not possible to be express as a value, we are kicking ourselves. Take Python for example, if we have a function that return nothing, then the function actually returns None when it exits. 1234def foo(): passassert(foo() is None) # check pass here 1234567def foo(arg: None) -&gt; None: passdef bar(arg: None) -&gt; None: passbar(foo(None)) # well.. if we really want to chain them together So nothing itself is a thing, in Python, we call it None. Every expression now is evaluated to some value that exists, the the type system build up that is complete at any case. The concept of nothing itself here is call unit type in type theory. Itâ€™s a type that has one and only one value. In Python, the value is None, in JavaScript itâ€™s null, in Golang â€¦ maybe struct{}{} is a good choice, although not standardized by the language. Unit Type in C++Now is the time for C++. As we already see, void is not a good choice for unit type because we can not have a value for it. Are there other choices here? Just define a empty struct and use it probably not a good choice, since that now our custom unit type is not compatible with unit type from other code in the product code base. How about nullptr, thatâ€™s the only one value for std::nullptr_t. (So the type is std::optional&lt;std::nullptr_t&gt;). Itâ€™s a feasible choice, but looks weird since that pointer implies indirect access semantic, but itâ€™s not the case when using with std::optional&lt;T&gt; here. How about using std::nullopt_t? Itâ€™s also a unit type but itâ€™s now more confusing. Whatâ€™s does it mean by std::optional&lt;std::nullopt_t&gt;? A optional with empty option? There is a static assert in std::optional&lt;T&gt; template that forbid this usage directly, probably because itâ€™s too confusing. Maybe std::tuple&lt;&gt;? A tuple with zero element, so it have only one value, the empty tuple. That seems to be a good choice because the canonical unit type in Haskell is () the empty tuple. So it looks natural for people came from Haskell. But personally I donâ€™t like this either since that now the type has nested angle bracket as std::optional&lt;std::tuple&lt;&gt;&gt;. There is a type called std::monostate, arrived at the same time as std::optional in C++17. This candidate do not have additional implication by itâ€™s type or itâ€™s name. Itâ€™s monostate! Just a little wordy. std::monostate is originally designed to solve the problem for a std::variant&lt;...&gt; to be default initialized with any value. But itâ€™s name and itâ€™s characteristic are all fit our requirement here. Thus a good choice for wrapping a function that may fail but return nothing. Now the interface looks like 1234567class Storage {public: virtual ~Storage() = default; virtual std::optional&lt;std::string&gt; GetName(int id) const = 0; virtual std::optional&lt;std::monostate&gt; SetName(int id, std::string name) const = 0;}; Hmmâ€¦ std::optional&lt;std::monostate&gt;, which takes 29 characters. C++ is not easy. Just like we use std::shared_ptr&lt;T&gt; all over the places. Maybe the C++ Standards Committee should specialize std::optional&lt;void&gt;, just like std::expected&lt;void&gt; in C++23. Wish someday void can be a REAL unit type in C/C++. :D","link":"/2024/10/23/cpp-optional-monostate.html"},{"title":"ä¿è­·å­˜åœ¨æª”æ¡ˆç³»çµ±ä¸Šçš„ Docker ç™»å…¥å¯†ç¢¼","text":"åœ¨ä¼æ¥­å…§éƒ¨çš„å·¥ä½œç’°å¢ƒä¸­ï¼Œå¸¸æœƒç¢°åˆ°éœ€è¦å­˜å– private registry ä¸Šçš„ image çš„ç‹€æ³ã€‚ ä»¥ Docker çš„å·¥ä½œæµç¨‹ä¾†èªªï¼Œä¸€èˆ¬è¦é€éåŸ·è¡Œ docker login ä¾†å­˜å– private registryã€‚ ä¸éï¼Œè‹¥äº‹å…ˆæ¯›è¨­å®šå¥½ docker credential helperï¼ŒåŸ·è¡Œ docker login æœƒå°è‡´ æˆ‘å€‘çš„å¯†ç¢¼ / API token ç›´æ¥ä»¥æ˜æ–‡çš„æ–¹å¼å¯«åœ¨æª”æ¡ˆç³»çµ±ä¸Šã€‚ é€™ç¯‡ç­†è¨˜èªªæ˜å¦‚ä½•åœ¨ Linux ç’°å¢ƒä¸‹å®‰è£èˆ‡è¨­å®š docker credential helperã€‚ Installationè‡³ docker/docker-credential-helpers çš„ GitHub release é é¢ä¸‹è¼‰æœ€æ–°ç‰ˆæœ¬çš„ docker-credential-secretserviceã€‚ 1curl -L https://github.com/docker/docker-credential-helpers/releases/download/v0.6.3/docker-credential-secretservice-v0.6.3-amd64.tar.gz &gt;secretservice.tar.gz è§£å£“ç¸®ä¸¦æŠŠåŸ·è¡Œæª”æ”¾åˆ°ä»»æ„ä¸€å€‹ PATH è³‡æ–™å¤¾å…§ã€‚ 123tar -zxv -f secretservice.tar.gzchmod +x docker-credential-secretservicemv docker-credential-secretservice ~/.local/bin Configurationç‚ºäº†è®“ docker å·¥å…·çŸ¥é“æˆ‘å€‘è¦ç”¨ credential helperï¼Œéœ€è¦èª¿æ•´å®¶ç›®éŒ„ä¸‹çš„è¨­å®šæª”ã€‚ åœ¨è¨­å®šæª” ~/.docker/config.json å…§åŠ å…¥ credsStore è¨­å®šã€‚ 1$EDITOR ~/.docker/config.json 123{ &quot;credsStore&quot;: &quot;secretservice&quot;} è¨»: æ­¤è³‡æ–™å¤¾å’Œ JSON æª”æ¡ˆå¯èƒ½ä¸å­˜åœ¨ã€‚è‹¥æ²’æœ‰è‡ªå·±å‰µä¸€å€‹å³å¯ã€‚ è¨»: æ ¹æ“šæ–‡ä»¶ï¼Œæ­¤æ¬„ä½çš„å€¼èˆ‡æ˜¯ helper binary çš„å¾Œç¶´å°é½Šï¼Œå› ç‚º Linux ç’°å¢ƒä½¿ç”¨çš„ binary æ˜¯ docker-credential-secretservice æ‰€ä»¥éœ€è¦å¡«å…¥çš„å€¼çˆ² secretservice Usageå¦‚æœå·²ç¶“æœ‰ç™»å…¥éæŸ registryï¼Œéœ€è¦æ‰‹å‹•ç™»å‡ºã€‚ 1docker logout registry.example.com (é‡æ–°) ç™»å…¥è©² registryã€‚ 1docker login registry.example.com æª¢è¦– ~/.docker/config.json ä¸¦ç¢ºèªå°æ‡‰çš„èº«åˆ†ç´€éŒ„æ˜¯ç©ºç™½çš„ã€‚ 12345{ &quot;auths&quot;: { &quot;registry.example.com&quot;: {} }} è‹¥æœ‰å®‰è£ Seahorse ç¨‹å¼çš„è©±ï¼Œæ­¤æ™‚å¯ä»¥çœ‹åˆ° secret è¢«æ”¾åœ¨ Login keyring ä¸­ã€‚ å¦‚æœè¨­å®šéŒ¯èª¤çš„è©±ï¼Œç™»å…¥è³‡è¨Šæœƒä»¥ç·¨ç¢¼éçš„æ–¹å¼å‘ˆç¾åœ¨è©²ç´€éŒ„ä¸­ã€‚ 1234567{ &quot;auths&quot;: { &quot;registry.example.com&quot;: { &quot;auth&quot;: &quot;c3R...zE2&quot; } }} Future Reading docker login - Docker Documentation docker/docker-credential-helpers GNOME/Keyring - ArchWiki","link":"/2021/03/04/docker-credential-helper.html"},{"title":"Make shpool Easier to Use","text":"shpool is a tool like tmux and screen to keep persistent shell sessions across hangups. Itâ€™s quite new (first released 2023), and extremely simple to use. Usually I only need one persistent shell in remote machine, and this tool, unlike tmux, is designed to support only one shell per session. That makes me very satisfied. Currently there is no Bash auto-complete setup provided from the official repo. Therefore I implemented one for myself. With that, I can make my life easier. ğŸ¤£ 12shpool &lt;tab&gt; # complete sub-commands like attach / list / help ...shpool attach &lt;tab&gt; # complete available sessions Here is the auto-complete setup script for Bash, for anyone who have same requirement. 123456789101112131415161718192021222324252627282930313233343536# shellcheck shell=bash_shpool_completions() { [[ ${#COMP_WORDS[@]} -eq 1 ]] &amp;&amp; return 0 [[ ${COMP_WORDS[0]} != &quot;shpool&quot; ]] &amp;&amp; return 0 if [[ ${#COMP_WORDS[@]} -eq 2 ]]; then local commands=(attach detach kill list version help) local partial=&quot;${COMP_WORDS[$COMP_CWORD]}&quot; mapfile -t COMPREPLY &lt; &lt;(compgen -W &quot;${commands[*]}&quot; -- &quot;${partial}&quot;) return 0 fi [[ ${#COMP_WORDS[@]} -ne 3 ]] &amp;&amp; return 0 # Now, try completing session names for commands that take them local partial=&quot;${COMP_WORDS[$COMP_CWORD]}&quot; local command=&quot;${COMP_WORDS[$COMP_CWORD-1]}&quot; case &quot;${command}&quot; in attach|detach|kill) local -a sessions mapfile -t sessions &lt; &lt;(shpool list | tail -n +2 | awk '{print $1}') mapfile -t COMPREPLY &lt; &lt;(compgen -W &quot;${sessions[*]}&quot; -- &quot;${partial}&quot;) return 0 ;; *) # No need for other commands, they don't take arguments COMPREPLY=() return 0 ;; esac}complete -F _shpool_completions shpool Wish this tool gain more public notice! GitHub Link: https://github.com/shell-pool/shpool","link":"/2025/06/28/easier-shpool.html"},{"title":"é—œæ–¼é›»å­å ±ä¸€éµé€€è¨‚","text":"å‰è¨€å‰å…ˆæ—¥å­åœ¨ Gmail å…§æ•´ç†ä¿¡ä»¶æ™‚ï¼Œèµ«ç„¶æ³¨æ„åˆ°äº†ä¸€ä»¶äº‹æƒ…ï¼š æŸäº›è¨‚é–±ä¾†çš„é›»å­å ±ï¼Œåœ¨å¯„ä»¶è€…åå­—çš„å³é‚Šæœ‰å€‹é€€è¨‚çš„æ–‡å­—å¯ä»¥æŒ‰ï¼ ä½†è®“æˆ‘è¨ç•°çš„å…¶å¯¦ä¸åªæ˜¯é€™å€‹é€€è¨‚æ–‡å­—.. æŒ‰ä¸‹é€€è¨‚æ–‡å­—å¾Œï¼ŒGmail æœƒå½ˆå‡ºä¸€å€‹è¦–çª—çµ¦æˆ‘ï¼Œè£¡é ­æœƒå•æˆ‘æ˜¯ä¸æ˜¯ç¢ºå®šè¦é€€è¨‚æ­¤é›»å­å ±ï¼Œä»¥åŠä¸€å€‹è—è‰²çš„é€€è¨‚æŒ‰éˆ•ã€‚ ç¥å¥‡çš„æ˜¯ï¼Œç•¶æˆ‘æŒ‰ä¸‹é€™å€‹æŒ‰éˆ•å¾Œï¼ŒGmail ç›´æ¥å‘Šè¨´æˆ‘ï¼Œä½ å·²ç¶“é€€è¨‚äº†æ­¤é›»å­å ±ï¼ â€œYou unsubscribed from xxxxxx..â€ æŸäºº: å¥‡æ€ªâ€¦ ä¸€èˆ¬ä¸æ˜¯æœƒé€£åˆ°æŸå€‹é›»å­å ±å¯„é€æ–¹çš„é é¢ï¼Œç„¶å¾Œè®“æˆ‘é»å€‹ç¢ºèªä¹‹é¡çš„å—ï¼Ÿ æ—¢ç„¶ Gmail æœ‰è¾¦æ³•åœ¨ä¸é›¢é–‹ web mail ä»‹é¢çš„æƒ…æ³ä¸‹ï¼Œå¹«æˆ‘å®Œæˆé€€è¨‚çš„å‹•ä½œï¼Œé‚£å¤§æ¦‚æ˜¯æœ‰æŸç¨®æ¨™æº–ç¨‹åºï¼Œå¯ä»¥è®“ mail ä¾›æ‡‰å•†è‡ªå‹•åŒ–çš„å¹«æˆ‘è™•ç†å§ï¼Ÿ æ–¼æ˜¯ä¹ï¼Œæœ¬è‘—å¯¦äº‹æ±‚æ˜¯çš„ç²¾ç¥ï¼Œå°±æœ‰äº†ä»Šå¤©é€™ç¯‡æ–‡ç« ã€‚ å·¥ç¨‹å¸«çš„ç›´è¦ºæ³¨æ„åˆ°æœ‰é€™å€‹é€€è¨‚æŒ‰éˆ•å¯ä»¥æŒ‰ä¹‹å¾Œï¼Œæˆ‘å°±é–‹å§‹ä¸€å°ä¿¡ä¸€å°ä¿¡çœ‹ï¼Œæœ‰é€€è¨‚æŒ‰éˆ•çš„éƒ½ä¾†çµ¦ä»–é»çœ‹çœ‹ï¼Œçœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ã€‚ä½†æˆ‘å¾ˆå¿«åœ°å°±æ³¨æ„åˆ°â€¦ ä¸¦ä¸æ˜¯æ¯å€‹æœ‰æŒ‰éˆ•å¯æŒ‰çš„ Gmailï¼Œéƒ½å¯ä»¥ç›´æ¥å¹«æˆ‘å®Œæˆé€€è¨‚ã€‚ åƒæ˜¯ Linkin å’Œ Google Map å¯„ä¾†çš„ä¿¡ï¼Œéƒ½æ˜¯æœƒå¹«ä½ æ‰“é–‹æŸé€£çµï¼Œè®“ä½ åˆ°è©²é é¢å»åšå¾ŒçºŒè™•ç†ã€‚ ä½†ä¸ç®¡å¦‚ä½•ï¼Œæ—¢ç„¶ Gmail å¯ä»¥å¹«æˆ‘æŠŠé€™å€‹é€£çµå–å‡ºä¾†ï¼Œå¤§æ¦‚æ˜¯æœ‰æŸç¨®æ¨™æº–çš„ mail header ä¾†è¨˜éŒ„é€™äº›è³‡è¨Šå§ï¼ŸæŠŠ Linkin é‚£å°åŸå§‹ä¿¡ä»¶é»é–‹ä¾†ä¸€çœ‹ï¼Œç™¼ç¾äº†é€™å€‹æ±è¥¿ 1List-Unsubscribe: &lt;https://www.linkedin.com/e/v2?e=6f948d7f&amp;t=ad69-4827&amp;...&gt; å†æŠŠé€™å€‹ List-Unsubscribe æ‹¿å»æŸ¥ï¼Œå°±æ‰¾åˆ°ä¸€ç¯‡ RFC äº† 123456789Network Working Group G. NeufeldRequest for Comments: 2369 NistoCategory: Standards Track J. Baer SkyWeyr Technologies July 1998 The Use of URLs as Meta-Syntax for Core Mail List Commands and their Transport through Message Header Fields RFC 2369 â€œThe Use of URLs as Meta-Syntax for Core Mail List Commandsâ€ã€‚ä»”ç´°ä¸€è®€å¾Œç™¼ç¾ï¼Œä»¥å‰çš„äººç‚ºäº†ç”¨ mail æ¨™æº–åŒ– mail list çš„å„ç¨®è™•ç†å‹•ä½œï¼Œé‚„ä¸‹äº†ä¸å°‘è‹¦å¿ƒã€‚ XD å…‰æ˜¯é€™ä»½ RFC å…§æœ‰æåˆ°çš„éƒ¨åˆ† header å°±æœ‰: List-Help: æ‰€æœ‰å’Œæ­¤ mail list ç›¸é—œçš„è³‡è¨Šéƒ½å¾é€™é‚Šå–å¾— List-Unsubscribe: ä½¿ç”¨è€…å¿«é€Ÿé€€è¨‚çš„æ–¹å¼ List-Subscribe: ä½¿ç”¨è€…å¿«é€Ÿè¨‚é–±çš„æ–¹å¼ List-Post: ä½¿ç”¨è€…ç™¼è¡¨æ–‡ç« è‡³æ­¤ mail list çš„æ–¹å¼ å…¶ä¸­çš„ List-Unsubscribe å°±æ˜¯æˆ‘å€‘è¦çš„æ±è¥¿ã€‚åƒç…§ RFC èªªæ˜ï¼Œé€™å€‹ header å…§å¯ä»¥æ”¾ HTTP çš„é€£çµæˆ– mailto çš„é€£çµã€‚é€™æ¨£çœ‹èµ·ä¾†ï¼Œå¦‚æœæ˜¯ HTTP é€£çµï¼ŒGmail å°±æœƒå¹«æˆ‘å€‘é€£ä¸Šè©²é é¢ã€‚è€Œé‚£äº›æ²’æœ‰é¡å¤–è·³å‡ºé é¢çš„ï¼Œå¤§æ¦‚å°±æ˜¯ Gmail ç›´æ¥å¹«æˆ‘å€‘å¯„é€€è¨‚ä¿¡ä»¶äº†å§ã€‚ 12List-Unsubscribe: &lt;http://www.host.com/list.cgi?cmd=unsub&amp;lst=list&gt;, &lt;mailto:list-request@host.com?subject=unsubscribe&gt; é–‹å§‹é©—è­‰ç‚ºäº†ç¢ºèªä¸Šé¢çš„çŒœæƒ³ï¼Œæˆ‘åˆé»äº†å°æœ‰é€€è¨‚æŒ‰éˆ•ä¸”ä¸æœƒè·³å‡ºé¡å¤–é é¢çš„ä¿¡ä»¶ã€‚é€™æ¬¡çš„å¯¦é©—å°è±¡æ˜¯ The Hacker Newsã€‚åœ¨é»æ“Šé€€è¨‚ä¹‹å¾Œï¼Œåœ¨æˆ‘çš„å¯„ä»¶ä¿¡ç®±å…§æ‰¾åˆ° Gmail è‡ªå‹•å¹«æˆ‘ç”¢ç”Ÿçš„ä¿¡ä»¶ï¼ŒGmail ä¸åªæœ‰å¹«æˆ‘å¯„é€™å°ä¿¡ï¼Œé€£ä¿¡ä»¶ä¸»æ—¨å’Œå…§æ–‡éƒ½å¹«æˆ‘å¡«å¥½å¥½çš„ã€‚ XD 123456# æŒ‰ä¸‹é€€è¨‚å¾Œï¼Œæˆ‘å¯„å‡ºçš„ä¿¡ (çœç•¥éƒ¨åˆ† header)To: f081fcde-0c7e-4617-afaf-c0c35eeea170@unsubscribe.netline.comSubject: UnsubscribeContent-Disposition: inline$You will be unsubscribed from this list within ten days of sending this reply åœ¨å›å»çœ‹ä¸€ä¸‹åŸæœ¬ç´å°é›»å­å ±çš„åŸå§‹ä¿¡ä»¶ï¼Œæœç„¶åœ¨ header å…§æ‰¾åˆ°é€™å°æ‡‰çš„ List-Unsubscribe mailto é€£çµï¼Œä¸”ä¿¡ä»¶ä¸»æ—¨å’Œä¿¡ä»¶å…§æ–‡å’Œé€™å€‹é€£çµå¾Œæ–¹å¸¶çš„è³‡è¨Šå®Œå…¨å»åˆã€‚ 12# The Hacker News ä¿¡ä»¶çš„ List-Unsubscribe headerList-Unsubscribe: &lt;mailto:f081fcde-0c7e-4617-afaf-c0c35eeea170@unsubscribe.netline.com?subject=Unsubscribe&amp;body=$You%20will%20be%20unsubscribed%20from%20this%20list%20within%20ten%20days%20of%20sending%20this%20reply&gt; çœ‹åˆ°é€™è£¡ï¼Œä¼¼ä¹æ˜¯çœŸç›¸å¤§ç™½äº†ã€‚åƒèˆ‡åˆ¶å®š RFC çš„äººå€‘çœŸå‰å¤§ï¼è¶´æ©Ÿè¶´æ©Ÿè¶´æ©Ÿï¼ ç”¨ HTTP(S) é€£çµåšé€€è¨‚çš„æœƒé–‹ä¸€å€‹ HTTP Get è«‹æ±‚ï¼Œè®“ä½¿ç”¨è€…åˆ°æŸé é¢æŒ‰é€€è¨‚ï¼›è€Œé‚£äº›ç”¨ mailto é€£çµçš„ï¼Œmail agent å¯ä»¥å¹«æˆ‘è‡ªå‹•å¯„å‡ºé€€è¨‚ä¿¡ä»¶ï¼Œæ–¼æ˜¯é”æˆä¸€éµé€€è¨‚çš„åŠŸèƒ½ï¼ ä¸éâ€¦ æˆ‘å‰›å‰›å¥½åƒä¹Ÿä¸€éµé€€è¨‚äº† Pinkoi çš„é›»å­å ±ï¼Œä½†å¥½åƒæ²’æœ‰çœ‹åˆ°è‡ªå‹•å¯„å‡ºçš„ä¿¡ä»¶ï¼Ÿ æ¡ˆå¤–æ¡ˆ: RFC 8058åŸæœ¬ä»¥ç‚ºè©²æ‡‚å¾—éƒ½æ‡‚äº†ï¼Œä¸€åˆ‡å°±æ˜¯é‚£éº¼çš„å–®ç´”ï¼Œéƒ½åœ¨æˆ‘çš„æŒæ¡ä¹‹ä¸­ã€‚ ç›´åˆ°æˆ‘æ³¨æ„åˆ° Pinkoi çš„é›»å­å ± (X åœ¨å¯¦é©—çš„éç¨‹ä¸­ï¼ŒPinkoi ä¹Ÿåƒ The Hacker News ä¸€æ¨£ï¼Œå¯ä»¥åœ¨ mail ä»‹é¢ä¸­ç›´æ¥å®Œæˆé€€è¨‚ã€‚ä½†ä¸ä¸€æ¨£çš„æ˜¯ï¼Œmail ç³»çµ±æ²’æœ‰è‡ªå‹•å¹«æˆ‘ç”¢ç”Ÿä¸¦å¯„å‡ºé€€è¨‚ç”¨çš„ä¿¡ä»¶ã€‚ â€¦çœ‹ä¾†é€™ç•¶ä¸­ä¸€å®šé‚„æœ‰äº›æˆ‘ä¸çŸ¥é“çš„æ±è¥¿ï¼ æœ‰äº†å…ˆå‰çš„ç¶“é©—ï¼Œé€™æ¬¡å¾ˆå¿«åœ°æŠŠ Pinkoi é›»å­å ±çš„åŸå§‹ä¿¡ä»¶æ‰“é–‹ä¾†çœ‹ï¼Œä¸¦ç›´æ¥æœå°‹ unsubscribe å­—çœ¼ã€‚ä¸€æœä¸å¾—äº†ï¼Œçœ‹åˆ°äº†ä¸€å€‹æ²’åœ¨ RFC 2369 ä¸­å‡ºç¾çš„ header: List-Unsubscribe-Post ã€‚æ‹¿é€™å€‹ header å»æ‰¾ RFCï¼Œçµæœæ‰¾åˆ°äº†é€™å€‹æ±è¥¿ 1234567891011121314Internet Engineering Task Force (IETF) J. LevineRequest for Comments: 8058 Taughannock NetworksCategory: Standards Track T. HerkulaISSN: 2070-1721 optivo GmbH January 2017 Signaling One-Click Functionality for List Email HeadersAbstract This document describes a method for signaling a one-click function for the List-Unsubscribe email header field. The need for this ... â€œSignaling One-Click Functionality for List Email Headersâ€ï¼Œå—¯.. çœ‹ä¾†é€™å°±æ˜¯æˆ‘è¦çš„æ±è¥¿äº†â€¦ åœ¨ç¶“éå¿«é€Ÿåœ°é–±è®€ä¹‹å¾Œï¼Œé€™å€‹ RFC çš„éƒ¨åˆ†å‹•æ©Ÿå¤§æ¦‚æ˜¯é€™æ¨£çš„ é˜²æ¯’è»Ÿé«”ä¸€èˆ¬æœƒæƒéæ‰€æœ‰åœ¨ä¿¡ä»¶å…§çš„ HTTP(S) é€£çµã€‚é›»å­å ±ä¾›æ‡‰å•†ç‚ºäº†é¿å…é˜²æ¯’è»Ÿé«”ä¸å°å¿ƒå¹«ä½¿ç”¨è€…é€€è¨‚ï¼Œé€šå¸¸æœƒæŠŠé€£çµåšæˆéœ€è¦ä½¿ç”¨è€…äº’å‹•çš„ç¶²é ï¼Œåƒæ˜¯åœ¨é é¢ä¸­æ”¾å€‹é¡å¤–çš„ç¢ºèªæŒ‰éˆ•ç­‰ã€‚ä½†æ­¤ä½œæ³•åˆæœƒé€ æˆä¿¡ä»¶è»Ÿé«”æˆ–ä¿¡ä»¶æœå‹™å•†ï¼Œç„¡æ³•åœ¨å–å¾—ä½¿ç”¨è€…çš„åŒæ„å¾Œï¼Œè‡ªå‹•åŒ–çš„å¹«ä½¿ç”¨è€…é€€è¨‚é›»å­å ±ã€‚å› æ­¤ï¼Œéœ€è¦è¨‚å‡ºä¸€å€‹æ¨™æº–çš„æ–¹æ³•ï¼Œè®“ HTTPS çš„é€€è¨‚é€£çµä¹Ÿå¯ä»¥é”æˆä¸€éµé€€è¨‚ã€‚ é€™å‹•æ©Ÿçœ‹èµ·ä¾†æ˜¯å¾ˆæ¸…æ¥šäº†.. (å…¶å¯¦é‚„æœ‰éƒ¨åˆ†æœ‰é—œåƒåœ¾ä¿¡çš„è™•ç†å•é¡Œï¼Œé€™é‚Šå°±ä¸ç¿»è­¯äº†)ã€‚ä¸éç©¶ç«Ÿè©²æ€éº¼åšä¸€éµé€€è¨‚å‘¢ï¼Ÿ æ ¹æ“š RFC 8058 çš„æè¿°ï¼Œä¿¡ä»¶è‹¥è¦ç”¨ HTTPS é€£çµåšä¸€éµé€€è¨‚ï¼Œè‡³å°‘éœ€è¦æ»¿è¶³ä»¥ä¸‹å¹¾é»: List-Unsubscribe header å…§è‡³å°‘æœ‰ä¸€ HTTPS é€£çµ éœ€è¦é¡å¤–æœ‰ List-Unsubscribe-Post headerï¼Œä¸”å…¶å€¼å¿…é ˆç‚º List-Unsubscribe=One-Click å¿…é ˆæœ‰ DKIM ç°½ç« ä¾†é©—è­‰ä¸Šè¿°å…©å€‹æ¬„ä½ ç¬¬ä¸€é»æ˜¯æŒºåˆç†çš„ï¼Œé€™å€‹ RFC æ˜¯ 2017 å¹´å‡ºä¾†çš„ï¼Œå¤§æ¦‚ä¸æœƒæœ‰äººé‚„æƒ³æ¨ HTTP é€£çµäº†ã€‚è€Œç¬¬äºŒé»çš„ List-Unsubscribe-Post headerï¼Œæ˜¯è¦å‘Šè¨´ mail è»Ÿé«”èªª â€œæˆ‘é€™å€‹é€£çµå¯ä»¥åƒ HTTP POST è«‹æ±‚å–”ï¼å–”å°äº†è¨˜å¾— POST éä¾†æ™‚å…§å®¹è¦å¸¶ List-Unsubscribe=One-Click å–”â€ã€‚è‡³æ–¼ç¬¬ä¸‰é»ï¼Œå–®ç´”æ˜¯è¦ç¢ºä¿ä¸Šè¿°å…©å€‹ header æ˜¯æ²’æœ‰è¢«ç«„æ”¹éçš„ã€‚ å› ç‚ºæœ‰è¬›å¥½ client æ‡‰è©²ç”¨ POST æ–¹æ³•å»æˆ³é€™å€‹é€£çµï¼Œæ–¼æ˜¯é›»å­å ±çš„ server å°±å¯ä»¥å¾ˆæ¸…æ¥šçš„åˆ†è¾¨ï¼Œå“ªäº›è«‹æ±‚æ˜¯é˜²æ¯’è»Ÿé«”ä¸å°å¿ƒèª¤ç™¼çš„ï¼Œå“ªäº›è«‹æ±‚æ˜¯ä½¿ç”¨è€…çœŸçš„æƒ³é€€è¨‚æ‰ç™¼çš„ã€‚ä¸”å› ç‚ºæœ‰æ¸…æ¥šçš„è¡¨é”æ„åœ–ï¼Œé€™å€‹ HTTPS POST è«‹æ±‚ä¹Ÿä¸éœ€è¦å›ä¸€å€‹è¦ä½¿ç”¨è€…é¡å¤–äº’å‹•çš„é é¢ï¼Œserver å¯ä»¥åœ¨æ”¶åˆ°è«‹æ±‚å¾Œï¼Œç›´æ¥è™•ç†ä½¿ç”¨è€…çš„é€€è¨‚å‹•ä½œã€‚ 1234567891011# å‡è¨­ä¿¡ä»¶å…§æœ‰ä»¥ä¸‹ headerList-Unsubscribe: &lt;https://example.com/unsubscribe/opaquepart&gt;List-Unsubscribe-Post: List-Unsubscribe=One-Click# é‚£ mail è»Ÿé«”(æä¾›å•†) å¯ä»¥ç°¡å–®é€éä»¥ä¸‹ HTTPS POST å¹«ä½¿ç”¨è€…é€€è¨‚POST /unsubscribe/opaquepart HTTP/1.1Host: example.comContent-Type: application/x-www-form-urlencodedContent-Length: 26List-Unsubscribe=One-Click å¯å–œå¯è³€.. å¯å–œå¯è³€ XDD å…¶ä»–è»Ÿé«”çš„æ”¯æ´æ€§å’Œ Google çš„å·¥äººæ™ºæ…§ç™¼ç¾æœ‰é€™å€‹æ¨™æº–å¾Œï¼Œå…¶å¯¦å¾ˆå¥½å¥‡å…¶ä»–çš„ web mail æˆ–ä¿¡ä»¶è»Ÿé«”å°é€™äº› header çš„æ”¯æ´åº¦å¦‚ä½•ã€‚ç„¡å¥ˆçš„æ˜¯ï¼Œæ²’æ‰¾åˆ°æ¯”è¼ƒå®Œæ•´çš„æ•´ç†çµæœï¼Œä¼¼ä¹ä¹Ÿæ²’å¤šå°‘äººåœ¨æ„é€™å€‹æ±è¥¿ã€‚ XD ä¸éå¾å”¯ä¸€ä¸€ä»½æ‰¾åˆ°çš„è³‡æ–™ä¾†çœ‹ï¼Œåœ¨ iOS Mail, Gmail, Outlook èˆ‡ Yahoo Mail å››è€…ä¸­ï¼Œmailto çš„é€€è¨‚é€£çµéƒ½æœ‰æ”¯æ´ï¼Œè€Œ RFC 8058 æ‰€å®šç¾©çš„ä¸€éµé€€è¨‚å‰‡æ˜¯åªæœ‰ Gmail å¯ä»¥åšåˆ°ã€‚(è‡³å°‘åœ¨ 2018 å¹´ 11 æœˆé‚„æ˜¯å¦‚æ­¤) å¦å¤–ï¼Œæˆ‘ä¹Ÿç™¼ç¾åˆ°ï¼Œå³ä½¿æœ‰äº›ä¿¡ä»¶å®Œå…¨æ²’æœ‰ List-Unsubscribe headerï¼ŒGmail ä»ç„¶å¯ä»¥ç”Ÿå‡ºé€€è¨‚çš„æŒ‰éˆ•çµ¦ä½¿ç”¨è€…æŒ‰ï¼ŒTwitter çš„é€šçŸ¥ä¿¡ä»¶å³æ˜¯ä¸€ä¾‹ã€‚Twitter çš„ä¿¡ä»¶ header å…§æ²’æœ‰ç›¸é—œçš„è³‡è¨Šï¼Œä½† Gmail å¯ä»¥å¾ä¿¡ä»¶å…§æ–‡å…§æŠŠé€€è¨‚çš„é€£çµ parse å‡ºä¾†ã€‚è‡³æ–¼é€™éƒ¨åˆ†æ˜¯ Google å‰å¤§çš„å·¥äººæ™ºæ…§ï¼Œé‚„æ˜¯æœ‰ä¸€äº›æˆ‘é‚„ä¸çŸ¥é“çš„æ¨™æº–å¯åƒè€ƒï¼Œé€™æˆ‘å°±é‚„æ²’ç ”ç©¶åˆ°äº†ã€‚ çµè«–é€™ç¯‡æ–‡ç« åŸºæœ¬ä¸Šæ˜¯æŠŠæŸå€‹é€±æœ«å› ç‚ºä¸‰åˆ†é˜ç†±åº¦è€Œå»å­¸çš„æ±è¥¿è¨˜éŒ„ä¸‹ä¾†ã€‚ä½†éäº†å…©é€±ä¹‹å¾Œå†å›ä¾†çœ‹ï¼Œå…¶å¯¦å¥½åƒä¹Ÿä¸æ˜¯å¤šé‡è¦çš„æ±è¥¿ã€‚å°±ç®—ä»Šå¤©æˆ‘å€‘ä¸çŸ¥é“æœ‰é€™å€‹æ¨™æº–ï¼Œæˆ–æ˜¯æ ¹æœ¬æ²’æ³¨æ„åˆ°æœ‰é€™å€‹åŠŸèƒ½ï¼Œæ—¥å­ä¹Ÿé‚„æ˜¯éå¾—å¾ˆå¥½ (? ä½†æ˜¯.. å°å·¥ç¨‹å¸«æ»¿è¶³è‡ªå·±çš„å¥½å¥‡å¿ƒå¾Œï¼Œå¿ƒä¸­æ‰€ç²å¾—çš„é‚£ç¨®æˆå°±æ„Ÿï¼Œæ˜¯ç„¡å¯å–ä»£çš„ï¼","link":"/2019/08/31/email-one-click-unsubscribe.html"},{"title":"åˆ©ç”¨ GitHub Page ç¶“ç‡Ÿ Blog","text":"å¦‚æœè¦ç”¨ä¸€å¥è©±ä¾†ç°¡å–®èªªæ˜ GitHub Pageï¼Œé‚£åŸºæœ¬ä¸Šå°±æ˜¯ æŒ‡å®šä¸€å€‹ Git ç‰ˆæœ¬åº«ä¾†ä½œç‚ºå­˜æ”¾ç¶²ç«™è³‡æºçš„åœ°æ–¹ï¼Œç„¶å¾Œè®“ GitHub å¹«ä½ æŠŠç¶²ç«™æ¶èµ·ä¾†ã€‚ ä»»ä½•äººåªè¦ç”³è«‹ä¸€å€‹ GitHub å¸³è™Ÿï¼Œéƒ½å¯ä»¥å…è²»çš„äº«æœ‰é€™å€‹æœå‹™ã€‚ ç•¶ç„¶ï¼Œè€ƒé‡åˆ° GitHub åªæ˜¯æŠŠæˆ‘å€‘æ”¾åœ¨ç‰ˆæœ¬åº«ä¸Šçš„æª”æ¡ˆï¼Œè®“åˆ¥äººé€éç€è¦½å™¨ç€è¦½ï¼Œ é‚£ç¨®éœ€è¦ç”¨åˆ°è³‡æ–™åº«çš„å¯äº’å‹•ç¶²ç«™åŸºæœ¬ä¸Šæ˜¯å¾ˆé›£é”æˆã€‚ ä½†è‹¥æˆ‘å€‘åªæ˜¯è¦ç¶“ç‡Ÿä¸€å€‹éƒ¨è½æ ¼ï¼Œæˆ–æ˜¯å­˜æ”¾å°ˆæ¡ˆæ–‡ä»¶ç­‰éœæ…‹ç¶²ç«™æ™‚ï¼ŒGitHub Page å°±æœƒæ˜¯å€‹å¾ˆåˆé©ä¸”æ–¹ä¾¿çš„é¸æ“‡ã€‚ æœ¬æ–‡æœƒç²—æ·ºçš„ä»‹ç´¹å¦‚ä½•åˆ©ç”¨ GitHub Page ä¾†ç¶“ç‡Ÿè‡ªå·±çš„ Blogï¼Œ ä»¥çœå»è‡ªè¡Œæ¶è¨­æ©Ÿå™¨çš„å„ç¨®ç…©æƒ±ã€‚ :D GitHub Page çš„é¡åˆ¥ç›®å‰ GitHub Page æœ‰å…©é¡çš„ç«™å°ï¼Œä¸€é¡æ˜¯ User Pageã€å¦ä¸€é¡æ˜¯ Project Pageã€‚ (å…¶å¯¦é‚„æœ‰ Organization Pageï¼Œä½†é€™é‚Šå°±ä¸èŠ±æ™‚é–“è´…è¿°) User Page èˆ‡ Project Page æœ€ä¸»è¦çš„å·®åˆ¥åœ¨æ–¼å°ˆæ¡ˆåç¨±çš„é™åˆ¶ï¼Œèˆ‡ç¶²ç«™çš„ URL æ ¼å¼é€™å…©é»ã€‚ç°¡å–®æ•´ç†å¦‚ä¸‹ User Page ç‰¹é»: å°ˆæ¡ˆåç¨±é ˆç‚º &lt;username&gt;.github.ioï¼Œå…¶ä¸­ &lt;username&gt; å³ç‚º GitHub å¸³è™Ÿçš„ä½¿ç”¨è€…åç¨±ã€‚ ç«™å°æœƒæ“ºåœ¨ http(s)://&lt;username&gt;.github.io ä¾›ä»–äººç€è¦½ Project Page ç‰¹é»: å°ˆæ¡ˆåç¨±æ²’æœ‰é™åˆ¶ã€‚ è‹¥å‡è¨­å°ˆæ¡ˆåç¨±ç‚º &lt;projectname&gt; å‰‡ ç«™å°æœƒæ“ºåœ¨ http(s)://&lt;username&gt;.github.io/&lt;projectname&gt; ä¾›ä»–äººç€è¦½ å› ç‚ºå°ˆæ¡ˆåç¨±çš„é™åˆ¶ï¼Œä¸€å€‹ GitHub å¸³è™Ÿåªèƒ½æœ‰ä¸€å€‹ User Page ä½†å¯ä»¥æœ‰å¤šå€‹ Project Pageã€‚ æ›´è©³ç´°çš„ä»‹ç´¹è«‹åƒè€ƒ å®˜æ–¹ç¶²ç«™çš„èªªæ˜ GitHub Page ä½¿ç”¨æ–¹å¼GitHub Page çš„ä½¿ç”¨æ–¹å¼ä¹Ÿå¯ä»¥ç°¡å–®åˆ†æˆå…©ç¨®ã€‚ ç¬¬ä¸€ç¨®æ˜¯ç›´æ¥å»ºç½®å¥½çš„æ•´å€‹ç¶²ç«™ç›´æ¥ push åˆ° GitHub ä¸Šï¼Œä¾›ä½¿ç”¨è€…ç€è¦½ã€‚ è‹¥æˆ‘å€‘éœ€è¦æ¶ä¸€å€‹ Blogï¼Œå¯ä»¥å…ˆç”¨ Markdown ç­‰ markup language æ’°å¯«æ–‡ç« ï¼Œ ä¹‹å¾Œåˆ©ç”¨ Jekyll(Ruby)ã€Hugo(Golang) æˆ– Hexo(JS) ç­‰éœæ…‹ç¶²ç«™ç”Ÿæˆå·¥å…·ï¼Œ å»ºå‡ºä¸€å€‹ Blog ç¶²ç«™ä¸¦ push ä¸Šå»ã€‚ åˆæˆ–æˆ‘å€‘éœ€è¦ host ä¸€å€‹å°ˆæ¡ˆæ–‡ä»¶ç«™å°æ™‚ï¼Œå¯ä»¥å°‡ Doxygen æˆ– Sphinx ç­‰å·¥å…· ç”¢ç”Ÿå‡ºçš„ç¶²ç«™æ¨ä¸Š GitHubã€‚ 12345678 + Local Project | GitHub Project | github.io site ++----------+ +--------+ +------+ User| Markup | Build | Site | Push | Site | Browse| config.. | +------&gt; | | +-----&gt; | | +-------&gt;+----------+ +--------+ +------+ å¦‚æœæˆ‘å€‘æ˜¯ä½¿ç”¨ Jekyll ä¾†å»ºç½®æˆ‘å€‘çš„ç¶²ç«™ï¼Œé‚£ GitHub Page æœ‰æä¾›æˆ‘å€‘ç¬¬äºŒç¨®ç”¨æ³•ã€‚ æˆ‘å€‘å¯ä»¥å°‡ Markup å’Œå…¶ä»– Jekyll éœ€è¦çš„è¨­å®šæª” push ä¸Š GitHubï¼Œè®“ GitHub å¹«æˆ‘å€‘ å»ºç½®ç¶²ç«™ï¼Œä¸¦åœ¨ github.io ç¶²åŸŸä¸Šæ”¾å‡ºç¶²ç«™ä¾›äººç€è¦½ã€‚ 12345678 + +Local Project | GitHub Project | github.io site | | + ++----------+ +----------+ +------+ User| Markup | Push | Markup | Build | Site | Browse| config.. | +----&gt; | Config.. | +-----&gt; | | +-------&gt;+----------+ +----------+ +------+ ç¬¬äºŒå€‹åšæ³•çš„ç¼ºé»æ˜¯ï¼ŒGitHub åªæ”¯æ´ Jekyll é€™å¥—å·¥å…·ï¼Œå…¶ä»–åŒæ€§è³ªçš„å·¥å…·çš„ä¸æ”¯æ´ã€‚ ä½†ç›¸å°ä¾†èªªä¹Ÿæœ‰å„ªé»ï¼Œå³æ˜¯æˆ‘å€‘ä¸é ˆæŠŠå·¥å…·å»ºå‡ºçš„ç¶²ç«™å…§çš„æ‰€æœ‰æª”æ¡ˆéƒ½é€²åˆ° commit ä¸­ã€‚ (åœ¨ git project ä¸­çœ‹åˆ°è¨±å¤šç„¡æ„ç¾© diff å¯¦åœ¨ä¸æ˜¯å·¥ç¨‹å¸«æ‰€æ¨‚è¦‹çš„äº‹æƒ… XD) é‡å°é€™å…©å€‹æ–¹å¼çš„æ›´è©³ç´°èªªæ˜ï¼Œä¹Ÿè«‹è¦‹å®˜æ–¹æ–‡ä»¶ ä½¿ç”¨ Jekyll ä¸ä½¿ç”¨ Jekyll ç°¡å–®çš„æµç¨‹èªªæ˜æ¥ä¸‹ä¾†æœƒä»‹ç´¹ä½¿ç”¨ Jekyllï¼Œä¸¦è®“ GitHub å¹«å¿™ build èˆ‡ host ç¶²ç«™çš„ç°¡å–®æ­¥é©Ÿã€‚ åƒç…§ å®˜æ–¹ä»‹ç´¹ çš„èªªæ˜ï¼Œæœ€ç°¡å–®çš„æ–¹å¼ï¼Œå…¶å¯¦åªéœ€è¦ æˆ‘å€‘é»é–‹ project çš„ GitHub è¨­å®šé é¢ï¼Œæ‰¾åˆ° GitHub Page çš„è¨­å®šé¸é …ï¼Œè¨­å®šä¸€å€‹ Jekyll ä½¿ç”¨çš„ä¸»é¡Œï¼Œä¸¦ç”¨ Markdown å¯«ä¸€å€‹é¦–é æ–‡ç« å³å¯ã€‚ ç”¨æ­¤æ–¹æ³•æœƒåœ¨å°ˆæ¡ˆå…§ç”¢ç”Ÿé¦–é çš„ index.md æª”æ¡ˆåŠä¸€å€‹ Jekyll çš„è¨­å®šæª” _config.ymlã€‚ æª”æ¡ˆå…§åƒ…ä¸€è¡Œä½ é¸çš„ä¸»é¡Œåç¨± 1theme: jekyll-theme-minimal ä½†åŸºæœ¬ä¸Šï¼Œä¸€å€‹ å®Œæ•´çš„ Jekyll å°ˆæ¡ˆ ä¸æœƒåªæœ‰é€™å…©å€‹æª”æ¡ˆï¼Œåˆ°æœ€å¾Œæˆ‘å€‘é‚„æ˜¯å¾—æŠŠå…¶ä»–éœ€è¦çš„æª”æ¡ˆç”Ÿå‡ºä¾†ã€‚ æ‰€ä»¥å€‹äººæ¨è–¦ä½¿ç”¨ä¸‹è¿°æ–¹æ³•å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆã€‚ (å‡è¨­æˆ‘å€‘å·²ç¶“è£å¥½ Git å’Œ Jekyll ç­‰å·¥å…·ã€‚) å»ºç«‹ Git å°ˆæ¡ˆ 12mkdir website &amp;&amp; cd websitegit init åœ¨å°ˆæ¡ˆè³‡æ–™å¤¾å»ºç«‹ Jekyll çš„ template æª”æ¡ˆ 1jekyll new . æ­¤æ™‚æ‡‰è©²æœƒçœ‹åˆ° jekyll é è¨­ç”¢ç”Ÿçš„æª”æ¡ˆ 12$ ls404.html about.md _config.yml Gemfile Gemfile.lock index.md _posts å°‡æ‰€æœ‰ç”¢ç”Ÿçš„æª”æ¡ˆ add ä¸¦ commit èµ·ä¾† (è¦ä¸è¦ç•¥é Gemfile.lock çœ‹å€‹äººéœ€æ±‚) 12git add .git commit ä¹‹å¾Œå°‡å°ˆæ¡ˆ push ä¸Š GitHubï¼Œä¸¦è‡³å°ˆæ¡ˆè¨­å®šå…§å•Ÿç”¨ GitHub Page å³å¯ã€‚ æ²’æ„å¤–çš„è©±ï¼Œå¤§æ¦‚åç§’å…§å°±å¯ä»¥åœ¨å°æ‡‰çš„ URL çœ‹åˆ°ç”Ÿæˆå¥½çš„ç¶²ç«™äº†ã€‚ æœ‰é—œ Jekyll çš„å®‰è£èªªæ˜æˆ–å…¶ä»–ç´°éƒ¨è¨­å®šï¼Œå¯åƒè€ƒ å®˜æ–¹ç¶²ç«™ã€‚ åœ¨ GitHub Page æœå‹™ä¸Šä½¿ç”¨å€‹äººå®¢è£½çš„ç¶²å€å¦‚æœä¸æƒ³ä½¿ç”¨ &lt;username&gt;.github.io ä¾†æä¾›è‡ªå·±çš„ç¶²ç«™ï¼Œè€Œæ˜¯é€éè‡ªå·±è³¼è²·çš„åŸŸåï¼Œ æ‰€éœ€çš„éº»ç…©å·®äº‹ GitHub Page ä¹Ÿå¹«æˆ‘å€‘åšå¾—å¥½äº†ã€‚ åœ¨ GitHub å°ˆæ¡ˆé–‹å•Ÿ GitHub Page åŠŸèƒ½å¾Œï¼Œå¯ä»¥çœ‹åˆ°ä¸€å€‹é¡å¤–çš„é¸é … Custom domainï¼Œ å¯ä»¥å¡«å…¥æˆ‘å€‘å¯æ§åˆ¶çš„ DNS hostnameã€‚ å‡è¨­æˆ‘å€‘æƒ³åœ¨ blog.example.com æä¾›æˆ‘å€‘çš„ç¶²ç«™ï¼Œåªéœ€è¦åœ¨ DNS è¨­å®šä¸­åŠ å…¥ä¸€ç­† CNAMEï¼Œå°‡ blog.example.com æŒ‡å‘ &lt;username&gt;.github.ioã€‚ä¸¦å» GitHub Page æ‰€ç”¨çš„ GitHub å°ˆæ¡ˆè¨­å®šé é¢å…§ï¼Œåœ¨ Custom domain æ¬„ä½å…§å¡«å…¥ blog.example.com å³å¯ã€‚ è¨­å®šå®Œå¾Œï¼Œå³å¯é€é blog.example.com ç€è¦½æˆ‘å€‘è¦çš„ç¶²ç«™ã€‚ åŒæ™‚ GitHub ä¹Ÿæœƒåœ¨ä¸€å¤©å…§ç”Ÿå‡ºå°æ‡‰çš„ SSL æ†‘è­‰ï¼Œå³ä½¿é€é blog.example.com ç€è¦½ï¼Œ ä¹Ÿå¯ä»¥äº«æœ‰ HTTPS protocol å¸¶ä¾†çš„å®‰å…¨æ€§ã€‚ :D é›œè«‡å¤§æ¦‚å¾ 2018 åæœˆé–‹å§‹ï¼Œå°å¼Ÿæˆ‘åœ¨èˆ‡æœ‹å‹ä»¥åŠå…¬å¸åŒäº‹è«‡è©±å¾Œï¼Œæ¼¸æ¼¸æœ‰äº†ç¶“ç‡Ÿè‡ªå·± Blog çš„æƒ³æ³•ã€‚ ç¶“æ­·äº†æ•¸é€±çš„æ‹–æ‹‰æ•£æ¼«å¾Œï¼Œçµ‚æ–¼åœ¨ 2018 åäºŒæœˆåº•åˆ·å¡è²·äº†è‡ªå·±çš„ domainï¼Œä¸¦åˆ©ç”¨ GitHub Page æ¶è¨­å¥½ Blogã€‚ä½†å› ç‚ºä¸€ç›´æ²’æƒ³å¥½è¦å¯«ä»€éº¼æ–‡ç« ï¼Œæ–¼æ˜¯ç¬¬ä¸€ç¯‡å°±å…ˆä¾†å¯«å¯« æˆ‘è‡ªå·±çš„æ¶ç«™ç­†è¨˜ã€‚ æœŸè¨±è‡ªå·±æœªä¾†èƒ½ä¸æ–·ç”¢å‡ºæ–°æ–‡ç« ï¼Œæˆç‚ºä¸€ä½æ•£ç™¼æ­£é¢èƒ½é‡çš„ä¸€å€å·¥ç¨‹å¸«ã€‚","link":"/2019/01/12/github-page-blog-howto.html"},{"title":"GitHub Pages èˆ‡ GitLab Pages æ¶è¨­ Blog","text":"ç­†è€…æœ€è¿‘æŠŠå€‹äºº blog çš„ç”¢ç”Ÿå·¥å…·å¾ GitHub Pages é è¨­çš„ Jekyll æ›æˆ Hexoï¼Œæœ‰äº†ä¸€é»å¿ƒå¾—ã€‚ è€Œä¸”ä¸åª GitHub Pagesï¼Œ ç­†è€…åœ¨å…¬å¸æ¥­å‹™ä¸­ä¹Ÿæœ‰å¤§é‡ä½¿ç”¨ GitLab Pages ä¾†ç”¢ç”Ÿæ–‡ä»¶åŠæ¸¬è©¦å ±è¡¨ï¼Œç®—æ˜¯æœ‰ç´¯ç©ä¸å°‘ç¶“é©—ã€‚ è¶è‘—å°è±¡é‚„æ·±åˆ»æ™‚ï¼Œå¯«é»ç­†è¨˜ï¼Œæ›¿é€™å…©å€‹ç›¸åŒæ€§è³ªçš„æœå‹™åšåŸºæœ¬çš„ä»‹ç´¹ã€‚ Pages æœå‹™èˆ‡ Static Site GeneratorGitHub / GitLab Pages å¯ä»¥å°‡ä¸€çµ„éœæ…‹ç¶²é å…§å®¹ (html, css, js ç­‰)ï¼Œé€é GitHub / GitLab çš„ä¼ºæœå™¨ï¼Œhost åœ¨æŸå€‹ URL åº•ä¸‹ã€‚ ç¶²é ç”¢ç”Ÿå·¥å…· (Static Site Generator, ä¸‹ç¨± SSG) å‰‡æ˜¯ ä¸€å€‹å¯ä»¥å°‡ç”¨ Markdown æ’°å¯«çš„æ–‡ç« ï¼Œè½‰åŒ–æˆæ¼‚äº®çš„éœæ…‹ç¶²é å…§å®¹çš„å·¥å…·ã€‚å¸¸è¦‹çš„ SSG æœ‰ Jekyll(Ruby), Hugo(Go), Hexo(JavaScript) ç­‰ã€‚ è‹¥å°‡ SSG å·¥å…·èˆ‡ GitHub / GitLab Pages æœå‹™ï¼Œæ­é…ä½¿ç”¨ï¼Œ å¯«ä½œè€…åªéœ€è¦å¯«å¯«ç°¡å–®çš„ Markdown ä¸¦ push commitï¼Œå°±èƒ½å¾—åˆ°ä¸€å€‹æ¼‚äº®çš„ blog æˆ–æ˜¯æ–‡ä»¶ç¶²é ã€‚ ç­†è€…çš„å€‹äºº blog åŠå…¬å¸çš„å·¥ä½œç­†è¨˜å³æ˜¯ä½¿ç”¨é€™é¡æµç¨‹æ¶è¨­ã€‚ æ•´é«”æµç¨‹å¤§æ¦‚å¦‚ä¸‹åœ–æ‰€ç¤º: 123456789 + GitHub + github.ioLocal Project | Project | site | GitLab | gitlab.io + ++----------+ +----------+ Build &amp; +------+ User| Markup | Push | Markup | Deploy | Site | Browse| config.. | +----&gt; | Config.. | +-------&gt; | | +-------&gt;+----------+ +----------+ +------+ GitHub PagesGitHub Pages åŸºæœ¬ä¸Šæœƒæœ‰å…©ç¨®ä¸»è¦çš„ä½¿ç”¨æ–¹å¼ã€‚ å¯ä»¥ç›´æ¥ä½¿ç”¨ GitHub Pagesï¼Œæˆ–æ˜¯é€é GitHub Pages çš„ Jekyll æ•´åˆåŠŸèƒ½ã€‚ å‰è€…éœ€è¦çš„æŠ€è¡“èƒŒæ™¯èˆ‡è¨­å®šæ­¥é©Ÿå‡è¼ƒè¤‡é›œï¼Œå¾Œè€…è¼ƒç°¡å–®ä½†ç¼ºå°‘äº†æ ¹æ“šå€‹åˆ¥éœ€æ±‚èª¿æ•´çš„æ©Ÿæœƒã€‚ Native GitHub Pagesè‹¥ç›´æ¥ä½¿ç”¨ GitHub Pagesï¼Œä½¿ç”¨æ–¹å¼æ˜¯: å°‡ SSG ç”¢ç”Ÿçš„ç¶²é æ“ºæ”¾è‡³æŸ branch (é è¨­ç‚º gh-pages) çš„ / æˆ– /docs ç›®éŒ„ã€‚ æ¯æ¬¡è©² branch è¢«æ›´æ–°æ™‚ï¼ŒGitHub å°±æœƒå°‡æœ€æ–°ç‰ˆæœ¬çš„ç¶²é å…§å®¹ï¼Œ å‘ˆç¾åœ¨ https://&lt;username&gt;.github.io/&lt;project&gt; é€£çµä¸‹ã€‚ æ—©æœŸé€™å€‹ push brach çš„å‹•ä½œæ˜¯è »éº»ç…©çš„ï¼Œä½†å¾Œä¾†æœ‰äº† GitHub Action ä¹‹å¾Œï¼Œ ç”¢ç”Ÿç¶²ç«™å’Œå¾Œ push branch çš„å‹•ä½œéƒ½å¯ä»¥åœ¨ GitHub æä¾›çš„ç’°å¢ƒå®Œæˆï¼Œéå¸¸æ–¹ä¾¿ã€‚ ç­†è€…å€‹äººä½¿ç”¨çš„ job æè¿°æª”å¦‚ä¸‹: 12345678910111213141516171819202122232425262728# .github/workflows/blog.yamlname: build-and-deploy-blogon: push: branches: [ &quot;master&quot; ] pull_request:jobs: blog: runs-on: ubuntu-20.04 steps: - name: Checkout uses: actions/checkout@v2.3.4 - name: Setup Node.js environment uses: actions/setup-node@v2.1.5 with: node-version: 12.x - name: Install dependent packages run: npm install - name: Build blog posts run: npm run build - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public è‹¥ä¸æƒ³ä½¿ç”¨ GitHub æä¾›çš„ domainï¼Œä¹Ÿå¯ä»¥åƒç…§ å®˜æ–¹æ–‡ä»¶ï¼Œ ä½¿ç”¨è‡ªå·±è³¼è²·çš„ domain ä¾†æ¶è¨­ç¶²ç«™ã€‚ åªè¦è¨­å®šå®Œæˆï¼ŒGitHub ä¹Ÿå¯ä»¥ä¸€ä½µå¹«ä½¿ç”¨è€…ç”³è«‹ custom domain éœ€è¦çš„ HTTPS æ†‘è­‰ã€‚ æ¯”æ–¹èªªç­†è€…çš„ blog åŸæœ¬å¯å­˜å–çš„ä½ç½®æ‡‰æ˜¯ https://wdhongtw.github.io/blogï¼Œä½†æœ‰è¨­å®š custom domain å¾Œï¼Œç›®å‰æ˜¯é€é https://blog.bitisle.net ä¾†å­˜å–æ¶åœ¨ GitHub Pages ä¸Šçš„ blogã€‚ GitHub Pages Jekyllå‰è¿° (Native) GitHub Pages çš„ä½¿ç”¨æ–¹å¼æœƒéœ€è¦è‡ªå·± push branchã€‚ ä½†è‹¥ GitHub åµæ¸¬åˆ° project ä½¿ç”¨çš„ SSG æ˜¯ Jekyllï¼ŒGitHub æœƒè‡ªå‹•è™•ç†ç”¢ç”Ÿç¶²é ä»¥åŠ å¾ŒçºŒéƒ¨å±¬åˆ° https://&lt;username&gt;.github.io/&lt;project&gt; çš„å·¥ä½œã€‚ (é€£ gh-pages branch éƒ½çœäº†ï¼Œæ•´å€‹ project æœƒéå¸¸ä¹¾æ·¨ã€‚) æ­¤æ–¹æ³•ç›¸ç•¶å®¹æ˜“ä¸Šæ‰‹ï¼Œä¹Ÿæ˜¯ GitHub Pages æ•™å­¸æ–‡ä»¶é è¨­çš„ä½¿ç”¨æ–¹å¼ã€‚ä½†å› ç‚ºç”¢ç”Ÿç¶²ç«™çš„ ç’°å¢ƒæ˜¯ç”± GitHub å”åŠ©è™•ç†ï¼Œèƒ½ä½¿ç”¨çš„ Jekyll plugin è‡ªç„¶ä¹Ÿæ˜¯å—åˆ°é™åˆ¶ã€‚ èªªæ˜¯å—åˆ°é™åˆ¶ï¼Œä½†ä»¥ä¸€èˆ¬ä½¿ç”¨æƒ…å¢ƒæ‡‰è©²ä¹Ÿå¾ˆå¤ äº†ã€‚è«¸å¦‚ RSS feed, sitemap, Open Graph metadata ç­‰ç¾ä»£ blog å¿…å‚™çš„åŠŸèƒ½éƒ½æœ‰è‡ªå¸¶ã€‚ è‹¥æƒ³çŸ¥é“æœ‰é‚£äº› Jekyll plugin å¯ç”¨ï¼Œå¯è‡³ Dependency versions | GitHub Pages æŸ¥é–±ã€‚ Compare Native GitHub Page with GitHub Pages and Jekyllç°¡å–®æ¯”è¼ƒä¸Šè¿°å…©ç¨®æ–¹å¼å¦‚ä¸‹ GitHub Page GitHub Page with Jekyll SSG Tool on your choice only Jekyll Deployment push generated site done by GitHub Customization any plugins of SSG limited Jekyll plugin list GitLab PagesGitLab Pages èˆ‡ GitHub Pages ä¸€æ¨£ï¼Œæœ‰å°‡ SSG ç”¢ç”Ÿçš„ç¶²é  host åœ¨ç‰¹å®šç¶²å€çš„èƒ½åŠ›ã€‚ ä»¥ GitLab å®˜æ–¹ host çš„ç«™å°ä¾†èªªï¼Œç¶²ç«™æœƒæ”¾åœ¨ https://&lt;username&gt;.gitlab.io/&lt;project&gt; ä¸‹ã€‚ (ç§äººæˆ–å…¬å¸ host çš„ GitLab instance å°±è¦çœ‹å„è‡ªçš„è¨­å®š) èˆ‡ GitHub ä¸åŒçš„æ˜¯ï¼ŒGitLab Pages ä¸¦ä¸æ˜¯é€é push branch çš„æ–¹å¼éƒ¨å±¬ï¼Œ ä¸”æ²’æœ‰é‡å°ç‰¹å®š SSG æä¾›æ›´é€²ä¸€æ­¥çš„è‡ªå‹•éƒ¨å±¬åŠŸèƒ½ã€‚ GitLab Pages çš„ä½¿ç”¨æ–¹å¼æ˜¯åŸºæ–¼ GitLab CI Pipeline çš„æ¶æ§‹è¨­è¨ˆçš„ã€‚è‹¥æƒ³è¦éƒ¨å±¬ ç¶²ç«™ï¼Œä¸€èˆ¬çš„ä½¿ç”¨æ–¹å¼æ˜¯åœ¨ pipeline å…§ç”¢ç”Ÿç¶²é ï¼Œæ¥è‘—å°‡ç¶²é å…§å®¹æ“ºæ”¾è‡³ç‚ºç‰¹å®š job (pages) çš„ç‰¹å®š artifacts ç›®éŒ„ (public) ä¸­ã€‚ ä¸€æ—¦æœ‰ pipeline jobs é”æˆæ­¤æ¢ä»¶ã€‚ GitLab å°±æœƒ æŠŠç¶²é å…§å®¹éƒ¨å±¬åˆ°å°æ‡‰çš„ç¶²å€ä¸‹ã€‚ ç­†è€…å€‹äººä½¿ç”¨çš„ job æè¿°æª”å¦‚ä¸‹: (å› ç‚º GitHub Action èˆ‡ GitLab CI çš„æ¶æ§‹å·®ç•°ï¼Œå¯«èµ·ä¾†æ¯”è¼ƒç°¡æ½”) 12345678910111213# .gitlab-ci.ymlpages: image: ruby:3.0.1 stage: deploy before_script: - bundle install script: - bundle exec jekyll build --destination public --baseurl &quot;$CI_PAGES_URL&quot; artifacts: paths: - public only: - master è‡³æ–¼å…¶ä»– GitHub Pages æœ‰çš„åŠŸèƒ½ï¼Œå¦‚ custom domainï¼Œè‡ªå‹•ç”³è«‹ HTTPS æ†‘è­‰ç­‰ï¼ŒGitLab Pages ä¹Ÿéƒ½æœ‰ã€‚ è¨˜å¾—å» project è¨­å®šé é¢è¨­å®šå³å¯ã€‚ Conclusionåœ¨ 2008 å¹´ GitHub Pages å‰›æ¨å‡ºæ™‚ï¼Œä½¿ç”¨è€…éƒ½è¦è‡ªå·±æ‰‹å‹• push gh-pages branchã€‚ å¾Œä¾† GitLab æ¨å‡ºåŸºæ–¼ GitLab CI çš„ Pages æœå‹™ä¹‹å¾Œï¼ŒGitHub Pages ä½¿ç”¨é«”é©—ç›¸è¼ƒä¹‹ä¸‹å¯èªªæ˜¯éå¸¸ç³Ÿç³•ã€‚ ä½†å¾Œä¾†éš¨è‘— GitHub Actions æœå‹™æ¨å‡ºï¼Œä»¥åŠç¤¾ç¾¤ç¶­è­·çš„é«˜å“è³ª Pages éƒ¨å±¬ Action å‡ºç¾ã€‚ GitHub / GitLab Pages çš„ä½¿ç”¨é«”é©—å·²ç¶“è®Šå¾—ç›¸ç•¶æ¥è¿‘ã€‚ å…¶ä»–åƒæ˜¯ custom domain ä»¥åŠ HTTPS çš„æ”¯æ´ä¹Ÿéƒ½æ˜¯å…è²»çš„åŸºæœ¬åŠŸèƒ½ã€‚ åŸºæ–¼ä¸Šè¿°åŸå› ï¼Œè¨±å¤šæ—©æœŸçš„ æ¯”è¼ƒæ–‡ç«  å…¶å¯¦å·²ç¶“æ²’ä»€éº¼åƒè€ƒåƒ¹å€¼ã€‚ è‹¥ç¾åœ¨æƒ³æ¶è¨­æ–°çš„ blog ç­‰ç«™å°ï¼Œåªè¦é¸æ“‡è‡ªå·±ç¿’æ…£çš„å¹³å°å³å¯ã€‚ References GitHub Pages Documentation - GitHub Docs GitLab Pages | GitLab","link":"/2021/06/06/github-pages-gitlab-pages.html"},{"title":"GitHub å³æ—¥èµ·æ”¯æ´ä½¿ç”¨ Security Key é€²è¡Œ Git æ“ä½œ","text":"GitHub é–‹å§‹æ”¯æ´ä½¿ç”¨ security key é€²è¡Œ Git æ“ä½œå•¦ï¼ é€™æ‡‰è©²æ˜¯å„å®¶ç§‘æŠ€å·¨é ­ç•¶ä¸­ï¼Œç¬¬ä¸€å€‹æ”¯æ´ security key é€²è¡Œ SSH login çš„æœå‹™å§ã€‚ ç­†è€…æ˜¨å¤© 5/10 æ‰åœ¨å…¬å¸å…§åˆ†äº«å¦‚ä½•ä½¿ç”¨ security key ä¾†åš SSH loginï¼Œ æ²’æƒ³åˆ° Yubico å’Œ GitHub ä¹Ÿå‰›å¥½åœ¨æ˜¨å¤©ä¸€èµ·åŒæ­¥æ›´æ–° blog æ–‡ç« ï¼Œé€šçŸ¥å¤§å®¶é€™å€‹æ–°åŠŸèƒ½ã€‚ å–œæ¥µè€Œæ³£.. Security keys are now supported for SSH Git operations - The GitHub Blog GitHub now supports SSH security keys - Yubico ä»¥ä¸‹ç°¡å–®ä»‹ç´¹å¦‚ä½•ä½¿ç”¨é€™å€‹æ–°åŠŸèƒ½ã€‚ ç‚ºäº†æ–¹ä¾¿è§£èªªåŠé¿å…èª¤æœƒï¼Œå¾Œè¿°å…§å®¹å‡ä»¥æ­£å¼åç¨± authenticator ä»£ç¨± security keyã€‚ å¦‚ä½•ä½¿ç”¨é¦–å…ˆç•¶ç„¶è¦æœ‰ä¸€æŠŠ authenticatorï¼Œå¦‚æœé‚„æ²’æœ‰ï¼Œè¶•å¿«å»è²·ä¸€æŠŠå›‰ã€‚ :D ç¬¬ä¸€æ­¥ï¼Œåœ¨ authenticator å…§ç”¢ç”Ÿæ–°çš„ key pairã€‚ ç”¢ç”Ÿ key pair çš„æµç¨‹å’Œå‚³çµ±æ”¾åœ¨æª”æ¡ˆç³»çµ±ä¸Šçš„å·®ä¸å¤šï¼Œåªæ˜¯ key type è¦æŒ‡å®šä»£è¡¨ authenticator çš„ typeã€‚ 1ssh-keygen -t ecdsa-sk ç”¢ç”Ÿçš„éç¨‹ï¼Œæ ¹æ“šä¸åŒçš„ authenticatorï¼Œæœƒæœ‰è¦æ±‚æŒ‰ä¸€ä¸‹ ä¸”/æˆ– è¼¸å…¥ PIN code é©—è­‰èº«åˆ†ã€‚ æ­¤æ­¥é©Ÿæœƒåœ¨ authenticator å…§ç”¢ç”Ÿä¸€çµ„ key pairï¼Œä¸¦å°‡ public key å¯«åˆ°æª”æ¡ˆç³»çµ±ä¸Šã€‚ å¹³å¸¸æ”¾ private key çš„é‚£å€‹æª”æ¡ˆé‚„æ˜¯æœƒç”¢ç”Ÿï¼Œä¸éé€™æ¬¡è£¡é¢æ”¾çš„æœƒæ˜¯ä¸€å€‹ key handleã€‚ ç¬¬äºŒæ­¥ï¼Œé€é GitHub çš„ web UI ä¸Šå‚³ public key ä¸Šå‚³å®Œä¹‹å¾Œï¼Œæ²’æ„å¤–å°±å¯ä»¥é †åˆ©ä½¿ç”¨äº†ï¼Œå¯ä»¥è©¦è‘— clone ä¸€äº› project 1234$ git clone git@github.com:github/secure_headers.gitCloning into 'secure_headers'...Confirm user presence for key ECDSA-SK SHA256:........User presence confirmed è‹¥ç¢ºèª OKï¼Œä¹‹å¾Œçš„ Git æ“ä½œéƒ½å¯ä»¥é€ééš¨èº«æ”œå¸¶çš„ authenticator ä¿è­·ï¼Œ åªè¦æŒ‰ä¸€ä¸‹ authenticator å³å¯ã€‚ è¨­å®šå®Œä¹‹å¾Œï¼Œè‹¥æ²’æœ‰æ‹¿å‡º authenticatorï¼Œå°±ä¸èƒ½é€²è¡Œ push / pull æ“ä½œã€‚ åªè¦ç¢ºä¿ authenticator é‚„åœ¨èº«ä¸Šï¼Œå°±å¯ä»¥å®‰å¿ƒç¡å¤§è¦ºã€‚ (å†ä¹Ÿä¸ç”¨æ“”å¿ƒ private key æ”¾åœ¨å…¬å¸é›»è…¦ä¸Šæœƒè¢«æ‘¸èµ°äº†ï¼) é€²éšä½¿ç”¨æ–¹å¼FIDO 2 authenticator åšå¤§ç²¾æ·±ï¼Œé™¤äº†ä¸Šè¿°çš„åŸºæœ¬ä½¿ç”¨æµç¨‹å¤–ï¼Œé‚„æœ‰äº›ç´°ç¯€å¯ä»¥è¨­å®šã€‚ ä»¥ä¸‹åˆ†åˆ¥ä»‹ç´¹ä¸‰å€‹é€²éšä½¿ç”¨æŠ€å·§ï¼š è¦æ±‚èº«åˆ†é©—è­‰ (User Verification) æ‰èƒ½ä½¿ç”¨ Authenticatoræ ¹æ“šæ¯å€‹äººå¹³å¸¸ä¿ç®¡é‘°åŒ™ç¿’æ…£çš„å·®ç•°ï¼Œå¯èƒ½æœ‰äººæœƒæ“”å¿ƒ authenticator çœŸçš„è¢«æ‘¸èµ°ã€‚ ä½† authenticator ä¹Ÿæœ‰æ”¯æ´ä¸€å®šè¦é©—ç”šèº«åˆ† (e.g. PIN code or æŒ‡ç´‹è¾¨è­˜) å¾Œæ‰èƒ½ ä½¿ç”¨å…§éƒ¨çš„ key pair çš„åŠŸèƒ½ã€‚ è¦å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ åªè¦åœ¨ç”¢ç”Ÿ key pair çš„éç¨‹ä¸­å¤šä¸‹ä¸€å€‹ flag å³å¯ã€‚ 1ssh-keygen -t ecdsa-sk -O verify-required è‹¥ä¹‹å¾Œè¦ä½¿ç”¨ç”±æ­¤æ–¹å¼ç”¢ç”Ÿçš„ key pairï¼Œé™¤äº†æ‰‹æŒ‡æŒ‰ä¸€ä¸‹ authenticator ä¹‹å¤–ï¼Œé‚„æœƒè¦æ±‚ ä½¿ç”¨è€…è¼¸å…¥ PIN code æ‰èƒ½é †åˆ©å®Œæˆæ“ä½œã€‚å¦‚æ­¤å³ä½¿ authenticator è¢«å·èµ°äº†ï¼Œä¹Ÿä¸ç”¨å¤ªç·Šå¼µã€‚ å…¨è‡ªå‹•ä½¿ç”¨ Authenticator (é¿å… User Presence Check)è‹¥æŠŠ authenticator æ’ä¸Šé›»è…¦å¾Œï¼Œæƒ³è¦éš¨æ™‚éš¨åœ°éƒ½é€²è¡Œ push / pullï¼Œ ä½†ä¸è¦æ¯æ¬¡éƒ½æ‰‹æŒ‰ä¸€ä¸‹ authenticatorã€‚é€™ç¨®è‡ªå‹•åŒ–çš„ä½¿ç”¨æƒ…å¢ƒ OpenSSH å…¶å¯¦ä¹Ÿæ˜¯æœ‰æ”¯æ´çš„ã€‚ ä½¿ç”¨çš„æ–¹å¼ä¹Ÿæ˜¯åœ¨ç”¢ç”Ÿ key pair æ™‚å¤šå¸¶ä¸€å€‹åƒæ•¸ã€‚ 1ssh-keygen -t ecdsa-sk -O no-touch-required åŒæ™‚åœ¨å°‡ public key éƒ¨å±¬åˆ°ç›®æ¨™æ©Ÿå™¨ä¸Šæ™‚ï¼Œåœ¨ public key è©²è¡Œå‰é¢å¤šä¸‹ no-touch-required å³å¯ã€‚ (è©³æƒ…è«‹è¦‹ ssh-keygen(1) åŠ sshd(8)) ä»¥æ­¤æ–¹å§‹ç”¢ç”Ÿçš„ key pair åœ¨ä½¿ç”¨æ™‚å°±ä¸éœ€è¦æ¯æ¬¡éƒ½æ‰‹æŒ‰ä¸€ä¸‹ï¼Œå¯ä»¥å…¨è‡ªå‹•ä½¿ç”¨ã€‚ ä¸éï¼Œé›–ç„¶ OpenSSH æœ‰æ”¯æ´æ­¤ç¨®ä½¿ç”¨æƒ…å¢ƒï¼Œä½†ç›®å‰ GitHub ç¦æ­¢é€™ç¨®ä½¿ç”¨æ–¹å¼ã€‚ ç¯€éŒ„è‡ªä¸Šè¿° blog æ–‡ç«  While we understand the appeal of removing the need for the taps, we determined our current approach to require presence and intention is the best balance between usability and security. æ‰€ä»¥åœ¨ GitHub ä¸Šï¼Œè‹¥æƒ³è¦å…¨è‡ªå‹•æ“ä½œï¼Œåªèƒ½å›å»ç”¨ä¸€èˆ¬çš„ SSH key æˆ– API token å›‰ã€‚ é¿å…æ‰‹å‹•è¤‡è£½ Key Handleå‰é¢æœ‰æåˆ°ï¼ŒåŸå…ˆæª”æ¡ˆç³»çµ±ä¸Šç”¨ä¾†æ”¾ private key çš„æª”æ¡ˆæœƒè®Šæˆæ‹¿ä¾†æ“ºæ”¾ key handleã€‚ é€™æ„å‘³è‘—ï¼Œç•¶æˆ‘å€‘æƒ³åœ¨æ–°çš„æ©Ÿå™¨ä¸Šé€é SSH é€²è¡Œ Git æ“ä½œæ™‚ï¼Œé™¤äº†æ‹¿å‡º authenticator ä¹‹å¤–ï¼Œ ä¹Ÿéœ€è¦æŠŠåŸå…ˆçš„ key handle æª”æ¡ˆè¤‡è£½åˆ°æ–°çš„æ©Ÿå™¨ä¸Šã€‚ ä¸”è‹¥ key handle æª”æ¡ˆæ‰äº†ï¼Œè©²çµ„ key pair å°±ä¸èƒ½ä½¿ç”¨äº†ã€‚ è‹¥è¦é¿å…æ­¤å•é¡Œï¼Œå°±è¦ç”¨ä¸Š authenticator çš„å¦ä¸€å€‹é€²éšåŠŸèƒ½ discoverable credentials / resident keys ã€‚ 1ssh-keygen -t ecdsa-sk -O resident ä½¿ç”¨æ­¤é¡å‹çš„ key pair æ™‚ï¼Œæœƒåœ¨ authenticator ä¸Šæ¶ˆè€—ä¸€äº›å„²å­˜ç©ºé–“ã€‚ä½†æ›ä¾†çš„å¥½è™•æ˜¯ï¼Œ ä½¿ç”¨è€…å¯ä»¥åœ¨æ–°çš„æ©Ÿå™¨ä¸Šï¼ŒæŠŠ key handle å¾ authenticator å…§æŠ½å‡ºä¾†ã€‚ 1ssh-keygen -K # extract discoverable credentials å¦‚æ­¤å°±ä¸ç”¨æ‰‹å‹•è¤‡è£½æ“ºæ”¾ key handle çš„ private key æª”æ¡ˆäº†ã€‚ ä½†è¦æ³¨æ„çš„æ˜¯æ­¤é¡å‹ key pair æœƒæ¶ˆè€— authenticator çš„ç©ºé–“ã€‚ æ¯æŠŠ authenticator å¯ä»¥æ”¾å¤šå°‘ key pair è¦å†è‡ªè¡ŒæŸ¥é–±å®˜æ–¹æ–‡ä»¶ã€‚ çµèªä»¥ä¸Šä»‹ç´¹äº†åŸºæœ¬ä½¿ç”¨æƒ…å¢ƒåŠä¸‰ç¨®å¯èƒ½çš„é€²éšä½¿ç”¨æ–¹å¼ã€‚ ç­†è€…åœ¨ 2014 å¹´ç¬¬ä¸€æ¬¡æ³¨æ„åˆ° FIDO (U2F) æ¨™æº–ï¼Œç•¶æ™‚å°±åœ¨æƒ³åƒæ²’æœ‰å¯†ç¢¼çš„ä¸–ç•Œã€‚ å¦‚ä»Šï¼Œè—‰ç”± FIDO 2 security key çš„æ™®åŠï¼Œç•¶åˆæ‰€æƒ³çš„ç¾å¥½é¡˜æ™¯ä¼¼ä¹åœ¨æ…¢æ…¢åœ°å¯¦ç¾ä¸­.. å¸Œæœ›æœªä¾†èƒ½çœ‹åˆ° security key é‹ç”¨åœ¨æ›´å¤šå ´æ™¯ä¸Šï¼","link":"/2021/05/11/github-ssh-fido-key.html"},{"title":"GitLab æ›´æ›è‡ªå®¶ GPG Key","text":"ä»Šå¤© GitLab åœ¨è‡ªå®¶ blog ä¸Šå…¬å‘Š revoke ç°½ç½² package çš„ GPG keyã€‚ We recently became aware of an instance where this key and other tokens used to distribute official GitLab Runner packages and binaries were not secured according to GitLabâ€™s security policies. We have not found any evidence of unauthorized modification of the packages or access to the services storing them. ä¸¦ä¸æ˜¯å› ç‚º key è¢« compromiseï¼Œåƒ…æ˜¯å› ç‚º key ä¸ç¬¦åˆå…¬å¸çš„å®‰å…¨è¦ç¯„ï¼Œæ‰€ä»¥å°±é€²è¡Œäº†ä¸€æ¬¡ rekeyã€‚ GPG key rekey ä¸¦ä¸å¦‚æ›æ†‘è­‰ä¸€æ¨£ï¼Œåªè¦é‡ç°½ä¸€å¼µå°±å¥½ (å› ç‚ºä¿¡è³´å»ºç«‹åœ¨å·²çŸ¥çš„ç¬¬ä¸‰æ–¹ CA ä¸Š)ã€‚ GPG key rekey éœ€è¦é€éå¯ä¿¡ç®¡é“é‡æ–°å®£å‘Š fingerprint ä¸¦è«‹å¤§å®¶ import æ–°çš„ keyã€‚ é€™å€‹è½‰æ›çš„æˆæœ¬ï¼Œç›¸è¼ƒæ›æ†‘è­‰æ‡‰æ˜¯é«˜éå¸¸å¤šä¸”é›£ä»¥é‡åŒ–çš„ã€‚ æ²’æƒ³åˆ°å±…ç„¶åƒ…ç‚ºäº†ä¸åˆå®‰å…¨è¦ç¯„å°±é€²è¡Œ rekeyï¼Œä¸æ„§æ˜¯åœ‹éš›ä¸€ç·šçš„è»Ÿé«”å…¬å¸ï¼ See: The GPG key used to sign GitLab Runner packages has been rotated | GitLab","link":"/2021/06/17/gitlab-revoke-gpg-key.html"},{"title":"Google æ›´æ–° Go çš„ç¤¾ç¾¤è¡Œç‚ºæº–å‰‡","text":"æ˜¨å¤© Go blog ä¸Šå‡ºæ–°æ–‡ç« ï¼Œèªªè¦æ›´æ–° Code of Conductã€‚ ä¸€ç›´ä¸€ä¾†è¦ºå¾—æ¯å€‹ç¤¾ç¾¤çš„ CoC éƒ½å¯«å¾—å·®ä¸å¤šï¼Œä¸å¤–ä¹æ˜¯è¦äº’ç›¸å°Šé‡ã€é–‹æ”¾é€æ˜ã€å»ºè¨­æ€§ç™¼è¨€ç­‰ç­‰ã€‚ ä¹Ÿå› ç‚ºéƒ½å·®ä¸å¤šï¼Œå¹³å¸¸ä¹Ÿä¸æœƒå»ç´°çœ‹ã€‚åæ­£å°±æ˜¯äº›æ­£å¸¸äººè©²æœ‰çš„é“å¾·è§€ã€‚ å› æ­¤ï¼Œçœ‹åˆ°èªªè¦æ›´æ–° Code of Conduct è®“æˆ‘æ„Ÿåˆ°æœ‰é»å¥½å¥‡ã€‚ è®€ä¸€è®€è®€ä¸‹å»ï¼Œå…¶å¯¦é€™æ¬¡ Go community çš„ CoC å°±æ˜¯æ–°å¢ä¸€æ¢ï¼š Be responsible. What you say and do matters. Take responsibility â€¦ æ²’æƒ³åˆ°é€£é€™å€‹éƒ½è¦å¯«é€² CoC â€¦ã€‚å¯èƒ½ Go çš„æ ¸å¿ƒé–‹ç™¼åœ˜éšŠçœ‹ issue çœŸçš„çœ‹åˆ°å¿ƒç´¯äº†ï¼Ÿ XD See: Code of Conduct Updates - go.dev","link":"/2021/09/23/golang-coc-update.html"},{"title":"Golang 1.18 Generics çµ‚æ–¼ä¾†è‡¨","text":"ä»Šå¤© Golang 1.18 çµ‚æ–¼æ­£å¼é‡‹å‡ºå•¦ï¼ æˆ‘å€‘çµ‚æ–¼æœ‰è¾¦æ³•åœ¨ Golang è£¡åš generic programming å•¦ï¼ Golang æ˜¯ä¸€å€‹è¿‘ 10 å¹´å¿«é€Ÿç«„ç´…çš„ç¨‹å¼èªè¨€ï¼Œä½†åœ¨å¾ˆå¤šé¢å‘å…¶å¯¦é‚„æ˜¯éå¸¸åœŸç‚®ã€‚ å¾—é å¾ŒçºŒç¤¾ç¾¤ä¸æ–·çš„è¨è«–èˆ‡è²¢ç»æ‰é”åˆ°ä¸€å€‹æ¯”è¼ƒå®Œå–„çš„æ°´æº–ã€‚ åƒæ˜¯.. context package in Golang 1.7: è§£æ±º long job cancelling çš„å•é¡Œ errors package in Golang 1.13: æ»¿è¶³å…¶ä»–èªè¨€å¸¸è¦‹çš„ error åµŒå¥—éœ€æ±‚å’Œæä¾›çµ±ä¸€çš„åˆ¤æ–·æ–¹å¼ Generic support in Golang 1.18: æä¾›é–‹ç™¼è€…å¯¦ä½œå„ç¨®å‹ç„¡é—œæ¼”ç®—æ³•çš„æ©Ÿæœƒ ä¸€ç›´ä»¥ä¾†ï¼Œåœ¨ Golang çš„æ¨™æº–å‡½å¼åº«ä¸­ï¼Œç¢°åˆ°é¡å‹ç„¡é—œçš„æŠ½è±¡å•é¡Œæ™‚ï¼Œæœ€å¾Œçµ¦å‡ºä¾†çš„è§£æ³•å¤§æ¦‚å°±å…©ç¨® æ‰€æœ‰ input / output åƒæ•¸éƒ½å®šç¾©æˆ interface{}ï¼Œå¤§å®¶ä¸€èµ·æŠŠå‹åˆ¥æª¢æŸ¥å¾€ run-time ä¸Ÿ åŒä¸€å€‹ class / function å°æ–¼å¸¸ç”¨çš„ data type é€šé€šå¯¦ä½œä¸€é å‰è€…æœ€å…¸å‹çš„å¤§æ¦‚å°±æ˜¯ sync é€™å€‹å‡½ç¤ºåº«ï¼Œå¾Œè€….. å¤§å®¶æ‡‰è©²éƒ½çœ‹éé‚£å€‹æ…˜ä¸å¿ç¹çš„ sort.. ä¸éé€™äº›éƒ½æ˜¯éå»å¼äº†ï¼Œå¾ä»Šå¤©é–‹å§‹ï¼Œå¤§å®¶éƒ½å¯ä»¥å¯«è‡ªå·±æƒ³è¦çš„ generic code / library / frameworkã€‚ :D UsageåŸºæœ¬èªæ³•å¾ˆç°¡å–®ï¼Œåªè¦åœ¨æƒ³åšæˆ generic çš„ function / struct å¾Œé¢å¤šåŠ ä¸€å€‹ [T TypeName] å³å¯ï¼Œ TypeName æ˜¯ç”¨åŸæœ¬å°±æœ‰çš„ interface{...} èªæ³•ä¾†è¡¨ç¤ºï¼Œå¯ä»¥è‡ªå·±æè¿°é€™å€‹ generic function / struct æ”¯æ´çš„å‹æ…‹å¿…é ˆæ»¿è¶³ä»€éº¼æ¨£çš„ä»‹é¢ã€‚ ä»¥ Python style çš„ sort by key ç•¶ä¾‹å­ã€‚ æˆ‘å€‘å¯ä»¥å®šç¾©ä¸€å€‹ generic çš„ sort functionï¼Œä¸¦ä¸”æ˜å®šé€é€²ä¾†çš„ list å…§çš„æ¯å€‹å…ƒç´ éœ€è¦æ”¯æ´ä¸€å€‹ Key å‡½ç¤ºï¼Œ ä½œç‚ºæ’åºæ™‚çš„æ ¹æ“šã€‚ ç¯„ä¾‹ code å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738package maintype Keyable interface { Key() int}func Sort[T Keyable](items []T) []T { if len(items) &lt;= 1 { return items } pivot := items[0] less, greater := []T{}, []T{} for _, item := range items[1:] { if item.Key() &lt; pivot.Key() { less = append(less, item) } else { greater = append(greater, item) } } return append(append(less, pivot), greater...)}type Person struct { Name string Age int}func (n Person) Key() int { return n.Age}func main() { persons := []Person{{Name: &quot;alice&quot;, Age: 33}, {Name: &quot;bob&quot;, Age: 27}} persons = Sort(persons)} åœ¨é€™å€‹ç¯„ä¾‹ä¸­ï¼ŒSort è¦æ±‚é€é€²ä¾†çš„ []T ç•¶ä¸­çš„ T è¦å¯¦ä½œ Keyable ä»‹é¢ (æä¾› Key method)ã€‚ ç•¶æˆ‘å€‘æƒ³æ’åºä¸€å † Person æ™‚ï¼Œæˆ‘å€‘å¯ä»¥åœ¨é€™å€‹ Person ç‰©ä»¶ä¸Šå®šç¾© Key methodï¼Œå–å‡º Person çš„å¹´é½¡ã€‚ å®Œæˆä¹‹å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ä¾å¹´é½¡ä¾†æ’åº []Person äº†ã€‚ æœŸè¨±è‡ªå·±æœªä¾†å¯ä»¥å¤šåŠ åˆ©ç”¨é€™å€‹é²ä¾†çš„åŠŸèƒ½.. XD References Go 1.18 Release Notes Tutorial: Getting started with generics","link":"/2022/03/16/golang-generics-coming.html"},{"title":"Golang 1.23 Iterator Functions","text":"For a long long long time, Golang have no standard way to represent a iterable sequence. C++ has range adaptor and iterator (although not strictly typed, only by concept), Python has iterable/iterator by __iter__/__next__, JavaScript has standardized for-of and Symbol.iterator since ES6. Now itâ€™s time for Golang. Starting from Golang 1.23 Aug., we have iterator functions. How It Works.Sample code explains faster. 1234567891011121314151617181920func Iota() func(yield func(idx int) bool) { return func(yield func(idx int) bool) { idx := 0 for { if !yield(idx) { return } idx += 1 } }}func main() { for idx := range Iota() { if idx == 3 { break } fmt.Println(idx) // print 0 1 2 }} According to Go 1.23 Release Notes Now the range keyword accept three kinds of functions, for which takes another yield function that yield zero/one/two values. 123func(func() bool)func(func(K) bool)func(func(K, V) bool) The loop control variable and the body of the for-loop is translated into the yield function by language definition. So we can still write imperative-style loop structure even though we are actually doing some functional-style function composition here. Why Do We Need This?Standardize the iterable/iterator interface is a important pre-condition for lazy evaluation. For example, how should we do when we need to iterates through all non-negative integer, and doing some map/filter/reduce on them? It waste space to allocate a list for all these integers (if possible). Someone may say â€œwe already have channel typesâ€. Well, but that requires a separate coroutine instance. We probably donâ€™t want such heavy cost every time we are doing some iterate operations. Also a separate coroutine means additional synchronization and lifecycle control. For example, how can we terminate the Count coroutine when we need early break in loop? 1234567891011121314151617181920func Count(start int) chan int { output := make(chan int) go func() { idx := start for { output &lt;- idx idx += 1 } }() return output}func main() { for idx := range Count(0) { if idx == 10 { break } fmt.Println(&quot;Loop: &quot;, idx) }} We need some mechanism like context object or another channel right? Thatâ€™s a burden for such easy task here. On the other hand, iterator functions are just ordinary function that accept another function to yield/output the iterated values, so itâ€™s much lightweight than a separate coroutine. We want fast program, right? :D The Stop DesignFor languages like Python and JavaScript, the iterator function (or generator in Python terms) is paused and the control is transfer back to the function that iterates the values. When break/return happens and no more value are required, the iterator function just got collected by the runtime since that there are no more references to the function object. But how do we early break the iteration process, if the control is transfer into the iterator function? Letâ€™s look at the function signature again. (Take one value iterator function for example). 1func(yield func(idx int) bool) The yield function returns a bool to indicate that whether the loop body does reach the end, or encounter a break statement. So in normal case, we continue to next possible value after yield return, but if we got false from yield, our iterator function can return immediately. Ecosystem around IteratorThe beauty of iterator only appears if the ecosystem, or we say, the common operations around iterator are already implemented in standard library. That means: Conversion from and to standard container types, like slice map and chan Operations and compositions of iterators, e.g. map/filter/reduce/chain/take â€¦ In Python, there are generator expressions, which evolves implicit map/filter. reduce is a function at global scope, also there are many useful functions in itertools package, e.g. pairwise, batched, chain. Most builtin container types takes iterable as first argument in itâ€™s constructor. In Golang, the first part is mostly done along the release of Golang 1.23. For example, to convert slice from and to iterator, we can use slices.Collect and slices.Values. For second part, there is a plan to add x/exp/xiter package under golang.org namespace. There should be at least Concat, Map, Filter, Reduce, Zip â€¦ once itâ€™s released. But unfortunately itâ€™s not compete yet. See: iter: new package for iterators Â· Issue #61897 Â· golang/go Also I create a toy package github.com/wdhongtw/mice/flow to address some important building wheel around iterators Empty/Pack return a iterator for zero/one value Any/All short-circuit lazy evaluation of a predicate on a sequence of values Forward/Backward absorb input and iterate in reversed order. For example, if we want to define a iterator function for a binary tree in recursive manner, we can use Empty and Pack together with Chain to implement this easily. 123456789101112131415161718type Node struct { val int left *Node right *Node}func Traverse(node *Node) iter.Seq[int] { // Empty is useful as base case during recursive generator chaining. if node == nil { return Empty[int]() } // Pack is useful to promote a single value into a iterable for chaining. return Chain( Traverse(node.left), Pack(node.val), Traverse(node.right), )} Looks cool, doesnâ€™t it? :D","link":"/2024/08/22/golang-iterator-functions.html"},{"title":"å»¶é•·æˆ–ç¸®çŸ­ GPG é‡‘é‘°çš„éæœŸæ™‚é–“ (Expiration Time)","text":"ç­†è€…åœ¨ 2018 å¹´çš„æ™‚å€™é–‹äº†ç¬¬ä¸€å€‹çœŸçš„æœ‰åœ¨é•·æœŸä½¿ç”¨çš„ GPG é‡‘é‘°ã€‚ å› ç‚ºå¹´å°‘è¼•ç‹‚ä¸æ‡‚äº‹ï¼Œç•¶æ™‚ç‰¹åˆ¥æŠŠ primary key è¨­å®šæˆæ°¸é ä¸æœƒéæœŸã€‚ ä½†æ¼”ç®—æ³•å¯èƒ½åœ¨æœªä¾†è¢«ç™¼ç¾æ¼æ´ï¼Œé›»è…¦çš„é‹ç®—èƒ½åŠ›ä¹Ÿæœƒè¶Šä¾†è¶Šå¥½ï¼Œ ä¸€æŠŠä¸æœƒéæœŸçš„ GPG é‡‘é‘°æ˜¯å…ˆå¤©ä¸Šä¸åˆç†çš„å­˜åœ¨ã€‚ è€ƒé‡åˆ°æ­¤å•é¡Œï¼Œç­†è€…å¾Œä¾†åˆå†ä¿®æ­£äº†è©²é‡‘é‘°çš„éæœŸæ™‚é–“ï¼Œ ä»¥åŠæ•´ç†é€™ç¯‡ç­†è¨˜â€¦ GPG Key å¯ä»¥å»¶å±•éæœŸæ™‚é–“ï¼Ÿæˆ‘æƒ³é€™æ‡‰è©²æ˜¯ç†Ÿæ‚‰ X.509 æ†‘è­‰ç”Ÿæ…‹ç³»çš„äººæœ€ç‚ºé©šè¨çš„ä¸€ä»¶äº‹æƒ…äº†ã€‚ æˆ‘ç™¼ç¾å¹¾ä½å…¬å¸ä¸»ç®¡ä¸¦ä¸çŸ¥é“é€™ä»¶äº‹æƒ…ï¼Œä¹Ÿä¿ƒä½¿æˆ‘åœ¨ç¶“éä¸€æ®µæ™‚é–“å¾Œå›ä¾†æ•´ç†é€™ç¯‡æ–‡ç« ã€‚ äº‹å¯¦ä¸Šï¼ŒGPG key ä¸åªæ˜¯å¯ä»¥å»¶å±•éæœŸæ™‚é–“ï¼Œé€™ä¹Ÿæ˜¯ä¸€èˆ¬æ¨è–¦çš„æœ€ä½³æ…£ä¾‹ã€‚ People think that they donâ€™t want their keys to expire, but you actually do. Why? Because you can always extend your expiration date, even after it has expired! See: OpenPGP Best Practices - riseup.net ä½¿ç”¨è€…æ‡‰è©²è¨­ä¸€å€‹è¼ƒçŸ­çš„æœ‰æ•ˆæ™‚é–“ï¼Œä¸¦åœ¨å¾ŒçºŒæœ‰éœ€è¦æ™‚å»¶å±•éæœŸæ™‚é–“ã€‚ GPG key å¯ä»¥è‡ªå·±ä¿®æ”¹é‡‘é‘°çš„éæœŸæ™‚é–“ï¼Œæ˜¯å› ç‚º GPG key å’Œ X.509 æ†‘è­‰æœ‰è‘—æœ¬è³ªä¸Šçš„å€åˆ¥ã€‚ GPG key çš„ç”¢ç”Ÿæ˜¯é€é primary key çš„ self-signatureï¼Œ è€Œ X.509 æ†‘è­‰çš„ç°½ç½²æ˜¯ç”±å…¬æ­£çš„ç¬¬ä¸‰æ–¹ CA é€²è¡Œã€‚ X.509 æ†‘è­‰çš„éæœŸæ™‚é–“æ˜¯ CA å¹«ä½ ç°½ç½²æ†‘è­‰æ™‚æ±ºå®šï¼Œè‡ªç„¶ç„¡æ³•éš¨æ„ä¿®æ”¹ï¼Œ å¤§å®¶ä¹Ÿå¾ˆç¿’æ…£é€™ä»¶äº‹æƒ…ï¼Œä½† GPG key å°±ä¸ä¸€æ¨£äº†ã€‚ GPG key çš„æœ‰æ•ˆæ™‚é–“æ˜¯é€é key çš„ self-signature å…§æ‰€è¨˜è¼‰çš„æ™‚é–“æ±ºå®šã€‚ åªè¦ primary (private) key æ²’æœ‰éºå¤±ï¼ŒæŒæœ‰è€…éš¨æ™‚å¯ä»¥é‡æ–°è‡ªç°½ä¸¦ä¿®æ”¹æ™‚é–“ã€‚ åªè¦èªçŸ¥åˆ°å…©è€…æœ¬è³ªä¸Šçš„å·®ç•°ï¼Œå¯ä»¥ä¿®æ”¹éæœŸæ™‚é–“é€™ä»¶äº‹æƒ…ä¹Ÿå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä»–äººå¦‚ä½•èªå®šéæœŸæ™‚é–“ï¼Ÿæ—¢ç„¶ GPG key å¯ä»¥éš¨æ™‚é‡ç°½ä¿®æ”¹éæœŸæ™‚é–“ï¼Œé‚£å°ä»–äººä¾†èªªï¼Œ è©²å¦‚ä½•åˆ¤å®šæŸæŠŠ key ç©¶ç«Ÿä»€éº¼æ™‚å€™éæœŸå‘¢ï¼Ÿ è¦å‰‡å¾ˆç°¡å–® The latest self-signature takes precedence See: Key Management è‹¥æ˜¯é€é gpg tool ä¿®æ”¹éæœŸæ™‚é–“ï¼ŒèˆŠçš„ self-signature æœƒè¢«åˆªæ‰ã€‚ å› ç‚ºåªæœ‰ä¸€å€‹ self-signatureï¼Œä¿®æ”¹å®Œä¹‹å¾Œï¼Œåªè¦é‡æ–°æŠŠ key export çµ¦ä»–äººï¼Œ ä»–äººå°±å¯ä»¥çŸ¥é“æ–°çš„éæœŸæ™‚é–“ã€‚ è‹¥ä¸æ˜¯é€éä¿¡è³´ç®¡é“ç›´æ¥æŠŠæ–°ç°½çš„ key çµ¦ä»–äººï¼Œè€Œæ˜¯é€é GPG key serverï¼Œ ç‹€æ³æœƒæœ‰é»ä¸ä¸€æ¨£ã€‚ åŸºæ–¼å®‰å…¨è€ƒé‡ï¼ŒGPG key server æ˜¯ä¸å…è¨±éƒ¨åˆ†æˆ–å®Œå…¨åˆªé™¤ key çš„ï¼ŒMIT åä¸‹çš„ key server é‚„ç‰¹åˆ¥å¯«äº†ä¸€ç¯‡ FAQ ä¾†èªªæ˜é€™ä»¶äº‹ã€‚ å°æ–¼ä¸€æŠŠå·²å­˜åœ¨çš„ keyï¼Œä½¿ç”¨è€…åªèƒ½æ¨æ–°çš„ sub key æˆ–æ–°çš„ signature ä¸Šå»ã€‚ å› æ­¤ï¼Œä»–äººé€é key server å–å¾— key æ™‚ï¼Œä¹Ÿæœƒæ‹¿åˆ°å¤šå€‹ signatureã€‚ å¥½åœ¨ signature æœ¬èº«ä¹Ÿæœ‰æ™‚æˆ³ï¼Œæ ¹æ“šä¸Šè¿° â€œå¾Œè€…ç‚ºæº–â€ çš„è¦å‰‡ï¼Œä»–äººå°±å¯ä»¥çŸ¥é“ æ­£ç¢ºçš„éæœŸæ™‚é–“æ˜¯ä½•æ™‚ã€‚ æœ‰èˆˆè¶£çš„å¯ä»¥æŸ¥çœ‹ç­†è€…çš„ GPG key ä¾†ç¢ºèªé€™å€‹è¡Œç‚º 12345678gpg --keyserver keys.gnupg.net --recv-keys C9756E05# Get key from key servergpg --export C9756E05 | gpg --list-packets# One signature has &quot;key expires after ...&quot; while another doesn'tgpg -k C9756E05# Validate that the key indeed expires at some time æˆ–æ˜¯å¯ä»¥ç›´æ¥å» GnuPG å®˜æ–¹çš„ key server æŸ¥çœ‹: Search results for â€˜0xc728b2bdc9756e05â€™ çµèªç¿»é–±æ–‡ä»¶ç ”ç©¶çš„éç¨‹ï¼Œæ…¢æ…¢æ„Ÿå—åˆ°åˆ° GPG é€™å€‹æ‰£é™¤ X.509 ä¹‹å¤–å”¯ä¸€æˆç†Ÿçš„ PKI ç”Ÿæ…‹ç³»ï¼Œç©¶ç«Ÿæœ‰å¤šéº¼å‰å¤§ã€‚åŒæ™‚ä¹Ÿçœ‹åˆ°å¾ˆå¤šå€¼å¾—ç´°è®€çš„ guideline æ–‡ä»¶ã€‚ è‹¥æœ‰æ™‚é–“ï¼ŒçœŸçš„è©²ä¾†å¥½å¥½å¸æ”¶æ•´ç†ã€‚","link":"/2021/05/06/gpg-key-extend-expiration-date.html"},{"title":"Introduction of Function Hijacking in C","text":"Thanks to the symbol-lazy-loading ability in Unix environment, we can do many interesting thing on functions from some shared library when executing some executables. All we need to do are Implement a shared library that contains the functions we want to hijack. Run the executable with our magic library inserted. Make a Shared LibraryIf we want to replace some function with stub / fake implementation. we can just implement a function with the same name and the same signature. For example, if we want to fixed the clock during unit test â€¦ 1234567891011// in hijack.c#include &lt;time.h&gt;// a &quot;time&quot; function which always return the timestamp of the epoch.time_t time(time_t* arg) { if (arg) *arg = 0; return 0;} If we want do observation about some function call, but still delegate the call to the original function, we can implement a function that load corresponding function at runtime and pass the function call. For example, if we want to monitor the call sequence of file open action. 1234567891011121314151617// in hijack.c#include &lt;dlfcn.h&gt;#include &lt;stdio.h&gt;#include &lt;time.h&gt;// write &quot;open&quot; action to standard error before open the fileFILE* fopen(const char* restrict path, const char* restrict mode) { static int used_count = 0; used_count += 1; fprintf(stderr, &quot;open file [%d]: \\&quot;%s\\&quot;\\n&quot;, used_count, path); typedef FILE* (*wrapped_type)(const char* restrict path, const char* restrict mode); // no dlopen, just search the function in magic handle RTLD_NEXT wrapped_type wrapped = dlsym(RTLD_NEXT, &quot;fopen&quot;); return wrapped(path, mode);} After finish our implementation, compile them as a shared library, called hijack.so here. 1cc -fPIC -shared -o hijack.so hijack.c Hijack during Actual ExecutionWe can use LD_PRELOAD environment variable to do insert our special shared library for any executable during execution. 1LD_PRELOAD=&quot;path-to-shared-lib&quot; executable For example, if we want to use the implementations in last section in our executable, called app here. 1234567891011121314151617// app.c#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;time.h&gt;int main() { FILE* handle = fopen(&quot;output.txt&quot;, &quot;a&quot;); assert(handle); fclose(handle); time_t current = time(NULL); printf(&quot;now: %s&quot;, asctime(gmtime(&amp;current))); return EXIT_SUCCESS;} (Compile and) run the executable 12cc -o app app.cLD_PRELOAD=./hijack.so ./app Output 12open file [1]: &quot;output.txt&quot;now: Thu Jan 1 00:00:00 1970 The open-file action is traced, and the time is fixed to the epoch. If we need to overwrite functions with more than one shared library, just use : to separate them in LD_PRELOAD. ConclusionItâ€™s a powerful feature, it allows we to do observation, to replace with mock/fake implementation, or sometime even to apply emergency patch. And all make this possible are the dynamic linking mechanism, and the one-to-one mapping from symbol from sources to libraries/binaries. Although development in C is somehow inconvenient, but itâ€™s still a interesting experience when seeing this kind of usage. :D","link":"/2024/07/08/intro-hijack-c-function.html"},{"title":"The Backbone of Frontend Framework","text":"Itâ€™s almost impossible to write a frontend without any UI framework nowadays. All these frameworks provide some kind of mechanism that, whenever we change a value in JavaScript, some element in UI will be changed automatically. For example, adding new row to a table when we push a item into a list. But how does this work under the surface? Thatâ€™s the Proxy Object. Internal Method and ProxyWe need to talk about internal method in JS first. A internal method is a special method/function that decide how a object behaves in JS runtime. For example, [[GET]] internal method determines the result when we access some property prop from an object obj, e.g. obj.prop. And [[Call]] internal method determines what to proceed when we call the object obj as a function, e.g. obj(). These internal methods can be intercepted and customized from some existing object, with a Proxy instance. For example, if we want to intercept the property-read action of some object. Here is the way to do. 123456789101112131415var person = { name: &quot;Alice&quot;};var agent = new Proxy( person, { get: function(target, property, receiver) { console.log(`access &quot;${property}&quot; as ${target[property]}`); return target[property]; }, },);var _ = agent.name; // prints: access &quot;name&quot; as Alice&quot; In the snippet above, agent is the proxy object instance. The second argument to Proxy constructor is the handler, and the get function in that handler is a trap to the [[GET]] internal method. See The set Trap for BindingJust like we can intercept the property read action for some object, we can also intercept the property write action. And thatâ€™s what UI frameworks do underneath. Assuming we have a paragraph in DOM tree, identified by id greeting. 1&lt;p id=&quot;greeting&quot;&gt;Hi&lt;/p&gt; We can ensure that the text is updated automatically when we are doing some change to JavaScript object. 123456789101112131415var element = document.querySelector('#greeting');var handler = { set: function(target, property, value, receiver) { if (property !== 'text') return false; target[property] = value; element.textContent = value; // react to the change return true; }};var greeting = new Proxy({text: element.textContent}, handler);console.log(greeting.text); // print 'Hi'greeting.text = 'Hello';// the text in the html page will be changed accordingly. Once this proxy object is created, we make the view (HTML) reactive to the model (JavaScript object), and the binding is established. In the examples above, we may noticed that all the intercepted objects are an object literally. That means we can not do similar thing to primitive type in JS, like number and string. And that do have impact on the design of UI framework. For example, Vue.js framework has a ref() wrapper for that. However, Proxy is still a powerful feature in JS, and probably the most important feature for any senior engineer who need to work with JS. So just get used to it. :D See Also: Proxy - MDN AppendixFull HTML file for the view-model binding example. 12345678910111213141516171819202122232425262728&lt;!DOCTYPE html&gt; &lt;html&gt;&lt;head&gt; &lt;title&gt;Proxy Demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p id=&quot;greeting&quot;&gt;Hi&lt;/p&gt; &lt;script&gt; document.addEventListener('DOMContentLoaded', function() { var element = document.querySelector('#greeting'); var handler = { set: function(target, property, value, receiver) { if (property !== 'text') return false; target[property] = value; element.textContent = value; // react to the change return true; } }; var greeting = new Proxy({text: element.textContent}, handler); console.log(greeting.text); // print 'Hi' greeting.text = 'Hello'; // the text in the html page will change accordingly. }); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;","link":"/2025/02/04/javascript-proxy.html"},{"title":"Kubernetes Audit Log ä½¿ç”¨ç­†è¨˜","text":"æˆ‘åœ¨å…¬å¸çš„å·¥ä½œç’°å¢ƒä¸­ï¼Œæœ‰äº›æ¥­å‹™éœ€è¦éƒ¨å±¬æœå‹™åœ¨ Kubernetes (ä¸‹ç¨± K8s) ä¸Šã€‚ å› æ­¤åœ¨å°ˆæ¡ˆæ—©æœŸï¼Œéƒ¨é–€å…§çš„åŒäº‹è‡ªæ¶äº† K8s cluster ä¾†é–‹ç™¼ã€‚ éš¨è‘—æ™‚é–“æµé€ï¼Œå„å€‹ RD é–‹å§‹ä¸Šæ‰‹ K8s æ“ä½œå¾Œï¼Œæ¯å¤©éƒ½æœ‰äººåœ¨å° K8s çš„ master é–‹ç™¼ç’°å¢ƒåšä¿®æ”¹ã€‚ æ–¼æ˜¯éƒ¨é–€å…§é–‹å§‹ç”¢ç”Ÿä¸€äº›ä»¤äººç…©èºçš„å°è©± æˆ‘çœ‹ K8s ä¸Šé¢æœ‰è£äº†æŸå€‹ CRDï¼Œä½†æ²’æœ‰è£å°æ‡‰çš„ service ä¾†ç”¨é€™å€‹ CRDï¼Œé€™å€‹æ˜¯ä½ è£çš„å—ï¼Ÿ Test namespace è£äº†ä¸€å€‹ Ingress rule ç”¢ç”Ÿè¡çªäº†ï¼Œé‚£å€‹ rule æ˜¯èª°è£çš„ï¼Ÿ â€¦ é€™äº›å°è©±çš„å…±é€šé»æ˜¯ï¼šæƒ³çŸ¥é“ K8s çš„ç‹€æ…‹æ”¹è®Šæ˜¯èª°é€ æˆçš„ã€‚ ä½†åœ¨éƒ¨é–€è‡ªæ¶çš„ç’°å¢ƒå…§ï¼Œå› ç‚ºå¤§å®¶å…±ç”¨äº†ä¸€å€‹ kubeconfigï¼Œæ‰€ä»¥æ ¹æœ¬ç„¡å¾æ‰¾èµ·.. æ–¼æ˜¯æˆ‘æƒ³è¾¦æ³•æŠŠé–‹ç™¼ç”¨çš„ K8s ç’°å¢ƒè¨­å®šå¥½ auditing log çš„åŠŸèƒ½ï¼Œä¸¦ç•™ä¸‹é€™ç¯‡ç­†è¨˜ Audit ç›®æ¨™è¦åš audit ä¾†ç¢ºèªæ¯å€‹äººåšäº†ä»€éº¼æ“ä½œï¼Œæˆ‘éœ€è¦é”åˆ°å…©å€‹ç›®æ¨™ ä¸åŒäººå“¡éœ€è¦ä½¿ç”¨ä¸åŒçš„èº«åˆ†å­˜å– K8s API server API server éœ€é–‹å•Ÿ log ä¸” log éœ€ä¿å­˜åœ¨ persistent storage ä¸Š èº«åˆ†é©—è­‰æ–¹å¼æ¯”è¼ƒåƒè€ƒ K8s çš„ Authenticating å®˜æ–¹æ–‡ä»¶ï¼Œåœ¨ä¸ä¾è³´å¤–éƒ¨æœå‹™çš„æƒ…æ³ä¸‹ï¼Œå¤§æ¦‚æœ‰ä¸‰ç¨®èº«åˆ†é©—è­‰çš„æ–¹å¼ X509 Client Certificate Static Token File Service Account Tokens ä»¥ä¸‹åˆ†åˆ¥ä»‹ç´¹å„æ–¹å¼çš„å„ªç¼ºé» X509 Client Certificateæ­¤æ–¹å¼ä¾è³´ TLS çš„ client verification åŠŸèƒ½ï¼Œåªè¦ä½ æœ‰æ­£ç¢ºçš„æ†‘è­‰å¡åœ¨ kubeconfig è£¡å³å¯ä½¿ç”¨ã€‚ ä¸€èˆ¬åœ¨åš cluster åˆå§‹åŒ–éç¨‹ä¸­æ‹¿åˆ°çš„ admin kubeconfig ï¼Œå…¶å…§å®¹å³å±¬é€™ä¸€é¡ã€‚ æ­¤æ–¹å¼çš„å„ªé»ç‚º è‹¥æ¡å–åš´è¬¹çš„ä½¿ç”¨è€…è‡ªè¡Œç”¢ç”Ÿ key-CSR pair å†çµ¦ CA ç°½ç½²æµç¨‹ï¼Œå› ç‚ºåƒ…ä½¿ç”¨è€…æœ‰ private keyï¼Œå‡ºäº‹æ™‚æœ‰é«˜åº¦ä¿¡å¿ƒä¸€å®šæ˜¯è©²ä½¿ç”¨è€…æ‰€ç‚º é™¤äº†è‡ªå·±çš„ user name å¤–ï¼Œä½¿ç”¨è€…å¯ä»¥å¾è‡ªå·±çš„æ†‘è­‰ä¸­ç›´æ¥ç¢ºèªæ“ä½œ K8s æ™‚æœƒæœ‰é‚£äº› group èº«åˆ† æ†‘è­‰å…§ subject çš„ CN å°æ‡‰ K8s user name, O å°æ‡‰ K8s group name æ­¤æ–¹å¼çš„ç¼ºé»ç‚º K8s ä¸æ”¯æ´ X509 åŸç”Ÿçš„ certificate revocation åŠŸèƒ½ï¼Œè‹¥æœ‰ç‰¹å®š client æ†‘è­‰æœ‰å•é¡Œï¼Œå¾—æ•´å€‹ CA æ›æ‰é‡ä¾† Upstream issue: Support for managing revoked certs (opened for 5 years) Static Token FileK8s API server åœ¨é–‹å•Ÿæ™‚ï¼Œå¯ä»¥è¨­å®šä¸€å€‹æª”æ¡ˆä¾†è¨˜éŒ„ token èˆ‡ user(group) çš„ mapping é—œä¿‚ã€‚ Client é€£ä¸Š API server æ™‚ï¼Œåªè¦èƒ½æ‹¿å‡ºæ­¤ tokenï¼Œä¾¿æœƒè¢«è¦–ç‚ºå°æ‡‰çš„ user é€²è¡Œå¾ŒçºŒæ¬Šé™æª¢æŸ¥ã€‚ æ­¤æ–¹å¼çš„å„ªé»ç‚º è¨­å®šç°¡å–®ã€‚éœ€è¦æ–°å¢/åˆªé™¤ä½¿ç”¨è€…æˆ–ä¿®æ”¹ token æ™‚ï¼Œåªéœ€ä¿®æ”¹ä¸€å€‹æª”æ¡ˆ Token å¯é•·å¯çŸ­ï¼Œå¯ä»¥åšå‡ºè¼ƒç‚ºå¯è®€çš„ kubeconfig æª”æ¡ˆ (è¡Œå¯¬ 80 å­—å…ƒä»¥å…§) æ­¤æ–¹å¼çš„ç¼ºé»ç‚º static token file è¨­å®šæœ‰ç•°å‹•æ™‚éœ€è¦é‡é–‹ server Service AccountService Account æ˜¯ K8s åŸç”Ÿè¨­è¨ˆçµ¦ K8s å…§çš„ service åš K8s è‡ªæˆ‘ç®¡ç†çš„æ©Ÿåˆ¶ã€‚ æ­¤æ–¹å¼çš„å„ªé»ç‚º å½ˆæ€§æ¥µé«˜ï¼Œå¯åœ¨ runtime ç›´æ¥é€é K8s API ç”¢ç”Ÿæ–°çš„ service account æ­¤æ–¹å¼çš„ç¼ºé»ç‚º service account å±¬ namespaced resourceï¼Œè‹¥æœ‰å¤šå€‹ namespace è¦ç›¸åŒ userï¼Œéœ€è¦é‡è¤‡è¨­å®š ç”¢ç”Ÿçš„ audit log è¼ƒé›£åšäº‹å¾Œæ¢³ç† K8s æœ‰å¤§é‡åˆ©ç”¨ service account çš„è‡ªæˆ‘ç®¡ç†è¡Œç‚ºï¼Œå› æ­¤é›£ä»¥å€éš”ä½¿ç”¨è€…æ“ä½œå’Œ K8s è‡ªèº«æ“ä½œ ç›¸è¼ƒæ–¼ X509 æˆ– static token æ–¹å¼ï¼Œservice account ä¸èƒ½ç›´æ¥è¨­å®šç¾¤çµ„ ç’°å¢ƒèªªæ˜è‹¥ä½¿ç”¨ kubeadm å®‰è£è¨­å®š K8s clusterï¼Œåªæœ‰ kubelet æœƒä½œç‚ºä¸€å€‹ system service é‹è¡Œåœ¨ host ä¸­ã€‚ å…¶ä»–å¦‚ K8s API server, scheduler åŠ etcd ç­‰éƒ½æ˜¯è·‘åœ¨ master node çš„ Docker container ç’°å¢ƒä¸­ ä»¥ä¸‹èªªæ˜å‡å‡è¨­ç‚ºæ­¤é¡ç’°å¢ƒé€²è¡Œæ“ä½œã€‚ è¨­å®š Static Token FileK8s Master Node è¨­å®šä¿®æ”¹æ–°å¢ user token file /etc/kubernetes/tokens.csv (è·¯å¾‘å¯è‡ªè¡Œèª¿æ•´) 12user-token,user-name,uid,&quot;optional-group,another-group&quot;fc27911e-73dd-46b0-8c57-86f2fe5fdd21,alice,alice@example.com,&quot;developer&quot; æª”æ¡ˆç‚ºå–®ç´”çš„ CSV æ ¼å¼ï¼ŒåŒ…å«å››å€‹æ¬„ä½ User Token: ä»»æ„å­—ä¸²ï¼Œä¸ä¸€å®šè¦ä½¿ç”¨ UUID æ ¼å¼ User Name: ä½¿ç”¨æ­¤ token èº«åˆ†é©—è­‰å®Œæˆå¾Œå¾—åˆ°çš„ user name UID: ç”¨é€”ä¸æ˜ï¼Œæœƒå‡ºç¾åœ¨ audit log ä¸­ identifies the end user and attempts to be more consistent and unique than username List of Group Name: (Optional) ä½¿ç”¨æ­¤ token èº«åˆ†é©—è­‰å®Œæˆå¾Œå¾—åˆ°çš„ group èº«åˆ† è¨­å¥½ static token file å¾Œï¼Œä¿®æ”¹ API server çš„ static pod æè¿° /etc/kubernetes/manifests/kube-apiserver.yamlã€‚ user-tokens çš„ path èˆ‡å‰è¿°è¨­å®šå°é½Šã€‚ 12345678910111213141516171819202122232425262728293031diff --git a/root/manifests/kube-apiserver.yaml b/root/token-api-server.yamlindex 31c5f40..d4511ae 100644--- a/root/manifests/kube-apiserver.yaml+++ b/root/token-api-server.yaml@@ -37,6 +37,7 @@ spec: - --service-cluster-ip-range=10.96.0.0/12 - --tls-cert-file=/etc/kubernetes/pki/apiserver.crt - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key+ - --token-auth-file=/etc/kubernetes/tokens.csv image: k8s.gcr.io/kube-apiserver:v1.17.4 imagePullPolicy: IfNotPresent livenessProbe:@@ -71,6 +72,9 @@ spec: - mountPath: /usr/share/ca-certificates name: usr-share-ca-certificates readOnly: true+ - mountPath: /etc/kubernetes/tokens.csv+ name: user-tokens+ readOnly: true hostNetwork: true priorityClassName: system-cluster-critical volumes:@@ -98,4 +102,8 @@ spec: path: /usr/share/ca-certificates type: DirectoryOrCreate name: usr-share-ca-certificates+ - hostPath:+ path: /etc/kubernetes/tokens.csv+ type: FileOrCreate+ name: user-tokens status: {} ä¸Šè¿°ä¿®æ”¹å…§å®¹çš„é‡é»ç‚º å°‡ master node ä¸Šçš„ user token è¨­å®šæª” mount è‡³ API server çš„ container å…§ è¨­å®š API server å»ä½¿ç”¨æ­¤ token æª”æ¡ˆ User Token File å¾ŒçºŒç¶­è­·è‹¥ä¹‹å¾Œéœ€è¦ä¿®æ”¹ user token fileï¼Œå› ç‚ºä¸€äº›ä¸Šæ¸¸çš„é™åˆ¶ï¼Œ API server pod ç„¡æ³•è§€æ¸¬åˆ°æª”æ¡ˆçš„ä¿®æ”¹ï¼Œå³ä½¿ kill pod å†é‡å•Ÿä¹Ÿç„¡æ³•ä½¿ç”¨æ–°çš„ token fileã€‚ ä¸éæˆ‘å€‘å¯ä»¥é€éä¿®æ”¹ API server æè¿°æª”çš„æ–¹å¼ï¼Œç©©å®šåœ°é‡æ–°éƒ¨å±¬ API serverï¼Œè®“æ–°çš„ token file ç”Ÿæ•ˆã€‚ ç·¨è¼¯ /etc/kubernetes/tokens.csv ä¿®æ”¹ API server æè¿°æª” /etc/kubernetes/manifests/kube-apiserver.yaml åŠ å…¥æˆ–ä¿®æ”¹ metadata.annotations.lastModify æ¬„ä½ï¼Œå¡«å…¥åˆé©å­—ä¸² ä¿®æ”¹å¾Œ kubelet æœƒåµæ¸¬åˆ°æª”æ¡ˆç•°å‹•ï¼Œä¸¦é‡æ–° apply apiserver pod User kubeconfig è¨­å®šä½¿ç”¨ kubectl è¨­å®š user token kubectl config set-credentials &lt;user-name&gt; --token=&lt;token&gt; æˆ–æ˜¯ç›´æ¥ä¿®æ”¹ kubeconfig å…§çš„ user object 123- name: alice user: token: fc27911e-73dd-46b0-8c57-86f2fe5fdd21 Log è¨­å®šç•¶å„å€‹ä½¿ç”¨è€…æ“ä½œ K8s çš„èº«åˆ†ç¢ºå¯¦æœ‰è¢«åˆ‡åˆ†é–‹ä¹‹å¾Œï¼Œå³å¯é€²è¡Œå¾ŒçºŒçš„ audit log è¨­å®šå‹•ä½œã€‚ Audit log å¿…é ˆåœ¨å»åˆäº‹å…ˆè¨­å®šçš„ match rule æ‰æœƒè¢«è¨˜éŒ„ä¸‹ä¾†ã€‚ æ ¹æ“š Auditing æ–‡ä»¶ èªªæ˜ï¼Œ server åœ¨åˆ¤æ–·æ¯å€‹äº‹ä»¶çš„ log level æ™‚ï¼Œæ˜¯æ¡å– first match çš„è¦å‰‡é€²è¡Œã€‚ç¬¬ä¸€å€‹å»åˆçš„è¦å‰‡æœƒæ±ºå®šæ­¤äº‹ä»¶æ˜¯å¦ç´€éŒ„ä»¥åŠç´€éŒ„çš„è©³ç´°ç¨‹åº¦ã€‚ The first matching rule sets the â€œaudit levelâ€ of the event. API Server Audit è¨­å®šåœ¨ master node ä¸Šè¨­å®š audit policy /etc/kubernetes/audit-policy.yaml (è·¯å¾‘å¯è‡ªè¡Œèª¿æ•´) 123456789101112131415apiVersion: audit.k8s.io/v1kind: PolicyomitStages:- &quot;RequestReceived&quot;rules:- level: Metadata userGroups: - &quot;developer&quot; verbs: [&quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;, &quot;deletecollection&quot;]- level: Metadata userGroups: - &quot;developer&quot; resources: - group: &quot;&quot; resources: [&quot;secrets&quot;, &quot;configmaps&quot;] æ­¤è¨­å®šæœ‰å¹¾å€‹é‡é» global çš„ omitStages è¨­å®š æ‰€æœ‰ API request éƒ½æœƒç¶“é RequestReceived stage çœç•¥æ­¤ stage å¯ä»¥é¿å…æ‰€æœ‰çš„ request éƒ½ç”¢ç”Ÿå…©ç­† log Rule ä»¥ userGroups é€²è¡Œç¯©é¸ è‹¥å·²çŸ¥è¦ç´€éŒ„çš„ user group ç¯„åœï¼Œæ˜å®š group å¯é¿å…è¨˜éŒ„åˆ°å¤§é‡çš„ K8s è‡ªèº«ç¶­è­·çš„äº‹ä»¶ è¨­å®šå‹•è©ç¯„åœè¨˜éŒ„æ‰€æœ‰çš„ modify æ“ä½œ è¨­å®šæ•æ„Ÿçš„ resource ç¨®é¡ (e.g. secrets &amp; configmaps) è¨˜éŒ„æ‰€æœ‰æ“ä½œ æ¥è‘—ä¿®æ”¹ API server çš„ static pod æè¿° /etc/kubernetes/manifests/kube-apiserver.yamlã€‚ audit hostPath volume éœ€èˆ‡å‰è¿°è¨­å®šå°é½Š 1234567891011121314151617181920212223242526272829303132333435363738394041diff --git a/root/token-api-server.yaml b/root/audit-token-api-server.yamlindex d4511ae..0e07f7f 100644--- a/root/token-api-server.yaml+++ b/root/audit-token-api-server.yaml@@ -38,6 +38,10 @@ spec: - --tls-cert-file=/etc/kubernetes/pki/apiserver.crt - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key - --token-auth-file=/etc/kubernetes/tokens.csv+ - --audit-policy-file=/etc/kubernetes/audit-policy.yaml+ - --audit-log-path=/var/log/kubernetes/audit.log+ - --audit-log-maxsize=1+ - --audit-log-maxbackup=6 image: k8s.gcr.io/kube-apiserver:v1.17.4 imagePullPolicy: IfNotPresent livenessProbe:@@ -75,6 +79,12 @@ spec: - mountPath: /etc/kubernetes/tokens.csv name: user-tokens readOnly: true+ - mountPath: /etc/kubernetes/audit-policy.yaml+ name: audit+ readOnly: true+ - mountPath: /var/log/kubernetes+ name: audit-log+ readOnly: false hostNetwork: true priorityClassName: system-cluster-critical volumes:@@ -106,4 +116,12 @@ spec: path: /etc/kubernetes/tokens.csv type: FileOrCreate name: user-tokens+ - name: audit+ hostPath:+ path: /etc/kubernetes/audit-policy.yaml+ type: File+ - name: audit-log+ hostPath:+ path: /var/log/kubernetes+ type: DirectoryOrCreate status: {} Note: é–‹ /var/log/kubernetes è³‡æ–™å¤¾è€Œéå–®ä¸€ log æª”æ¡ˆï¼Œæ˜¯ç‚ºäº†é¿å… log rotate æ™‚å› æ¬Šé™ä¸è¶³ç„¡æ³•æ­£ç¢º rotate è¨­å®šå®Œä¹‹å¾Œå³å¯åœ¨ master node çš„ /var/log/kubernetes çœ‹åˆ° access log Sample å¦‚ä¸‹ command: kubectl apply -f services/tasks/redis-cluster-proxy.yml log: (Log æª”å…§æœƒå¯«æˆä¸€è¡Œï¼Œbeautify å¾Œå¦‚ä¸‹) 12345678910111213141516171819202122232425262728293031323334353637{ &quot;kind&quot;:&quot;Event&quot;, &quot;apiVersion&quot;:&quot;audit.k8s.io/v1&quot;, &quot;level&quot;:&quot;Metadata&quot;, &quot;auditID&quot;:&quot;f09f32f4-a93f-41ee-b2b9-2f3acf3aa963&quot;, &quot;stage&quot;:&quot;ResponseComplete&quot;, &quot;requestURI&quot;:&quot;/api/v1/namespaces/alice/services&quot;, &quot;verb&quot;:&quot;create&quot;, &quot;user&quot;:{ &quot;username&quot;:&quot;alice&quot;, &quot;uid&quot;:&quot;alice@example.com&quot;, &quot;groups&quot;:[ &quot;developer&quot;, &quot;system:authenticated&quot; ] }, &quot;sourceIPs&quot;:[ &quot;10.300.400.512&quot; ], &quot;userAgent&quot;:&quot;kubectl/v1.18.2 (linux/amd64) kubernetes/52c56ce&quot;, &quot;objectRef&quot;:{ &quot;resource&quot;:&quot;services&quot;, &quot;namespace&quot;:&quot;alice&quot;, &quot;name&quot;:&quot;redis-cluster-proxy&quot;, &quot;apiVersion&quot;:&quot;v1&quot; }, &quot;responseStatus&quot;:{ &quot;metadata&quot;:{}, &quot;code&quot;:201 }, &quot;requestReceivedTimestamp&quot;:&quot;2020-10-21T12:27:30.252440Z&quot;, &quot;stageTimestamp&quot;:&quot;2020-10-21T12:27:30.272401Z&quot;, &quot;annotations&quot;:{ &quot;authorization.k8s.io/decision&quot;:&quot;allow&quot;, &quot;authorization.k8s.io/reason&quot;:&quot;RBAC: allowed by RoleBinding \\&quot;super-user-role-binding-alice/alice\\&quot; of Role \\&quot;super-user\\&quot; to User \\&quot;alice\\&quot;&quot; }} ç–‘é›£æ’è§£è¨­å®šæª”ä½ç½®kubelet Static Pod è¨­å®šè³‡æ–™å¤¾ä¸ä¸€å®šåœ¨ /etc/kubernetes/manifests ä½ç½®ï¼Œ é ˆå¾ kubelet å•Ÿå‹•è¨­å®šä¸­çš„ staticPodPath æ¬„ä½æ‰¾åˆ°çœŸå¯¦ä½ç½®ã€‚ å‚™ä»½è¨­å®šæª”è‹¥è¦å‚™ä»½ static pod è¨­å®šè³‡æ–™å¤¾å…§çš„ä»»ä½•æª”æ¡ˆï¼Œä¸èƒ½å‚™ä»½åœ¨ç›¸åŒè³‡æ–™å¤¾å…§ï¼Œå¦å‰‡æœƒå°è‡´ kubelet è¡Œç‚ºæ€ªç•°ã€‚ Reload K8s API server è¨­å®škubelet service ä¸€èˆ¬æœƒè‡ªå‹•åµæ¸¬ static pod è³‡æ–™å¤¾å…§çš„æª”æ¡ˆç•°å‹•ï¼Œä¸¦é‡æ–°ä½ˆç½²è©² podï¼Œä½†å¶çˆ¾é‚„æ˜¯æœƒç¢°ä¸Šæ„å¤–.. ç™¼ç”Ÿæ„å¤–æ™‚ï¼Œä»¥ä¸‹æ–¹å¼å¯èƒ½å¯ä»¥å›åˆ°æ­£å¸¸ç‹€æ…‹ åˆªé™¤å°æ‡‰çš„ pod, e.g. kubectl delete -n kube-system pod kube-apiserver-&lt;cluster name&gt; åˆªé™¤å¾Œ kubelet æœƒé¦¬ä¸Šé‡æ–°ä½ˆç½²ä¸€å€‹æ–°çš„ API server Controlled By: Node/k8s-master: æ„å‘³è€…æ­¤ pod ä¸æ˜¯ç”± deployment ç­‰ K8s object æ§åˆ¶ï¼Œæ˜¯ç›´æ¥ç”± master node æ§åˆ¶ æˆ–æ˜¯é‡å•Ÿ kubelet systemd service å¾ŒçºŒæ­¤ç¯‡ç­†è¨˜ç´€éŒ„ static token çš„èº«åˆ†é©—è­‰æ©Ÿåˆ¶ï¼Œä½†è‹¥æœ‰ä¼æ¥­è¦æ¨¡çš„èº«åˆ†é©—è­‰éœ€æ±‚æ™‚ï¼Œé€™é¡¯ç„¶ä¸æ˜¯å€‹å¥½æ–¹æ³•ã€‚ Kubernetes ä¹Ÿæœ‰åŸç”Ÿæ”¯æ´ OpenID çš„èº«åˆ†é©—è­‰æ–¹å¼ä¾†æ‡‰ä»˜æ›´é€²ä¸€æ­¥çš„éœ€æ±‚ï¼Œä¸éé€™éƒ¨åˆ†å°±ç­‰æœªä¾†æœ‰ç©ºå†ä¾†ç ”ç©¶äº†ã€‚ References Authenticating | Kubernetes kubernetes - How can kube-apiserver be restarted? - Stack Overflow Auditing | Kubernetes Authorization Overview | Kubernetes kube-apiserver | Kubernetes kube-apiserver audit log rotation throwing permission denied Â· Issue #70664 Â· kubernetes/kubernetes AppendixRequest Stages: 123456789101112 +-----------------+ | RequestReceived +----+ +---+-------------+ | | | | +----------v------+ | | ResponseStarted | | +----------+------+ | | +-------+ | | | Panic |+----v------------+ | +-------+| ResponseComplete&lt;-----++-----------------+","link":"/2020/10/22/kubernetes-auditing.html"},{"title":"NATS èˆ‡ JetStream ç°¡æ˜“ä»‹ç´¹","text":"æœ€è¿‘å› å…¬å¸æ¥­å‹™åœ¨ç©ä¸€å¥—ç›¸å°æ–°çš„ MQ: NATSã€‚ å› ç‚ºå®˜æ–¹æ–‡ä»¶ä¸æ…æ¸…æ¥šä¸”æœ‰äº›åœ°æ–¹èˆ‡ç›´è¦ºä¸åŒï¼Œé€ æˆèµ·æ­¥ç·©æ…¢ã€‚ ä»¥ä¸‹ç°¡å–®ç´€éŒ„ä¸€ä¸‹å‰›å…¥é–€æ™‚æ‡‰çŸ¥é“çš„äº‹æƒ…ã€‚ Guideç›¸è¼ƒ RabbitMQ, Kafka ç­‰ï¼ŒNATS æ˜¯ä¸€å¥—è¼ƒç‚ºå¹´è¼•çš„ MQã€‚ é›–ç„¶æœ‰éƒ¨åˆ†å­å°ˆæ¡ˆçš„ç‰ˆæœ¬æœªé” v1.0ï¼Œä½†å®˜æ–¹å®£ç¨±å·²ç¶“æ¥è¿‘ production readyã€‚ NATS å¾ä¸€é–‹å§‹å°±æ˜¯é‡å° cloud service è¨­è¨ˆï¼Œcluster mode çš„æ°´å¹³æ“´å±•ï¼Œ node ä¹‹é–“çš„èº«åˆ†é©—è­‰åŠ TLS é€šè¨Šè¨­è¨ˆçœ‹èµ·ä¾†éƒ½é‚„ä¸éŒ¯ã€‚ NATS çš„ message ä¸¦ç„¡ç‰¹åˆ¥é™åˆ¶ï¼Œåœ¨ client library å…§ä»»ä½•çš„ byte sequence éƒ½å¯ä»¥æˆç‚º messageã€‚ NATS æœ‰ä»¥ä¸‹ä¸‰å€‹æ¨¡å¼(ä»¥åŠå…¶å°æ‡‰çš„ client library)ã€‚ NATS (NATS Core)NATS å°ˆæ¡ˆå¾ä¸€é–‹å§‹ç™¼å±•æ™‚çš„åŸºæœ¬æ¨¡å¼ã€‚ æ”¯æ´ Pub/Sub pattern ä¸¦æä¾› at-most-once èªæ„ã€‚ NATS StreamingNATS Streaming æ˜¯ä¸€å¥—ç–Šåœ¨ NATS ä¸Šé¢å½¢æˆçš„ solutionã€‚ å› ç‚ºè¨­è¨ˆä¸Šçš„å•é¡Œï¼Œå¾Œä¾†åˆæœ‰äº† JetStreamï¼Œæ‰€ä»¥æˆ‘å€‘åŸºæœ¬ä¸Šä¸ç”¨ç†å®ƒï¼Œåªè¦çŸ¥é“ NATS Streaming å’Œ JetStream ä¸ä¸€æ¨£ï¼Œç¿»æ–‡ä»¶çš„æ™‚å€™ä¸è¦ç¿»éŒ¯å³å¯ã€‚ JetStreamJetStream æ˜¯å¾Œä¾†åšåœ¨ NATS å…§ï¼Œå¯é¸æ“‡æ˜¯å¦å•Ÿç”¨çš„å­ç³»çµ±ã€‚ è—‰ç”± JetStreamï¼Œ å¯ä»¥å¯¦ä½œ Producer/Consumer pattern ä¸¦æä¾› at-least-once èªæ„ã€‚ Server side æ²’ä»€éº¼éœ€è¦æ³¨æ„çš„ï¼Œåªè¦ç”¨è¼ƒæ–°ç‰ˆçš„ NATS image ä¸¦å•Ÿç”¨è¨­å®šå³å¯ã€‚ Client é–‹ç™¼å‰‡éœ€è¦æ³¨æ„ä¸€äº›æ¦‚å¿µã€‚ Subject: NATS æœ€åˆçš„æ¦‚å¿µï¼Œä»£è¡¨ä¸€äº› message çš„é›†åˆã€‚ Stream: å»ºç«‹æ–¼ä¸€æˆ–å¤šå€‹ Subject ä¹‹ä¸Šï¼Œå¯å°‡é€™äº› subject å…§çš„ message çµ±æ•´èµ·ä¾†ï¼Œä¸¦æ”¾å…¥ persistent storageã€‚ Consumer: å»ºç«‹åœ¨æŸå€‹ Stream ä¹‹ä¸‹ï¼Œå¯ä»¥ä¾åºçš„ consume å±¬æ–¼æ­¤ stream çš„ç‰¹å®š messageã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åª Subject èˆ‡ Streamï¼ŒConsumer æœ¬èº«ä¹Ÿæ˜¯å»ºç«‹åœ¨ NATS server ä¸­çš„ä¸€å€‹ç‰©ä»¶ã€‚ ç•¶åˆ©ç”¨ client library create ä¸€å€‹ Consumer æ™‚ï¼Œä¸¦ä¸æ˜¯è©² process æœ¬èº«æˆç‚ºä¸€å€‹ consumerï¼Œ è€Œæ˜¯ NATS server ä¸­è¢«å‰µäº†ä¸€å€‹ Consumer ç‰©ä»¶ï¼Œæº–å‚™å»ä½¿ç”¨ Stream è£¡é¢çš„ messageã€‚ JetStream client library ä¸¦æ²’æœ‰æä¾›ä¸€å€‹å°ç¨±çš„ producer/consumer APIã€‚ åŸºæ–¼è¡“èªçš„é™åˆ¶ä»¥åŠç‚ºäº†é¿å…èª¤æœƒï¼Œä»¥ä¸‹åœ¨ç¨±å‘¼ä¸€èˆ¬æ‰€ç¨±çš„ producer/consumer æ™‚ï¼Œ æœƒç‰¹åˆ¥åŠ ä¸Š role å¾Œç¶´ä¾†è¡¨ç¤ºã€‚ Producer role: è¦ä½¿ç”¨ NATS library å…§çš„ Publish APIï¼Œå°‡ç”¢ç”Ÿçš„ message æ¨é€è‡³ æŸå€‹ Subject å…§ã€‚ Consumer role: è¦ä½¿ç”¨ JetStream library å…§çš„ Stream APIï¼Œåœ¨ NATS server ä¸Šå°ç›®æ¨™ Subject å»ºç«‹ Streamï¼Œæ¥è‘—ä½¿ç”¨ JetStream Consumer APIï¼Œåœ¨ NATS server ä¸­ å»ºç«‹å±¬æ–¼è©² Stream çš„ Consumerã€‚ä»¥ä¸Šéƒ½å®Œæˆä¹‹å¾Œï¼Œå³å¯åˆ©ç”¨ Consumer ä¸Šçš„ NextMsg ä¾† æ¶ˆè€— messageã€‚ ConclusionJetStream çš„ API è¨­è¨ˆä¸¦ä¸å¸¸è¦‹ï¼Œéœ€è¦å…ˆèªçŸ¥åˆ°èˆ‡æ—¢æœ‰è¨­è¨ˆçš„å·®åˆ¥ä¹‹è™•æ‰èƒ½é–‹å§‹é–‹ç™¼ã€‚ ä¸éå…¶ cloud native çš„æ¶æ§‹è¨­è¨ˆæˆ–è¨±å¯ä»¥åœ¨ç¶­é‹ä¸Šé¢å‹éå…¶ä»–è€ç‰Œçš„ MQ solutionã€‚ ä»Šå¤©å°±å…ˆå¯«åˆ°é€™è£¡ï¼Œå¦‚æœæœ‰å“ªå¤©æœ‰èˆˆè¶£å†è£œå§ã€‚ :D Reference Comparing NATS, NATS Streaming and NATS JetStream | by George Koulouris | Medium AppendixGolang sample code: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128package mainimport ( &quot;context&quot; &quot;fmt&quot; &quot;log&quot; &quot;math/rand&quot; &quot;os&quot; &quot;testing&quot; &quot;time&quot; &quot;github.com/nats-io/jsm.go&quot; &quot;github.com/nats-io/jsm.go/api&quot; &quot;github.com/nats-io/nats.go&quot;)var fullSubject string = &quot;report_task.scheduled&quot;var wildcardSubject string = &quot;report_task.*&quot;func consumeOne(doneChan chan bool) { msg, err := consumer.NextMsg() if err != nil { fmt.Printf(&quot;Fail to get message: %v\\n&quot;, err) } fmt.Printf(&quot;Consume get task: %s\\n&quot;, string(msg.Data)) time.Sleep(2 * time.Second) if err := msg.Ack(); err != nil { fmt.Printf(&quot;Fail to ack the message %s: %v\\n&quot;, string(msg.Data), err) } doneChan &lt;- true}func TestProduceAndConsume(t *testing.T) { producerStopChan := make(chan bool) consumerStopChan := make(chan bool) var taskCount int = 1 go func() { for idx := 0; idx &lt; taskCount; idx++ { taskName := fmt.Sprintf(&quot;task #%d&quot;, rand.Int()) nc.Publish(fullSubject, []byte(taskName)) fmt.Printf(&quot;Producer produce: %s\\n&quot;, taskName) } producerStopChan &lt;- true }() for idx := 0; idx &lt; taskCount; idx++ { go func() { consumeOne(consumerStopChan) }() } &lt;-producerStopChan for idx := 0; idx &lt; taskCount; idx++ { &lt;-consumerStopChan } fmt.Println(&quot;Done&quot;)}var ctx context.Contextvar cancel context.CancelFuncvar nc *nats.Connvar stream *jsm.Streamvar consumer *jsm.Consumerfunc setup() { var err error ctx, cancel = context.WithTimeout(context.Background(), 10*time.Second) nc, err = nats.Connect(nats.DefaultURL, nats.UserInfo(&quot;name&quot;, &quot;password&quot;), nats.UseOldRequestStyle()) if err != nil { log.Fatal(err) } jsmgr, err := jsm.New(nc) if err != nil { log.Fatal(err) } streamName := &quot;ReportTask&quot; stream, err = jsmgr.LoadOrNewStreamFromDefault(streamName, api.StreamConfig{ Subjects: []string{wildcardSubject}, Storage: api.FileStorage, Retention: api.LimitsPolicy, Discard: api.DiscardOld, MaxConsumers: -1, MaxMsgs: -1, MaxBytes: -1, MaxAge: 24 * time.Hour, MaxMsgSize: -1, Replicas: 1, NoAck: false, }) if err != nil { log.Fatal(err) } consumerName := &quot;Generator&quot; consumer, err = stream.LoadOrNewConsumerFromDefault(consumerName, api.ConsumerConfig{ Durable: consumerName, DeliverPolicy: api.DeliverNew, FilterSubject: fullSubject, AckPolicy: api.AckExplicit, AckWait: 30 * time.Second, MaxDeliver: 5, ReplayPolicy: api.ReplayInstant, SampleFrequency: &quot;0%&quot;, }) if err != nil { log.Fatal(err) }}func shutdown() { cancel()}func TestMain(m *testing.M) { setup() code := m.Run() shutdown() os.Exit(code)}","link":"/2021/07/28/nats-brief-intro.html"},{"title":"Pipeline Style Map-Reduce in Python","text":"Since C++20, C++ provide a new style of data processing, and the ability of lazy evaluation by chaining the iterator to another iterator. 123456789#include &lt;ranges&gt;#include &lt;vector&gt;int main() { std::vector&lt;int&gt; input = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}; auto output = input | std::views::filter([](const int n) {return n % 3 == 0;}) | std::views::transform([](const int n) {return n * n;}); // now output is [0, 9, 36, 81], conceptually} Can we use this style in Python? Yes! :D Evaluation of OperatorsIn Python, all expression evolves a arithmetic operator, e.g. a + b, is evaluate by follow rule If the (forward) special method, e.g. __add__ exists on left operand Itâ€™s invoked on left operand, e.g. a.__add__(b) If the invocation return some meaningful value other than NotImplemented, done! If the (forward) special method does not exist, or the invocation returns NotImplemented, then If the reverse special method, e.g. __radd__ exists on right operand Itâ€™s invoked on the right operator, e.g. b.__radd__(a) If the invocation return some meaningful value other than NotImplemented, done! Otherwise, TypeError is raised So it seems possible hereâ€¦ Letâ€™s make a quick experiment 123456789class Adder: def __init__(self, rhs: int) -&gt; None: self._rhs = rhs def __ror__(self, lhs: int) -&gt; int: return lhs + self._rhsassert 5 == 2 | Adder(3) # Is 5 equals to 2 + 3 ? Yes!! This works because the | operator of integer 2 check the type of Adder(3) and found that is not something it recognized, so it returns NotImplemented and our reverse magic method goes. In C++, the | operator is overloaded(?) on range adaptors to accept ranges. So maybe we can make something similar, having some object implements __ror__ that accept an iterable and return another value (probably a iterator). Pipe-able Higher Order FunctionSo back to our motivation, Python already have something like filter map reduce, and also the powerful generator expression to filter and/or map without explicit function call. 1values = filter(lambda v: v % 2 == 0, range(10)) 1values = (v for v in range(10) if v % 2 == 0) But itâ€™s just hard to chain multiple operations together while preserving readability. So letâ€™s make a filter object that support | operator 123456789101112class Filter: def __init__(self, predicate: Callable[[int], bool]) -&gt; None: self._predicate = predicate def __ror__(self, values: Iterable[int]) -&gt; Iterator[int]: for value in values: if self._predicate(value): yield valueselected = range(10) | Filter(lambda val: val % 2 == 0)assert [0, 2, 4, 6, 8] == list(selected) How about map? 1234567891011class Mapper: def __init__(self, transform: Callable[[int], int]) -&gt; None: self._transform = transform def __ror__(self, values: Iterable[int]) -&gt; Iterator[int]: for value in values: yield self._transform(value)processed = range(3) | Mapper(lambda val: val * 2)assert [0, 2, 4] == list(processed) Works well, we are great again!! It just take some time for we to write the class representation for filter, map, reduce, take, any â€¦ and any higher function you may think useful. Wait, it looks so tedious. Python should be a powerful language, isnâ€™t it? Piper and DecoratorsThe function capturing and __ror__ implementation can be so annoying for all high order function. If we can make sure __ror__ only take left operand, and return the return value of the captured function, than we can extract a common Piper class. We just need another function to produce a function that already capture the required logic. 12345678910111213141516171819class Piper(Generic[_T, _U]): def __init__(self, func: Callable[[_T], _U]) -&gt; None: self._func = func def __ror__(self, lhs: _T) -&gt; _U: return self._func(lhs)def filter_wrapped(predicate: Callable[[_T], bool]): def apply(items: Iterable[_T]) -&gt; Iterator[_T]: for item in items: if predicate(item): yield item return Piper(apply)selected = range(10) | filter_wrapped(lambda val: val % 2 == 0)assert [0, 2, 4, 6, 8] == list(selected) Now it looks a little nicer â€¦ but we still need to implement all wrapper functions for all kinds of operations? Again, the only difference between these wrapped functions is the logic inside apply function, so we can extract this part again, with a decorator!! :D 12345678910111213141516171819def on(func: Callable[Concatenate[_T, _P], _R]) -&gt; Callable[_P, Piper[_T, _R]]: def wrapped(*args: _P.args, **kwargs: _P.kwargs) -&gt; Piper[_T, _R]: def apply(head: _T) -&gt; _R: return func(head, *args, **kwargs) return Piper(apply) return wrapped@ondef filter(items: Iterable[_T], predicate: Callable[[_T], bool]) -&gt; Iterator[_T]: for item in items: if predicate(item): yield itemselected = range(10) | filter(lambda val: val % 2 == 0)assert [0, 2, 4, 6, 8] == list(selected) The on decorator accept some function func, and return a function that first take the tail arguments of func and return a function that accept head argument of func through pipe operator. So now we can express our thoughts in our codebase using pipeline style code, just with one helper class and one helper decorator! :D 12345678values = range(10)result = ( values | filter(lambda val: val % 2 == 0) | map(str) | on(lambda chunks: &quot;&quot;.join(chunks))() # create pipe-able object on the fly)assert result == &quot;02468&quot; or 12for val in range(10) | filter(lambda val: val % 2 == 0): print(val) AppendixComplete type-safe code here 1234567891011121314151617181920212223242526272829303132333435363738394041&quot;&quot;&quot;pipe is a module that make it easy to write higher-order pipeline function&quot;&quot;&quot;from collections.abc import Callable, Iterable, Iteratorfrom typing import Generic, TypeVar, ParamSpec, Concatenate_R = TypeVar(&quot;_R&quot;)_T = TypeVar(&quot;_T&quot;)_P = ParamSpec(&quot;_P&quot;)class Piper(Generic[_T, _R]): &quot;&quot;&quot; Piper[T, R] is a function that accept T and return R call the piper with &quot;value_t | piper_t_r&quot; &quot;&quot;&quot; def __init__(self, func: Callable[[_T], _R]) -&gt; None: self._func = func def __ror__(self, items: _T) -&gt; _R: return self._func(items)def on(func: Callable[Concatenate[_T, _P], _R]) -&gt; Callable[_P, Piper[_T, _R]]: &quot;&quot;&quot; &quot;on&quot; decorates a func into pipe-style function. The result function first takes the arguments, excluding first, and returns an object that takes the first argument through &quot;|&quot; operator. &quot;&quot;&quot; def wrapped(*args: _P.args, **kwargs: _P.kwargs) -&gt; Piper[_T, _R]: def apply(head: _T) -&gt; _R: return func(head, *args, **kwargs) return Piper(apply) return wrapped","link":"/2024/07/13/pipeline-style-python.html"},{"title":"Python çš„ type ä¸æ˜¯ typeï¼Ÿ","text":"Introè¿‘æœŸå› ç‚ºä¸€äº›åŸå› ï¼Œæƒ³è‡ªå·±å¯«ä¸€å€‹ Python ç”¨çš„ DI libraryã€‚å¯«æ˜¯å¯«å®Œäº†ï¼Œä¸å« test åŸºæœ¬ä¸Šä¸åˆ° 50 è¡Œï¼Œ ä¹Ÿ release åˆ° luckydep Â· PyPI äº†ã€‚ ä¸éåœ¨å¯«çš„éç¨‹ä¸­ç™¼ç¾äº†ä¸€äº›å•é¡Œã€‚ èˆ‡ Golang ä¸åŒã€‚ åœ¨ Python ä¸­ï¼ŒDI container æ‹¿å–ç‰¹å®š instance çš„ä»‹é¢ (invoke/bind/get ç­‰ï¼Œä¸‹ç¨± invoke) éœ€è¦æ˜ç¢ºå‚³éæƒ³æ‹¿å–çš„ instance çš„ typeã€‚ 1234567func Invoke[T any](c *Container) T { var _ T // can construct T event if T is a interface}// although we need to specify the type parameter, the type parameter// is not passed during runtimevar instance = Invoke[SomeType](c) 12345class Container: def invoke(t): # search and build a instance of type tc = Container()instance = c.invoke(SomeType) # need to pass type as a parameter å…¶ä¸­çš„æ ¹æœ¬å·®ç•°æ˜¯ï¼ŒGolang é¡å‹çš„ static type languageï¼Œgeneric function æœƒçœŸçš„æ ¹æ“šä¸åŒå‹åˆ¥ï¼Œç”¢ç”Ÿå°æ‡‰çš„ function å‡ºä¾†ï¼Œé€™äº› function çš„ byte code/machine code è‡ªç„¶çŸ¥é“ç•¶ä¸‹åœ¨è™•ç†çš„å‹åˆ¥ã€‚ è€Œ Python é€™é¡èªè¨€ï¼Œé  static type checker å»ºç«‹ generic functionï¼Œå¯¦éš›ä¸Šåˆ° runtime æ™‚é‚„æ˜¯åªæœ‰ä¸€å€‹ functionï¼Œè‡ªç„¶æœƒéœ€è¦å‚³é type çµ¦ invoke ä»‹é¢ã€‚ è‡ªå¾ Python 3.6 é–‹å§‹æˆ‘å€‘æœ‰ type hintï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ annotate function/method ä¾†å¹«åŠ© IDE/type checker ä¾†æ¨è«–æ­£ç¢ºçš„å‹åˆ¥ã€‚ 12345class Container: def invoke(t: type[T]) -&gt; T: # search and build a instance of type tc = Container()instance: SomeType = c.invoke(SomeType) # ok, we can infer instance is SomeType é€™é‚Š type[T] (or typing.Type[T], the old way) ç”¨ä¾†è¡¨ç¤ºæˆ‘å€‘æ­£åœ¨ç”¨ t ä¾†å‚³éå‚³éæŸå€‹ type Tï¼Œ è€Œé type ç‚º T çš„æŸå€‹ instanceã€‚ From typing document: A variable annotated with C may accept a value of type C. In contrast, a variable annotated with type[C] (or typing.Type[C]) may accept values that are classes themselves The ProblemOKï¼Œæˆ‘å€‘æœ‰ type[T] å¯ä»¥ç”¨ã€‚ DI library é–‹ç™¼è€…å¯ä»¥ç”¨å‹åˆ¥ç‚º type[T] çš„ t ä¾†åš indexingï¼Œ library ä½¿ç”¨è€…å¯ä»¥äº«å—åˆ° static type checker å¸¶ä¾†çš„ type safetyã€‚ æ–¼æ˜¯æˆ‘å€‘æ‹¿é€™å€‹ library ä¾†ç”¨åœ¨çœŸå¯¦æƒ…å¢ƒ.. æ²’æƒ³åˆ°ä¸€ä¸‹å­å°±ç¢°ä¸Šå•é¡Œäº†ã€‚ ç•¶æˆ‘å€‘å®šç¾© interface typeï¼Œä¸¦é€é DI container å°è©² interface æ‹¿å–å°æ‡‰çš„ implementation instance æ™‚ã€‚ å› ç‚º interface é€šå¸¸æ˜¯å€‹ abstract class (or protocol)ï¼Œmypy type checker æœƒå ±éŒ¯ (mypy: type-abstract)ã€‚ 1234567class SomeInterface(Protocol): def hello(self): ...class SomeImplementation: def hello(self): ...c.invoke(SomeInterface) # trigger mypy error [type-abstract] ä¸æœƒå§â€¦ é€™ä¸æ˜¯æˆ‘å€‘éœ€è¦ DI çš„æœ€é‡è¦åŸå› å—ï¼Ÿ æˆ‘å€‘å®šç¾© interface ä¸¦å¦å¤–æä¾› implementationï¼Œä¾†é”åˆ°éš”é›¢ä¸åŒ class è·è²¬çš„æ•ˆæœã€‚ çµæœç•¶ user è¦ç”¨é€™å€‹ library çš„æ™‚å€™å»å¡åœ¨å‹åˆ¥æª¢æŸ¥â€¦ The Historyç¿»é–±æ–‡ä»¶ï¼Œç¬¬ä¸€æ™‚é–“ä»¥ç‚ºé€™æ˜¯ mypy çš„è¨­è¨ˆå•é¡Œã€‚ Mypy always allows instantiating (calling) type objects typed as Type[t] æ²’æƒ³åˆ°ç¿»äº† mypy issue #4717 Â· python/mypy å¾Œï¼Œç™¼ç¾é€™æ˜¯å·²ç¶“å¯«åœ¨ PEP 544 å…§çš„è¦æ ¼ã€‚ Variables and parameters annotated with Type[Proto] accept only concrete (non-protocol) subtypes of Proto. The main reason for this is to allow instantiation of parameters with such type. For example: 12def fun(cls: Type[Proto]) -&gt; int: return cls().meth() # OK mypy å…è¨± construct ä¸€å€‹ä¸çŸ¥é“ constructor é•·ä»€éº¼æ¨£å­çš„ interface typeï¼Œ æ‰€ä»¥è©²æ¨™ç¤º Type[Proto] çš„ parameter åªèƒ½å‚³é concrete typeâ€¦ å—¯ï¼Ÿ ç¹¼çºŒå¾€ä¸‹è¿½ï¼Œæƒ³ä¸åˆ°ä¸€é–‹å§‹æœƒæœ‰é€™å€‹æª¢æŸ¥ï¼Œæ˜¯å› ç‚º Guido æœ¬äºº åœ¨ 2016 å¹´é–‹çš„ #1843 Â· python/mypyï¼Œ èªç‚ºæ‡‰è©²å…è¨±é€™ç¨®ä½¿ç”¨æ–¹æ³•ã€‚ æ–¼æ˜¯ mypy åŠ å…¥äº†é€™å€‹æª¢æŸ¥ï¼Œå¾Œä¾† 2017 å¹´çš„ PEP 544 ä¹Ÿæ˜ç¢ºå®šç¾©äº†é€™å€‹ä½¿ç”¨è¦å‰‡ã€‚ The Controversyé€™å€‹ t: type[T] çš„è¨­è¨ˆå¼•èµ·å¾ˆå¤šçˆ­è­°ï¼Œå¾ #4717 Â· python/mypy ä¾†çœ‹ï¼Œä¸å°‘äººèªç‚º: ç‚ºäº†å…è¨± construct t() è€Œé™åˆ¶åªèƒ½å‚³é concrete class æœƒå¤§å¹…é™åˆ¶é€™å€‹ type[T] çš„ä½¿ç”¨æƒ…å¢ƒã€‚ ä¹Ÿæœ‰äººèªç‚ºé€™å€‹æª¢æŸ¥æ ¹æœ¬å°±ä¸åˆç†ï¼Œå› ç‚ºæ²’æœ‰äººèƒ½ä¿è­‰é€™å€‹ protocol type åº•ä¸‹çš„ concrete class çš„ constructor åˆ°åº•è¦åƒä»€éº¼æ±è¥¿ã€‚ å³ä½¿ static type check æª¢æŸ¥éäº†ï¼Œt() åœ¨ runtime å™´æ‰ä¸€é»ä¹Ÿä¸å¥‡æ€ªã€‚ æ›´ä½•æ³æ ¹æœ¬æ²’çœ‹éæœ‰äººåœ¨ protocol type ä¸Šé¢å®šç¾© __init__ methodï¼Œé€™å€‹ t() ä¸€é–‹å§‹åˆ°åº•è¦æ€éº¼æª¢æŸ¥ä¹Ÿä¸çŸ¥é“ã€‚ å¦‚æœçœ‹ç›¸å…¶ä»–èªè¨€çš„é–‹ç™¼ç¶“é©—â€¦ Golang ç”Ÿæ…‹ç³» constructor æ˜¯ plain functionï¼Œå®šç¾© interface type æ™‚è‡ªç„¶ä¸æœƒåŒ…å« constructorã€‚ å¯« C++ çš„äººæ‡‰è©²ä¹Ÿæ²’è½éä»€éº¼ abstract constructorï¼Œåªæœ‰ destructor æœƒæ› abstract keywordã€‚ å›åˆ° Python è‡ªèº«ï¼Œmypy å’Œ pyright å…©å¤§å·¥å…·ä¹Ÿéƒ½å…è¨± __init__ çš„ signature åœ¨ç¹¼æ‰¿éŠä¸­è¢«ä¿®æ”¹ã€‚ (see: python/typing Â· Discussion #1305) è‡³æ–¼ typing.Type çš„æ–‡ä»¶ï¼Œå¯«å¾—å¾ˆæ¨¡ç³Šï¼Œæˆ‘æƒ³æœ‰ä¸€å®šç¨‹åº¦çš„äººçœ‹åˆ°åè€Œæ›´å®¹æ˜“èª¤æœƒã€‚ type[C] â€¦ may accept values that are classes themselves â€¦ å°±ç®—æ¨æ£„æ‰ protocolï¼Œé™åˆ¶éƒ½åªèƒ½ç”¨ concrete class ä¾†å®šç¾© interfaceã€‚ é€™å€‹åªèƒ½å…è¨± concrete class çš„è¦å‰‡é‚„é€ æˆäº†å¦ä¸€å€‹å•é¡Œ: ä½¿ç”¨è€…è©²å¦‚ä½•å‚³é function typeï¼Ÿ 1c.register(Callable[[int, int], int], lambda a, b: a + b) # ???? èªªå¥½çš„ function as first-class citizen å‘¢ï¼Ÿ æ€éº¼åˆ°äº†è¦å‚³éå‹åˆ¥æ™‚å°±ä¸è¡Œäº†ï¼Ÿ åœ¨ç¿»é–± issue çš„éç¨‹ä¸­ï¼Œç™¼ç¾å…¶ä»– DI framework çš„ repo ä¹Ÿé‡ä¸ŠåŒæ¨£çš„å•é¡Œ #143 Â· python-injector/injectorï¼Œ é “æ™‚è¦ºå¾—è‡ªå·±ä¸å­¤å–®ã€‚ The Futureç”±æ–¼ PEP 544 è‡ªå¾ 2017 å¹´å°±å·²ç¶“å®Œæˆï¼Œmypy é è¨­åŸ·è¡Œé€™å€‹æª¢æŸ¥ä¹Ÿè¡Œä¹‹æœ‰å¹´ï¼Œ ç¾åœ¨å†ä¾†æ”¹é€™å€‹è¡Œç‚ºæˆ–è¨±å·²ç¶“ä¾†ä¸åŠäº†ã€‚ æ–¼æ˜¯ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œ2020 æœ‰äººåœ¨é–‹äº†æ–° issue 9773 Â· python/mypy æƒ³è¦å®šç¾©æ–°çš„ annotation TypeForm[T]/TypeExpr[T] ä¾†é”æˆè¦è¡¨é”ä»»æ„ type çš„ type çš„éœ€æ±‚ã€‚ åˆ°ç›®å‰ (2024-06)ï¼Œå°æ‡‰çš„ PEP 747 draft ä¹Ÿå·²ç¶“è¢«æå‡ºäº†ã€‚ è‹¥ä¸€åˆ‡é †åˆ©ï¼Œä»¥å¾Œæˆ‘å€‘å°±æœƒç”¨ TypeExpr[T] ä¾†è¡¨é”é€™é¡ generic function 12345678class Container: def invoke(t: TypeExpr[T]) -&gt; T: # search and build a instance of type tclass SomeType(Protocol): ...c = Container()instance = c.invoke(SomeType) # ok, we find a object for type SomeType for you!operator = c.invoke(Callable[[int], bool]) # you need a (int -&gt; bool)? no problem! è‡³æ–¼ç›®å‰å˜›.. library user åœ¨ä½¿ç”¨åˆ°é€™é¡ library çš„æª”æ¡ˆåŠ å…¥ä¸‹é¢é€™è¡Œå³å¯ã€‚ æˆ‘æƒ³è¦ä¿®æ”¹çš„ç¯„åœå’Œé€ æˆçš„å½±éŸ¿æ‡‰è©²éƒ½é‚„å¯ä»¥æ¥å—ã€‚ 1# mypy: disable-error-code=&quot;type-abstract&quot; æœŸè¨± Python typing system å®Œå¥½çš„é‚£å¤©åˆ°ä¾†ã€‚ Timeline 2016-07: #1843 Â· python/mypy Guido æå‡ºè¦ instantiate çš„éœ€æ±‚ 2017-05: PEP 544 standardized and published 2018-05: #4717 Â· python/mypy first discussion against type[T] design 2020-04: #143 Â· python-injector/injector 2020-10: #9773 Â· python/mypy propose idea of TypeFrom[T] 2024-06: PEP 747 draft created","link":"/2024/06/05/python-type-expression.html"},{"title":"åœ¨ macOS ä¸Šæ¶è¨­ Apache èˆ‡ PHP-FPM","text":"å·¥ä½œä¸Šå› ç‚ºä¸€äº›ç‰¹æ®Šéœ€æ±‚ï¼Œéœ€è¦åœ¨ macOS ç’°å¢ƒä¸‹æ¶è¨­ Apache + PHP-FPM çš„ä½¿ç”¨ç’°å¢ƒã€‚å¥½åœ¨ macOS æœ¬ä¾†å°±æœ‰é è£ Apache ä»¥åŠ PHP-FPMï¼Œä¸¦æä¾› Apache çš„ launchd è¨­å®šæª”ï¼Œè¦åœ¨ macOS ä¸Šæ¶è¨­é€™å€‹æœå‹™ä¸¦ä¸å›°é›£ã€‚ æœ¬æ–‡ä»‹ç´¹å¦‚ä½•ä»¥æœ€ä½é™åº¦çš„è¨­å®šï¼Œåœ¨ macOS ä¸Šè·‘ Apache + PHP-FPMã€‚ä»¥ç­†è¨˜çš„æ–¹å¼å‘ˆç¾ï¼Œä¸æœƒæœ‰å¤ªå¤šçš„è¬›è§£ã€‚ Notes ç­†è€…æ˜¯åœ¨ macOS 10.14 èˆ‡ 10.15 ä¸Šæ¸¬è©¦æ­¤æµç¨‹ macOS ç³»çµ±ä¸Šï¼Œ/etc æ˜¯ä¸€å€‹ symblic link é€£è‡³ /private/etcï¼Œ /var, /tmp ä¹Ÿæœ‰ç›¸åŒè¡Œç‚ºã€‚ è¨­å®šèˆ‡å•Ÿç”¨ PHP-FPMè¤‡è£½ä¸¦ä¿®æ”¹ PHP-FPM è¨­å®šæª”ç³»çµ±å…§æœ‰æœƒè‡ªå¸¶ PHP-FPM çš„ default è¨­å®šæª”ï¼Œå°‡å…¶è¤‡è£½ä¸€ä»½å‡ºä¾†ï¼Œä¸¦ä¿®æ”¹å…§å®¹ã€‚ 12$ sudo cp /etc/php-fpm.conf.default /etc/php-fpm.conf$ sudo cp /etc/php-fpm.d/www.conf.default /etc/php-fpm.d/www.conf å°‡åŸ·è¡Œèº«åˆ†å¾ nobody ä¿®æ”¹ç‚º _www (èˆ‡ Apache httpdä¸€è‡´)ã€‚ 1$ sudo vim /etc/php-fpm.d/www.conf 12345; Unix user/group of processes; Note: The user is mandatory. If the group is not set, the default user's group; will be used.user = _wwwgroup = _www ä¿®æ”¹ error_logï¼Œèª¿æ•´ log file çš„è·¯å¾‘ã€‚ 1$ sudo vim /etc/php-fpm.conf 123456; Error log file; If it's set to &quot;syslog&quot;, log is sent to syslogd instead of being written; into a local file.; Note: the default prefix is /usr/var; Default Value: log/php-fpm.logerror_log = /var/log/php-fpm.log æ–°å¢ PHP-FPM çš„ launchd è¨­å®šæª”ä¸¦å•Ÿç”¨å‰µä¸€å€‹ launchd daemon è¨­å®šæª”çµ¦ PHP-FPM ä½¿ç”¨ï¼Œ æ­¤èˆ‰ç›®çš„ç‚ºè®“ PHP-FPM daemon å¯ä»¥åœ¨ macOS é–‹æ©Ÿæ™‚è‡ªå·±å•Ÿç”¨ã€‚ å»ºè­°å°‡è¨­å®šæª”æ”¾åœ¨ /Library/LaunchDaemons ä¸‹ï¼Œåƒç…§ launchd çš„æ–‡ä»¶ï¼Œ æ­¤ä½ç½®æ˜¯ä¾›ç¬¬ä¸‰æ–¹è»Ÿé«”æ“ºæ”¾ daemon è¨­å®šä½¿ç”¨ã€‚ 1$ sudo vim /Library/LaunchDaemons/com.example.php-fpm.plist 1234567891011121314151617&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt; &lt;key&gt;Disabled&lt;/key&gt; &lt;true/&gt; &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;com.example.php-fpm&lt;/string&gt; &lt;key&gt;ProgramArguments&lt;/key&gt; &lt;array&gt; &lt;string&gt;/usr/sbin/php-fpm&lt;/string&gt; &lt;string&gt;--nodaemonize&lt;/string&gt; &lt;/array&gt; &lt;key&gt;OnDemand&lt;/key&gt; &lt;false/&gt;&lt;/dict&gt;&lt;/plist&gt; åšå¥½è¨­å®šæª”ä¹‹å¾Œï¼Œç”¨ launchctl æŒ‡ä»¤ load æ­¤è¨­å®šæª”ï¼Œä¸¦ä¸‹åƒæ•¸å‘Šè¨´ macOS ä¹‹å¾Œæ­¤ daemon è¦åœ¨é–‹æ©Ÿæ™‚é è¨­å•Ÿç”¨ã€‚ 1$ sudo launchctl load -w /Library/LaunchDaemons/com.example.php-fpm.plist ä¸Šè¿°æŒ‡ä»¤åŸ·è¡Œå®Œå¾Œï¼Œ launchd æœƒæŠŠ PHP-FPM daemon å«èµ·ã€‚ 1234$ ps aux | grep php_www 515 0.0 0.0 4297608 648 ?? S 6:18PM 0:00.00 /usr/sbin/php-fpm_www 514 0.0 0.0 4305800 628 ?? S 6:18PM 0:00.00 /usr/sbin/php-fpmroot 513 0.0 0.0 4305800 784 ?? Ss 6:18PM 0:00.00 /usr/sbin/php-fpm è¨­å®šä¸¦å•Ÿç”¨ Apache Web Serverä¿®æ”¹è¨­å®šæª”ï¼Œè®“ Apache ä½¿ç”¨ proxy_module èˆ‡ proxy_fcgi_moduleï¼Œ ä¸¦ç¢ºèª php7_module æ²’è¢«å•Ÿç”¨ã€‚ éœ€è¦æœ¬æ–‡çš„è®€è€…æ‡‰è©²ä¸è‡³æ–¼æŠŠ Apache PHP module èˆ‡ PHP-FPM ææ··.. XD 1$ sudo vim /etc/apache2/httpd.conf 123LoadModule proxy_module libexec/apache2/mod_proxy.soLoadModule proxy_fcgi_module libexec/apache2/mod_proxy_fcgi.so# LoadModule php7_module libexec/apache2/libphp7.so åœ¨ &lt;Directory &quot;/Library/WebServer/Documents&quot;&gt; æˆ–å…¶ä»–éœ€è¦çš„åœ°æ–¹å…§ï¼Œ åŠ å…¥ PHP çš„ handlerï¼ŒæŒ‡å‘ PHP-FPM é è¨­æä¾›æœå‹™çš„ socketã€‚ 1234567&lt;Directory &quot;/Library/WebServer/Documents&quot;&gt;... ä¸Šç•¥ &lt;FilesMatch \\.php$&gt; SetHandler &quot;proxy:fcgi://localhost:9000/&quot; &lt;/FilesMatch&gt;&lt;/Directory&gt; Apache çš„ daemon config æœ¬ä¾†å°±å­˜åœ¨æ–¼ç³»çµ±ç›®éŒ„å…§ï¼Œä½† Disable çš„å€¼è¢«è¨­ç‚º trueï¼Œ ç”¨ä¸‹è¿° command å°‡ Apache daemon load é€² launchd å…§ï¼Œä¸¦è®“ launchd è¨˜éŒ„æ­¤ daemon æ‡‰è¢«å•Ÿç”¨ã€‚ 1sudo launchctl load -w /System/Library/LaunchDaemons/org.apache.httpd.plist èˆ‡ PHP-FPM ç›¸åŒï¼Œæ­¤æŒ‡ä»¤ä¸‹å»ä¹‹å¾Œï¼Œlaunchd å°±æœƒæŠŠ Apache æ‹‰èµ·ã€‚ æ­¤æ™‚å¯å» http://localhost/ ç¢ºèªï¼Œå¦‚æœçœ‹åˆ°å¤§å¤§çš„æ¨™é¡Œå¯«è‘— It works! å³ä»£è¡¨ Apache æœ‰é †åˆ©åŸ·è¡Œã€‚ ç¢ºèª PHP-FPM é‹ä½œæ­£å¸¸ä¸Ÿä¸€å€‹ phpinfo åˆ° web server çš„é è¨­æ ¹ç›®éŒ„ä¸‹ã€‚ 1$ sudo vim /Library/WebServer/Documents/phpinfo.php 123&lt;?php phpinfo();?&gt; ä¹‹å¾Œé€£ä¸Š http://localhost/phpinfo.php ï¼Œçœ‹åˆ° Server API ç‚º FPM/FastCGI å³å¯ã€‚ :D Useful Links A launchd Tutorial","link":"/2019/11/09/run-apache-and-php-fpm-in-macos.html"},{"title":"åœ¨ Ubuntu Server ä¸Šè‡ªå‹•å•Ÿç”¨ SSH Agent","text":"ç•¶ æˆ‘å€‘çš„ SSH private key æœ‰ä¸Š pass phrase ä¿è­·æ™‚ï¼Œ SSH agent æ˜¯å€‹æ–¹ä¾¿çš„å¥½æ±è¥¿ã€‚å› ç‚ºå®ƒå¯ä»¥å¹«æˆ‘å€‘è¨˜ä½å·²ç¶“è§£é–éçš„ private keyã€‚ å¯æƒœçš„æ˜¯ï¼ŒUbuntu server 18.04 çš„ç’°å¢ƒé è¨­ä¸¦ä¸æœƒå¹«ä½ ç”Ÿä¸€å€‹ SSH agent å‡ºä¾†ã€‚ æœ¬æ–‡ç« è¨˜éŒ„ä¸€é»æ‘¸ç´¢çš„éç¨‹â€¦ ç³»çµ±è‡ªå¸¶çš„ SSH agent systemd unit æˆ‘çœ‹åˆ¥äººçš„ Ubuntu ç™»å…¥ä¹‹å¾Œå°±æœ‰ SSH agent å¯ä»¥ç”¨å•Šï¼Ÿ å¾ˆå¯æƒœçš„æ˜¯æˆ‘çš„ç’°å¢ƒæ²’æœ‰ã€‚ç ”ç©¶ä¸€é™£å­ä¹‹å¾Œï¼Œç™¼ç¾ SSH agent æ‡‰æ˜¯åœ¨æœ‰åœ–å½¢ä»‹é¢ çš„æƒ…æ³ä¸‹æ‰æœƒè¢«è‡ªå‹•å¸¶èµ·ã€‚ åœ¨ dpkg --listfiles openssh-client ä¸‹å¯çœ‹åˆ°å¹¾å€‹é‡è¦çš„æª”æ¡ˆ /usr/lib/openssh/launch-agent /usr/lib/systemd/user/ssh-agent.service /usr/lib/systemd/user/graphical-session-pre.target.wants/ssh-agent.service çœ‹äº†é€™å¹¾å€‹æª”æ¡ˆçš„å…§å®¹å¾Œå¯å¾—çŸ¥ é€™æ˜¯è¨­è¨ˆçµ¦åœ–å½¢ä»‹é¢çš„ç™»å…¥ session ä½¿ç”¨çš„ service å³ä½¿æƒ³è¦ç›´æ¥ enable ssh-agent.service ä¹Ÿç„¡æ³•ï¼Œå› ç‚ºè£¡é¢æ²’æœ‰å¯«ä»»ä½•çš„ [Install] åƒæ•¸ è‡ªè¡Œæ’°å¯«ä¸¦å•Ÿç”¨ä¸€å€‹ SSH agent æœå‹™ç‚ºäº†è§£æ±ºæ²’æœ‰ SSH agent çš„å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥è‡ªå·±å¯«ä¸€å€‹ systemd çš„ user serviceï¼Œ è®“ç³»çµ±åœ¨ç™¼ç¾æˆ‘ç™»å…¥ä¹‹å¾Œï¼Œè‡ªå‹•å¹«æˆ‘æŠŠ SSH agent æ‹‰èµ·ä¾†ã€‚ é¦–å…ˆç·¨è¼¯ ~/.local/share/systemd/user/ssh-agent.service (åƒè€ƒ man systemd.unit æ­¤ç‚ºé è¨­çš„ user unit è·¯å¾‘) 123456789[Unit]Description=SSH authentication agent[Service]ExecStart=/usr/bin/ssh-agent -a %t/ssh-agent.socket -DType=simple[Install]WantedBy=default.target æ³¨æ„ ssh-agent çš„ -D åƒæ•¸èˆ‡ Type=simple è¨­å®šã€‚ æ¥è‘—åŸ·è¡Œ systemctl --user enable ssh-agent.serviceã€‚ é€™ä¸€æ­¥æœƒåœ¨ .config/systemd/user/default.target.wants è³‡æ–™å¤¾ä¸‹å‰µå‡ºä¸€å€‹ symbolic linkï¼Œ é€£å›å‰›å‰›æˆ‘å€‘å¯«çš„ service fileï¼Œè¡¨ç¤ºè¦åœ¨ç™»å…¥æ™‚è‡ªå‹•å•Ÿç”¨æ­¤ unitã€‚ æ¥è‘—é‡æ–°ç™»å…¥è©²æ©Ÿå™¨ï¼Œæ‡‰è©²å°±å¯ä»¥çœ‹åˆ°ä¸€å€‹ ssh-agent process è·‘èµ·ä¾†äº†ã€‚ è¨­å®š SSH agent æ‰€éœ€çš„çš„ç’°å¢ƒè®Šæ•¸é›–ç„¶ SSH agent èµ·ä¾†äº†ï¼Œä½†æ­¤æ™‚è‹¥ä¸‹ ssh-add -L ä¾ç„¶æœƒç™¼ç¾ç„¡æ³•é€£ä¸Š SSH agentã€‚ Could not open a connection to your authentication agent. é€™æ˜¯å› ç‚º ssh ä»¥åŠ ssh-add ç­‰å·¥å…·é è¨­éƒ½æ˜¯çœ‹ SSH_AUTH_SOCK ç’°å¢ƒè®Šæ•¸ä¾†å¾—çŸ¥ è¦é€éå“ªå€‹ Unix socket èˆ‡ agent æºé€šã€‚ ç‚ºäº†è™•ç†æ­¤å•é¡Œï¼Œæˆ‘å€‘éœ€åœ¨ ~/.profile å…§åŠ å…¥ä¸€è¡Œç’°å¢ƒè®Šæ•¸è¨­å®šï¼Œç¢ºä¿åœ¨ç™»å…¥æ™‚èƒ½è‡ªå‹•è¨­å®šå®Œæˆã€‚ 1export SSH_AUTH_SOCK=&quot;$XDG_RUNTIME_DIR/ssh-agent.socket&quot; è¨»: $XDG_RUNTIME_DIR/ssh-agent.socket èˆ‡å‰è¿° unit file å…§çš„ -a %t/ssh-agent.socket å°æ‡‰ã€‚è©³ç´°å¯åƒè€ƒ man systemd.unit ä¸‹æ¬¡ç™»å…¥é‡æ–°è®€å– profile ä¹‹å¾Œå³å¯æ­£å¸¸ä½¿ç”¨ SSH agent å›‰ã€‚ :D Alternative Solutionå°‹æ‰¾è§£æ±ºæ–¹å¼çš„éç¨‹ä¸­ï¼Œæ³¨æ„åˆ°äº†ä¸€äº›è§£æ³•ï¼Œé€éç´” shell script çš„æ–¹å¼è™•ç†é‡è¤‡ç™»å…¥çš„å•é¡Œ 1234567891011121314151617SSH_ENV=&quot;$HOME/.ssh/environment&quot;function start_agent { /usr/bin/ssh-agent | sed 's/^echo/#echo/' &gt; &quot;${SSH_ENV}&quot; chmod 600 &quot;${SSH_ENV}&quot; . &quot;${SSH_ENV}&quot; &gt; /dev/null /usr/bin/ssh-add;}if [ -f &quot;${SSH_ENV}&quot; ]; then . &quot;${SSH_ENV}&quot; &gt; /dev/null ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ &gt; /dev/null || { start_agent; }else start_agent;fi Ref: https://stackoverflow.com/questions/18880024/start-ssh-agent-on-login/18915067#18915067 è‹¥ä¸è€ƒæ…® race conditionï¼Œè©²ä½œæ³•å…¶å¯¦ä¹Ÿå¾ˆå€¼å¾—åƒè€ƒã€‚å¯ä»¥åœ¨æ²’æœ‰ systemd è¼”åŠ©çš„çš„ç”Ÿæ…‹ç³»åº•ä¸‹ä½¿ç”¨ã€‚ é›œè«‡çœ‹ systemd çš„æ–‡ä»¶æ™‚ï¼Œç™¼ç¾ systemd çš„ user mode æœƒéå¸¸éµå®ˆ XDG_ ç³»åˆ—çš„ç’°å¢ƒè®Šæ•¸ã€‚ ä¸éå› ç‚ºæˆ‘å€‘æ˜¯åœ¨ Ubuntu server edition ä¸‹ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†éƒ½ç•¥éä¸çœ‹ã€‚ :D ä½† XDG_RUNTIME_DIR é€™å€‹è®Šæ•¸é™¤å¤–ï¼Œæ­¤è®Šæ•¸é›–ç„¶ä¹Ÿæ˜¯ç”± XDG Base Directory Specification æ‰€è¦ç¯„ï¼Œä½†åœ¨ä¸€èˆ¬ Linux ç™¼è¡Œç‰ˆï¼Œæ­¤è®Šæ•¸æ˜¯ç”± pam_systemd ç›´æ¥ç¶­è­·çš„ã€‚æ‰€ä»¥å³ä½¿æ˜¯åœ¨ server ç’°å¢ƒä¹Ÿæœƒæœ‰æ­¤è®Šæ•¸å­˜åœ¨ã€‚ References systemd.unit command line - What is XDG_RUNTIME_DIR? - Ask Ubuntu XDG Base Directory Specification Add user ssh-agent as daemon to Ubuntu 18.04LTS server. git - Start ssh-agent on login - Stack Overflow","link":"/2020/04/04/run-ssh-agent-ubuntu-server.html"},{"title":"Samba å…§æª”æ¡ˆçš„ç•°å¸¸åŸ·è¡Œæ¬Šé™","text":"è¨±å¤šå ´åˆæœƒåˆ©ç”¨ Samba ä¾†å»ºç«‹çµ¦æ‰€æœ‰å·¥ä½œè€…å…±ç”¨çš„ SMB å·¥ä½œç›®éŒ„ã€‚ SMB æ˜¯ Microsoft é‡å° Windows é«”ç³»è¨­è¨ˆçš„ protocolï¼Œä½†å› ç‚ºç¨®ç¨®å› ç´ ï¼Œ ç›®å‰ Mac åŠå„ Linux æ¡Œé¢ç™¼è¡Œç‰ˆä¹Ÿéƒ½æœ‰ä¸éŒ¯çš„ SMB client æ”¯æ´ã€‚ å·² SMB æä¾›å…±ç”¨çš„å·¥ä½œç›®éŒ„ï¼Œä¼¼ä¹å·²æˆç‚ºæœ€å¸¸è¦‹çš„å”åŒå·¥ä½œæ–¹æ³•ã€‚ åœ¨å¦ä¸€æ–¹é¢ï¼ŒSamba æ˜¯ä¸€å¥—åŸºæ–¼ Unix ç’°å¢ƒé–‹ç™¼çš„é–‹æº SMB server å¯¦ä½œã€‚ ä½†å› ç‚º Windows èˆ‡ Unix åœ¨æª”æ¡ˆç³»çµ±ä¸Šè¨­è¨ˆçš„æ ¹æœ¬æ€§å·®åˆ¥ï¼Œå„˜ç®¡ Samba æ­·å²æ‚ ä¹…ä¸”åŠŸèƒ½é½Šå…¨ï¼Œ ä»ç„¶æœƒæœ‰ä¸€äº›å…ˆå¤©æ€§çš„å•é¡Œã€‚ ç‚ºäº†è§£é‡‹å•é¡Œåˆ°åº•å¾ä½•è€Œä¾†ï¼Œä»¥ä¸‹è¦ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ Windows èˆ‡ Unix çš„æª”æ¡ˆç›¸é—œç‰¹æ€§ã€‚ Windows File Attribute èˆ‡ Unix File Modeå‚³çµ±ä¸Šï¼ŒWindows ç³»çµ±ä¸‹çš„æ¯å€‹æª”æ¡ˆéƒ½æœƒéœ€è¦æœ‰ä»¥ä¸‹å››å€‹å±¬æ€§: Archive: ç´€éŒ„æ­¤æª”æ¡ˆåœ¨ä¸Šæ¬¡å‚™ä»½å¾Œæ˜¯å¦æ›´å‹•éã€‚ Hidden: ç´€éŒ„æ­¤æª”æ¡ˆæ˜¯å¦è¦éš±è—ã€‚Windows å…§å»º dir æˆ–æª”æ¡ˆç¸½ç®¡å‡æœƒéµå¾æ­¤è¨­å®šã€‚ System: ç´€éŒ„æ­¤æª”æ¡ˆæ˜¯å¦çˆ²ç³»çµ±æª”æ¡ˆã€‚ Read-only: ç´€éŒ„æ­¤æª”æ¡ˆæ˜¯å¦åªèƒ½è®€å–ã€‚ Unix ä½œæ¥­ç³»çµ±æ¡å–äº†èˆ‡ Windows ä¸åŒçš„è¨­è¨ˆã€‚ åœ¨ Unix å…§ï¼Œæ¯å€‹æª”æ¡ˆç´€éŒ„é‡å°æª”æ¡ˆæ“æœ‰è€…ã€æª”æ¡ˆæ“æœ‰ç¾¤çµ„åŠå…¶ä»–äººåˆ†åˆ¥ç´€éŒ„ä¸‰çµ„æ¬Šé™ Readable: æª”æ¡ˆæ˜¯å¦å¯è®€å– Writableï¼š æª”æ¡ˆæ˜¯å¦å¯å¯«å…¥ Executableï¼š æª”æ¡ˆæ˜¯å¦å¯åŸ·è¡Œ ç¾åœ¨æˆ‘å€‘å¯ä»¥çŸ¥é“ï¼ŒWindows èˆ‡ Unix å°æ–¼æª”æ¡ˆæ‡‰è©²ç´€éŒ„çš„ç‰¹æ€§/æ¨¡å¼å…¶å¯¦æœ‰ä¸ä¸€æ¨£çš„è¦æ±‚ã€‚ è¨±å¤šå’Œæª”æ¡ˆç³»çµ±ç›¸é—œçš„åŠŸèƒ½ä¹Ÿæœƒç”¨ä¸åŒçš„æ–¹å¼ä¾†é”æˆã€‚ æ¯”æ–¹èªªï¼Œæœ‰é—œæª”æ¡ˆ æ˜¯å¦éš±è— é€™ä»¶äº‹æƒ…ï¼Œåœ¨ Windows ä¸Šæœƒæœ‰ä¸€å€‹ç¨ç«‹çš„ attribute ä¾†è™•ç†ã€‚ è€Œåœ¨ Unix ä¸Šï¼Œå‰‡æ˜¯ä¾æ“š â€œ. é–‹é ­çš„æª”æ¡ˆæ‡‰è¢«éš±è—â€ çš„å¸¸è¦ã€‚é™¤äº†æª”åçœ‹èµ·ä¾†æœ‰é»ä¸ä¸€æ¨£ä¹‹å¤–ï¼Œ éš±è—æª”æ¡ˆå’Œä¸€èˆ¬æª”æ¡ˆåœ¨æª”æ¡ˆç³»çµ±è£¡æ²’æœ‰å·®åˆ¥ã€‚ å¦å¤–æˆ‘å€‘ä¹Ÿå¯ä»¥æ³¨æ„åˆ°Windows å’Œ Unix å°æ–¼ å¯åŸ·è¡Œ é€™å€‹æ¦‚å¿µçš„è™•ç†æ–¹å¼ä¹Ÿä¸åŒã€‚ åœ¨ Unix çš„ä¸–ç•Œä¸­ï¼Œæ¯å€‹æª”æ¡ˆçš„ mode ä¸­æœƒç´€éŒ„é€™å€‹æª”æ¡ˆæ˜¯å¦å¯åŸ·è¡Œã€‚è€Œåœ¨ Windows ä¸­ï¼Œ æª”æ¡ˆä¸¦æ²’æœ‰æ˜¯å¦å¯åŸ·è¡Œçš„æ¦‚å¿µï¼Œè€Œæ˜¯è®“ä½œæ¥­ç³»çµ±ç¶­è­·ä¸€å€‹è¡¨å–®ï¼Œè£¡é¢ç´€éŒ„å„ç¨®å‰¯æª”åçš„æª”æ¡ˆæ‡‰è©²å¦‚ä½•é–‹å•Ÿæˆ–åŸ·è¡Œã€‚ Samba çš„è¨­è¨ˆèˆ‡ç”¢ç”Ÿçš„å•é¡ŒSamba æ˜¯å€‹ SMB çš„ server å¯¦ä½œï¼Œä½œç‚ºåœ¨ Unix ç’°å¢ƒä¸Šè·‘çš„æœå‹™ï¼Œä½†åŒæ™‚ä¹Ÿè¦æ”¯æ´ Windows çš„ file attributeï¼Œäº¦å³å‰è¿°æåˆ°çš„ Archiveã€Read-only ç­‰ã€‚é€™äº› attribute æ˜¯å¿…å¾—ä»¥æŸç¨® æ–¹å¼å­˜åœ¨ Samba server ä¸Šã€‚åœ¨é€™è£ Samba çš„å¯¦ä½œéå¸¸æœ‰è¶£ï¼š åˆ©ç”¨ Unix ç’°å¢ƒä¸­ Windows ç”¨ä¸åˆ°çš„ executable bit ä¾†å­˜æ”¾ Windows éœ€è¦çš„ file attributeã€‚ å…·é«”ä¾†èªªï¼ŒArchiveã€System èˆ‡ Hidden å±¬æ€§æœƒåˆ†åˆ¥å­˜åœ¨æ“æœ‰è€…ã€æ“æœ‰ç¾¤çµ„èˆ‡å…¶ä»–äººçš„ file mode çš„ executable bit ç•¶ä¸­ã€‚è€Œ Read-only å‰‡æ˜¯å½±éŸ¿æª”æ¡ˆæ“æœ‰è€…çš„å¯«å…¥æ¬Šé™æ˜¯é–‹å•Ÿã€‚ ç°¡å–®åœ–ç¤ºå¦‚ä¸‹: 123456 Owner Group Others +----------------------------+ | r w x r w x r w x | +-^--^--^--------^--------^--+ | | | | |ReadOnly Archive System Hidden ä½†æ­¤åšæ³•èˆ‰å…¶å¯¦æœƒå°è‡´å…¶ä»–å•é¡Œã€‚é€™æœƒå…¶ä»–åœ¨ Mac æˆ– Unix ç’°å¢ƒä¸‹æ›è¼‰ SMB share çš„ä½¿ç”¨è€…ï¼Œ æœƒçœ‹åˆ°æª”æ¡ˆæœ‰æ™‚è«åçš„è®Šæˆå¯åŸ·è¡Œï¼Œæˆ–åŸæœ¬å¯åŸ·è¡Œçš„ script çªç„¶è®Šæˆä¸å¯åŸ·è¡Œã€‚ æ–¼æ˜¯ä¹ï¼Œåœ¨ Window èˆ‡ Linux æ··ç”¨çš„å·¥ä½œç’°å¢ƒä¸­ï¼ŒRD çš„ terminal ä¸‹å¸¸æœƒçœ‹åˆ°ä¸€ç‰‡èŠ±èŠ±ç¶ ç¶ çš„ source code è³‡æ–™å¤¾ã€‚(ä¸€èˆ¬ shell éƒ½æœƒé è¨­é–‹ ls çš„ colorize é¸é …) Executable Bit ç•°å¸¸çš„è§£æ±ºæ–¹å¼è‹¥è¦é¿å… Samba çš„é€™é¡è¡Œç‚ºï¼Œå¯ä»¥åœ¨ smb.conf ä¸­åŠ å…¥ä»¥ä¸‹è¨­å®š 1234map archive = nomap system = nomap hidden = nomap read only = no å¦‚æ­¤ Samba å°±ä¸æœƒå˜—è©¦åˆ©ç”¨ Unix çš„ file mode ä¾†å­˜æ”¾é€™äº› attributeã€‚ åˆæˆ–æ˜¯å¦‚æœæƒ³æ”¯æ´ Windows çš„ attributeï¼Œä½†åˆä¸æƒ³å½±éŸ¿ Unix ä¸‹çš„åŸ·è¡Œæ¬Šé™ï¼Œå¯ä»¥å°‡é€™äº› attribute å¯«é€² extended attributes è£¡ã€‚é€™éœ€è¦ä½¿ç”¨ä»¥ä¸‹è¨­å®š 1store dos attributes = yes ç¢ç¢å”¸ä½œç‚ºä¸€å€‹è»Ÿé«”å·¥ç¨‹å¸«ï¼Œå¸¸è½åˆ° Every detail matters æˆ–å…¶ä»–é¡ä¼¼ç²¾ç¥çš„æ¨™èªã€‚ é­”é¬¼è”µåœ¨ç´°ç¯€è£ï¼Œç¢ºä¿æ¯å€‹ç´°ç¯€çš„æ­£ç¢º(æˆ–è‡³å°‘çœ‹èµ·ä¾†æ­£ç¢º)æ˜¯æ¯å€‹å·¥ç¨‹å¸«éƒ½æ‡‰è©²è¿½æ±‚çš„å¢ƒç•Œã€‚ è€Œé€™å€‹è¿½æ±‚ç´°ç¯€çš„ç²¾ç¥ï¼Œå¿…é ˆå¾ä¹¾æ·¨çš„å·¥ä½œç’°å¢ƒé–‹å§‹åšèµ·ã€‚ ç‚ºä»€éº¼æœƒå¯«å‡ºé€™é‚Šæ–‡ç« ï¼Ÿå…¶å¯¦å°±åªçœ‹åˆ°å…¬å¸çš„ VCS å…§å„ç¨®æ€ªç•°çš„æª”æ¡ˆæ¬Šé™ï¼Œ æ„Ÿåˆ°å›°æƒ‘è€Œå·²ã€‚æ¸…æ¥šçš„è®Šæ•¸å‘½åã€ç¬¦åˆç›´è¦ºçš„ API è¨­è¨ˆæœ‰åŠ©æ–¼é–‹ç™¼äººå“¡ç†è§£å°ˆæ¡ˆã€‚æ­£ç¢ºçš„æª”æ¡ˆæ¬Šé™ å…¶å¯¦ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¨­å®šæª”æ‡‰è©²æ˜¯ rw-ï¼Œscript æ‡‰è©²æ˜¯ r-xï¼Œä¸é•èƒŒç›´è¦ºçš„å°ˆæ¡ˆç‹€æ…‹æ‰ä¸æœƒ é˜»ç¤™å·¥ç¨‹å¸«å·¥ä½œã€‚ ç•¶ç„¶ï¼Œä¸€åˆ‡çš„æ ¹æœ¬åŸå› é‚„æ˜¯åœ¨æ–¼ Samba çš„é è¨­è¨­å®šæœƒæŠŠ Archive attribute map åˆ° file mode è£¡é¢ã€‚åœ¨ Window ç’°å¢ƒå·¥ä½œçš„å·¥ç¨‹å¸«ä¸€èˆ¬éƒ½æ˜¯åœ¨ç„¡æ„çš„æƒ…æ³ä¸‹æŠŠ file mode çš„ç•°å‹• å¯«é“ VCS è£¡é¢ã€‚é€™æ™‚åªèƒ½æŠ±æ€¨çˆ²ä½•ç•¶å¹´ Samba çš„ä½œè€…è¦åšå‡ºé€™ç¨®è¨­è¨ˆäº†ã€‚ ç›¸é—œé€£çµ Why are files in a smbfs mounted share created with executable bit set? File Permissions and Attributes on MS-DOS and Unix Document: attrib command Document: File attribute API Official Samba Config Document","link":"/2018/04/17/samba-executable-bit.html"},{"title":"å–®å°æ©Ÿå™¨çš„ Ceph éƒ¨ç½²","text":"åŸç”±Ceph çš„é è¨­è¨­å®šå°è³‡æ–™çš„ replica è¡Œç‚ºè¦æ±‚åš´æ ¼ã€‚ è‹¥åªæœ‰å–®å°æ©Ÿå™¨æˆ–æ˜¯ç¡¬ç¢Ÿæ•¸é‡å—é™ï¼Œå¾€å¾€æ¶è¨­èµ·ä¾†çš„ Ceph ç„¡æ³•é †åˆ©å­˜æ”¾è³‡æ–™ã€‚ æ­¤ç¯‡ç­†è¨˜é—œæ³¨çš„ç›®æ¨™å¦‚ä¸‹ è‹¥æƒ³è¦ç”¨æœ€å°‘è³‡æºï¼Œå»ºç«‹å¯ç”¨çš„ Ceph ç’°å¢ƒï¼Œéœ€è¦åšå“ªäº›é¡å¤–çš„èª¿æ•´ï¼Ÿ èƒŒæ™¯çŸ¥è­˜Ceph æ˜¯ä¸€å¥—é–‹æºçš„å„²å­˜å¢é›† solutionã€‚ å¯ä»¥æ•´åˆå¤šå€‹å„²å­˜è¨­å‚™ä¸¦åœ¨å…¶ä¸Šæä¾› RADOSGW, RBD, Ceph FS ç­‰ä¸åŒå±¤ç´šçš„å­˜å–ä»‹é¢ã€‚ å°æ–¼æ¯å€‹å„²å­˜è¨­å‚™ (HDD, SSD)ï¼ŒCeph æœƒå»ºç«‹å°æ‡‰çš„ OSD ä¾†ç®¡ç†å„²å­˜è¨­å‚™ã€‚ æœ‰äº†å„²å­˜è¨­å‚™ä¹‹å¾Œï¼ŒCeph æœƒå»ºç«‹é‚è¼¯ä¸Šçš„ pool ä½œç‚ºç®¡ç†ç©ºé–“çš„å–®ä½ã€‚ Pool åº•ä¸‹æœƒæœ‰å¤šå€‹ PG(placement group) ä½œç‚ºå¯¦éš›å­˜æ”¾è³‡æ–™è‡³ OSD ä¸­çš„å€å¡Šã€‚ åœ¨ Ceph çš„é è¨­è¨­å®šä¸­ï¼Œä¸€èˆ¬ pool çš„ replica è¡Œç‚ºå¦‚ä¸‹ è¦æœ‰ä¸‰ä»½ replica replica è¦åˆ†æ•£åœ¨ä¸åŒçš„ host ä¸Š åœ¨é–‹ç™¼ç’°å¢ƒä¸­ï¼Œè³‡æ–™æ‰äº†å…¶å¯¦ä¸¦ç„¡å‚·å¤§é›…ï¼Œä¸‰ä»½ replica æ„å‘³è‘—å„²å­˜ç©ºé–“çš„æµªè²»ã€‚ ä¸”è‹¥è³‡æ–™çœŸçš„è¦æ”¾åœ¨ä¸åŒçš„ host ä¸Šï¼Œé€£åŒ replica ä¸‰ä»½é€™é»ï¼Œæˆ‘å€‘å°±è‡³å°‘è¦é–‹ä¸‰å°æ©Ÿå™¨ï¼Œ å¢åŠ ç„¡è¬‚çš„ç®¡ç†æˆæœ¬ã€‚ è§£æ±ºæ–¹å¼å‡è¨­æˆ‘å€‘éƒ½æ˜¯é€é cephadm bootstrap ä¾†æ¶è¨­ Cephã€‚ Ceph cluster å»ºç«‹å¥½ï¼Œä¹Ÿè¨­å®šå®Œéœ€è¦çš„ OSD ä¹‹å¾Œï¼Œå°±å¯ä»¥ä¾†å»ºç«‹ poolã€‚ æ ¹æ“š pool çš„ç›®çš„ä¸åŒï¼Œè¦è§£æ±ºå–®å°æ©Ÿå™¨éƒ¨ç½² Ceph çš„é™åˆ¶ï¼Œå¤§æ¦‚æœƒæœ‰å…©ç¨®åšæ³•ã€‚ é™ä½ Pool SizePool size æ­¤è¡“èªæ„å‘³è‘—è©² pool ä¸‹çš„ PG è¦ replica å¹¾ä»½ã€‚ è‹¥æŸ pool æ˜¯æ‹¿ä¾›ä»–äººå­˜æ”¾è³‡æ–™ï¼Œæˆ–æ˜¯æœƒä½¿ç”¨è¼ƒå¤šç©ºé–“çš„ï¼Œå¯ä»¥æŠŠ size é™ç‚º 1ã€‚ èª¿æ•´å®Œä¹‹å¾Œå°±ç›¸ç•¶æ–¼è©² pool å…§çš„æ‰€æœ‰è³‡æ–™éƒ½ä¸æœƒæœ‰ replicaã€‚ ç¯„ä¾‹å¦‚ä¸‹: 123ceph osd pool create &quot;&lt;pool name&gt;&quot;ceph osd pool set &quot;&lt;pool name&gt;&quot; size 1ceph osd pool application enable &quot;&lt;pool name&gt;&quot; rbd èª¿æ•´ Choose Leaf è¡Œç‚ºCeph æœ‰å®šç¾©ä¸åŒå±¤ç´šçš„è³‡æ–™åˆ†æ•£è¨­å®šã€‚ é è¨­å€¼ç‚º hostï¼Œæ„å‘³è‘—åªæœ‰ä¸€å°æ©Ÿå™¨çš„æƒ…æ³ä¸‹ï¼Œè³‡æ–™æœƒç„¡æ³•è¤‡è£½ã€‚ è‹¥èª¿æ•´ç‚º osdï¼Œåªè¦è©²æ©Ÿå™¨ä¸Šæœ‰å¤šé¡†ç¡¬ç¢Ÿå³å¯æ»¿è¶³è¤‡è£½æ¢ä»¶ã€‚ è‹¥æ˜¯é‡å° Ceph è‡ªè¡Œå»ºç«‹å‡ºä¾†ï¼Œç®¡ç† meta data çš„ pool (e.g. device_health_metrics) å¯ä»¥è€ƒæ…®ä½¿ç”¨æ­¤æ–¹å¼è™•ç†ã€‚ è¨­å®šæ–¹å¼å¤§æ¦‚æœ‰å…©ç¨®ã€‚ æ–¹æ³•ä¸€: èª¿æ•´ Ceph global è¨­å®š ç·¨è¼¯ /etc/ceph.conf ä¸¦åœ¨ global section ä¸‹åŠ å…¥ osd_crush_chooseleaf_type è¨­å®š 123[global]... osd_crush_chooseleaf_type = 0 æˆ–æ˜¯ç›´æ¥åŸ·è¡Œ command 1ceph config set global osd_crush_chooseleaf_type 0 é€™é‚Šçš„ 0 ä»£è¡¨ OSDã€‚é è¨­çš„å°æ‡‰åˆ—è¡¨å¦‚ä¸‹ 123456type 0 osdtype 1 host...type 9 zonetype 10 regiontype 11 root æ–¹æ³•äºŒ: ä¿®æ”¹ crush map å…§å®¹ ç­†è€…æœ‰æ³¨æ„åˆ°æœ‰æ™‚å³ä½¿æœ‰åŸ·è¡Œæ–¹æ³•ä¸€ï¼Œpool é‚„æ˜¯ä¸æœƒå—åˆ°è¨­å®šå½±éŸ¿ã€‚ (ç›¸é—œçŸ¥è­˜é‚„å¤ªå°‘ï¼Œ ä¸å¤ªç¢ºå®šå…·é«”åŸå› ) ä¸éé‡å°æ­¤ç‹€æ³ï¼Œé‚„æœ‰ç¬¬äºŒå€‹æ–¹æ³•å¯ä»¥ä½¿ç”¨ã€‚ æ­¤æ–¹æ³•æœƒç”¨åˆ° crushtool æŒ‡ä»¤ (Ubuntu ä¸­éœ€è¦é¡å¤–å®‰è£ ceph-base å¥—ä»¶) é¦–å…ˆåŸ·è¡ŒæŒ‡ä»¤å°‡ç›®å‰çš„ crush map æ’ˆå‡ºä¾† 12ceph osd getcrushmap -o &quot;compiled-crush-map&quot;crushtool -d &quot;compiled-crush-map&quot; -o &quot;crush-map&quot; æ¥è‘—ä¿®æ”¹ crush-map æª”æ¡ˆå…§å®¹ï¼Œæ‡‰è©²æœƒæœ‰ä¸€è¡Œæœ‰ step chooseleaf é–‹é ­çš„è¨­å®šï¼ŒæŠŠæœ€å¾Œçš„ type å¾ host èª¿æ•´ç‚º osdã€‚ 1234# Beforestep chooseleaf firstn &lt;number&gt; type host# Afterstep chooseleaf firstn &lt;number&gt; type osd æœ€å¾Œå°‡ä¿®æ”¹å¥½çš„ crush map è¨­å®šå¡å›å»ã€‚ 12crushtool -c &quot;crush-map&quot; -o &quot;compiled-crush-map&quot;ceph osd setcrushmap -i &quot;compiled-crush-map&quot; ç›¸é—œ reference link Common Settings â€” Ceph Documentation Chapter 4. Create a Cluster Red Hat Ceph Storage 1.2.3 | Red Hat Customer Portal CRUSH Maps â€” Ceph Documentation Manually editing a CRUSH Map â€” Ceph Documentation CRUSH Maps â€” Ceph Documentation çµèªç­†è€…åœ¨å…¬å¸æ¥­å‹™ä¸¦ä¸è² è²¬ç¶­è­· production çš„ Ceph clusterï¼Œåƒ…æ˜¯ç‚ºäº†å»ºç«‹ Kubernetes é–‹ç™¼ç’°å¢ƒï¼Œéœ€è¦æœ‰å€‹åŸºæœ¬æœƒå‹•çš„ Cephã€‚ ç‚ºäº†ç”¨æœ€å°‘è³‡æºå»ºç«‹ Ceph ç’°å¢ƒï¼Œéœ€è¦èª¿æ•´ç›¸é—œè¨­å®šä¾†æ”¹è®Š Ceph è¡Œç‚ºã€‚ åªå¯æƒœç›¸é—œçš„è³‡æºä¸æ˜¯å¾ˆå¤ ï¼Œä¸€è·¯è·Œè·Œæ’æ’ä¸‹ä¾†ï¼Œæ±ºå®šå¯«ä¸‹é€™ç¯‡ç­†è¨˜ï¼Œå¸Œæœ›é€ ç¦æœªä¾†çš„è‡ªå·±ï¼Œä¹ŸåŒæ™‚ç…§é¡§ä»–äººã€‚","link":"/2021/08/08/single-node-ceph-cluster.html"},{"title":"åˆ©ç”¨ SSH å»ºç«‹ SOCKS Proxy","text":"æœ€è¿‘å› ç‚ºç–«æƒ…åˆé–‹å§‹ WFH äº†ã€‚ å…¬å¸æœ‰æä¾›ä¸€äº› VPN solution è®“å“¡å·¥å­˜å–å…¬å¸å…§ç¶²è·¯ï¼Œ ä½†æœ‰ä¸€äº›æ¶åœ¨ public cloud ä¸Šçš„æœå‹™å¾Œå°å› ç‚ºæœ‰æ“‹ä¾†æº IPï¼Œç„¡æ³•åœ¨å®¶ç›´æ¥å­˜å–ã€‚ é€™æ™‚å€™ SSH å…§å»ºçš„ SOCKS proxy server åŠŸèƒ½å°±å¯ä»¥æ´¾ä¸Šç”¨å ´äº†ï¼ SSH å¯ä»¥åœ¨å»ºç«‹é€£ç·šæ™‚ï¼Œä¸€ä½µåœ¨æœ¬æ©Ÿç«¯é–‹å‡ºä¸€å€‹ SOCKS (version 4 and 5) çš„ serverï¼Œ æ¥ä¸‹ä¾†ä»»ä½•æ‡‰ç”¨ç¨‹å¼éƒ½å¯ä»¥å°‡ä»»æ„çš„ TCP é€£ç·šé€éé€™å€‹ SOCKS serverï¼Œè½‰é€åˆ° SSH server å¾Œå†èˆ‡ç›®æ¨™ç«™å°é€£ç·šã€‚ å› ç‚ºå¤§å®¶ä¸€å®šåœ¨å…¬å¸è£¡æœ‰å°å¯ä»¥ SSH çš„æ©Ÿå™¨(?)ï¼Œæ–¼æ˜¯é€™ç¨®é™åˆ¶å…¬å¸ IP çš„ç®¡ç†å¾Œå°å°±å¯ä»¥é †åˆ©å­˜å–ã€‚ :D ä½¿ç”¨æ–¹å¼å¾ˆç°¡å–®ï¼ŒSSH é€£ç·šæ™‚å¤šä¸‹åƒæ•¸å³å¯ã€‚ 1ssh &quot;target-machine&quot; -D &quot;localhost:1080&quot; -N -D localhost:1080: æ±ºå®šè¦é–‹åœ¨ local çš„ SOCKS portï¼ŒRFC å»ºè­°æ˜¯ 1080 -N: å¦‚æœä¸éœ€è¦é–‹ä¸€å€‹ shellï¼Œåªæ˜¯è¦ SOCKS proxy åŠŸèƒ½ï¼Œé‚£å¯ä»¥å¤šå¸¶æ­¤åƒæ•¸ Note: SSH æœ‰æ”¯æ´ SOCKS5 (å¯åš IPv6 proxy) ä½†ä¸æ”¯æ´ authenticationï¼Œä¸éå› ç‚º SOCKS server å¯ä»¥å¦‚ä¸Šè¿°è¨­å®šåªé–‹åœ¨ localhost ä¸Šï¼Œæ‰€ä»¥æ²’éº¼å•é¡Œã€‚ æ¥è‘—æˆ‘å€‘å°±å¯ä»¥è¨­å®š OS å±¤ç´šæˆ–æ˜¯ application å±¤ç´šçš„ proxy è¨­å®šä¾†ä½¿ç”¨é€™å€‹ proxy äº†ï¼ ä»¥æˆ‘ä¸€é–‹å§‹é‡åˆ°çš„å•é¡Œä¾†èªªï¼Œé€šå¸¸æˆ‘æœƒå¤šé–‹ä¸€å€‹ Firefox ä¸¦è¨­å®šä½¿ç”¨ proxy ä¾†å­˜å–å…¬å¸çš„å„ç¨®ç®¡ç†å¾Œå°ã€‚ é€™æ¨£å°±å¯ä»¥ä¿æŒå…¶ä»–ç¶²è·¯æµé‡é‚„æ˜¯ç›´æ¥å¾€å¤–æ‰“ï¼Œä¸éœ€è¦é proxyã€‚ :D è‹¥è¦å¿«é€Ÿå•Ÿå‹• proxyï¼Œå¯ä»¥ä½¿ç”¨ Windows Terminal ä¸¦è¨­å®šä¸€å€‹ profileï¼ŒåŸ·è¡Œä¸Šè¿° SSH æŒ‡ä»¤ã€‚ PuTTY ä½œç‚º Windows ä¸Šæœ€å¤šäººä½¿ç”¨çš„ SSH clientï¼Œä¹Ÿæœ‰æ”¯æ´ SOCKS proxy åŠŸèƒ½ï¼Œ è©³è¦‹: How To Set up a SOCKS Proxy Using Putty &amp; SSH - Security Musings Reference ssh(1): OpenSSH SSH client - Linux man page linux - How can I setup a SOCKS proxy over ssh with password based authentication on CentOS? - Server Fault","link":"/2022/04/20/ssh-socks-proxy.html"},{"title":"å¦‚ä½•é¿å… Commit Message æ‹¼éŒ¯å­—ï¼Ÿ","text":"æ–‡ä»¶æ‰“éŒ¯å­—é‚„å¥½ï¼Œéš¨æ™‚å¯ä»¥ä¿®ã€‚ ä½†åœ¨ commit message ä¸­æ‰“éŒ¯å­—ï¼Œå¯æ˜¯æœƒæµå‚³åƒå¤ã€‚ èº«ç‚ºä¸€å€‹ RDï¼Œæœ‰å€‹æ¥µç°¡çš„è§£æ±ºæ–¹æ³•.. æŠŠåº•ä¸‹é€™è¡Œè¨­å®šæ”¾åˆ° .vimrc å…§å³å¯ã€‚ (O 1autocmd FileType gitcommit setlocal spell (å°æ–¼å±¬ Git commit message çš„ buffer è‡ªå‹•å•Ÿç”¨ spell check åŠŸèƒ½) è¨­å®šå®Œä¹‹å¾Œï¼Œç•¶å‡ºç¾ vim ä¸èªè­˜çš„å–®å­—æ™‚ï¼Œå°±æœƒæœ‰é†’ç›®çš„é¡è‰²æç¤ºï¼Œ æé†’è‡ªå·±è©²å›é ­çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯åˆæ‹¼éŒ¯å­—äº†ã€‚ ç•¶ç„¶ï¼Œè¦æœ‰èˆ’é©çš„æ‹¼å­—æª¢æŸ¥é«”é©—ï¼Œå­—å…¸æª”çš„ç¶­è­·ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ç’°ã€‚ ä¸éé‚£åˆæ˜¯å¦ä¸€å€‹è©±é¡Œäº†.. Reference Vim Spell-Checking Vim: spell.txt","link":"/2021/09/28/vim-git-commit-spell-check.html"},{"title":"VS Code æ–°åŠŸèƒ½: Remote Repositories","text":"VS Code åœ¨ 1.57 ç‰ˆä¸­ï¼Œ Remote Development ç³»åˆ— extension åŠ å…¥äº†æ–°æˆå“¡: Remote Repositoriesã€‚ æœ‰äº†é€™å€‹ extension ä¹‹å¾Œï¼Œå¦‚æœé‡ä¸Šè‡¨æ™‚æƒ³çœ‹çš„ projectï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ VS Code ä¸­å«å‡ºä¾†çœ‹ï¼Œä¸éœ€è¦äº‹å…ˆ clone è‡³æŸå€‹ local è³‡æ–™å¤¾ã€‚ ä¸é.. å› ç‚ºé€™å€‹ extension å¯¦éš›ä¸Šæ˜¯å»ºä¸€å€‹ Virtual Workspaces ä¸¦æŠŠ code æ”¾åœ¨è£¡é¢é–±è¦½ï¼Œ æ‰€ä»¥ç”¨ Remote Repositories é–‹å‡ºä¾†çš„ workspace åŠŸèƒ½éå¸¸å—é™ã€‚ è«¸å¦‚ Debug, Terminal åŠå¤§éƒ¨åˆ†çš„ extension åŸºæœ¬ä¸Šéƒ½ä¸èƒ½ç”¨ã€‚ ä½†è©±é›–å¦‚æ­¤ï¼Œç•¶çœ‹ code çœ‹ä¸€çœ‹æƒ³è¦é–‹å§‹é€²è¡Œæ¯”è¼ƒæ·±å…¥çš„ä¿®æ”¹åŠé™¤éŒ¯æ™‚ï¼Œ å…¶å¯¦ä¹Ÿæ˜¯æœ‰æä¾›è½‰æ›æˆä¸€èˆ¬ workspace çš„åŠŸèƒ½ã€‚ ä½¿ç”¨ä¸Šéå¸¸æ–¹ä¾¿ï¼ å¯æƒœçš„æ˜¯ï¼Œç›®å‰æ­¤ extension æ”¯æ´çš„ remote repository ç¨®é¡åªæœ‰ GitHubã€‚ ä¸”å¦‚åŒå…¶ä»– Remote Development Seriesï¼Œé€™å€‹ extension ä¸¦é open source projectï¼š Visual Studio Code Remote Development Frequently Asked Questions Cannot use Remote Development extension pack Â· Issue #196 Â· VSCodium/vscodium æœªä¾†æœƒä¸æœƒæ”¯æ´ GitHub ä»¥å¤–çš„ Git repositoriesï¼Œç”šè‡³å…¶ä»–ç¨®é¡çš„ VCSï¼Œ åªèƒ½çœ‹å¾®è»Ÿçˆ¸çˆ¸çš„çœ¼è‰²äº†ã€‚","link":"/2021/06/12/vscode-feature-remote-repositories.html"}],"tags":[{"name":"cpp","slug":"cpp","link":"/tags/cpp/"},{"name":"typing","slug":"typing","link":"/tags/typing/"},{"name":"docker","slug":"docker","link":"/tags/docker/"},{"name":"secret","slug":"secret","link":"/tags/secret/"},{"name":"security","slug":"security","link":"/tags/security/"},{"name":"shell","slug":"shell","link":"/tags/shell/"},{"name":"terminal","slug":"terminal","link":"/tags/terminal/"},{"name":"email","slug":"email","link":"/tags/email/"},{"name":"rfc","slug":"rfc","link":"/tags/rfc/"},{"name":"github","slug":"github","link":"/tags/github/"},{"name":"blog","slug":"blog","link":"/tags/blog/"},{"name":"jekyll","slug":"jekyll","link":"/tags/jekyll/"},{"name":"gitlab","slug":"gitlab","link":"/tags/gitlab/"},{"name":"fido","slug":"fido","link":"/tags/fido/"},{"name":"git","slug":"git","link":"/tags/git/"},{"name":"gnupg","slug":"gnupg","link":"/tags/gnupg/"},{"name":"golang","slug":"golang","link":"/tags/golang/"},{"name":"community","slug":"community","link":"/tags/community/"},{"name":"generic","slug":"generic","link":"/tags/generic/"},{"name":"functional","slug":"functional","link":"/tags/functional/"},{"name":"c","slug":"c","link":"/tags/c/"},{"name":"testing","slug":"testing","link":"/tags/testing/"},{"name":"development","slug":"development","link":"/tags/development/"},{"name":"javascript","slug":"javascript","link":"/tags/javascript/"},{"name":"kubernetes","slug":"kubernetes","link":"/tags/kubernetes/"},{"name":"log","slug":"log","link":"/tags/log/"},{"name":"authentication","slug":"authentication","link":"/tags/authentication/"},{"name":"nats","slug":"nats","link":"/tags/nats/"},{"name":"mq","slug":"mq","link":"/tags/mq/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"ssh","slug":"ssh","link":"/tags/ssh/"},{"name":"systemd","slug":"systemd","link":"/tags/systemd/"},{"name":"samba","slug":"samba","link":"/tags/samba/"},{"name":"ceph","slug":"ceph","link":"/tags/ceph/"},{"name":"socks","slug":"socks","link":"/tags/socks/"},{"name":"vim","slug":"vim","link":"/tags/vim/"},{"name":"spell","slug":"spell","link":"/tags/spell/"},{"name":"ide","slug":"ide","link":"/tags/ide/"},{"name":"vscode","slug":"vscode","link":"/tags/vscode/"}],"categories":[{"name":"news","slug":"news","link":"/categories/news/"},{"name":"notes","slug":"notes","link":"/categories/notes/"},{"name":"tips","slug":"tips","link":"/categories/tips/"}],"pages":[{"title":"About","text":"ä¸€å€å·¥ç¨‹å¸«åœ¨ç¶“æ­·äº†ä¸€ç•ªåŠªåŠ›ä¹‹å¾Œï¼Œæˆç‚ºäº†ä¸€é»äº”å€å·¥ç¨‹å¸«ã€‚ ä»–æ¯å¤©åŠ ç­å››å°æ™‚ã€‚ My public key: 1234567891011121314151617181920-----BEGIN PGP PUBLIC KEY BLOCK-----mDMEWzRiaBYJKwYBBAHaRw8BAQdAork0AXgHa/7KPcnYvTZLmswyIYC5SNU1pWQJHU/WC/y0H1dlaWRhIEhvbmcgPHdkaG9uZ3R3QGdtYWlsLmNvbT6IlgQTFggAPgIbAQULCQgHAgYVCgkICwIEFgIDAQIeAQIXgBYhBLpheEMt5aUAqCgg9scosr3JdW4FBQJgQ5uwBQkSN6HIAAoJEMcosr3JdW4FEc4A/iqX61c5lwfuHwfvJ1u+8KEF7QUfYhoobjmpfM/4Sk/uAP9Dx0WfW9EN0I429FjzKOUg7msjX7mcHalpNasBeNZHBLgzBF7Sis8WCSsGAQQB2kcPAQEHQAk7WSboerZhn6raITZvdDirbgO7SlPGCAR7V1YtP048iPUEGBYIACYCGwIWIQS6YXhDLeWlAKgoIPbHKLK9yXVuBQUCXtKLkQUJBKKGwgCBdiAEGRYIAB0WIQSz0YvHVafhHsjzqQKMwunPs74nDAUCXtKKzwAKCRCMwunPs74nDEyRAQC9E1AXlN0/uqSoOsrU0oJceicHgnYTT06CrcK4EXGCuQD/aeAt3P34j03sx5W80+xyrIBvAQvMbkVhkI+mRHG0bQ0JEMcosr3JdW4F6hwA+wTA38zfrw+FYjce1SuVxQBMeGbjlglZVNM7GvwcZkyQAPkBbKDhiKGAwHw2/3d1TGsnTe1YyRndEysyQApZjTR+A7g4BF+aYkcSCisGAQQBl1UBBQEBB0Au9XV4/WzaaUX3A1pDJIQzU7EQczLujJ5eyZBcgGR0egMBCAeIfgQYFggAJhYhBLpheEMt5aUAqCgg9scosr3JdW4FBQJfmmJHAhsMBQkDwmcAAAoJEMcosr3JdW4FovgBANqzGusL//4Rqu3v0DC/s8ZbMhIiL0jF41VTXKa6vAaDAQDIxX2A5V3QettMyLz/j4GpdXLmxh7R6n4kajNuiEAoBA===Covm-----END PGP PUBLIC KEY BLOCK-----","link":"/about/index.html"}]}