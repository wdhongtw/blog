<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bitisle</title>
  
  
  <link href="https://blog.bitisle.net/atom.xml" rel="self"/>
  
  <link href="https://blog.bitisle.net/"/>
  <updated>2025-06-28T13:22:00.000Z</updated>
  <id>https://blog.bitisle.net/</id>
  
  <author>
    <name>Weida Hong</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Make shpool Easier to Use</title>
    <link href="https://blog.bitisle.net/2025/06/28/easier-shpool.html"/>
    <id>https://blog.bitisle.net/2025/06/28/easier-shpool.html</id>
    <published>2025-06-28T13:22:00.000Z</published>
    <updated>2025-06-28T13:22:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>shpool</code> is a tool like <code>tmux</code> and <code>screen</code> to keep persistent shell sessions across hangups.</p><p>It‚Äôs quite new (first released 2023), and extremely simple to use.Usually I only need one persistent shell in remote machine, and this tool, unlike <code>tmux</code>,is designed to support <strong>only one</strong> shell per session.That makes me very satisfied.</p><p>Currently there is no Bash auto-complete setup provided from the official repo.Therefore I implemented one for myself. With that, I can make my life easier. ü§£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shpool &lt;tab&gt;  <span class="comment"># complete sub-commands like attach / list / help ...</span></span><br><span class="line">shpool attach &lt;tab&gt;  <span class="comment"># complete available sessions</span></span><br></pre></td></tr></table></figure><p>Here is the auto-complete setup script for Bash, for anyone who have same requirement.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shellcheck shell=bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">_shpool_completions</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">  [[ <span class="variable">$&#123;#COMP_WORDS[@]&#125;</span> -eq 1 ]] &amp;&amp; <span class="built_in">return</span> 0</span><br><span class="line">  [[ <span class="variable">$&#123;COMP_WORDS[0]&#125;</span> != <span class="string">&quot;shpool&quot;</span> ]] &amp;&amp; <span class="built_in">return</span> 0</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="variable">$&#123;#COMP_WORDS[@]&#125;</span> -eq 2 ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">local</span> commands=(attach detach <span class="built_in">kill</span> list version <span class="built_in">help</span>)</span><br><span class="line">    <span class="built_in">local</span> partial=<span class="string">&quot;<span class="variable">$&#123;COMP_WORDS[$COMP_CWORD]&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">mapfile</span> -t COMPREPLY &lt; &lt;(compgen -W <span class="string">&quot;<span class="variable">$&#123;commands[*]&#125;</span>&quot;</span> -- <span class="string">&quot;<span class="variable">$&#123;partial&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  [[ <span class="variable">$&#123;#COMP_WORDS[@]&#125;</span> -ne 3 ]] &amp;&amp; <span class="built_in">return</span> 0</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Now, try completing session names for commands that take them</span></span><br><span class="line">  <span class="built_in">local</span> partial=<span class="string">&quot;<span class="variable">$&#123;COMP_WORDS[$COMP_CWORD]&#125;</span>&quot;</span></span><br><span class="line">  <span class="built_in">local</span> <span class="built_in">command</span>=<span class="string">&quot;<span class="variable">$&#123;COMP_WORDS[$COMP_CWORD-1]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$&#123;command&#125;</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    attach|detach|<span class="built_in">kill</span>)</span><br><span class="line">      <span class="built_in">local</span> -a sessions</span><br><span class="line">      <span class="built_in">mapfile</span> -t sessions &lt; &lt;(shpool list | <span class="built_in">tail</span> -n +2 | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">      <span class="built_in">mapfile</span> -t COMPREPLY &lt; &lt;(compgen -W <span class="string">&quot;<span class="variable">$&#123;sessions[*]&#125;</span>&quot;</span> -- <span class="string">&quot;<span class="variable">$&#123;partial&#125;</span>&quot;</span>)</span><br><span class="line">      <span class="built_in">return</span> 0</span><br><span class="line">      ;;</span><br><span class="line">    *)</span><br><span class="line">      <span class="comment"># No need for other commands, they don&#x27;t take arguments</span></span><br><span class="line">      COMPREPLY=()</span><br><span class="line">      <span class="built_in">return</span> 0</span><br><span class="line">      ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">complete -F _shpool_completions shpool</span><br></pre></td></tr></table></figure><p>Wish this tool gain more public notice!</p><ul><li>GitHub Link: <a href="https://github.com/shell-pool/shpool">https://github.com/shell-pool/shpool</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;shpool&lt;/code&gt; is a tool like &lt;code&gt;tmux&lt;/code&gt; and &lt;code&gt;screen&lt;/code&gt; to keep persistent shell sessions across hangups.&lt;/p&gt;
&lt;p&gt;It‚Äô</summary>
      
    
    
    
    <category term="tips" scheme="https://blog.bitisle.net/categories/tips/"/>
    
    
    <category term="shell" scheme="https://blog.bitisle.net/tags/shell/"/>
    
    <category term="terminal" scheme="https://blog.bitisle.net/tags/terminal/"/>
    
  </entry>
  
  <entry>
    <title>Easier Iteration with Generator</title>
    <link href="https://blog.bitisle.net/2025/02/26/cpp-generator-crtp.html"/>
    <id>https://blog.bitisle.net/2025/02/26/cpp-generator-crtp.html</id>
    <published>2025-02-26T01:05:00.000Z</published>
    <updated>2025-02-26T01:05:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>In Python, we can make a container type iterable by implement <code>__iter__</code> method.</p><p>For example, if we want to provide all value in a range <code>[lo, hi)</code> ‚Ä¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TwoTillSix</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> val <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">6</span>):</span><br><span class="line">            <span class="keyword">yield</span> val</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(TwoTillSix())  <span class="comment"># [2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><p>With the help of this generator function, we don‚Äôt need a separate iterator type.Just keep the state during iteration directly in some local variable.</p><p>In this post, let‚Äôs see how we can do this in C++, with the help of <code>std::generator&lt;T&gt;</code>.</p><p>A shorter version of this post can be found in Gist and Compiler Explorer.</p><ul><li><a href="https://gist.github.com/wdhongtw/aa61b9b4dd132ffeae64d9189e9ba2cc">https://gist.github.com/wdhongtw/aa61b9b4dd132ffeae64d9189e9ba2cc</a></li><li><a href="https://godbolt.org/z/K57Enfhcr">https://godbolt.org/z/K57Enfhcr</a></li></ul><h2 id="Coroutine-and-Concurrent-Programming"><a href="#Coroutine-and-Concurrent-Programming" class="headerlink" title="Coroutine and Concurrent Programming"></a>Coroutine and Concurrent Programming</h2><p>What happens in the example above is that Python interpreter binds the execution state ofthat function to a generator object. Every time we want a value from that generator,the execution resumes until the function yields the next value (or returns).</p><p>This is doable because Python provide a builtin support for <strong>coroutine, an interruptible&#x2F;resumablefunction</strong>, so the control flow can interleave between callee and caller functions. And that‚Äôs theprimitive building block of concurrent programming.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">values = TwoTillSix()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> values:</span><br><span class="line">    <span class="built_in">print</span>(val)</span><br><span class="line">    <span class="keyword">if</span> val == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># Print 2 and 3. The body of `TwoTillSix.__iter__` is only executed twice.</span></span><br></pre></td></tr></table></figure><p>As we can see here, the generator makes it possible that some values are evaluated lazily,and we can even stop the evaluation any time when we lost the interest.All of this is possible because the support of coroutine.</p><h2 id="C-Coroutine-and-std-generator"><a href="#C-Coroutine-and-std-generator" class="headerlink" title="C++ Coroutine and std::generator"></a>C++ Coroutine and <code>std::generator</code></h2><p>Fortunately, C++ has language level support for coroutine since C++20.When compiler see a function using new keywords <code>co_await</code> &#x2F; <code>co_yield</code> and <code>co_return</code>,it will generate corresponding code to provide the ability of partial execution, and the storageof state for that function when it‚Äôs interrupted.</p><p>Also, starting from C++23, <code>std::generator</code> is included in standard library. As thecoroutine (promise-)type that capture the common usage of‚Ä¶ yes, generator!!(Actually I‚Äôm surprised that there is no any high-level coroutine type in standard librarywhen coroutine is accepted as a language feature when C++20 is finalized.)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::generator&lt;<span class="type">int</span>&gt; <span class="title">fibonacci</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">co_yield</span> a;</span><br><span class="line">        b = std::<span class="built_in">exchange</span>(a, a + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : <span class="built_in">fibonacci</span>()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        std::<span class="built_in">println</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, num); <span class="comment">// prints 1 1 2 3 5 8</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When <code>fibonacci</code> is called here, an interruptible function is created, and wrapped in the<code>std::generator</code> return value. Every time we take next value out in the for-loop, the functionresumes and yield next value (and is interrupted again).</p><p>So now we have the ability to interleave control flow, just like the example in Python earlier!!But‚Ä¶ that‚Äôs a free function, usually what we encounter is a container class.A class must has <code>begin</code>&#x2F;<code>end</code> method, and corresponding increment&#x2F;dereference operator onthe returned iterator type, in order to be iterable.(It‚Äôs modeled as named requirements <em>Container</em> in standard.)If a class need another method call to be iterated on, it just looks‚Ä¶ not like C++.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Factorial</span> &#123; <span class="comment">// a virtual container for factorial series</span></span><br><span class="line">    <span class="function">std::generator&lt;<span class="type">int</span>&gt; <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> product = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> val = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">co_yield</span> product;</span><br><span class="line">            product *= val++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Factorial fac &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : fac.<span class="built_in">generate</span>()) &#123; <span class="comment">// well.. can we iterate on fac directly?</span></span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        std::<span class="built_in">println</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So‚Ä¶ can we keep the implementation simple (using <code>std::generator</code> coroutine type),while keeping the container being iterated in usual way?</p><h2 id="CRTP-Curiously-Recurring-Template-Pattern"><a href="#CRTP-Curiously-Recurring-Template-Pattern" class="headerlink" title="CRTP: Curiously Recurring Template Pattern"></a>CRTP: Curiously Recurring Template Pattern</h2><p>Now our goal become clear:</p><blockquote><p>How can we make a class be used as before, if the class only provides a methodthat return a <code>std::generator</code>?‚Äù</p></blockquote><p>That‚Äôs the place where we adopt CRTP to solve problem.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @brief HasGenerator identifies the customization point of CRTP base AutoContainer.</span></span><br><span class="line"><span class="comment">/// @tparam C the child class type.</span></span><br><span class="line"><span class="comment">/// @tparam T the value type.</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">concept</span> HasGenerator = <span class="built_in">requires</span>(C c) &#123;</span><br><span class="line">    &#123; c.<span class="built_in">generate</span>() &#125; -&gt; std::same_as&lt;std::generator&lt;T&gt;&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief A CRTP base type that allow easy iteration implementation.</span></span><br><span class="line"><span class="comment">/// @tparam T the value type of element being iterated. Not child class type.</span></span><br><span class="line"><span class="comment">/// @details Child class must provide std::generator&lt;T&gt; generate() member function.</span></span><br><span class="line"><span class="keyword">template</span> &lt;std::semiregular T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AutoContainer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Iter</span> &#123;</span><br><span class="line">        std::generator&lt;T&gt; gen_;</span><br><span class="line">        std::ranges::<span class="type">iterator_t</span>&lt;std::generator&lt;T&gt;&gt; iter_;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Iter</span>(std::generator&lt;T&gt;&amp;&amp; gen)</span><br><span class="line">            : gen_ &#123; std::<span class="built_in">move</span>(gen) &#125; <span class="comment">// ensure generator being alive</span></span><br><span class="line">            , iter_ &#123; gen_.<span class="built_in">begin</span>() &#125; &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> std::<span class="type">default_sentinel_t</span>&amp;) <span class="type">const</span> &#123; <span class="keyword">return</span> iter_ == gen_.<span class="built_in">end</span>(); &#125;</span><br><span class="line">        Iter&amp; <span class="keyword">operator</span>++() &#123; <span class="keyword">return</span> ++iter_, *<span class="keyword">this</span>; &#125;</span><br><span class="line">        T <span class="keyword">operator</span>*() <span class="type">const</span> &#123; <span class="keyword">return</span> *iter_; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// deducing-this so that we can do CRTP.</span></span><br><span class="line">    <span class="comment">// Also use concept to give better error message when doing mistake.</span></span><br><span class="line">    <span class="function">Iter <span class="title">begin</span><span class="params">(<span class="keyword">this</span> HasGenerator&lt;T&gt; <span class="keyword">auto</span>&amp;&amp; self)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Iter</span>(self.<span class="built_in">generate</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// deducing-this not required, just be symmetric with begin.</span></span><br><span class="line">    <span class="function">std::<span class="type">default_sentinel_t</span> <span class="title">end</span><span class="params">(<span class="keyword">this</span> <span class="keyword">auto</span>&amp;&amp; self)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::default_sentinel;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>AutoContainer</code> can inherited by any class that want the all the implementation for iteration.The base class here provides an iterator type to capture the generator, and forwards theincrement&#x2F;dereference operation to it. With this iterator type, the remaineffort is on the <code>begin</code> method, just construct the iterator from <code>self.generate()</code>.Here <code>self</code> is typed by deducing-this so <code>generate()</code> can be provided later by child class.And that‚Äôs the place where the base class connects to it‚Äôs child.</p><p>Also at the <code>begin</code> method, we add concept constrain <code>HasGenerator</code>.This way we can avoid error waterfall when using templated library.And the interesting thing here is: ‚ÄúThe thing to be templated so that we achieve CRTP,is the templated <code>begin</code> method, not the <code>AutoContainer</code> class itself.If there are two child class both  inherit from <code>AuthContainer&lt;int&gt;</code>,only one <code>AuthContainer</code> type is instantiated, but two different <code>begin</code> are instantiated.</p><p>(See also: <a href="https://en.cppreference.com/w/cpp/language/crtp">Curiously Recurring Template Pattern - cppreference.com</a>)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @brief Factorial sequence generator.</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Factorial</span> : <span class="keyword">public</span> AutoContainer&lt;<span class="type">int</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Implement `generate` so this class can be iterated like a container.</span></span><br><span class="line">        <span class="function">std::generator&lt;<span class="type">int</span>&gt; <span class="title">generate</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">            <span class="comment">// The mutable state is the local variable of this coroutine,</span></span><br><span class="line">            <span class="comment">// so the method receiver can be const.</span></span><br><span class="line">            <span class="type">int</span> product = <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> val = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">co_yield</span> product;</span><br><span class="line">                product *= val++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> Factorial fac &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> value : fac) &#123; <span class="comment">// noticed that we don&#x27;t call generate() here</span></span><br><span class="line">        <span class="keyword">if</span> (value &gt; <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        std::<span class="built_in">println</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, value); <span class="comment">// prints 1, 1, 2, 6</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now we can use the <code>AutoContainer</code> by inherit it in any child class.In the example above, <code>Factorial</code> inherit from <code>AutoContainer&lt;int&gt;</code> (since it generates integers).All we need to do is implement the <code>generate</code> method. Being a coroutine, the logic is clean.</p><p>Now everything works and <strong>looks nice</strong>!! :D</p><p>To make this class recognized as a <code>std::ranges::input_range</code>, that is, to make this classworks with <code>&lt;ranges&gt;</code> library, the base <code>AutoContainer</code> actually need more stuffs, like<code>value_type</code>&#x2F;<code>difference_type</code> on it‚Äôs iterator, support of post-increment operator, and so on‚Ä¶But that‚Äôs probably too much in a tutorial, so let‚Äôs stop here.</p><h2 id="More-Standard-Library-Support-Maybe"><a href="#More-Standard-Library-Support-Maybe" class="headerlink" title="More Standard Library Support, Maybe?"></a>More Standard Library Support, Maybe?</h2><p>We describe the minimal concept about coroutine, one important application of coroutine asGenerator (<code>std::generator</code>), and how to use it in a beautiful way.But there is another important application of coroutine: Promise (with Event Loop).</p><p>JS developers already get used to the <code>Promise</code> type (or maybe the <code>async</code>&#x2F;<code>await</code> keyword).Python also support this kind of usage since Python 3.5.But unfortunately, there is still no such thing in C++ standard library, even if the coroutineis standardized in C++20.</p><p>The good news is that there is already a proposal P2300 and a reference implementation <code>NVIDIA/stdexec</code>.(They don‚Äôt use the term Promise, probably because <code>promise_type</code> already have other meaningin the context of C++ coroutine)</p><p>Hope we can see more usage about these in the future.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;In Python, we can make a container type iterable by implement &lt;code&gt;__iter__&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;For example, if we want to provide all</summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="cpp" scheme="https://blog.bitisle.net/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title>The Backbone of Frontend Framework</title>
    <link href="https://blog.bitisle.net/2025/02/04/javascript-proxy.html"/>
    <id>https://blog.bitisle.net/2025/02/04/javascript-proxy.html</id>
    <published>2025-02-04T14:10:00.000Z</published>
    <updated>2025-02-04T14:10:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>It‚Äôs almost impossible to write a frontend without any UI framework nowadays.</p><p>All these frameworks provide some kind of mechanism that, whenever we change a value in JavaScript,some element in UI will be changed automatically. For example, adding new row to a tablewhen we push a item into a list.</p><p>But how does this work under the surface?That‚Äôs the <em>Proxy Object</em>.</p><hr><h2 id="Internal-Method-and-Proxy"><a href="#Internal-Method-and-Proxy" class="headerlink" title="Internal Method and Proxy"></a>Internal Method and Proxy</h2><p>We need to talk about <em>internal method</em> in JS first.</p><p>A <em>internal method</em> is a special method&#x2F;function that decide how a object behaves in JS runtime.For example, <code>[[GET]]</code> internal method determines the result when we access some property <code>prop</code>from an object <code>obj</code>, e.g. <code>obj.prop</code>. And <code>[[Call]]</code> internal method determines what toproceed when we call the object <code>obj</code> as a function, e.g. <code>obj()</code>.</p><p>These internal methods can be intercepted and customized from some existing object,with a <em>Proxy</em> instance.</p><p>For example, if we want to intercept the property-read action of some object. Here is the way to do.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> agent = <span class="keyword">new</span> <span class="title class_">Proxy</span>(</span><br><span class="line">    person,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`access &quot;<span class="subst">$&#123;property&#125;</span>&quot; as <span class="subst">$&#123;target[property]&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> target[property];</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ = agent.<span class="property">name</span>; <span class="comment">// prints: access &quot;name&quot; as Alice&quot;</span></span><br></pre></td></tr></table></figure><p>In the snippet above, <code>agent</code> is the proxy object instance.The second argument to Proxy constructor is the <em>handler</em>, and the <code>get</code> function in that handleris a <em>trap</em> to the <code>[[GET]]</code> internal method.</p><p>See </p><h2 id="The-set-Trap-for-Binding"><a href="#The-set-Trap-for-Binding" class="headerlink" title="The set Trap for Binding"></a>The <code>set</code> Trap for Binding</h2><p>Just like we can intercept the property <strong>read</strong> action for some object, we can also interceptthe property <strong>write</strong> action. And that‚Äôs what UI frameworks do underneath.</p><p>Assuming we have a paragraph in DOM tree, identified by id <code>greeting</code>.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;greeting&quot;</span>&gt;</span>Hi<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>We can ensure that the text is updated automatically when we are doing somechange to JavaScript object. </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#greeting&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (property !== <span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        target[property] = value;</span><br><span class="line">        element.<span class="property">textContent</span> = value; <span class="comment">// react to the change</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> greeting = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;<span class="attr">text</span>: element.<span class="property">textContent</span>&#125;, handler);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(greeting.<span class="property">text</span>); <span class="comment">// print &#x27;Hi&#x27;</span></span><br><span class="line">greeting.<span class="property">text</span> = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"><span class="comment">// the text in the html page will be changed accordingly.</span></span><br></pre></td></tr></table></figure><p>Once this proxy object is created, we make the view (HTML) reactive tothe model (JavaScript object), and the binding is established.</p><hr><p>In the examples above, we may noticed that all the intercepted objects are an <em>object</em> literally.That means we can not do similar thing to primitive type in JS, like <code>number</code> and <code>string</code>.And that do have impact on the design of UI framework.For example, Vue.js framework has a <a href="https://vuejs.org/guide/essentials/reactivity-fundamentals#ref"><code>ref()</code></a> wrapper for that.</p><p>However, Proxy is still a powerful feature in JS, and probably the most important featurefor any senior engineer who need to work with JS.So just get used to it. :D</p><p>See Also: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy - MDN</a></p><h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><p>Full HTML file for the view-model binding example.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Proxy Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;greeting&quot;</span>&gt;</span>Hi<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> element = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#greeting&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> handler = &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, property, value, receiver</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (property !== <span class="string">&#x27;text&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                    target[property] = value;</span></span><br><span class="line"><span class="language-javascript">                    element.<span class="property">textContent</span> = value; <span class="comment">// react to the change</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> greeting = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;<span class="attr">text</span>: element.<span class="property">textContent</span>&#125;, handler);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(greeting.<span class="property">text</span>); <span class="comment">// print &#x27;Hi&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            greeting.<span class="property">text</span> = <span class="string">&#x27;Hello&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// the text in the html page will change accordingly.</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;It‚Äôs almost impossible to write a frontend without any UI framework nowadays.&lt;/p&gt;
&lt;p&gt;All these frameworks provide some kind of mechanism </summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="javascript" scheme="https://blog.bitisle.net/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>The True Placeholder Symbol in C++</title>
    <link href="https://blog.bitisle.net/2024/11/25/cpp-blank-identifier.html"/>
    <id>https://blog.bitisle.net/2024/11/25/cpp-blank-identifier.html</id>
    <published>2024-11-25T22:25:00.000Z</published>
    <updated>2024-11-25T22:25:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>In many programming language, the common way to indicate that the symbol is not important,is to use <code>_</code> for the symbol.</p><p>It was just a convention in C++, but it will become a language feature start from C++26.</p><p>Well‚Ä¶ what‚Äôs the difference?</p><hr><p>We use <code>_</code> when there is some declaration but we do not care the name &#x2F; have no good name forthe variable.</p><p>For example, a common trick to preserve the life time of RAII lock is</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">doJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> std::mutex mutex;</span><br><span class="line">    std::lock_guard _(mutex); <span class="comment">// give it a name so it won&#x27;t unlock immediately</span></span><br><span class="line">    <span class="comment">// some jobs ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Or in structure-binding statement.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;std::regular T&gt;</span><br><span class="line"><span class="function">std::tuple&lt;T, <span class="type">bool</span>&gt; <span class="title">someJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; &#123;&#125;, <span class="literal">true</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> [_, done] = <span class="built_in">someJob</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The problem is‚Ä¶ in C++, this style is just a convention, <code>_</code> is still a regular variable.So if we want to ignore two value with different type, it does not work since the type mismatch.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> [_1, done1] = <span class="built_in">someJob</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">    <span class="keyword">auto</span> [_2, done2] = <span class="built_in">someJob</span>&lt;std::string&gt;();</span><br><span class="line">    <span class="comment">// we need to separate _2 from _1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That‚Äôs frustrating, especially for people with experience of pattern-matching expression inother languages.</p><p>So in C++26 (proposed by P2169), now we can new way to interpret the semantic of <code>_</code>.</p><p>The rule is simple.</p><blockquote><p>If there is only one declaration of <code>_</code> in some scope, everything is same as before.</p></blockquote><p>A we can reference it later if we wan‚Äôt, although it‚Äôs probably a bad smell to use <code>_</code> in this case.</p><blockquote><p>If there are more declarations of <code>_</code>, they all refer to different objects respectively.</p></blockquote><p>In this case, they can only be assigned to. Try to use them is a compiling error.</p><p>And we can finally write something that looks more natural.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> [_, done1] = <span class="built_in">someJob</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">    <span class="keyword">auto</span> [_, done2] = <span class="built_in">someJob</span>&lt;std::string&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>Golang has this feature from the beginning, is called <em>blank identifier</em>.For Python, although being a dynamic-type language, there is no problem to do use <code>_</code> for differenttype value. <code>_</code> is defined as a wildcard when pattern-matching is introduced to Python (PEP 634).</p><p>It‚Äôs happy to see this came to C++ now. :D</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;In many programming language, the common way to indicate that the symbol is not important,
is to use &lt;code&gt;_&lt;/code&gt; for the symbol.&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="news" scheme="https://blog.bitisle.net/categories/news/"/>
    
    
    <category term="cpp" scheme="https://blog.bitisle.net/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title>There is No Unit Type in C++</title>
    <link href="https://blog.bitisle.net/2024/10/23/cpp-optional-monostate.html"/>
    <id>https://blog.bitisle.net/2024/10/23/cpp-optional-monostate.html</id>
    <published>2024-10-23T00:15:00.000Z</published>
    <updated>2024-10-23T00:15:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>There is NO unit type in C++. (Not in core language spec, at least.)</p><h2 id="A-Story"><a href="#A-Story" class="headerlink" title="A Story"></a>A Story</h2><p>Assuming we are define a abstract interface for storage to get name &#x2F; set name for some user.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Storage</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">GetName</span><span class="params">(<span class="type">int</span> id)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SetName</span><span class="params">(<span class="type">int</span> id, std::string name)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Simple and straightforward.</p><p>But it‚Äôs intended to be a storage accessed through network, so any operation on it isinherently going to fail at some time.Also, We are 2024 now, loving FP, preferring expression over statement, monadic operationbeing so cool.Thus we decide to wrap all return type in <code>std::optional</code> to indicate these actions may fail.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Storage</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::optional&lt;std::string&gt; <span class="title">GetName</span><span class="params">(<span class="type">int</span> id)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::optional&lt;<span class="type">void</span>&gt; <span class="title">SetName</span><span class="params">(<span class="type">int</span> id, std::string name)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Looks good! But now it fails to be compiled.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...\include\optional(100,26): error C2182: &#x27;_Value&#x27;: this use of &#x27;void&#x27; is not valid</span><br></pre></td></tr></table></figure><p>Well. template stuff.</p><h2 id="What-Happened"><a href="#What-Happened" class="headerlink" title="What Happened?"></a>What Happened?</h2><p>The problem is that <code>void</code> is an incomplete type in C&#x2F;C++, and always to be treat speciallywhen we are trying to use them.</p><p>By incomplete in C&#x2F;C++, we mean a type that the size of which is not (yet) known.</p><p>For example, if we forward declare a struct type, and later define it‚Äôs member. The struct typeis incomplete before the definition.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Item</span>;</span><br><span class="line"></span><br><span class="line">Item item; <span class="comment">// &lt;- invalid usage, since that the size of Item is unknown yet.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">    <span class="type">int</span> price;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Item item; <span class="comment">// &lt;- valid usage here.</span></span><br></pre></td></tr></table></figure><p>And <code>void</code> is a type that is impossible to be complete by specification.</p><p>But we can have a function that return <code>void</code>?Well, we return <em>nothing</em></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span>; &#125; <span class="comment">// Or explicit return, both equivalent.</span></span><br></pre></td></tr></table></figure><p>BTW, C before C23 prefer putting a <code>void</code> in parameter list to indicate that a function takes<em>nothing</em>, e.g. <code>int bar(void)</code>, but is‚Äôs kinda broken design here.</p><p>Since that we can not evaluate <code>bar(foo())</code>. There is no such thing that is a <code>void</code> and exists.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bar</span><span class="params">(<span class="type">void</span>)</span> </span>&#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bar</span>(<span class="built_in">foo</span>()); <span class="comment">// &lt;- invalid expression here.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So back to our problem here <code>std::optional&lt;void&gt;</code></p><p>Conceptually, <code>std::optional&lt;T&gt;</code> is just a some T with additional information of <em>value-existence</em>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyOptional</span> &#123;</span><br><span class="line">    T value;</span><br><span class="line">    <span class="type">bool</span> hasValue;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Because that there is impossible to have a member <code>void value</code>,<code>std::optional&lt;void&gt;</code> is not going to be a valid type at first place.</p><p>(Well, we can make a specialization for <code>void</code>, but that‚Äôs another story.)</p><h2 id="So-How-can-We-Fix"><a href="#So-How-can-We-Fix" class="headerlink" title="So, How can We Fix?"></a>So, How can We Fix?</h2><p>The problem here is that there is no a valid value for <code>void</code> in C&#x2F;C++.At some level, program can be though of a bunch of expressions. An running a programis just the evaluation of these expressions. (Also the side effects, for real products &#x2F; services)</p><p>The atom of expression is value. If there is a concept that‚Äôs not possible to be expressas a value, we are kicking ourselves.</p><p>Take Python for example, if we have a function that return nothing, then the function actually<strong>returns</strong> <code>None</code> when it exits.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(foo() <span class="keyword">is</span> <span class="literal">None</span>) <span class="comment"># check pass here</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">arg: <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bar</span>(<span class="params">arg: <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">bar(foo(<span class="literal">None</span>)) <span class="comment"># well.. if we really want to chain them together</span></span><br></pre></td></tr></table></figure><p>So <em>nothing</em> itself is a thing, in Python, we call it <code>None</code>.Every expression now is evaluated to some value that exists, the the type system build up thatis complete at any case.</p><p>The concept of <em>nothing</em> itself here is call <strong>unit type</strong> in type theory.It‚Äôs a type that has one and only one value.In Python, the value is <code>None</code>, in JavaScript it‚Äôs <code>null</code>, in Golang ‚Ä¶ maybe <code>struct&#123;&#125;&#123;&#125;</code> is agood choice, although not standardized by the language.</p><h2 id="Unit-Type-in-C"><a href="#Unit-Type-in-C" class="headerlink" title="Unit Type in C++"></a>Unit Type in C++</h2><p>Now is the time for C++. As we already see, <code>void</code> is not a good choice for unit type because wecan not have a value for it. Are there other choices here?</p><p>Just define a empty struct and use it probably not a good choice, since thatnow our custom unit type is not compatible with unit type from other code in the product code base.</p><p>How about <code>nullptr</code>, that‚Äôs the only one value for <code>std::nullptr_t</code>.(So the type is <code>std::optional&lt;std::nullptr_t&gt;</code>).It‚Äôs a feasible choice, but looks weird since that pointer implies indirect access semantic,but it‚Äôs not the case when using with <code>std::optional&lt;T&gt;</code> here.</p><p>How about using <code>std::nullopt_t</code>? It‚Äôs also a unit type but it‚Äôs now more confusing.What‚Äôs does it mean by <code>std::optional&lt;std::nullopt_t&gt;</code>? A optional with empty option?There is a static assert in <code>std::optional&lt;T&gt;</code> template that forbid this usage directly,probably because it‚Äôs too confusing.</p><p>Maybe <code>std::tuple&lt;&gt;</code>? A tuple with zero element, so it have only one value, the empty tuple.That seems to be a good choice because the canonical unit type in Haskell is <code>()</code> the empty tuple.So it looks natural for people came from Haskell.But personally I don‚Äôt like this either since that now the type has nested angle bracketas <code>std::optional&lt;std::tuple&lt;&gt;&gt;</code>.</p><p>There is a type called <code>std::monostate</code>, arrived at the same time as <code>std::optional</code> in C++17.This candidate do not have additional implication by it‚Äôs type or it‚Äôs name.It‚Äôs <em>monostate</em>! Just a little wordy.</p><p><code>std::monostate</code> is originally designed to solve the problem for a <code>std::variant&lt;...&gt;</code> to bedefault initialized with any value. But it‚Äôs name and it‚Äôs characteristic are all fit ourrequirement here. Thus a good choice for wrapping a function that may fail butreturn nothing.</p><p>Now the interface looks like</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Storage</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::optional&lt;std::string&gt; <span class="title">GetName</span><span class="params">(<span class="type">int</span> id)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::optional&lt;std::monostate&gt; <span class="title">SetName</span><span class="params">(<span class="type">int</span> id, std::string name)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Hmm‚Ä¶ <code>std::optional&lt;std::monostate&gt;</code>, which takes 29 characters.C++ is not easy. Just like we use <code>std::shared_ptr&lt;T&gt;</code> all over the places.</p><p>Maybe the C++ Standards Committee should specialize <code>std::optional&lt;void&gt;</code>,just like <code>std::expected&lt;void&gt;</code> in C++23.</p><hr><p>Wish someday <code>void</code> can be a REAL unit type in C&#x2F;C++. :D</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;There is NO unit type in C++. (Not in core language spec, at least.)&lt;/p&gt;
&lt;h2 id=&quot;A-Story&quot;&gt;&lt;a href=&quot;#A-Story&quot; class=&quot;headerlink&quot; title=&quot;A </summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="cpp" scheme="https://blog.bitisle.net/tags/cpp/"/>
    
    <category term="typing" scheme="https://blog.bitisle.net/tags/typing/"/>
    
  </entry>
  
  <entry>
    <title>Golang 1.23 Iterator Functions</title>
    <link href="https://blog.bitisle.net/2024/08/22/golang-iterator-functions.html"/>
    <id>https://blog.bitisle.net/2024/08/22/golang-iterator-functions.html</id>
    <published>2024-08-22T09:05:34.000Z</published>
    <updated>2024-08-22T09:05:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>For a long long long time, Golang have no standard way to represent a iterable sequence.</p><p>C++ has range adaptor and iterator (although not strictly typed, only by concept), Python hasiterable&#x2F;iterator by <code>__iter__</code>&#x2F;<code>__next__</code>, JavaScript has standardized <code>for-of</code> and<code>Symbol.iterator</code> since ES6.</p><p>Now it‚Äôs time for Golang. Starting from Golang 1.23 Aug., we have <strong>iterator functions</strong>.</p><h2 id="How-It-Works"><a href="#How-It-Works" class="headerlink" title="How It Works."></a>How It Works.</h2><p>Sample code explains faster.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Iota</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">(yield <span class="keyword">func</span>(idx <span class="type">int</span>)</span></span> <span class="type">bool</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(yield <span class="keyword">func</span>(idx <span class="type">int</span>)</span></span> <span class="type">bool</span>) &#123;</span><br><span class="line">idx := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !yield(idx) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">idx += <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> idx := <span class="keyword">range</span> Iota() &#123;</span><br><span class="line"><span class="keyword">if</span> idx == <span class="number">3</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(idx) <span class="comment">// print 0 1 2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>According to <a href="https://go.dev/doc/go1.23">Go 1.23 Release Notes</a>Now the <code>range</code> keyword accept three kinds of functions, for which takes another <code>yield</code> functionthat yield zero&#x2F;one&#x2F;two values.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>()</span></span> <span class="type">bool</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>(K)</span></span> <span class="type">bool</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>(K, V)</span></span> <span class="type">bool</span>)</span><br></pre></td></tr></table></figure><p>The loop control variable and the body of the for-loop is translated into the <code>yield</code> function bylanguage definition. So we can still write imperative-style loop structure even though we areactually doing some functional-style function composition here.</p><h2 id="Why-Do-We-Need-This"><a href="#Why-Do-We-Need-This" class="headerlink" title="Why Do We Need This?"></a>Why Do We Need This?</h2><p>Standardize the iterable&#x2F;iterator interface is a important pre-condition for lazy evaluation.For example, how should we do when we need to iterates through all non-negative integer,and doing some map&#x2F;filter&#x2F;reduce on them?  It waste space to allocate a list for all theseintegers (if possible).</p><p>Someone may say ‚Äúwe already have channel types‚Äù.Well, but that requires a separate coroutine instance. We probably don‚Äôt want such heavycost every time we are doing some iterate operations.</p><p>Also a separate coroutine means additional synchronization and lifecycle control.For example, how can we terminate the <code>Count</code> coroutine when we need early break in loop?</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Count</span><span class="params">(start <span class="type">int</span>)</span></span> <span class="keyword">chan</span> <span class="type">int</span> &#123;</span><br><span class="line">output := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">idx := start</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">output &lt;- idx</span><br><span class="line">idx += <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">return</span> output</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> idx := <span class="keyword">range</span> Count(<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> idx == <span class="number">10</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;Loop: &quot;</span>, idx)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We need some mechanism like context object or another channel right?That‚Äôs a burden for such easy task here.</p><p>On the other hand, <strong>iterator functions</strong> are just ordinary function that accept another functionto yield&#x2F;output the iterated values, so it‚Äôs much lightweight than a separate coroutine.We want fast program, right? :D</p><h2 id="The-Stop-Design"><a href="#The-Stop-Design" class="headerlink" title="The Stop Design"></a>The Stop Design</h2><p>For languages like Python and JavaScript, the iterator function (or generator in Python terms)is paused and the control is transfer back to the function that iterates the values.When <code>break</code>&#x2F;<code>return</code> happens and no more value are required, the iterator function justgot collected by the runtime since that there are no more references to the function object.</p><p>But how do we early break the iteration process, if the control is transferinto the iterator function? Let‚Äôs look at the function signature again.(Take one value iterator function for example).</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(yield <span class="keyword">func</span>(idx <span class="type">int</span>)</span></span> <span class="type">bool</span>)</span><br></pre></td></tr></table></figure><p>The <code>yield</code> function returns a <code>bool</code> to indicate that whether the loop body does reach theend, or encounter a <code>break</code> statement. So in normal case, we continue to next possible valueafter <code>yield</code> return, but if we got <code>false</code> from <code>yield</code>, our iterator functioncan return immediately. </p><h2 id="Ecosystem-around-Iterator"><a href="#Ecosystem-around-Iterator" class="headerlink" title="Ecosystem around Iterator"></a>Ecosystem around Iterator</h2><p>The beauty of iterator only appears if the ecosystem, or we say, the common operations arounditerator are already implemented in standard library. That means:</p><ul><li>Conversion from and to standard container types, like <code>slice</code> <code>map</code> and <code>chan</code></li><li>Operations and compositions of iterators, e.g. <code>map</code>&#x2F;<code>filter</code>&#x2F;<code>reduce</code>&#x2F;<code>chain</code>&#x2F;<code>take</code> ‚Ä¶</li></ul><p>In Python, there are generator expressions, which evolves implicit <code>map/filter</code>.<code>reduce</code> is a function at global scope, also there are many useful functions in <code>itertools</code> package,e.g. <code>pairwise</code>, <code>batched</code>, <code>chain</code>. Most builtin container types takes iterable as first argumentin it‚Äôs constructor.</p><p>In Golang, the first part is mostly done along the release of Golang 1.23.For example, to convert slice from and to iterator, we can use <code>slices.Collect</code> and <code>slices.Values</code>.</p><p>For second part, there is a plan to add <code>x/exp/xiter</code> package under <code>golang.org</code> namespace.There should be at least <code>Concat</code>, <code>Map</code>, <code>Filter</code>, <code>Reduce</code>, <code>Zip</code> ‚Ä¶ once it‚Äôs released.But unfortunately it‚Äôs not compete yet.</p><p>See: <a href="https://github.com/golang/go/issues/61897">iter: new package for iterators ¬∑ Issue #61897 ¬∑ golang&#x2F;go</a></p><p>Also I create a toy package <a href="https://pkg.go.dev/github.com/wdhongtw/mice/flow">github.com&#x2F;wdhongtw&#x2F;mice&#x2F;flow</a>to address some important building wheel around iterators</p><ul><li><code>Empty</code>&#x2F;<code>Pack</code> return a iterator for zero&#x2F;one value</li><li><code>Any</code>&#x2F;<code>All</code> short-circuit lazy evaluation of a predicate on a sequence of values</li><li><code>Forward</code>&#x2F;<code>Backward</code> absorb input and iterate in reversed order.</li></ul><p>For example, if we want to define a iterator function for a binary tree in recursive manner,we can use <code>Empty</code> and <code>Pack</code> together with <code>Chain</code> to implement this easily.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">    val   <span class="type">int</span></span><br><span class="line">    left  *Node</span><br><span class="line">    right *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Traverse</span><span class="params">(node *Node)</span></span> iter.Seq[<span class="type">int</span>] &#123;</span><br><span class="line">    <span class="comment">// Empty is useful as base case during recursive generator chaining.</span></span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Empty[<span class="type">int</span>]()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Pack is useful to promote a single value into a iterable for chaining.</span></span><br><span class="line">    <span class="keyword">return</span> Chain(</span><br><span class="line">        Traverse(node.left),</span><br><span class="line">        Pack(node.val),</span><br><span class="line">        Traverse(node.right),</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Looks cool, doesn‚Äôt it? :D</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;For a long long long time, Golang have no standard way to represent a iterable sequence.&lt;/p&gt;
&lt;p&gt;C++ has range adaptor and iterator (altho</summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="golang" scheme="https://blog.bitisle.net/tags/golang/"/>
    
    <category term="functional" scheme="https://blog.bitisle.net/tags/functional/"/>
    
  </entry>
  
  <entry>
    <title>Pipeline Style Map-Reduce in Python</title>
    <link href="https://blog.bitisle.net/2024/07/13/pipeline-style-python.html"/>
    <id>https://blog.bitisle.net/2024/07/13/pipeline-style-python.html</id>
    <published>2024-07-13T03:50:00.000Z</published>
    <updated>2024-07-13T03:50:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Since C++20, C++ provide a new style of data processing, and the ability oflazy evaluation by chaining the iterator to another iterator.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ranges&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; input = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> output = input | std::views::<span class="built_in">filter</span>([](<span class="type">const</span> <span class="type">int</span> n) &#123;<span class="keyword">return</span> n % <span class="number">3</span> == <span class="number">0</span>;&#125;)</span><br><span class="line">                        | std::views::<span class="built_in">transform</span>([](<span class="type">const</span> <span class="type">int</span> n) &#123;<span class="keyword">return</span> n * n;&#125;);</span><br><span class="line">    <span class="comment">// now output is [0, 9, 36, 81], conceptually</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Can we use this style in Python? Yes! :D</p><h2 id="Evaluation-of-Operators"><a href="#Evaluation-of-Operators" class="headerlink" title="Evaluation of Operators"></a>Evaluation of Operators</h2><p>In Python, all expression evolves a arithmetic operator, e.g. <code>a + b</code>, is evaluate by follow rule</p><ul><li>If the (forward) special method, e.g. <code>__add__</code> exists on left operand<ul><li>It‚Äôs invoked on left operand, e.g. <code>a.__add__(b)</code></li><li>If the invocation return some meaningful value other than <code>NotImplemented</code>, done!</li></ul></li><li>If the (forward) special method does not exist, or the invocation returns <code>NotImplemented</code>, then</li><li>If the <strong>reverse special method</strong>, e.g. <code>__radd__</code> exists on right operand<ul><li>It‚Äôs invoked on the right operator, e.g. <code>b.__radd__(a)</code></li><li>If the invocation return some meaningful value other than <code>NotImplemented</code>, done!</li></ul></li><li>Otherwise, <code>TypeError</code> is raised</li></ul><p>So it seems possible here‚Ä¶ Let‚Äôs make a quick experiment</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Adder</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, rhs: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._rhs = rhs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__ror__</span>(<span class="params">self, lhs: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> lhs + self._rhs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="number">5</span> == <span class="number">2</span> | Adder(<span class="number">3</span>)  <span class="comment"># Is 5 equals to 2 + 3 ? Yes!!</span></span><br></pre></td></tr></table></figure><p>This works because the <code>|</code> operator of integer <code>2</code> check the type of <code>Adder(3)</code> and found thatis not something it recognized, so it returns <code>NotImplemented</code> and our reverse magic method goes.</p><p>In C++, the <code>|</code> operator is overloaded(?) on range adaptors to accept ranges.So maybe we can make something similar, having some object implements <code>__ror__</code> that acceptan iterable and return another value (probably a iterator).</p><h2 id="Pipe-able-Higher-Order-Function"><a href="#Pipe-able-Higher-Order-Function" class="headerlink" title="Pipe-able Higher Order Function"></a>Pipe-able Higher Order Function</h2><p>So back to our motivation, Python already have something like <code>filter</code> <code>map</code> <code>reduce</code>,and also the powerful generator expression to filter and&#x2F;or map without explicit function call.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">values = <span class="built_in">filter</span>(<span class="keyword">lambda</span> v: v % <span class="number">2</span> == <span class="number">0</span>, <span class="built_in">range</span>(<span class="number">10</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">values = (v <span class="keyword">for</span> v <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> v % <span class="number">2</span> == <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>But it‚Äôs just hard to chain multiple operations together while preserving readability.</p><p>So let‚Äôs make a filter object that support <code>|</code> operator</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Filter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, predicate: <span class="type">Callable</span>[[<span class="built_in">int</span>], <span class="built_in">bool</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._predicate = predicate</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__ror__</span>(<span class="params">self, values: Iterable[<span class="built_in">int</span>]</span>) -&gt; Iterator[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">            <span class="keyword">if</span> self._predicate(value):</span><br><span class="line">                <span class="keyword">yield</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">selected = <span class="built_in">range</span>(<span class="number">10</span>) | Filter(<span class="keyword">lambda</span> val: val % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">assert</span> [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>] == <span class="built_in">list</span>(selected)</span><br></pre></td></tr></table></figure><p>How about map?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Mapper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, transform: <span class="type">Callable</span>[[<span class="built_in">int</span>], <span class="built_in">int</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._transform = transform</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__ror__</span>(<span class="params">self, values: Iterable[<span class="built_in">int</span>]</span>) -&gt; Iterator[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">            <span class="keyword">yield</span> self._transform(value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">processed = <span class="built_in">range</span>(<span class="number">3</span>) | Mapper(<span class="keyword">lambda</span> val: val * <span class="number">2</span>)</span><br><span class="line"><span class="keyword">assert</span> [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>] == <span class="built_in">list</span>(processed)</span><br></pre></td></tr></table></figure><p>Works well, we are great again!!</p><p>It just take some time for we to write the class representation for <code>filter</code>, <code>map</code>, <code>reduce</code>,<code>take</code>, <code>any</code> ‚Ä¶ and any higher function you may think useful.</p><p>Wait, it looks so tedious. Python should be a powerful language, isn‚Äôt it?</p><h2 id="Piper-and-Decorators"><a href="#Piper-and-Decorators" class="headerlink" title="Piper and Decorators"></a>Piper and Decorators</h2><p>The function capturing and <code>__ror__</code> implementation can be so annoying for all high order function.If we can make sure <code>__ror__</code> only take left operand, and return the return value of the capturedfunction, than we can extract a common <code>Piper</code> class. We just need another function to produce afunction that already capture the required logic.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Piper</span>(<span class="type">Generic</span>[_T, _U]):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func: <span class="type">Callable</span>[[_T], _U]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._func = func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__ror__</span>(<span class="params">self, lhs: _T</span>) -&gt; _U:</span><br><span class="line">        <span class="keyword">return</span> self._func(lhs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_wrapped</span>(<span class="params">predicate: <span class="type">Callable</span>[[_T], <span class="built_in">bool</span>]</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">apply</span>(<span class="params">items: Iterable[_T]</span>) -&gt; Iterator[_T]:</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            <span class="keyword">if</span> predicate(item):</span><br><span class="line">                <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Piper(apply)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">selected = <span class="built_in">range</span>(<span class="number">10</span>) | filter_wrapped(<span class="keyword">lambda</span> val: val % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">assert</span> [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>] == <span class="built_in">list</span>(selected)</span><br></pre></td></tr></table></figure><p>Now it looks a little nicer ‚Ä¶ but we still need to implement all wrapper functions for allkinds of operations?</p><p>Again, the only difference between these wrapped functions is the logic inside apply function,so we can extract this part again, with a decorator!! :D</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">on</span>(<span class="params">func: <span class="type">Callable</span>[Concatenate[_T, _P], _R]</span>) -&gt; <span class="type">Callable</span>[_P, Piper[_T, _R]]:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapped</span>(<span class="params">*args: _P.args, **kwargs: _P.kwargs</span>) -&gt; Piper[_T, _R]:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">apply</span>(<span class="params">head: _T</span>) -&gt; _R:</span><br><span class="line">            <span class="keyword">return</span> func(head, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Piper(apply)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapped</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@on</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">items: Iterable[_T], predicate: <span class="type">Callable</span>[[_T], <span class="built_in">bool</span>]</span>) -&gt; Iterator[_T]:</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">if</span> predicate(item):</span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">selected = <span class="built_in">range</span>(<span class="number">10</span>) | <span class="built_in">filter</span>(<span class="keyword">lambda</span> val: val % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">assert</span> [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>] == <span class="built_in">list</span>(selected)</span><br></pre></td></tr></table></figure><p>The <code>on</code> decorator accept some function <code>func</code>, and return a function that first take thetail arguments of <code>func</code> and return a function that accept head argument of <code>func</code> throughpipe operator.</p><p>So now we can express our thoughts in our codebase using pipeline style code,just with one helper class and one helper decorator! :D</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">values = <span class="built_in">range</span>(<span class="number">10</span>)</span><br><span class="line">result = (</span><br><span class="line">    values</span><br><span class="line">    | <span class="built_in">filter</span>(<span class="keyword">lambda</span> val: val % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">    | <span class="built_in">map</span>(<span class="built_in">str</span>)</span><br><span class="line">    | on(<span class="keyword">lambda</span> chunks: <span class="string">&quot;&quot;</span>.join(chunks))() <span class="comment"># create pipe-able object on the fly</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">assert</span> result == <span class="string">&quot;02468&quot;</span></span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) | <span class="built_in">filter</span>(<span class="keyword">lambda</span> val: val % <span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(val)</span><br></pre></td></tr></table></figure><h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><p>Complete type-safe code here</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">pipe is a module that make it easy to write higher-order pipeline function</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> <span class="type">Callable</span>, Iterable, Iterator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Generic</span>, TypeVar, ParamSpec, Concatenate</span><br><span class="line"></span><br><span class="line">_R = TypeVar(<span class="string">&quot;_R&quot;</span>)</span><br><span class="line">_T = TypeVar(<span class="string">&quot;_T&quot;</span>)</span><br><span class="line">_P = ParamSpec(<span class="string">&quot;_P&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Piper</span>(<span class="type">Generic</span>[_T, _R]):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Piper[T, R] is a function that accept T and return R</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    call the piper with &quot;value_t | piper_t_r&quot;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func: <span class="type">Callable</span>[[_T], _R]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._func = func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__ror__</span>(<span class="params">self, items: _T</span>) -&gt; _R:</span><br><span class="line">        <span class="keyword">return</span> self._func(items)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on</span>(<span class="params">func: <span class="type">Callable</span>[Concatenate[_T, _P], _R]</span>) -&gt; <span class="type">Callable</span>[_P, Piper[_T, _R]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &quot;on&quot; decorates a func into pipe-style function.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The result function first takes the arguments, excluding first,</span></span><br><span class="line"><span class="string">    and returns an object that takes the first argument through &quot;|&quot; operator.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapped</span>(<span class="params">*args: _P.args, **kwargs: _P.kwargs</span>) -&gt; Piper[_T, _R]:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">apply</span>(<span class="params">head: _T</span>) -&gt; _R:</span><br><span class="line">            <span class="keyword">return</span> func(head, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Piper(apply)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapped</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Since C++20, C++ provide a new style of data processing, and the ability of
lazy evaluation by chaining the iterator to another iterator.</summary>
      
    
    
    
    <category term="tips" scheme="https://blog.bitisle.net/categories/tips/"/>
    
    
    <category term="development" scheme="https://blog.bitisle.net/tags/development/"/>
    
    <category term="python" scheme="https://blog.bitisle.net/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Introduction of Function Hijacking in C</title>
    <link href="https://blog.bitisle.net/2024/07/08/intro-hijack-c-function.html"/>
    <id>https://blog.bitisle.net/2024/07/08/intro-hijack-c-function.html</id>
    <published>2024-07-08T11:28:00.000Z</published>
    <updated>2024-07-08T11:28:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Thanks to the symbol-lazy-loading ability in Unix environment,we can do many interesting thing on functions from some shared librarywhen executing some executables.</p><p>All we need to do are</p><ul><li>Implement a shared library that contains the functions we want to hijack.</li><li>Run the executable with our magic library inserted.</li></ul><h2 id="Make-a-Shared-Library"><a href="#Make-a-Shared-Library" class="headerlink" title="Make a Shared Library"></a>Make a Shared Library</h2><p>If we want to replace some function with stub &#x2F; fake implementation.we can just implement a function with the same name and the same signature.</p><p>For example, if we want to fixed the clock during unit test ‚Ä¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in hijack.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a &quot;time&quot; function which always return the timestamp of the epoch.</span></span><br><span class="line"><span class="type">time_t</span> <span class="title function_">time</span><span class="params">(<span class="type">time_t</span>* arg)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (arg)</span><br><span class="line">        *arg = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If we want do observation about some function call, but still delegate thecall to the original function, we can implement a function that loadcorresponding function at runtime and pass the function call.</p><p>For example, if we want to monitor the call sequence of file open action.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in hijack.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// write &quot;open&quot; action to standard error before open the file</span></span><br><span class="line">FILE* <span class="title function_">fopen</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* <span class="keyword">restrict</span> path, <span class="type">const</span> <span class="type">char</span>* <span class="keyword">restrict</span> mode)</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> used_count = <span class="number">0</span>;</span><br><span class="line">    used_count += <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;open file [%d]: \&quot;%s\&quot;\n&quot;</span>, used_count, path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> FILE* (*wrapped_type)(<span class="type">const</span> <span class="type">char</span>* <span class="keyword">restrict</span> path, <span class="type">const</span> <span class="type">char</span>* <span class="keyword">restrict</span> mode);</span><br><span class="line">    <span class="comment">// no dlopen, just search the function in magic handle RTLD_NEXT</span></span><br><span class="line">    wrapped_type wrapped = dlsym(RTLD_NEXT, <span class="string">&quot;fopen&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> wrapped(path, mode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>After finish our implementation, compile them as a shared library,called <code>hijack.so</code> here.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc -fPIC -shared -o hijack.so hijack.c</span><br></pre></td></tr></table></figure><h2 id="Hijack-during-Actual-Execution"><a href="#Hijack-during-Actual-Execution" class="headerlink" title="Hijack during Actual Execution"></a>Hijack during Actual Execution</h2><p>We can use <code>LD_PRELOAD</code> environment variable to do insert our specialshared library for any executable during execution.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=&quot;path-to-shared-lib&quot; executable</span><br></pre></td></tr></table></figure><p>For example, if we want to use the implementations in last section inour executable, called <code>app</code> here.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    FILE* handle = fopen(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">    assert(handle);</span><br><span class="line">    fclose(handle);</span><br><span class="line"></span><br><span class="line">    <span class="type">time_t</span> current = time(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;now: %s&quot;</span>, asctime(gmtime(&amp;current)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(Compile and) run the executable</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cc -o app app.c</span><br><span class="line">LD_PRELOAD=./hijack.so ./app</span><br></pre></td></tr></table></figure><p>Output</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">open file [1]: &quot;output.txt&quot;</span><br><span class="line">now: Thu Jan  1 00:00:00 1970</span><br></pre></td></tr></table></figure><p>The open-file action is traced, and the time is fixed to the epoch.</p><p>If we need to overwrite functions with more than one shared library,just use <code>:</code> to separate them in <code>LD_PRELOAD</code>.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>It‚Äôs a powerful feature, it allows we to do observation, to replace withmock&#x2F;fake implementation, or sometime even to apply emergency patch.</p><p>And all make this possible are the dynamic linking mechanism, andthe one-to-one mapping from symbol from sources to libraries&#x2F;binaries.</p><p>Although development in C is somehow inconvenient, but it‚Äôs stilla interesting experience when seeing this kind of usage. :D</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Thanks to the symbol-lazy-loading ability in Unix environment,
we can do many interesting thing on functions from some shared library
whe</summary>
      
    
    
    
    <category term="tips" scheme="https://blog.bitisle.net/categories/tips/"/>
    
    
    <category term="c" scheme="https://blog.bitisle.net/tags/c/"/>
    
    <category term="testing" scheme="https://blog.bitisle.net/tags/testing/"/>
    
    <category term="development" scheme="https://blog.bitisle.net/tags/development/"/>
    
  </entry>
  
  <entry>
    <title>Python ÁöÑ type ‰∏çÊòØ typeÔºü</title>
    <link href="https://blog.bitisle.net/2024/06/05/python-type-expression.html"/>
    <id>https://blog.bitisle.net/2024/06/05/python-type-expression.html</id>
    <published>2024-06-05T09:38:00.000Z</published>
    <updated>2024-06-05T09:38:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>ËøëÊúüÂõ†ÁÇ∫‰∏Ä‰∫õÂéüÂõ†ÔºåÊÉ≥Ëá™Â∑±ÂØ´‰∏ÄÂÄã Python Áî®ÁöÑ DI library„ÄÇÂØ´ÊòØÂØ´ÂÆå‰∫ÜÔºå‰∏çÂê´ test Âü∫Êú¨‰∏ä‰∏çÂà∞ 50 Ë°åÔºå‰πü release Âà∞ <a href="https://pypi.org/project/luckydep/">luckydep ¬∑ PyPI</a> ‰∫Ü„ÄÇ‰∏çÈÅéÂú®ÂØ´ÁöÑÈÅéÁ®ã‰∏≠ÁôºÁèæ‰∫Ü‰∏Ä‰∫õÂïèÈ°å„ÄÇ</p><p>Ëàá Golang ‰∏çÂêå„ÄÇ Âú® Python ‰∏≠ÔºåDI container ÊãøÂèñÁâπÂÆö instance ÁöÑ‰ªãÈù¢ (invoke&#x2F;bind&#x2F;get Á≠âÔºå‰∏ãÁ®± invoke)ÈúÄË¶ÅÊòéÁ¢∫ÂÇ≥ÈÅûÊÉ≥ÊãøÂèñÁöÑ instance ÁöÑ type„ÄÇ</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Invoke</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(c *Container)</span></span> T &#123;</span><br><span class="line">    <span class="keyword">var</span> _ T <span class="comment">// can construct T event if T is a interface</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// although we need to specify the type parameter, the type parameter</span></span><br><span class="line"><span class="comment">// is not passed during runtime</span></span><br><span class="line"><span class="keyword">var</span> instance = Invoke[SomeType](c)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">invoke</span>(<span class="params">t</span>): <span class="comment"># search and build a instance of type t</span></span><br><span class="line"></span><br><span class="line">c = Container()</span><br><span class="line">instance = c.invoke(SomeType) <span class="comment"># need to pass type as a parameter</span></span><br></pre></td></tr></table></figure><p>ÂÖ∂‰∏≠ÁöÑÊ†πÊú¨Â∑ÆÁï∞ÊòØÔºåGolang È°ûÂûãÁöÑ static type languageÔºågeneric function ÊúÉÁúüÁöÑÊ†πÊìö‰∏çÂêåÂûãÂà•ÔºåÁî¢ÁîüÂ∞çÊáâÁöÑfunction Âá∫‰æÜÔºåÈÄô‰∫õ function ÁöÑ byte code&#x2F;machine code Ëá™ÁÑ∂Áü•ÈÅìÁï∂‰∏ãÂú®ËôïÁêÜÁöÑÂûãÂà•„ÄÇËÄå Python ÈÄôÈ°ûË™ûË®ÄÔºåÈù† static type checker Âª∫Á´ã generic functionÔºåÂØ¶Èöõ‰∏äÂà∞ runtime ÊôÇÈÇÑÊòØÂè™Êúâ‰∏ÄÂÄãfunctionÔºåËá™ÁÑ∂ÊúÉÈúÄË¶ÅÂÇ≥ÈÅû type Áµ¶ invoke ‰ªãÈù¢„ÄÇ</p><p>Ëá™Âæû Python 3.6 ÈñãÂßãÊàëÂÄëÊúâ type hintÔºåÊâÄ‰ª•ÊàëÂÄëÂèØ‰ª• annotate function&#x2F;method ‰æÜÂπ´Âä©IDE&#x2F;type checker ‰æÜÊé®Ë´ñÊ≠£Á¢∫ÁöÑÂûãÂà•„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">invoke</span>(<span class="params">t: <span class="built_in">type</span>[T]</span>) -&gt; T: <span class="comment"># search and build a instance of type t</span></span><br><span class="line"></span><br><span class="line">c = Container()</span><br><span class="line">instance: SomeType = c.invoke(SomeType) <span class="comment"># ok, we can infer instance is SomeType</span></span><br></pre></td></tr></table></figure><p>ÈÄôÈÇä <code>type[T]</code> (or <code>typing.Type[T]</code>, the old way) Áî®‰æÜË°®Á§∫ÊàëÂÄëÊ≠£Âú®Áî® <code>t</code> ‰æÜÂÇ≥ÈÅûÂÇ≥ÈÅûÊüêÂÄã type <code>T</code>ÔºåËÄåÈùû type ÁÇ∫ <code>T</code> ÁöÑÊüêÂÄã instance„ÄÇ</p><p>From <code>typing</code> document:</p><blockquote><p>A variable annotated with <code>C</code> may accept a value of type <code>C</code>. In contrast, a variable annotated with<code>type[C]</code> (or <code>typing.Type[C]</code>) may accept values that are classes themselves</p></blockquote><h2 id="The-Problem"><a href="#The-Problem" class="headerlink" title="The Problem"></a>The Problem</h2><p>OKÔºåÊàëÂÄëÊúâ <code>type[T]</code> ÂèØ‰ª•Áî®„ÄÇ DI library ÈñãÁôºËÄÖÂèØ‰ª•Áî®ÂûãÂà•ÁÇ∫ <code>type[T]</code> ÁöÑ <code>t</code> ‰æÜÂÅö indexingÔºålibrary ‰ΩøÁî®ËÄÖÂèØ‰ª•‰∫´ÂèóÂà∞ static type checker Â∏∂‰æÜÁöÑ type safety„ÄÇ</p><p>ÊñºÊòØÊàëÂÄëÊãøÈÄôÂÄã library ‰æÜÁî®Âú®ÁúüÂØ¶ÊÉÖÂ¢É.. Ê≤íÊÉ≥Âà∞‰∏Ä‰∏ãÂ≠êÂ∞±Á¢∞‰∏äÂïèÈ°å‰∫Ü„ÄÇÁï∂ÊàëÂÄëÂÆöÁæ© interface typeÔºå‰∏¶ÈÄèÈÅé DI container Â∞çË©≤ interface ÊãøÂèñÂ∞çÊáâÁöÑ implementation instance ÊôÇ„ÄÇÂõ†ÁÇ∫ interface ÈÄöÂ∏∏ÊòØÂÄã abstract class (or protocol)Ôºå<code>mypy</code> type checker ÊúÉÂ†±ÈåØ(<a href="https://mypy.readthedocs.io/en/stable/error_code_list.html#safe-handling-of-abstract-type-object-types-type-abstract">mypy: type-abstract</a>)„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeInterface</span>(<span class="title class_ inherited__">Protocol</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">self</span>): ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeImplementation</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">self</span>): ...</span><br><span class="line"></span><br><span class="line">c.invoke(SomeInterface) <span class="comment"># trigger mypy error [type-abstract]</span></span><br></pre></td></tr></table></figure><p>‰∏çÊúÉÂêß‚Ä¶ ÈÄô‰∏çÊòØÊàëÂÄëÈúÄË¶Å DI ÁöÑÊúÄÈáçË¶ÅÂéüÂõ†ÂóéÔºüÊàëÂÄëÂÆöÁæ© interface ‰∏¶Âè¶Â§ñÊèê‰æõ implementationÔºå‰æÜÈÅîÂà∞ÈöîÈõ¢‰∏çÂêå class ËÅ∑Ë≤¨ÁöÑÊïàÊûú„ÄÇÁµêÊûúÁï∂ user Ë¶ÅÁî®ÈÄôÂÄã library ÁöÑÊôÇÂÄôÂçªÂç°Âú®ÂûãÂà•Ê™¢Êü•‚Ä¶</p><h2 id="The-History"><a href="#The-History" class="headerlink" title="The History"></a>The History</h2><p>ÁøªÈñ±Êñá‰ª∂ÔºåÁ¨¨‰∏ÄÊôÇÈñì‰ª•ÁÇ∫ÈÄôÊòØ <code>mypy</code> ÁöÑË®≠Ë®àÂïèÈ°å„ÄÇ</p><blockquote><p>Mypy always allows instantiating (calling) type objects typed as <code>Type[t]</code></p></blockquote><p>Ê≤íÊÉ≥Âà∞Áøª‰∫Ü <code>mypy</code> issue <a href="https://github.com/python/mypy/issues/4717">#4717 ¬∑ python&#x2F;mypy</a>ÂæåÔºåÁôºÁèæÈÄôÊòØÂ∑≤Á∂ìÂØ´Âú® PEP 544 ÂÖßÁöÑË¶èÊ†º„ÄÇ</p><blockquote><p>Variables and parameters annotated with <code>Type[Proto]</code> accept only concrete (non-protocol) subtypes of Proto.The main reason for this is to allow instantiation of parameters with such type. For example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">cls: <span class="type">Type</span>[Proto]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> cls().meth() <span class="comment"># OK</span></span><br></pre></td></tr></table></figure></blockquote><p><code>mypy</code> ÂÖÅË®± construct ‰∏ÄÂÄã‰∏çÁü•ÈÅì constructor Èï∑‰ªÄÈ∫ºÊ®£Â≠êÁöÑ interface typeÔºåÊâÄ‰ª•Ë©≤Ê®ôÁ§∫ <code>Type[Proto]</code> ÁöÑ parameter Âè™ËÉΩÂÇ≥ÈÅû concrete type‚Ä¶ ÂóØÔºü</p><p>ÁπºÁ∫åÂæÄ‰∏ãËøΩÔºåÊÉ≥‰∏çÂà∞‰∏ÄÈñãÂßãÊúÉÊúâÈÄôÂÄãÊ™¢Êü•ÔºåÊòØÂõ†ÁÇ∫ <strong>Guido Êú¨‰∫∫</strong> Âú® 2016 Âπ¥ÈñãÁöÑ <a href="https://github.com/python/mypy/issues/1843">#1843 ¬∑ python&#x2F;mypy</a>ÔºåË™çÁÇ∫ÊáâË©≤ÂÖÅË®±ÈÄôÁ®Æ‰ΩøÁî®ÊñπÊ≥ï„ÄÇ</p><p>ÊñºÊòØ <code>mypy</code> Âä†ÂÖ•‰∫ÜÈÄôÂÄãÊ™¢Êü•ÔºåÂæå‰æÜ 2017 Âπ¥ÁöÑ PEP 544 ‰πüÊòéÁ¢∫ÂÆöÁæ©‰∫ÜÈÄôÂÄã‰ΩøÁî®Ë¶èÂâá„ÄÇ</p><h2 id="The-Controversy"><a href="#The-Controversy" class="headerlink" title="The Controversy"></a>The Controversy</h2><p>ÈÄôÂÄã <code>t: type[T]</code> ÁöÑË®≠Ë®àÂºïËµ∑ÂæàÂ§öÁà≠Ë≠∞ÔºåÂæû <a href="https://github.com/python/mypy/issues/4717">#4717 ¬∑ python&#x2F;mypy</a>‰æÜÁúãÔºå‰∏çÂ∞ë‰∫∫Ë™çÁÇ∫: ÁÇ∫‰∫ÜÂÖÅË®± construct <code>t()</code> ËÄåÈôêÂà∂Âè™ËÉΩÂÇ≥ÈÅû concrete class ÊúÉÂ§ßÂπÖÈôêÂà∂ÈÄôÂÄã <code>type[T]</code> ÁöÑ‰ΩøÁî®ÊÉÖÂ¢É„ÄÇ</p><p>‰πüÊúâ‰∫∫Ë™çÁÇ∫ÈÄôÂÄãÊ™¢Êü•Ê†πÊú¨Â∞±‰∏çÂêàÁêÜÔºåÂõ†ÁÇ∫Ê≤íÊúâ‰∫∫ËÉΩ‰øùË≠âÈÄôÂÄã protocol type Â∫ï‰∏ãÁöÑ concrete class ÁöÑ constructorÂà∞Â∫ïË¶ÅÂêÉ‰ªÄÈ∫ºÊù±Ë•ø„ÄÇ Âç≥‰Ωø static type check Ê™¢Êü•ÈÅé‰∫ÜÔºå<code>t()</code> Âú® runtime Âô¥Êéâ‰∏ÄÈªû‰πü‰∏çÂ•áÊÄ™„ÄÇÊõ¥‰ΩïÊ≥ÅÊ†πÊú¨Ê≤íÁúãÈÅéÊúâ‰∫∫Âú® protocol type ‰∏äÈù¢ÂÆöÁæ© <code>__init__</code> methodÔºåÈÄôÂÄã <code>t()</code> ‰∏ÄÈñãÂßãÂà∞Â∫ïË¶ÅÊÄéÈ∫ºÊ™¢Êü•‰πü‰∏çÁü•ÈÅì„ÄÇ</p><p>Â¶ÇÊûúÁúãÁõ∏ÂÖ∂‰ªñË™ûË®ÄÁöÑÈñãÁôºÁ∂ìÈ©ó‚Ä¶Golang ÁîüÊÖãÁ≥ª constructor ÊòØ plain functionÔºåÂÆöÁæ© interface type ÊôÇËá™ÁÑ∂‰∏çÊúÉÂåÖÂê´ constructor„ÄÇÂØ´ C++ ÁöÑ‰∫∫ÊáâË©≤‰πüÊ≤íËÅΩÈÅé‰ªÄÈ∫º abstract constructorÔºåÂè™Êúâ destructor ÊúÉÊéõ <code>abstract</code> keyword„ÄÇÂõûÂà∞ Python Ëá™Ë∫´Ôºå<code>mypy</code> Âíå <code>pyright</code> ÂÖ©Â§ßÂ∑•ÂÖ∑‰πüÈÉΩÂÖÅË®± <code>__init__</code> ÁöÑ signature Âú®ÁπºÊâøÈçä‰∏≠Ë¢´‰øÆÊîπ„ÄÇ(see: <a href="https://github.com/python/typing/discussions/1305">python&#x2F;typing ¬∑ Discussion #1305</a>)</p><p>Ëá≥Êñº <code>typing.Type</code> ÁöÑÊñá‰ª∂ÔºåÂØ´ÂæóÂæàÊ®°Á≥äÔºåÊàëÊÉ≥Êúâ‰∏ÄÂÆöÁ®ãÂ∫¶ÁöÑ‰∫∫ÁúãÂà∞ÂèçËÄåÊõ¥ÂÆπÊòìË™§ÊúÉ„ÄÇ</p><blockquote><p><code>type[C]</code> ‚Ä¶ may accept values that are classes themselves ‚Ä¶</p></blockquote><p>Â∞±ÁÆóÊç®Ê£ÑÊéâ protocolÔºåÈôêÂà∂ÈÉΩÂè™ËÉΩÁî® concrete class ‰æÜÂÆöÁæ© interface„ÄÇÈÄôÂÄãÂè™ËÉΩÂÖÅË®± concrete class ÁöÑË¶èÂâáÈÇÑÈÄ†Êàê‰∫ÜÂè¶‰∏ÄÂÄãÂïèÈ°å: ‰ΩøÁî®ËÄÖË©≤Â¶Ç‰ΩïÂÇ≥ÈÅû function typeÔºü</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.register(<span class="type">Callable</span>[[<span class="built_in">int</span>, <span class="built_in">int</span>], <span class="built_in">int</span>], <span class="keyword">lambda</span> a, b: a + b) <span class="comment"># ????</span></span><br></pre></td></tr></table></figure><p>Ë™™Â•ΩÁöÑ function as first-class citizen Âë¢Ôºü ÊÄéÈ∫ºÂà∞‰∫ÜË¶ÅÂÇ≥ÈÅûÂûãÂà•ÊôÇÂ∞±‰∏çË°å‰∫ÜÔºü</p><p>Âú®ÁøªÈñ± issue ÁöÑÈÅéÁ®ã‰∏≠ÔºåÁôºÁèæÂÖ∂‰ªñ DI framework ÁöÑ repo ‰πüÈÅá‰∏äÂêåÊ®£ÁöÑÂïèÈ°å <a href="https://github.com/python-injector/injector/issues/143">#143 ¬∑ python-injector&#x2F;injector</a>ÔºåÈ†ìÊôÇË¶∫ÂæóËá™Â∑±‰∏çÂ≠§ÂñÆ„ÄÇ</p><h2 id="The-Future"><a href="#The-Future" class="headerlink" title="The Future"></a>The Future</h2><p>Áî±Êñº PEP 544 Ëá™Âæû 2017 Âπ¥Â∞±Â∑≤Á∂ìÂÆåÊàêÔºå<code>mypy</code> È†êË®≠Âü∑Ë°åÈÄôÂÄãÊ™¢Êü•‰πüË°å‰πãÊúâÂπ¥ÔºåÁèæÂú®ÂÜç‰æÜÊîπÈÄôÂÄãË°åÁÇ∫ÊàñË®±Â∑≤Á∂ì‰æÜ‰∏çÂèä‰∫Ü„ÄÇ</p><p>ÊñºÊòØÁÇ∫‰∫ÜËß£Ê±∫ÈÄôÂÄãÂïèÈ°åÔºå2020 Êúâ‰∫∫Âú®Èñã‰∫ÜÊñ∞ issue <a href="https://github.com/python/mypy/issues/9773">9773 ¬∑ python&#x2F;mypy</a>ÊÉ≥Ë¶ÅÂÆöÁæ©Êñ∞ÁöÑ annotation <code>TypeForm[T]</code>&#x2F;<code>TypeExpr[T]</code> ‰æÜÈÅîÊàêË¶ÅË°®ÈÅî‰ªªÊÑè type ÁöÑ type ÁöÑÈúÄÊ±Ç„ÄÇÂà∞ÁõÆÂâç (2024-06)ÔºåÂ∞çÊáâÁöÑ <a href="https://github.com/python/peps/pull/3798">PEP 747 draft</a> ‰πüÂ∑≤Á∂ìË¢´ÊèêÂá∫‰∫Ü„ÄÇ</p><p>Ëã•‰∏ÄÂàáÈ†ÜÂà©Ôºå‰ª•ÂæåÊàëÂÄëÂ∞±ÊúÉÁî® <code>TypeExpr[T]</code> ‰æÜË°®ÈÅîÈÄôÈ°û generic function</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">invoke</span>(<span class="params">t: TypeExpr[T]</span>) -&gt; T: <span class="comment"># search and build a instance of type t</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeType</span>(<span class="title class_ inherited__">Protocol</span>): ...</span><br><span class="line"></span><br><span class="line">c = Container()</span><br><span class="line">instance = c.invoke(SomeType) <span class="comment"># ok, we find a object for type SomeType for you!</span></span><br><span class="line">operator = c.invoke(<span class="type">Callable</span>[[<span class="built_in">int</span>], <span class="built_in">bool</span>]) <span class="comment"># you need a (int -&gt; bool)? no problem!</span></span><br></pre></td></tr></table></figure><p>Ëá≥ÊñºÁõÆÂâçÂòõ.. library user Âú®‰ΩøÁî®Âà∞ÈÄôÈ°û library ÁöÑÊ™îÊ°àÂä†ÂÖ•‰∏ãÈù¢ÈÄôË°åÂç≥ÂèØ„ÄÇÊàëÊÉ≥Ë¶Å‰øÆÊîπÁöÑÁØÑÂúçÂíåÈÄ†ÊàêÁöÑÂΩ±ÈüøÊáâË©≤ÈÉΩÈÇÑÂèØ‰ª•Êé•Âèó„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mypy: disable-error-code=&quot;type-abstract&quot;</span></span><br></pre></td></tr></table></figure><p>ÊúüË®± Python typing system ÂÆåÂ•ΩÁöÑÈÇ£Â§©Âà∞‰æÜ„ÄÇ</p><h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><ul><li>2016-07: <a href="https://github.com/python/mypy/issues/1843">#1843 ¬∑ python&#x2F;mypy</a> Guido ÊèêÂá∫Ë¶Å instantiate ÁöÑÈúÄÊ±Ç</li><li>2017-05: <a href="https://peps.python.org/pep-0544/">PEP 544</a> standardized and published</li><li>2018-05: <a href="https://github.com/python/mypy/issues/4717">#4717 ¬∑ python&#x2F;mypy</a> first discussion against <code>type[T]</code> design</li><li>2020-04: <a href="https://github.com/python-injector/injector/issues/143">#143 ¬∑ python-injector&#x2F;injector</a></li><li>2020-10: <a href="https://github.com/python/mypy/issues/9773">#9773 ¬∑ python&#x2F;mypy</a> propose idea of <code>TypeFrom[T]</code></li><li>2024-06: <a href="https://github.com/python/peps/pull/3798">PEP 747</a> draft created</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Intro&quot;&gt;&lt;a href=&quot;#Intro&quot; class=&quot;headerlink&quot; title=&quot;Intro&quot;&gt;&lt;/a&gt;Intro&lt;/h2&gt;&lt;p&gt;ËøëÊúüÂõ†ÁÇ∫‰∏Ä‰∫õÂéüÂõ†ÔºåÊÉ≥Ëá™Â∑±ÂØ´‰∏ÄÂÄã Python Áî®ÁöÑ DI library„ÄÇÂØ´ÊòØÂØ´ÂÆå‰∫ÜÔºå‰∏çÂê´ test Âü∫Êú¨‰∏ä‰∏çÂà∞ 5</summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="typing" scheme="https://blog.bitisle.net/tags/typing/"/>
    
    <category term="generic" scheme="https://blog.bitisle.net/tags/generic/"/>
    
    <category term="python" scheme="https://blog.bitisle.net/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Âà©Áî® SSH Âª∫Á´ã SOCKS Proxy</title>
    <link href="https://blog.bitisle.net/2022/04/20/ssh-socks-proxy.html"/>
    <id>https://blog.bitisle.net/2022/04/20/ssh-socks-proxy.html</id>
    <published>2022-04-20T02:58:00.000Z</published>
    <updated>2022-04-20T02:58:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ÊúÄËøëÂõ†ÁÇ∫Áñ´ÊÉÖÂèàÈñãÂßã WFH ‰∫Ü„ÄÇ ÂÖ¨Âè∏ÊúâÊèê‰æõ‰∏Ä‰∫õ VPN solution ËÆìÂì°Â∑•Â≠òÂèñÂÖ¨Âè∏ÂÖßÁ∂≤Ë∑ØÔºå‰ΩÜÊúâ‰∏Ä‰∫õÊû∂Âú® public cloud ‰∏äÁöÑÊúçÂãôÂæåÂè∞Âõ†ÁÇ∫ÊúâÊìã‰æÜÊ∫ê IPÔºåÁÑ°Ê≥ïÂú®ÂÆ∂Áõ¥Êé•Â≠òÂèñ„ÄÇ</p><p>ÈÄôÊôÇÂÄô SSH ÂÖßÂª∫ÁöÑ SOCKS proxy server ÂäüËÉΩÂ∞±ÂèØ‰ª•Ê¥æ‰∏äÁî®Â†¥‰∫ÜÔºÅ</p><p>SSH ÂèØ‰ª•Âú®Âª∫Á´ãÈÄ£Á∑öÊôÇÔºå‰∏Ä‰ΩµÂú®Êú¨Ê©üÁ´ØÈñãÂá∫‰∏ÄÂÄã SOCKS (version 4 and 5) ÁöÑ serverÔºåÊé•‰∏ã‰æÜ‰ªª‰ΩïÊáâÁî®Á®ãÂºèÈÉΩÂèØ‰ª•Â∞á‰ªªÊÑèÁöÑ TCP ÈÄ£Á∑öÈÄèÈÅéÈÄôÂÄã SOCKS serverÔºåËΩâÈÄÅÂà∞ SSH serverÂæåÂÜçËàáÁõÆÊ®ôÁ´ôÂè∞ÈÄ£Á∑ö„ÄÇÂõ†ÁÇ∫Â§ßÂÆ∂‰∏ÄÂÆöÂú®ÂÖ¨Âè∏Ë£°ÊúâÂè∞ÂèØ‰ª• SSH ÁöÑÊ©üÂô®(?)ÔºåÊñºÊòØÈÄôÁ®ÆÈôêÂà∂ÂÖ¨Âè∏ IP ÁöÑÁÆ°ÁêÜÂæåÂè∞Â∞±ÂèØ‰ª•È†ÜÂà©Â≠òÂèñ„ÄÇ :D</p><p>‰ΩøÁî®ÊñπÂºèÂæàÁ∞°ÂñÆÔºåSSH ÈÄ£Á∑öÊôÇÂ§ö‰∏ãÂèÉÊï∏Âç≥ÂèØ„ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &quot;target-machine&quot; -D &quot;localhost:1080&quot; -N</span><br></pre></td></tr></table></figure><ul><li><code>-D localhost:1080</code>: Ê±∫ÂÆöË¶ÅÈñãÂú® local ÁöÑ SOCKS portÔºåRFC Âª∫Ë≠∞ÊòØ 1080</li><li><code>-N</code>: Â¶ÇÊûú‰∏çÈúÄË¶ÅÈñã‰∏ÄÂÄã shellÔºåÂè™ÊòØË¶Å SOCKS proxy ÂäüËÉΩÔºåÈÇ£ÂèØ‰ª•Â§öÂ∏∂Ê≠§ÂèÉÊï∏</li></ul><p>Note: SSH ÊúâÊîØÊè¥ SOCKS5 (ÂèØÂÅö IPv6 proxy) ‰ΩÜ‰∏çÊîØÊè¥ authenticationÔºå‰∏çÈÅéÂõ†ÁÇ∫ SOCKS serverÂèØ‰ª•Â¶Ç‰∏äËø∞Ë®≠ÂÆöÂè™ÈñãÂú® <code>localhost</code> ‰∏äÔºåÊâÄ‰ª•Ê≤íÈ∫ºÂïèÈ°å„ÄÇ</p><p>Êé•ËëóÊàëÂÄëÂ∞±ÂèØ‰ª•Ë®≠ÂÆö OS Â±§Á¥öÊàñÊòØ application Â±§Á¥öÁöÑ proxy Ë®≠ÂÆö‰æÜ‰ΩøÁî®ÈÄôÂÄã proxy ‰∫ÜÔºÅ‰ª•Êàë‰∏ÄÈñãÂßãÈÅáÂà∞ÁöÑÂïèÈ°å‰æÜË™™ÔºåÈÄöÂ∏∏ÊàëÊúÉÂ§öÈñã‰∏ÄÂÄã Firefox ‰∏¶Ë®≠ÂÆö‰ΩøÁî® proxy ‰æÜÂ≠òÂèñÂÖ¨Âè∏ÁöÑÂêÑÁ®ÆÁÆ°ÁêÜÂæåÂè∞„ÄÇÈÄôÊ®£Â∞±ÂèØ‰ª•‰øùÊåÅÂÖ∂‰ªñÁ∂≤Ë∑ØÊµÅÈáèÈÇÑÊòØÁõ¥Êé•ÂæÄÂ§ñÊâìÔºå‰∏çÈúÄË¶ÅÈÅé proxy„ÄÇ :D</p><p>Ëã•Ë¶ÅÂø´ÈÄüÂïüÂãï proxyÔºåÂèØ‰ª•‰ΩøÁî® <a href="https://www.microsoft.com/zh-tw/p/windows-terminal/9n0dx20hk701">Windows Terminal</a>‰∏¶Ë®≠ÂÆö‰∏ÄÂÄã profileÔºåÂü∑Ë°å‰∏äËø∞ SSH Êåá‰ª§„ÄÇ</p><p>PuTTY ‰ΩúÁÇ∫ Windows ‰∏äÊúÄÂ§ö‰∫∫‰ΩøÁî®ÁöÑ SSH clientÔºå‰πüÊúâÊîØÊè¥ SOCKS proxy ÂäüËÉΩÔºåË©≥Ë¶ã: <a href="https://securitymusings.com/article/462/how-to-set-up-a-socks-proxy-using-putty-ssh">How To Set up a SOCKS Proxy Using Putty &amp; SSH - Security Musings</a></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://linux.die.net/man/1/ssh">ssh(1): OpenSSH SSH client - Linux man page</a></li><li><a href="https://serverfault.com/questions/336067/how-can-i-setup-a-socks-proxy-over-ssh-with-password-based-authentication-on-cen">linux - How can I setup a SOCKS proxy over ssh with password based authentication on CentOS? - Server Fault</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ÊúÄËøëÂõ†ÁÇ∫Áñ´ÊÉÖÂèàÈñãÂßã WFH ‰∫Ü„ÄÇ ÂÖ¨Âè∏ÊúâÊèê‰æõ‰∏Ä‰∫õ VPN solution ËÆìÂì°Â∑•Â≠òÂèñÂÖ¨Âè∏ÂÖßÁ∂≤Ë∑ØÔºå
‰ΩÜÊúâ‰∏Ä‰∫õÊû∂Âú® public cloud ‰∏äÁöÑÊúçÂãôÂæåÂè∞Âõ†ÁÇ∫ÊúâÊìã‰æÜÊ∫ê IPÔºåÁÑ°Ê≥ïÂú®ÂÆ∂Áõ¥Êé•Â≠òÂèñ„ÄÇ&lt;/p&gt;
&lt;p&gt;ÈÄôÊôÇÂÄô SSH ÂÖßÂª∫ÁöÑ SOCKS proxy server ÂäüËÉΩÂ∞±</summary>
      
    
    
    
    <category term="tips" scheme="https://blog.bitisle.net/categories/tips/"/>
    
    
    <category term="ssh" scheme="https://blog.bitisle.net/tags/ssh/"/>
    
    <category term="socks" scheme="https://blog.bitisle.net/tags/socks/"/>
    
  </entry>
  
  <entry>
    <title>Golang 1.18 Generics ÁµÇÊñº‰æÜËá®</title>
    <link href="https://blog.bitisle.net/2022/03/16/golang-generics-coming.html"/>
    <id>https://blog.bitisle.net/2022/03/16/golang-generics-coming.html</id>
    <published>2022-03-16T14:54:00.000Z</published>
    <updated>2022-03-16T14:54:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>‰ªäÂ§© Golang 1.18 ÁµÇÊñºÊ≠£ÂºèÈáãÂá∫Âï¶ÔºÅÊàëÂÄëÁµÇÊñºÊúâËæ¶Ê≥ïÂú® Golang Ë£°ÂÅö generic programming Âï¶ÔºÅ</p><p>Golang ÊòØ‰∏ÄÂÄãËøë 10 Âπ¥Âø´ÈÄüÁ´ÑÁ¥ÖÁöÑÁ®ãÂºèË™ûË®ÄÔºå‰ΩÜÂú®ÂæàÂ§öÈù¢ÂêëÂÖ∂ÂØ¶ÈÇÑÊòØÈùûÂ∏∏ÂúüÁÇÆ„ÄÇÂæóÈù†ÂæåÁ∫åÁ§æÁæ§‰∏çÊñ∑ÁöÑË®éË´ñËàáË≤¢ÁçªÊâçÈÅîÂà∞‰∏ÄÂÄãÊØîËºÉÂÆåÂñÑÁöÑÊ∞¥Ê∫ñ„ÄÇ ÂÉèÊòØ..</p><ul><li><code>context</code> package in Golang 1.7: Ëß£Ê±∫ long job cancelling ÁöÑÂïèÈ°å</li><li><code>errors</code> package in Golang 1.13: ÊªøË∂≥ÂÖ∂‰ªñË™ûË®ÄÂ∏∏Ë¶ãÁöÑ error ÂµåÂ•óÈúÄÊ±ÇÂíåÊèê‰æõÁµ±‰∏ÄÁöÑÂà§Êñ∑ÊñπÂºè</li><li>Generic support in Golang 1.18: Êèê‰æõÈñãÁôºËÄÖÂØ¶‰ΩúÂêÑÁ®ÆÂûãÁÑ°ÈóúÊºîÁÆóÊ≥ïÁöÑÊ©üÊúÉ</li></ul><p>‰∏ÄÁõ¥‰ª•‰æÜÔºåÂú® Golang ÁöÑÊ®ôÊ∫ñÂáΩÂºèÂ∫´‰∏≠ÔºåÁ¢∞Âà∞È°ûÂûãÁÑ°ÈóúÁöÑÊäΩË±°ÂïèÈ°åÊôÇÔºåÊúÄÂæåÁµ¶Âá∫‰æÜÁöÑËß£Ê≥ïÂ§ßÊ¶ÇÂ∞±ÂÖ©Á®Æ</p><ol><li>ÊâÄÊúâ input &#x2F; output ÂèÉÊï∏ÈÉΩÂÆöÁæ©Êàê <code>interface&#123;&#125;</code>ÔºåÂ§ßÂÆ∂‰∏ÄËµ∑ÊääÂûãÂà•Ê™¢Êü•ÂæÄ run-time ‰∏ü</li><li>Âêå‰∏ÄÂÄã class &#x2F; function Â∞çÊñºÂ∏∏Áî®ÁöÑ data type ÈÄöÈÄöÂØ¶‰Ωú‰∏ÄÈÅç</li></ol><p>ÂâçËÄÖÊúÄÂÖ∏ÂûãÁöÑÂ§ßÊ¶ÇÂ∞±ÊòØ <code>sync</code> ÈÄôÂÄãÂáΩÁ§∫Â∫´ÔºåÂæåËÄÖ.. Â§ßÂÆ∂ÊáâË©≤ÈÉΩÁúãÈÅéÈÇ£ÂÄãÊÖò‰∏çÂøçÁùπÁöÑ <code>sort</code>..</p><p>‰∏çÈÅéÈÄô‰∫õÈÉΩÊòØÈÅéÂéªÂºè‰∫ÜÔºåÂæû‰ªäÂ§©ÈñãÂßãÔºåÂ§ßÂÆ∂ÈÉΩÂèØ‰ª•ÂØ´Ëá™Â∑±ÊÉ≥Ë¶ÅÁöÑ generic code &#x2F; library &#x2F; framework„ÄÇ :D</p><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Âü∫Êú¨Ë™ûÊ≥ïÂæàÁ∞°ÂñÆÔºåÂè™Ë¶ÅÂú®ÊÉ≥ÂÅöÊàê generic ÁöÑ function &#x2F; struct ÂæåÈù¢Â§öÂä†‰∏ÄÂÄã <code>[T TypeName]</code> Âç≥ÂèØÔºå<code>TypeName</code> ÊòØÁî®ÂéüÊú¨Â∞±ÊúâÁöÑ <code>interface&#123;...&#125;</code> Ë™ûÊ≥ï‰æÜË°®Á§∫ÔºåÂèØ‰ª•Ëá™Â∑±ÊèèËø∞ÈÄôÂÄã generic function &#x2F; structÊîØÊè¥ÁöÑÂûãÊÖãÂøÖÈ†àÊªøË∂≥‰ªÄÈ∫ºÊ®£ÁöÑ‰ªãÈù¢„ÄÇ</p><p>‰ª• Python style ÁöÑ sort by key Áï∂‰æãÂ≠ê„ÄÇÊàëÂÄëÂèØ‰ª•ÂÆöÁæ©‰∏ÄÂÄã generic ÁöÑ sort functionÔºå‰∏¶‰∏îÊòéÂÆöÈÄÅÈÄ≤‰æÜÁöÑ list ÂÖßÁöÑÊØèÂÄãÂÖÉÁ¥†ÈúÄË¶ÅÊîØÊè¥‰∏ÄÂÄã <code>Key</code> ÂáΩÁ§∫Ôºå‰ΩúÁÇ∫ÊéíÂ∫èÊôÇÁöÑÊ†πÊìö„ÄÇ</p><p>ÁØÑ‰æã code Â¶Ç‰∏ã</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Keyable <span class="keyword">interface</span> &#123;</span><br><span class="line">Key() <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sort</span>[<span class="title">T</span> <span class="title">Keyable</span>]<span class="params">(items []T)</span></span> []T &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(items) &lt;= <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> items</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pivot := items[<span class="number">0</span>]</span><br><span class="line">less, greater := []T&#123;&#125;, []T&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> items[<span class="number">1</span>:] &#123;</span><br><span class="line"><span class="keyword">if</span> item.Key() &lt; pivot.Key() &#123;</span><br><span class="line">less = <span class="built_in">append</span>(less, item)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">greater = <span class="built_in">append</span>(greater, item)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">append</span>(<span class="built_in">append</span>(less, pivot), greater...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="type">string</span></span><br><span class="line">Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n Person)</span></span> Key() <span class="type">int</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n.Age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">persons := []Person&#123;&#123;Name: <span class="string">&quot;alice&quot;</span>, Age: <span class="number">33</span>&#125;, &#123;Name: <span class="string">&quot;bob&quot;</span>, Age: <span class="number">27</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">persons = Sort(persons)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Âú®ÈÄôÂÄãÁØÑ‰æã‰∏≠Ôºå<code>Sort</code> Ë¶ÅÊ±ÇÈÄÅÈÄ≤‰æÜÁöÑ <code>[]T</code> Áï∂‰∏≠ÁöÑ <code>T</code> Ë¶ÅÂØ¶‰Ωú <code>Keyable</code> ‰ªãÈù¢ (Êèê‰æõ <code>Key</code> method)„ÄÇÁï∂ÊàëÂÄëÊÉ≥ÊéíÂ∫è‰∏ÄÂ†Ü <code>Person</code> ÊôÇÔºåÊàëÂÄëÂèØ‰ª•Âú®ÈÄôÂÄã <code>Person</code> Áâ©‰ª∂‰∏äÂÆöÁæ© <code>Key</code> methodÔºåÂèñÂá∫ <code>Person</code> ÁöÑÂπ¥ÈΩ°„ÄÇÂÆåÊàê‰πãÂæåÔºåÊàëÂÄëÂ∞±ÂèØ‰ª•‰æùÂπ¥ÈΩ°‰æÜÊéíÂ∫è <code>[]Person</code> ‰∫Ü„ÄÇ</p><p>ÊúüË®±Ëá™Â∑±Êú™‰æÜÂèØ‰ª•Â§öÂä†Âà©Áî®ÈÄôÂÄãÈÅ≤‰æÜÁöÑÂäüËÉΩ.. XD</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://tip.golang.org/doc/go1.18">Go 1.18 Release Notes</a></li><li><a href="https://go.dev/doc/tutorial/generics">Tutorial: Getting started with generics</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;‰ªäÂ§© Golang 1.18 ÁµÇÊñºÊ≠£ÂºèÈáãÂá∫Âï¶ÔºÅ
ÊàëÂÄëÁµÇÊñºÊúâËæ¶Ê≥ïÂú® Golang Ë£°ÂÅö generic programming Âï¶ÔºÅ&lt;/p&gt;
&lt;p&gt;Golang ÊòØ‰∏ÄÂÄãËøë 10 Âπ¥Âø´ÈÄüÁ´ÑÁ¥ÖÁöÑÁ®ãÂºèË™ûË®ÄÔºå‰ΩÜÂú®ÂæàÂ§öÈù¢ÂêëÂÖ∂ÂØ¶ÈÇÑÊòØÈùûÂ∏∏ÂúüÁÇÆ„ÄÇ
ÂæóÈù†ÂæåÁ∫åÁ§æÁæ§‰∏çÊñ∑ÁöÑË®éË´ñËàáË≤¢ÁçªÊâçÈÅîÂà∞‰∏ÄÂÄãÊØîËºÉÂÆå</summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="golang" scheme="https://blog.bitisle.net/tags/golang/"/>
    
    <category term="generic" scheme="https://blog.bitisle.net/tags/generic/"/>
    
  </entry>
  
  <entry>
    <title>Â¶Ç‰ΩïÈÅøÂÖç Commit Message ÊãºÈåØÂ≠óÔºü</title>
    <link href="https://blog.bitisle.net/2021/09/28/vim-git-commit-spell-check.html"/>
    <id>https://blog.bitisle.net/2021/09/28/vim-git-commit-spell-check.html</id>
    <published>2021-09-28T17:43:50.000Z</published>
    <updated>2021-09-28T17:43:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>Êñá‰ª∂ÊâìÈåØÂ≠óÈÇÑÂ•ΩÔºåÈö®ÊôÇÂèØ‰ª•‰øÆ„ÄÇ‰ΩÜÂú® commit message ‰∏≠ÊâìÈåØÂ≠óÔºåÂèØÊòØÊúÉÊµÅÂÇ≥ÂçÉÂè§„ÄÇ</p><p>Ë∫´ÁÇ∫‰∏ÄÂÄã RDÔºåÊúâÂÄãÊ•µÁ∞°ÁöÑËß£Ê±∫ÊñπÊ≥ï..ÊääÂ∫ï‰∏ãÈÄôË°åË®≠ÂÆöÊîæÂà∞ <code>.vimrc</code> ÂÖßÂç≥ÂèØ„ÄÇ (O</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autocmd FileType gitcommit setlocal spell</span><br></pre></td></tr></table></figure><p>(Â∞çÊñºÂ±¨ Git commit message ÁöÑ buffer Ëá™ÂãïÂïüÁî® spell check ÂäüËÉΩ)</p><p>Ë®≠ÂÆöÂÆå‰πãÂæåÔºåÁï∂Âá∫Áèæ <code>vim</code> ‰∏çË™çË≠òÁöÑÂñÆÂ≠óÊôÇÔºåÂ∞±ÊúÉÊúâÈÜíÁõÆÁöÑÈ°èËâ≤ÊèêÁ§∫ÔºåÊèêÈÜíËá™Â∑±Ë©≤ÂõûÈ†≠Áúã‰∏Ä‰∏ãÊòØ‰∏çÊòØÂèàÊãºÈåØÂ≠ó‰∫Ü„ÄÇ</p><p>Áï∂ÁÑ∂ÔºåË¶ÅÊúâËàíÈÅ©ÁöÑÊãºÂ≠óÊ™¢Êü•È´îÈ©óÔºåÂ≠óÂÖ∏Ê™îÁöÑÁ∂≠Ë≠∑‰πüÊòØÂæàÈáçË¶ÅÁöÑ‰∏ÄÁí∞„ÄÇ‰∏çÈÅéÈÇ£ÂèàÊòØÂè¶‰∏ÄÂÄãË©±È°å‰∫Ü..</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://thoughtbot.com/blog/vim-spell-checking">Vim Spell-Checking</a></li><li><a href="https://vimhelp.org/spell.txt.html#spell">Vim: spell.txt</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Êñá‰ª∂ÊâìÈåØÂ≠óÈÇÑÂ•ΩÔºåÈö®ÊôÇÂèØ‰ª•‰øÆ„ÄÇ
‰ΩÜÂú® commit message ‰∏≠ÊâìÈåØÂ≠óÔºåÂèØÊòØÊúÉÊµÅÂÇ≥ÂçÉÂè§„ÄÇ&lt;/p&gt;
&lt;p&gt;Ë∫´ÁÇ∫‰∏ÄÂÄã RDÔºåÊúâÂÄãÊ•µÁ∞°ÁöÑËß£Ê±∫ÊñπÊ≥ï..
ÊääÂ∫ï‰∏ãÈÄôË°åË®≠ÂÆöÊîæÂà∞ &lt;code&gt;.vimrc&lt;/code&gt; ÂÖßÂç≥ÂèØ„ÄÇ (O&lt;/p&gt;
&lt;figure class=&quot;highli</summary>
      
    
    
    
    <category term="tips" scheme="https://blog.bitisle.net/categories/tips/"/>
    
    
    <category term="git" scheme="https://blog.bitisle.net/tags/git/"/>
    
    <category term="vim" scheme="https://blog.bitisle.net/tags/vim/"/>
    
    <category term="spell" scheme="https://blog.bitisle.net/tags/spell/"/>
    
  </entry>
  
  <entry>
    <title>Google Êõ¥Êñ∞ Go ÁöÑÁ§æÁæ§Ë°åÁÇ∫Ê∫ñÂâá</title>
    <link href="https://blog.bitisle.net/2021/09/23/golang-coc-update.html"/>
    <id>https://blog.bitisle.net/2021/09/23/golang-coc-update.html</id>
    <published>2021-09-23T13:18:47.000Z</published>
    <updated>2021-09-23T13:18:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>Êò®Â§© Go blog ‰∏äÂá∫Êñ∞ÊñáÁ´†ÔºåË™™Ë¶ÅÊõ¥Êñ∞ Code of Conduct„ÄÇ</p><p>‰∏ÄÁõ¥‰∏Ä‰æÜË¶∫ÂæóÊØèÂÄãÁ§æÁæ§ÁöÑ CoC ÈÉΩÂØ´ÂæóÂ∑Æ‰∏çÂ§öÔºå‰∏çÂ§ñ‰πéÊòØË¶Å‰∫íÁõ∏Â∞äÈáç„ÄÅÈñãÊîæÈÄèÊòé„ÄÅÂª∫Ë®≠ÊÄßÁôºË®ÄÁ≠âÁ≠â„ÄÇ‰πüÂõ†ÁÇ∫ÈÉΩÂ∑Æ‰∏çÂ§öÔºåÂπ≥Â∏∏‰πü‰∏çÊúÉÂéªÁ¥∞Áúã„ÄÇÂèçÊ≠£Â∞±ÊòØ‰∫õÊ≠£Â∏∏‰∫∫Ë©≤ÊúâÁöÑÈÅìÂæ∑ËßÄ„ÄÇÂõ†Ê≠§ÔºåÁúãÂà∞Ë™™Ë¶ÅÊõ¥Êñ∞ Code of Conduct ËÆìÊàëÊÑüÂà∞ÊúâÈªûÂ•ΩÂ•á„ÄÇ</p><p>ËÆÄ‰∏ÄËÆÄËÆÄ‰∏ãÂéªÔºåÂÖ∂ÂØ¶ÈÄôÊ¨° Go community ÁöÑ CoC Â∞±ÊòØÊñ∞Â¢û‰∏ÄÊ¢ùÔºö</p><blockquote><p><strong>Be responsible.</strong> What you say and do matters. Take responsibility ‚Ä¶</p></blockquote><p>Ê≤íÊÉ≥Âà∞ÈÄ£ÈÄôÂÄãÈÉΩË¶ÅÂØ´ÈÄ≤ CoC ‚Ä¶„ÄÇÂèØËÉΩ Go ÁöÑÊ†∏ÂøÉÈñãÁôºÂúòÈöäÁúã issue ÁúüÁöÑÁúãÂà∞ÂøÉÁ¥Ø‰∫ÜÔºü XD</p><p>See: <a href="https://go.dev/blog/conduct-2021">Code of Conduct Updates - go.dev</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Êò®Â§© Go blog ‰∏äÂá∫Êñ∞ÊñáÁ´†ÔºåË™™Ë¶ÅÊõ¥Êñ∞ Code of Conduct„ÄÇ&lt;/p&gt;
&lt;p&gt;‰∏ÄÁõ¥‰∏Ä‰æÜË¶∫ÂæóÊØèÂÄãÁ§æÁæ§ÁöÑ CoC ÈÉΩÂØ´ÂæóÂ∑Æ‰∏çÂ§öÔºå‰∏çÂ§ñ‰πéÊòØË¶Å‰∫íÁõ∏Â∞äÈáç„ÄÅÈñãÊîæÈÄèÊòé„ÄÅÂª∫Ë®≠ÊÄßÁôºË®ÄÁ≠âÁ≠â„ÄÇ
‰πüÂõ†ÁÇ∫ÈÉΩÂ∑Æ‰∏çÂ§öÔºåÂπ≥Â∏∏‰πü‰∏çÊúÉÂéªÁ¥∞Áúã„ÄÇÂèçÊ≠£Â∞±ÊòØ‰∫õÊ≠£Â∏∏‰∫∫Ë©≤ÊúâÁöÑÈÅìÂæ∑ËßÄ„ÄÇ
Âõ†Ê≠§ÔºåÁúãÂà∞Ë™™Ë¶ÅÊõ¥Êñ∞ C</summary>
      
    
    
    
    <category term="news" scheme="https://blog.bitisle.net/categories/news/"/>
    
    
    <category term="golang" scheme="https://blog.bitisle.net/tags/golang/"/>
    
    <category term="community" scheme="https://blog.bitisle.net/tags/community/"/>
    
  </entry>
  
  <entry>
    <title>ÂñÆÂè∞Ê©üÂô®ÁöÑ Ceph ÈÉ®ÁΩ≤</title>
    <link href="https://blog.bitisle.net/2021/08/08/single-node-ceph-cluster.html"/>
    <id>https://blog.bitisle.net/2021/08/08/single-node-ceph-cluster.html</id>
    <published>2021-08-08T03:52:24.000Z</published>
    <updated>2021-08-08T03:52:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ÂéüÁî±"><a href="#ÂéüÁî±" class="headerlink" title="ÂéüÁî±"></a>ÂéüÁî±</h2><p>Ceph ÁöÑÈ†êË®≠Ë®≠ÂÆöÂ∞çË≥áÊñôÁöÑ replica Ë°åÁÇ∫Ë¶ÅÊ±ÇÂö¥Ê†º„ÄÇËã•Âè™ÊúâÂñÆÂè∞Ê©üÂô®ÊàñÊòØÁ°¨Á¢üÊï∏ÈáèÂèóÈôêÔºåÂæÄÂæÄÊû∂Ë®≠Ëµ∑‰æÜÁöÑ Ceph ÁÑ°Ê≥ïÈ†ÜÂà©Â≠òÊîæË≥áÊñô„ÄÇ</p><p>Ê≠§ÁØáÁ≠ÜË®òÈóúÊ≥®ÁöÑÁõÆÊ®ôÂ¶Ç‰∏ã</p><blockquote><p>Ëã•ÊÉ≥Ë¶ÅÁî®ÊúÄÂ∞ëË≥áÊ∫êÔºåÂª∫Á´ãÂèØÁî®ÁöÑ Ceph Áí∞Â¢ÉÔºåÈúÄË¶ÅÂÅöÂì™‰∫õÈ°çÂ§ñÁöÑË™øÊï¥Ôºü</p></blockquote><h2 id="ËÉåÊôØÁü•Ë≠ò"><a href="#ËÉåÊôØÁü•Ë≠ò" class="headerlink" title="ËÉåÊôØÁü•Ë≠ò"></a>ËÉåÊôØÁü•Ë≠ò</h2><p>Ceph ÊòØ‰∏ÄÂ•óÈñãÊ∫êÁöÑÂÑ≤Â≠òÂè¢ÈõÜ solution„ÄÇ ÂèØ‰ª•Êï¥ÂêàÂ§öÂÄãÂÑ≤Â≠òË®≠ÂÇô‰∏¶Âú®ÂÖ∂‰∏äÊèê‰æõRADOSGW, RBD, Ceph FS Á≠â‰∏çÂêåÂ±§Á¥öÁöÑÂ≠òÂèñ‰ªãÈù¢„ÄÇ</p><p><img src="https://docs.ceph.com/en/latest/_images/stack.png" alt="ceph-stack"></p><p>Â∞çÊñºÊØèÂÄãÂÑ≤Â≠òË®≠ÂÇô (HDD, SSD)ÔºåCeph ÊúÉÂª∫Á´ãÂ∞çÊáâÁöÑ OSD ‰æÜÁÆ°ÁêÜÂÑ≤Â≠òË®≠ÂÇô„ÄÇÊúâ‰∫ÜÂÑ≤Â≠òË®≠ÂÇô‰πãÂæåÔºåCeph ÊúÉÂª∫Á´ãÈÇèËºØ‰∏äÁöÑ pool ‰ΩúÁÇ∫ÁÆ°ÁêÜÁ©∫ÈñìÁöÑÂñÆ‰Ωç„ÄÇPool Â∫ï‰∏ãÊúÉÊúâÂ§öÂÄã PG(placement group) ‰ΩúÁÇ∫ÂØ¶ÈöõÂ≠òÊîæË≥áÊñôËá≥ OSD ‰∏≠ÁöÑÂçÄÂ°ä„ÄÇ</p><p>Âú® Ceph ÁöÑÈ†êË®≠Ë®≠ÂÆö‰∏≠Ôºå‰∏ÄËà¨ pool ÁöÑ replica Ë°åÁÇ∫Â¶Ç‰∏ã</p><ul><li>Ë¶ÅÊúâ‰∏â‰ªΩ replica</li><li>replica Ë¶ÅÂàÜÊï£Âú®‰∏çÂêåÁöÑ host ‰∏ä</li></ul><p>Âú®ÈñãÁôºÁí∞Â¢É‰∏≠ÔºåË≥áÊñôÊéâ‰∫ÜÂÖ∂ÂØ¶‰∏¶ÁÑ°ÂÇ∑Â§ßÈõÖÔºå‰∏â‰ªΩ replica ÊÑèÂë≥ËëóÂÑ≤Â≠òÁ©∫ÈñìÁöÑÊµ™Ë≤ª„ÄÇ‰∏îËã•Ë≥áÊñôÁúüÁöÑË¶ÅÊîæÂú®‰∏çÂêåÁöÑ host ‰∏äÔºåÈÄ£Âêå replica ‰∏â‰ªΩÈÄôÈªûÔºåÊàëÂÄëÂ∞±Ëá≥Â∞ëË¶ÅÈñã‰∏âÂè∞Ê©üÂô®ÔºåÂ¢ûÂä†ÁÑ°Ë¨ÇÁöÑÁÆ°ÁêÜÊàêÊú¨„ÄÇ</p><h2 id="Ëß£Ê±∫ÊñπÂºè"><a href="#Ëß£Ê±∫ÊñπÂºè" class="headerlink" title="Ëß£Ê±∫ÊñπÂºè"></a>Ëß£Ê±∫ÊñπÂºè</h2><p>ÂÅáË®≠ÊàëÂÄëÈÉΩÊòØÈÄèÈÅé <code>cephadm bootstrap</code> ‰æÜÊû∂Ë®≠ Ceph„ÄÇ</p><p>Ceph cluster Âª∫Á´ãÂ•ΩÔºå‰πüË®≠ÂÆöÂÆåÈúÄË¶ÅÁöÑ OSD ‰πãÂæåÔºåÂ∞±ÂèØ‰ª•‰æÜÂª∫Á´ã pool„ÄÇ</p><p>Ê†πÊìö pool ÁöÑÁõÆÁöÑ‰∏çÂêåÔºåË¶ÅËß£Ê±∫ÂñÆÂè∞Ê©üÂô®ÈÉ®ÁΩ≤ Ceph ÁöÑÈôêÂà∂ÔºåÂ§ßÊ¶ÇÊúÉÊúâÂÖ©Á®ÆÂÅöÊ≥ï„ÄÇ</p><h3 id="Èôç‰Ωé-Pool-Size"><a href="#Èôç‰Ωé-Pool-Size" class="headerlink" title="Èôç‰Ωé Pool Size"></a>Èôç‰Ωé Pool Size</h3><p>Pool size Ê≠§Ë°ìË™ûÊÑèÂë≥ËëóË©≤ pool ‰∏ãÁöÑ PG Ë¶Å replica Âπæ‰ªΩ„ÄÇËã•Êüê pool ÊòØÊãø‰æõ‰ªñ‰∫∫Â≠òÊîæË≥áÊñôÔºåÊàñÊòØÊúÉ‰ΩøÁî®ËºÉÂ§öÁ©∫ÈñìÁöÑÔºåÂèØ‰ª•Êää size ÈôçÁÇ∫ 1„ÄÇ</p><p>Ë™øÊï¥ÂÆå‰πãÂæåÂ∞±Áõ∏Áï∂ÊñºË©≤ pool ÂÖßÁöÑÊâÄÊúâË≥áÊñôÈÉΩ‰∏çÊúÉÊúâ replica„ÄÇ</p><p>ÁØÑ‰æãÂ¶Ç‰∏ã:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ceph osd pool create &quot;&lt;pool name&gt;&quot;</span><br><span class="line">ceph osd pool set &quot;&lt;pool name&gt;&quot; size 1</span><br><span class="line">ceph osd pool application enable &quot;&lt;pool name&gt;&quot; rbd</span><br></pre></td></tr></table></figure><h3 id="Ë™øÊï¥-Choose-Leaf-Ë°åÁÇ∫"><a href="#Ë™øÊï¥-Choose-Leaf-Ë°åÁÇ∫" class="headerlink" title="Ë™øÊï¥ Choose Leaf Ë°åÁÇ∫"></a>Ë™øÊï¥ Choose Leaf Ë°åÁÇ∫</h3><p>Ceph ÊúâÂÆöÁæ©‰∏çÂêåÂ±§Á¥öÁöÑË≥áÊñôÂàÜÊï£Ë®≠ÂÆö„ÄÇÈ†êË®≠ÂÄºÁÇ∫ <code>host</code>ÔºåÊÑèÂë≥ËëóÂè™Êúâ‰∏ÄÂè∞Ê©üÂô®ÁöÑÊÉÖÊ≥Å‰∏ãÔºåË≥áÊñôÊúÉÁÑ°Ê≥ïË§áË£Ω„ÄÇËã•Ë™øÊï¥ÁÇ∫ <code>osd</code>ÔºåÂè™Ë¶ÅË©≤Ê©üÂô®‰∏äÊúâÂ§öÈ°ÜÁ°¨Á¢üÂç≥ÂèØÊªøË∂≥Ë§áË£ΩÊ¢ù‰ª∂„ÄÇËã•ÊòØÈáùÂ∞ç Ceph Ëá™Ë°åÂª∫Á´ãÂá∫‰æÜÔºåÁÆ°ÁêÜ meta data ÁöÑ pool (e.g. <code>device_health_metrics</code>)ÂèØ‰ª•ËÄÉÊÖÆ‰ΩøÁî®Ê≠§ÊñπÂºèËôïÁêÜ„ÄÇ</p><p>Ë®≠ÂÆöÊñπÂºèÂ§ßÊ¶ÇÊúâÂÖ©Á®Æ„ÄÇ</p><p><strong>ÊñπÊ≥ï‰∏Ä</strong>: Ë™øÊï¥ Ceph global Ë®≠ÂÆö</p><p>Á∑®ËºØ <code>/etc/ceph.conf</code> ‰∏¶Âú® global section ‰∏ãÂä†ÂÖ• <code>osd_crush_chooseleaf_type</code> Ë®≠ÂÆö</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">...</span><br><span class="line">    osd_crush_chooseleaf_type = 0</span><br></pre></td></tr></table></figure><p>ÊàñÊòØÁõ¥Êé•Âü∑Ë°å command</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set global osd_crush_chooseleaf_type 0</span><br></pre></td></tr></table></figure><p>ÈÄôÈÇäÁöÑ <code>0</code> ‰ª£Ë°® OSD„ÄÇÈ†êË®≠ÁöÑÂ∞çÊáâÂàóË°®Â¶Ç‰∏ã</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type 0 osd</span><br><span class="line">type 1 host</span><br><span class="line">...</span><br><span class="line">type 9 zone</span><br><span class="line">type 10 region</span><br><span class="line">type 11 root</span><br></pre></td></tr></table></figure><p><strong>ÊñπÊ≥ï‰∫å</strong>: ‰øÆÊîπ crush map ÂÖßÂÆπ</p><p>Á≠ÜËÄÖÊúâÊ≥®ÊÑèÂà∞ÊúâÊôÇÂç≥‰ΩøÊúâÂü∑Ë°åÊñπÊ≥ï‰∏ÄÔºåpool ÈÇÑÊòØ‰∏çÊúÉÂèóÂà∞Ë®≠ÂÆöÂΩ±Èüø„ÄÇ (Áõ∏ÈóúÁü•Ë≠òÈÇÑÂ§™Â∞ëÔºå‰∏çÂ§™Á¢∫ÂÆöÂÖ∑È´îÂéüÂõ†) ‰∏çÈÅéÈáùÂ∞çÊ≠§ÁãÄÊ≥ÅÔºåÈÇÑÊúâÁ¨¨‰∫åÂÄãÊñπÊ≥ïÂèØ‰ª•‰ΩøÁî®„ÄÇ</p><p>Ê≠§ÊñπÊ≥ïÊúÉÁî®Âà∞ <code>crushtool</code> Êåá‰ª§ (Ubuntu ‰∏≠ÈúÄË¶ÅÈ°çÂ§ñÂÆâË£ù <code>ceph-base</code> Â•ó‰ª∂)</p><p>È¶ñÂÖàÂü∑Ë°åÊåá‰ª§Â∞áÁõÆÂâçÁöÑ crush map ÊíàÂá∫‰æÜ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph osd getcrushmap -o &quot;compiled-crush-map&quot;</span><br><span class="line">crushtool -d &quot;compiled-crush-map&quot; -o &quot;crush-map&quot;</span><br></pre></td></tr></table></figure><p>Êé•Ëëó‰øÆÊîπ <code>crush-map</code> Ê™îÊ°àÂÖßÂÆπÔºåÊáâË©≤ÊúÉÊúâ‰∏ÄË°åÊúâ <code>step chooseleaf</code> ÈñãÈ†≠ÁöÑË®≠ÂÆöÔºåÊääÊúÄÂæåÁöÑtype Âæû <code>host</code> Ë™øÊï¥ÁÇ∫ <code>osd</code>„ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Before</span></span><br><span class="line">step chooseleaf firstn &lt;number&gt; type host</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">After</span></span><br><span class="line">step chooseleaf firstn &lt;number&gt; type osd</span><br></pre></td></tr></table></figure><p>ÊúÄÂæåÂ∞á‰øÆÊîπÂ•ΩÁöÑ crush map Ë®≠ÂÆöÂ°ûÂõûÂéª„ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crushtool -c &quot;crush-map&quot; -o &quot;compiled-crush-map&quot;</span><br><span class="line">ceph osd setcrushmap -i &quot;compiled-crush-map&quot;</span><br></pre></td></tr></table></figure><p>Áõ∏Èóú reference link</p><ul><li><a href="https://docs.ceph.com/en/latest/rados/configuration/common/">Common Settings ‚Äî Ceph Documentation</a></li><li><a href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/1.2.3/html/installation_guide_for_centos_x86_64/create_a_cluster">Chapter¬†4.¬†Create a Cluster Red Hat Ceph Storage 1.2.3 | Red Hat Customer Portal</a></li><li><a href="https://docs.ceph.com/en/latest/rados/operations/crush-map/">CRUSH Maps ‚Äî Ceph Documentation</a></li><li><a href="https://docs.ceph.com/en/latest/rados/operations/crush-map-edits/">Manually editing a CRUSH Map ‚Äî Ceph Documentation</a></li><li><a href="https://docs.ceph.com/en/latest/rados/operations/crush-map/">CRUSH Maps ‚Äî Ceph Documentation</a></li></ul><h2 id="ÁµêË™û"><a href="#ÁµêË™û" class="headerlink" title="ÁµêË™û"></a>ÁµêË™û</h2><p>Á≠ÜËÄÖÂú®ÂÖ¨Âè∏Ê•≠Âãô‰∏¶‰∏çË≤†Ë≤¨Á∂≠Ë≠∑ production ÁöÑ Ceph clusterÔºåÂÉÖÊòØÁÇ∫‰∫ÜÂª∫Á´ã KubernetesÈñãÁôºÁí∞Â¢ÉÔºåÈúÄË¶ÅÊúâÂÄãÂü∫Êú¨ÊúÉÂãïÁöÑ Ceph„ÄÇ</p><p>ÁÇ∫‰∫ÜÁî®ÊúÄÂ∞ëË≥áÊ∫êÂª∫Á´ã Ceph Áí∞Â¢ÉÔºåÈúÄË¶ÅË™øÊï¥Áõ∏ÈóúË®≠ÂÆö‰æÜÊîπËÆä Ceph Ë°åÁÇ∫„ÄÇÂè™ÂèØÊÉúÁõ∏ÈóúÁöÑË≥áÊ∫ê‰∏çÊòØÂæàÂ§†Ôºå‰∏ÄË∑ØË∑åË∑åÊíûÊíû‰∏ã‰æÜÔºåÊ±∫ÂÆöÂØ´‰∏ãÈÄôÁØáÁ≠ÜË®òÔºåÂ∏åÊúõÈÄ†Á¶èÊú™‰æÜÁöÑËá™Â∑±Ôºå‰πüÂêåÊôÇÁÖßÈ°ß‰ªñ‰∫∫„ÄÇ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ÂéüÁî±&quot;&gt;&lt;a href=&quot;#ÂéüÁî±&quot; class=&quot;headerlink&quot; title=&quot;ÂéüÁî±&quot;&gt;&lt;/a&gt;ÂéüÁî±&lt;/h2&gt;&lt;p&gt;Ceph ÁöÑÈ†êË®≠Ë®≠ÂÆöÂ∞çË≥áÊñôÁöÑ replica Ë°åÁÇ∫Ë¶ÅÊ±ÇÂö¥Ê†º„ÄÇ
Ëã•Âè™ÊúâÂñÆÂè∞Ê©üÂô®ÊàñÊòØÁ°¨Á¢üÊï∏ÈáèÂèóÈôêÔºåÂæÄÂæÄÊû∂Ë®≠Ëµ∑‰æÜÁöÑ Ceph ÁÑ°Ê≥ïÈ†ÜÂà©Â≠òÊîæË≥áÊñô„ÄÇ&lt;</summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="ceph" scheme="https://blog.bitisle.net/tags/ceph/"/>
    
  </entry>
  
  <entry>
    <title>NATS Ëàá JetStream Á∞°Êòì‰ªãÁ¥π</title>
    <link href="https://blog.bitisle.net/2021/07/28/nats-brief-intro.html"/>
    <id>https://blog.bitisle.net/2021/07/28/nats-brief-intro.html</id>
    <published>2021-07-28T16:23:00.000Z</published>
    <updated>2021-07-28T16:23:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ÊúÄËøëÂõ†ÂÖ¨Âè∏Ê•≠ÂãôÂú®Áé©‰∏ÄÂ•óÁõ∏Â∞çÊñ∞ÁöÑ MQ: NATS„ÄÇÂõ†ÁÇ∫ÂÆòÊñπÊñá‰ª∂‰∏çÊÖéÊ∏ÖÊ•ö‰∏îÊúâ‰∫õÂú∞ÊñπËàáÁõ¥Ë¶∫‰∏çÂêåÔºåÈÄ†ÊàêËµ∑Ê≠•Á∑©ÊÖ¢„ÄÇ</p><p>‰ª•‰∏ãÁ∞°ÂñÆÁ¥ÄÈåÑ‰∏Ä‰∏ãÂâõÂÖ•ÈñÄÊôÇÊáâÁü•ÈÅìÁöÑ‰∫ãÊÉÖ„ÄÇ</p><h2 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h2><p>Áõ∏ËºÉ RabbitMQ, Kafka Á≠âÔºå<a href="https://nats.io/">NATS</a> ÊòØ‰∏ÄÂ•óËºÉÁÇ∫Âπ¥ËºïÁöÑ MQ„ÄÇÈõñÁÑ∂ÊúâÈÉ®ÂàÜÂ≠êÂ∞àÊ°àÁöÑÁâàÊú¨Êú™ÈÅî v1.0Ôºå‰ΩÜÂÆòÊñπÂÆ£Á®±Â∑≤Á∂ìÊé•Ëøë production ready„ÄÇ</p><p>NATS Âæû‰∏ÄÈñãÂßãÂ∞±ÊòØÈáùÂ∞ç cloud service Ë®≠Ë®àÔºåcluster mode ÁöÑÊ∞¥Âπ≥Êì¥Â±ïÔºånode ‰πãÈñìÁöÑË∫´ÂàÜÈ©óË≠âÂèä TLS ÈÄöË®äË®≠Ë®àÁúãËµ∑‰æÜÈÉΩÈÇÑ‰∏çÈåØ„ÄÇ</p><p>NATS ÁöÑ message ‰∏¶ÁÑ°ÁâπÂà•ÈôêÂà∂ÔºåÂú® client library ÂÖß‰ªª‰ΩïÁöÑ byte sequence ÈÉΩÂèØ‰ª•ÊàêÁÇ∫ message„ÄÇ</p><p>NATS Êúâ‰ª•‰∏ã‰∏âÂÄãÊ®°Âºè(‰ª•ÂèäÂÖ∂Â∞çÊáâÁöÑ client library)„ÄÇ</p><h3 id="NATS-NATS-Core"><a href="#NATS-NATS-Core" class="headerlink" title="NATS (NATS Core)"></a>NATS (NATS Core)</h3><p>NATS Â∞àÊ°àÂæû‰∏ÄÈñãÂßãÁôºÂ±ïÊôÇÁöÑÂü∫Êú¨Ê®°Âºè„ÄÇ ÊîØÊè¥ <strong>Pub&#x2F;Sub</strong> pattern ‰∏¶Êèê‰æõ <code>at-most-once</code> Ë™ûÊÑè„ÄÇ</p><h3 id="NATS-Streaming"><a href="#NATS-Streaming" class="headerlink" title="NATS Streaming"></a>NATS Streaming</h3><p>NATS Streaming ÊòØ‰∏ÄÂ•óÁñäÂú® NATS ‰∏äÈù¢ÂΩ¢ÊàêÁöÑ solution„ÄÇ</p><p>Âõ†ÁÇ∫Ë®≠Ë®à‰∏äÁöÑÂïèÈ°åÔºåÂæå‰æÜÂèàÊúâ‰∫Ü JetStreamÔºåÊâÄ‰ª•ÊàëÂÄëÂü∫Êú¨‰∏ä‰∏çÁî®ÁêÜÂÆÉÔºåÂè™Ë¶ÅÁü•ÈÅì NATS Streaming ÂíåJetStream ‰∏ç‰∏ÄÊ®£ÔºåÁøªÊñá‰ª∂ÁöÑÊôÇÂÄô‰∏çË¶ÅÁøªÈåØÂç≥ÂèØ„ÄÇ</p><h3 id="JetStream"><a href="#JetStream" class="headerlink" title="JetStream"></a>JetStream</h3><p>JetStream ÊòØÂæå‰æÜÂÅöÂú® NATS ÂÖßÔºåÂèØÈÅ∏ÊìáÊòØÂê¶ÂïüÁî®ÁöÑÂ≠êÁ≥ªÁµ±„ÄÇ ËóâÁî± JetStreamÔºåÂèØ‰ª•ÂØ¶‰Ωú <strong>Producer&#x2F;Consumer</strong> pattern ‰∏¶Êèê‰æõ <code>at-least-once</code> Ë™ûÊÑè„ÄÇ</p><p>Server side Ê≤í‰ªÄÈ∫ºÈúÄË¶ÅÊ≥®ÊÑèÁöÑÔºåÂè™Ë¶ÅÁî®ËºÉÊñ∞ÁâàÁöÑ NATS image ‰∏¶ÂïüÁî®Ë®≠ÂÆöÂç≥ÂèØ„ÄÇClient ÈñãÁôºÂâáÈúÄË¶ÅÊ≥®ÊÑè‰∏Ä‰∫õÊ¶ÇÂøµ„ÄÇ</p><ul><li>Subject: NATS ÊúÄÂàùÁöÑÊ¶ÇÂøµÔºå‰ª£Ë°®‰∏Ä‰∫õ message ÁöÑÈõÜÂêà„ÄÇ</li><li>Stream: Âª∫Á´ãÊñº‰∏ÄÊàñÂ§öÂÄã Subject ‰πã‰∏äÔºåÂèØÂ∞áÈÄô‰∫õ subject ÂÖßÁöÑ message Áµ±Êï¥Ëµ∑‰æÜÔºå‰∏¶ÊîæÂÖ• persistent storage„ÄÇ</li><li>Consumer: Âª∫Á´ãÂú®ÊüêÂÄã Stream ‰πã‰∏ãÔºåÂèØ‰ª•‰æùÂ∫èÁöÑ consume Â±¨ÊñºÊ≠§ stream ÁöÑÁâπÂÆö message„ÄÇ</li></ul><p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºå‰∏çÂè™ Subject Ëàá StreamÔºåConsumer Êú¨Ë∫´‰πüÊòØÂª∫Á´ãÂú® NATS server ‰∏≠ÁöÑ‰∏ÄÂÄãÁâ©‰ª∂„ÄÇÁï∂Âà©Áî® client library create ‰∏ÄÂÄã Consumer ÊôÇÔºå‰∏¶‰∏çÊòØË©≤ process Êú¨Ë∫´ÊàêÁÇ∫‰∏ÄÂÄã consumerÔºåËÄåÊòØ NATS server ‰∏≠Ë¢´Ââµ‰∫Ü‰∏ÄÂÄã Consumer Áâ©‰ª∂ÔºåÊ∫ñÂÇôÂéª‰ΩøÁî® Stream Ë£°Èù¢ÁöÑ message„ÄÇ</p><p>JetStream client library ‰∏¶Ê≤íÊúâÊèê‰æõ‰∏ÄÂÄãÂ∞çÁ®±ÁöÑ producer&#x2F;consumer API„ÄÇÂü∫ÊñºË°ìË™ûÁöÑÈôêÂà∂‰ª•ÂèäÁÇ∫‰∫ÜÈÅøÂÖçË™§ÊúÉÔºå‰ª•‰∏ãÂú®Á®±Âëº‰∏ÄËà¨ÊâÄÁ®±ÁöÑ producer&#x2F;consumer ÊôÇÔºåÊúÉÁâπÂà•Âä†‰∏ä <strong>role</strong> ÂæåÁ∂¥‰æÜË°®Á§∫„ÄÇ</p><p>Producer role: Ë¶Å‰ΩøÁî® NATS library ÂÖßÁöÑ Publish APIÔºåÂ∞áÁî¢ÁîüÁöÑ message Êé®ÈÄÅËá≥ÊüêÂÄã Subject ÂÖß„ÄÇ</p><p>Consumer role: Ë¶Å‰ΩøÁî® JetStream library ÂÖßÁöÑ Stream APIÔºåÂú® NATS server ‰∏äÂ∞çÁõÆÊ®ôSubject Âª∫Á´ã StreamÔºåÊé•Ëëó‰ΩøÁî® JetStream Consumer APIÔºåÂú® NATS server ‰∏≠Âª∫Á´ãÂ±¨ÊñºË©≤ Stream ÁöÑ Consumer„ÄÇ‰ª•‰∏äÈÉΩÂÆåÊàê‰πãÂæåÔºåÂç≥ÂèØÂà©Áî® Consumer ‰∏äÁöÑ <code>NextMsg</code> ‰æÜÊ∂àËÄó message„ÄÇ</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>JetStream ÁöÑ API Ë®≠Ë®à‰∏¶‰∏çÂ∏∏Ë¶ãÔºåÈúÄË¶ÅÂÖàË™çÁü•Âà∞ËàáÊó¢ÊúâË®≠Ë®àÁöÑÂ∑ÆÂà•‰πãËôïÊâçËÉΩÈñãÂßãÈñãÁôº„ÄÇ‰∏çÈÅéÂÖ∂ cloud native ÁöÑÊû∂ÊßãË®≠Ë®àÊàñË®±ÂèØ‰ª•Âú®Á∂≠ÈÅã‰∏äÈù¢ÂãùÈÅéÂÖ∂‰ªñËÄÅÁâåÁöÑ MQ solution„ÄÇ</p><p>‰ªäÂ§©Â∞±ÂÖàÂØ´Âà∞ÈÄôË£°ÔºåÂ¶ÇÊûúÊúâÂì™Â§©ÊúâËààË∂£ÂÜçË£úÂêß„ÄÇ :D</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://gcoolinfo.medium.com/comparing-nats-nats-streaming-and-nats-jetstream-ec2d9f426dc8">Comparing NATS, NATS Streaming and NATS JetStream | by George Koulouris | Medium</a></li></ul><h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><p>Golang sample code:</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;context&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;testing&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/nats-io/jsm.go&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/nats-io/jsm.go/api&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/nats-io/nats.go&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fullSubject <span class="type">string</span> = <span class="string">&quot;report_task.scheduled&quot;</span></span><br><span class="line"><span class="keyword">var</span> wildcardSubject <span class="type">string</span> = <span class="string">&quot;report_task.*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumeOne</span><span class="params">(doneChan <span class="keyword">chan</span> <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">msg, err := consumer.NextMsg()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Fail to get message: %v\n&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Consume get task: %s\n&quot;</span>, <span class="type">string</span>(msg.Data))</span><br><span class="line">time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line"><span class="keyword">if</span> err := msg.Ack(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Fail to ack the message %s: %v\n&quot;</span>, <span class="type">string</span>(msg.Data), err)</span><br><span class="line">&#125;</span><br><span class="line">doneChan &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestProduceAndConsume</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">producerStopChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">consumerStopChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line"><span class="keyword">var</span> taskCount <span class="type">int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> idx := <span class="number">0</span>; idx &lt; taskCount; idx++ &#123;</span><br><span class="line">taskName := fmt.Sprintf(<span class="string">&quot;task #%d&quot;</span>, rand.Int())</span><br><span class="line">nc.Publish(fullSubject, []<span class="type">byte</span>(taskName))</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;Producer produce: %s\n&quot;</span>, taskName)</span><br><span class="line">&#125;</span><br><span class="line">producerStopChan &lt;- <span class="literal">true</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx := <span class="number">0</span>; idx &lt; taskCount; idx++ &#123;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">consumeOne(consumerStopChan)</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;-producerStopChan</span><br><span class="line"><span class="keyword">for</span> idx := <span class="number">0</span>; idx &lt; taskCount; idx++ &#123;</span><br><span class="line">&lt;-consumerStopChan</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;Done&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx context.Context</span><br><span class="line"><span class="keyword">var</span> cancel context.CancelFunc</span><br><span class="line"><span class="keyword">var</span> nc *nats.Conn</span><br><span class="line"><span class="keyword">var</span> stream *jsm.Stream</span><br><span class="line"><span class="keyword">var</span> consumer *jsm.Consumer</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line"></span><br><span class="line">ctx, cancel = context.WithTimeout(context.Background(), <span class="number">10</span>*time.Second)</span><br><span class="line">nc, err = nats.Connect(nats.DefaultURL, nats.UserInfo(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;password&quot;</span>), nats.UseOldRequestStyle())</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jsmgr, err := jsm.New(nc)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">streamName := <span class="string">&quot;ReportTask&quot;</span></span><br><span class="line">stream, err = jsmgr.LoadOrNewStreamFromDefault(streamName,</span><br><span class="line">api.StreamConfig&#123;</span><br><span class="line">Subjects:     []<span class="type">string</span>&#123;wildcardSubject&#125;,</span><br><span class="line">Storage:      api.FileStorage,</span><br><span class="line">Retention:    api.LimitsPolicy,</span><br><span class="line">Discard:      api.DiscardOld,</span><br><span class="line">MaxConsumers: <span class="number">-1</span>,</span><br><span class="line">MaxMsgs:      <span class="number">-1</span>,</span><br><span class="line">MaxBytes:     <span class="number">-1</span>,</span><br><span class="line">MaxAge:       <span class="number">24</span> * time.Hour,</span><br><span class="line">MaxMsgSize:   <span class="number">-1</span>,</span><br><span class="line">Replicas:     <span class="number">1</span>,</span><br><span class="line">NoAck:        <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">consumerName := <span class="string">&quot;Generator&quot;</span></span><br><span class="line">consumer, err = stream.LoadOrNewConsumerFromDefault(consumerName,</span><br><span class="line">api.ConsumerConfig&#123;</span><br><span class="line">Durable:         consumerName,</span><br><span class="line">DeliverPolicy:   api.DeliverNew,</span><br><span class="line">FilterSubject:   fullSubject,</span><br><span class="line">AckPolicy:       api.AckExplicit,</span><br><span class="line">AckWait:         <span class="number">30</span> * time.Second,</span><br><span class="line">MaxDeliver:      <span class="number">5</span>,</span><br><span class="line">ReplayPolicy:    api.ReplayInstant,</span><br><span class="line">SampleFrequency: <span class="string">&quot;0%&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">shutdown</span><span class="params">()</span></span> &#123;</span><br><span class="line">cancel()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMain</span><span class="params">(m *testing.M)</span></span> &#123;</span><br><span class="line">setup()</span><br><span class="line">code := m.Run()</span><br><span class="line">shutdown()</span><br><span class="line">os.Exit(code)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ÊúÄËøëÂõ†ÂÖ¨Âè∏Ê•≠ÂãôÂú®Áé©‰∏ÄÂ•óÁõ∏Â∞çÊñ∞ÁöÑ MQ: NATS„ÄÇ
Âõ†ÁÇ∫ÂÆòÊñπÊñá‰ª∂‰∏çÊÖéÊ∏ÖÊ•ö‰∏îÊúâ‰∫õÂú∞ÊñπËàáÁõ¥Ë¶∫‰∏çÂêåÔºåÈÄ†ÊàêËµ∑Ê≠•Á∑©ÊÖ¢„ÄÇ&lt;/p&gt;
&lt;p&gt;‰ª•‰∏ãÁ∞°ÂñÆÁ¥ÄÈåÑ‰∏Ä‰∏ãÂâõÂÖ•ÈñÄÊôÇÊáâÁü•ÈÅìÁöÑ‰∫ãÊÉÖ„ÄÇ&lt;/p&gt;
&lt;h2 id=&quot;Guide&quot;&gt;&lt;a href=&quot;#Guide&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="golang" scheme="https://blog.bitisle.net/tags/golang/"/>
    
    <category term="nats" scheme="https://blog.bitisle.net/tags/nats/"/>
    
    <category term="mq" scheme="https://blog.bitisle.net/tags/mq/"/>
    
  </entry>
  
  <entry>
    <title>GitLab Êõ¥ÊèõËá™ÂÆ∂ GPG Key</title>
    <link href="https://blog.bitisle.net/2021/06/17/gitlab-revoke-gpg-key.html"/>
    <id>https://blog.bitisle.net/2021/06/17/gitlab-revoke-gpg-key.html</id>
    <published>2021-06-17T03:10:00.000Z</published>
    <updated>2021-06-17T03:10:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>‰ªäÂ§© GitLab Âú®Ëá™ÂÆ∂ blog ‰∏äÂÖ¨Âëä revoke Á∞ΩÁΩ≤ package ÁöÑ GPG key„ÄÇ</p><blockquote><p>We recently became aware of an instance where this key and other tokensused to distribute official GitLab Runner packages and binaries were notsecured according to GitLab‚Äôs security policies.</p></blockquote><blockquote><p>We have not found any evidence of unauthorized modification of the packagesor access to the services storing them.</p></blockquote><p>‰∏¶‰∏çÊòØÂõ†ÁÇ∫ key Ë¢´ compromiseÔºåÂÉÖÊòØÂõ†ÁÇ∫ key ‰∏çÁ¨¶ÂêàÂÖ¨Âè∏ÁöÑÂÆâÂÖ®Ë¶èÁØÑÔºåÊâÄ‰ª•Â∞±ÈÄ≤Ë°å‰∫Ü‰∏ÄÊ¨° rekey„ÄÇ</p><p>GPG key rekey ‰∏¶‰∏çÂ¶ÇÊèõÊÜëË≠â‰∏ÄÊ®£ÔºåÂè™Ë¶ÅÈáçÁ∞Ω‰∏ÄÂºµÂ∞±Â•Ω (Âõ†ÁÇ∫‰ø°Ë≥¥Âª∫Á´ãÂú®Â∑≤Áü•ÁöÑÁ¨¨‰∏âÊñπ CA ‰∏ä)„ÄÇGPG key rekey ÈúÄË¶ÅÈÄèÈÅéÂèØ‰ø°ÁÆ°ÈÅìÈáçÊñ∞ÂÆ£Âëä fingerprint ‰∏¶Ë´ãÂ§ßÂÆ∂ import Êñ∞ÁöÑ key„ÄÇÈÄôÂÄãËΩâÊèõÁöÑÊàêÊú¨ÔºåÁõ∏ËºÉÊèõÊÜëË≠âÊáâÊòØÈ´òÈùûÂ∏∏Â§ö‰∏îÈõ£‰ª•ÈáèÂåñÁöÑ„ÄÇ</p><p>Ê≤íÊÉ≥Âà∞Â±ÖÁÑ∂ÂÉÖÁÇ∫‰∫Ü‰∏çÂêàÂÆâÂÖ®Ë¶èÁØÑÂ∞±ÈÄ≤Ë°å rekeyÔºå‰∏çÊÑßÊòØÂúãÈöõ‰∏ÄÁ∑öÁöÑËªüÈ´îÂÖ¨Âè∏ÔºÅ</p><p>See: <a href="https://about.gitlab.com/blog/2021/06/16/gpg-key-used-to-sign-gitlab-runner-packages-rotated/">The GPG key used to sign GitLab Runner packages has been rotated | GitLab</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;‰ªäÂ§© GitLab Âú®Ëá™ÂÆ∂ blog ‰∏äÂÖ¨Âëä revoke Á∞ΩÁΩ≤ package ÁöÑ GPG key„ÄÇ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We recently became aware of an instance where this key and other </summary>
      
    
    
    
    <category term="news" scheme="https://blog.bitisle.net/categories/news/"/>
    
    
    <category term="gitlab" scheme="https://blog.bitisle.net/tags/gitlab/"/>
    
    <category term="gnupg" scheme="https://blog.bitisle.net/tags/gnupg/"/>
    
  </entry>
  
  <entry>
    <title>VS Code Êñ∞ÂäüËÉΩ: Remote Repositories</title>
    <link href="https://blog.bitisle.net/2021/06/12/vscode-feature-remote-repositories.html"/>
    <id>https://blog.bitisle.net/2021/06/12/vscode-feature-remote-repositories.html</id>
    <published>2021-06-12T08:35:00.000Z</published>
    <updated>2021-06-12T08:35:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>VS Code Âú® <a href="https://code.visualstudio.com/updates/v1_57">1.57</a> Áâà‰∏≠ÔºåRemote Development Á≥ªÂàó extension Âä†ÂÖ•‰∫ÜÊñ∞ÊàêÂì°:<a href="https://marketplace.visualstudio.com/items?itemName=GitHub.remotehub">Remote Repositories</a>„ÄÇ</p><p>Êúâ‰∫ÜÈÄôÂÄã extension ‰πãÂæåÔºåÂ¶ÇÊûúÈÅá‰∏äËá®ÊôÇÊÉ≥ÁúãÁöÑ projectÔºåÂ∞±ÂèØ‰ª•Áõ¥Êé•Âú® VS Code‰∏≠Âè´Âá∫‰æÜÁúãÔºå‰∏çÈúÄË¶Å‰∫ãÂÖà clone Ëá≥ÊüêÂÄã local Ë≥áÊñôÂ§æ„ÄÇ</p><p>‰∏çÈÅé.. Âõ†ÁÇ∫ÈÄôÂÄã extension ÂØ¶Èöõ‰∏äÊòØÂª∫‰∏ÄÂÄã<a href="https://github.com/microsoft/vscode/wiki/Virtual-Workspaces">Virtual Workspaces</a>‰∏¶Êää code ÊîæÂú®Ë£°Èù¢Èñ±Ë¶ΩÔºåÊâÄ‰ª•Áî® Remote Repositories ÈñãÂá∫‰æÜÁöÑ workspace ÂäüËÉΩÈùûÂ∏∏ÂèóÈôê„ÄÇË´∏Â¶Ç Debug, Terminal ÂèäÂ§ßÈÉ®ÂàÜÁöÑ extension Âü∫Êú¨‰∏äÈÉΩ‰∏çËÉΩÁî®„ÄÇ‰ΩÜË©±ÈõñÂ¶ÇÊ≠§ÔºåÁï∂Áúã code Áúã‰∏ÄÁúãÊÉ≥Ë¶ÅÈñãÂßãÈÄ≤Ë°åÊØîËºÉÊ∑±ÂÖ•ÁöÑ‰øÆÊîπÂèäÈô§ÈåØÊôÇÔºåÂÖ∂ÂØ¶‰πüÊòØÊúâÊèê‰æõËΩâÊèõÊàê‰∏ÄËà¨ workspace ÁöÑÂäüËÉΩ„ÄÇ ‰ΩøÁî®‰∏äÈùûÂ∏∏Êñπ‰æøÔºÅ</p><p>ÂèØÊÉúÁöÑÊòØÔºåÁõÆÂâçÊ≠§ extension ÊîØÊè¥ÁöÑ remote repository Á®ÆÈ°ûÂè™Êúâ GitHub„ÄÇ‰∏îÂ¶ÇÂêåÂÖ∂‰ªñ Remote Development SeriesÔºåÈÄôÂÄã extension ‰∏¶Èùû open source projectÔºö</p><ul><li><a href="https://code.visualstudio.com/docs/remote/faq#_why-arent-the-remote-development-extensions-or-their-components-open-source">Visual Studio Code Remote Development Frequently Asked Questions</a></li><li><a href="https://github.com/VSCodium/vscodium/issues/196">Cannot use Remote Development extension pack ¬∑ Issue #196 ¬∑ VSCodium&#x2F;vscodium</a></li></ul><p>Êú™‰æÜÊúÉ‰∏çÊúÉÊîØÊè¥ GitHub ‰ª•Â§ñÁöÑ Git repositoriesÔºåÁîöËá≥ÂÖ∂‰ªñÁ®ÆÈ°ûÁöÑ VCSÔºåÂè™ËÉΩÁúãÂæÆËªüÁà∏Áà∏ÁöÑÁúºËâ≤‰∫Ü„ÄÇ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;VS Code Âú® &lt;a href=&quot;https://code.visualstudio.com/updates/v1_57&quot;&gt;1.57&lt;/a&gt; Áâà‰∏≠Ôºå
Remote Development Á≥ªÂàó extension Âä†ÂÖ•‰∫ÜÊñ∞ÊàêÂì°:
&lt;a href=&quot;https://mar</summary>
      
    
    
    
    <category term="news" scheme="https://blog.bitisle.net/categories/news/"/>
    
    
    <category term="github" scheme="https://blog.bitisle.net/tags/github/"/>
    
    <category term="development" scheme="https://blog.bitisle.net/tags/development/"/>
    
    <category term="ide" scheme="https://blog.bitisle.net/tags/ide/"/>
    
    <category term="vscode" scheme="https://blog.bitisle.net/tags/vscode/"/>
    
  </entry>
  
  <entry>
    <title>GitHub Pages Ëàá GitLab Pages Êû∂Ë®≠ Blog</title>
    <link href="https://blog.bitisle.net/2021/06/06/github-pages-gitlab-pages.html"/>
    <id>https://blog.bitisle.net/2021/06/06/github-pages-gitlab-pages.html</id>
    <published>2021-06-06T13:00:00.000Z</published>
    <updated>2021-06-06T13:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Á≠ÜËÄÖÊúÄËøëÊääÂÄã‰∫∫ blog ÁöÑÁî¢ÁîüÂ∑•ÂÖ∑Âæû GitHub Pages È†êË®≠ÁöÑ <a href="https://jekyllrb.com/">Jekyll</a>ÊèõÊàê <a href="https://hexo.io/">Hexo</a>ÔºåÊúâ‰∫Ü‰∏ÄÈªûÂøÉÂæó„ÄÇ ËÄå‰∏î‰∏çÂè™ GitHub PagesÔºåÁ≠ÜËÄÖÂú®ÂÖ¨Âè∏Ê•≠Âãô‰∏≠‰πüÊúâÂ§ßÈáè‰ΩøÁî® GitLab Pages ‰æÜÁî¢ÁîüÊñá‰ª∂ÂèäÊ∏¨Ë©¶Â†±Ë°®ÔºåÁÆóÊòØÊúâÁ¥ØÁ©ç‰∏çÂ∞ëÁ∂ìÈ©ó„ÄÇ</p><p>Ë∂ÅËëóÂç∞Ë±°ÈÇÑÊ∑±ÂàªÊôÇÔºåÂØ´ÈªûÁ≠ÜË®òÔºåÊõøÈÄôÂÖ©ÂÄãÁõ∏ÂêåÊÄßË≥™ÁöÑÊúçÂãôÂÅöÂü∫Êú¨ÁöÑ‰ªãÁ¥π„ÄÇ</p><h2 id="Pages-ÊúçÂãôËàá-Static-Site-Generator"><a href="#Pages-ÊúçÂãôËàá-Static-Site-Generator" class="headerlink" title="Pages ÊúçÂãôËàá Static Site Generator"></a>Pages ÊúçÂãôËàá Static Site Generator</h2><p>GitHub &#x2F; GitLab Pages ÂèØ‰ª•Â∞á‰∏ÄÁµÑÈùúÊÖãÁ∂≤È†ÅÂÖßÂÆπ (html, css, js Á≠â)ÔºåÈÄèÈÅé GitHub &#x2F; GitLabÁöÑ‰º∫ÊúçÂô®Ôºåhost Âú®ÊüêÂÄã URL Â∫ï‰∏ã„ÄÇ Á∂≤È†ÅÁî¢ÁîüÂ∑•ÂÖ∑ (Static Site Generator, ‰∏ãÁ®± SSG) ÂâáÊòØ‰∏ÄÂÄãÂèØ‰ª•Â∞áÁî® Markdown Êí∞ÂØ´ÁöÑÊñáÁ´†ÔºåËΩâÂåñÊàêÊºÇ‰∫ÆÁöÑÈùúÊÖãÁ∂≤È†ÅÂÖßÂÆπÁöÑÂ∑•ÂÖ∑„ÄÇÂ∏∏Ë¶ãÁöÑ SSG Êúâ Jekyll(Ruby), Hugo(Go),Hexo(JavaScript) Á≠â„ÄÇ</p><p>Ëã•Â∞á SSG Â∑•ÂÖ∑Ëàá GitHub &#x2F; GitLab Pages ÊúçÂãôÔºåÊê≠ÈÖç‰ΩøÁî®Ôºå<strong>ÂØ´‰ΩúËÄÖÂè™ÈúÄË¶ÅÂØ´ÂØ´Á∞°ÂñÆÁöÑ Markdown ‰∏¶ push commitÔºåÂ∞±ËÉΩÂæóÂà∞‰∏ÄÂÄãÊºÇ‰∫ÆÁöÑ blog ÊàñÊòØÊñá‰ª∂Á∂≤È†Å„ÄÇ</strong>Á≠ÜËÄÖÁöÑÂÄã‰∫∫ blog ÂèäÂÖ¨Âè∏ÁöÑÂ∑•‰ΩúÁ≠ÜË®òÂç≥ÊòØ‰ΩøÁî®ÈÄôÈ°ûÊµÅÁ®ãÊû∂Ë®≠„ÄÇ</p><p>Êï¥È´îÊµÅÁ®ãÂ§ßÊ¶ÇÂ¶Ç‰∏ãÂúñÊâÄÁ§∫:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">               +   GitHub            +     github.io</span><br><span class="line">Local Project  |          Project    |               site</span><br><span class="line">               |   GitLab            |     gitlab.io</span><br><span class="line">               +                     +</span><br><span class="line"></span><br><span class="line">+----------+        +----------+  Build &amp;  +------+  User</span><br><span class="line">| Markup   |  Push  | Markup   |  Deploy   | Site |  Browse</span><br><span class="line">| config.. | +----&gt; | Config.. | +-------&gt; |      | +-------&gt;</span><br><span class="line">+----------+        +----------+           +------+</span><br></pre></td></tr></table></figure><h2 id="GitHub-Pages"><a href="#GitHub-Pages" class="headerlink" title="GitHub Pages"></a>GitHub Pages</h2><p><a href="https://pages.github.com/">GitHub Pages</a> Âü∫Êú¨‰∏äÊúÉÊúâÂÖ©Á®Æ‰∏ªË¶ÅÁöÑ‰ΩøÁî®ÊñπÂºè„ÄÇÂèØ‰ª•Áõ¥Êé•‰ΩøÁî® GitHub PagesÔºåÊàñÊòØÈÄèÈÅé GitHub Pages ÁöÑ Jekyll Êï¥ÂêàÂäüËÉΩ„ÄÇÂâçËÄÖÈúÄË¶ÅÁöÑÊäÄË°ìËÉåÊôØËàáË®≠ÂÆöÊ≠•È©üÂùáËºÉË§áÈõúÔºåÂæåËÄÖËºÉÁ∞°ÂñÆ‰ΩÜÁº∫Â∞ë‰∫ÜÊ†πÊìöÂÄãÂà•ÈúÄÊ±ÇË™øÊï¥ÁöÑÊ©üÊúÉ„ÄÇ</p><h3 id="Native-GitHub-Pages"><a href="#Native-GitHub-Pages" class="headerlink" title="Native GitHub Pages"></a>Native GitHub Pages</h3><p>Ëã•Áõ¥Êé•‰ΩøÁî® GitHub PagesÔºå‰ΩøÁî®ÊñπÂºèÊòØ: Â∞á SSG Áî¢ÁîüÁöÑÁ∂≤È†ÅÊì∫ÊîæËá≥Êüê branch (È†êË®≠ÁÇ∫ <code>gh-pages</code>)ÁöÑ <code>/</code> Êàñ <code>/docs</code> ÁõÆÈåÑ„ÄÇ ÊØèÊ¨°Ë©≤ branch Ë¢´Êõ¥Êñ∞ÊôÇÔºåGitHub Â∞±ÊúÉÂ∞áÊúÄÊñ∞ÁâàÊú¨ÁöÑÁ∂≤È†ÅÂÖßÂÆπÔºåÂëàÁèæÂú® <code>https://&lt;username&gt;.github.io/&lt;project&gt;</code> ÈÄ£Áµê‰∏ã„ÄÇ</p><p>Êó©ÊúüÈÄôÂÄã push brach ÁöÑÂãï‰ΩúÊòØË†ªÈ∫ªÁÖ©ÁöÑÔºå‰ΩÜÂæå‰æÜÊúâ‰∫Ü GitHub Action ‰πãÂæåÔºåÁî¢ÁîüÁ∂≤Á´ôÂíåÂæå push branch ÁöÑÂãï‰ΩúÈÉΩÂèØ‰ª•Âú® GitHub Êèê‰æõÁöÑÁí∞Â¢ÉÂÆåÊàêÔºåÈùûÂ∏∏Êñπ‰æø„ÄÇ</p><p>Á≠ÜËÄÖÂÄã‰∫∫‰ΩøÁî®ÁöÑ job ÊèèËø∞Ê™îÂ¶Ç‰∏ã:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/blog.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name:</span> <span class="string">build-and-deploy-blog</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">&quot;master&quot;</span> ]</span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">blog:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2.3.4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node.js</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2.1.5</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="number">12.</span><span class="string">x</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependent</span> <span class="string">packages</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">blog</span> <span class="string">posts</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">publish_dir:</span> <span class="string">./public</span></span><br></pre></td></tr></table></figure><p>Ëã•‰∏çÊÉ≥‰ΩøÁî® GitHub Êèê‰æõÁöÑ domainÔºå‰πüÂèØ‰ª•ÂèÉÁÖß<a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site">ÂÆòÊñπÊñá‰ª∂</a>Ôºå‰ΩøÁî®Ëá™Â∑±Ë≥ºË≤∑ÁöÑ domain ‰æÜÊû∂Ë®≠Á∂≤Á´ô„ÄÇÂè™Ë¶ÅË®≠ÂÆöÂÆåÊàêÔºåGitHub ‰πüÂèØ‰ª•‰∏Ä‰ΩµÂπ´‰ΩøÁî®ËÄÖÁî≥Ë´ã custom domain ÈúÄË¶ÅÁöÑ HTTPS ÊÜëË≠â„ÄÇ</p><p>ÊØîÊñπË™™Á≠ÜËÄÖÁöÑ blog ÂéüÊú¨ÂèØÂ≠òÂèñÁöÑ‰ΩçÁΩÆÊáâÊòØ <code>https://wdhongtw.github.io/blog</code>Ôºå‰ΩÜÊúâË®≠ÂÆöcustom domain ÂæåÔºåÁõÆÂâçÊòØÈÄèÈÅé <code>https://blog.bitisle.net</code> ‰æÜÂ≠òÂèñÊû∂Âú® GitHub Pages ‰∏äÁöÑ blog„ÄÇ</p><p><img src="/assets/images/f0b7ac13-d964-496f-ab78-1fed9a8a742b.png"></p><h3 id="GitHub-Pages-Jekyll"><a href="#GitHub-Pages-Jekyll" class="headerlink" title="GitHub Pages Jekyll"></a>GitHub Pages Jekyll</h3><p>ÂâçËø∞ (Native) GitHub Pages ÁöÑ‰ΩøÁî®ÊñπÂºèÊúÉÈúÄË¶ÅËá™Â∑± push branch„ÄÇ‰ΩÜËã• GitHub ÂÅµÊ∏¨Âà∞ project ‰ΩøÁî®ÁöÑ SSG ÊòØ JekyllÔºåGitHub ÊúÉËá™ÂãïËôïÁêÜÁî¢ÁîüÁ∂≤È†Å‰ª•ÂèäÂæåÁ∫åÈÉ®Â±¨Âà∞ <code>https://&lt;username&gt;.github.io/&lt;project&gt;</code> ÁöÑÂ∑•‰Ωú„ÄÇ(ÈÄ£ <code>gh-pages</code> branch ÈÉΩÁúÅ‰∫ÜÔºåÊï¥ÂÄã project ÊúÉÈùûÂ∏∏‰πæÊ∑®„ÄÇ)</p><p>Ê≠§ÊñπÊ≥ïÁõ∏Áï∂ÂÆπÊòì‰∏äÊâãÔºå‰πüÊòØ GitHub Pages ÊïôÂ≠∏Êñá‰ª∂È†êË®≠ÁöÑ‰ΩøÁî®ÊñπÂºè„ÄÇ‰ΩÜÂõ†ÁÇ∫Áî¢ÁîüÁ∂≤Á´ôÁöÑÁí∞Â¢ÉÊòØÁî± GitHub ÂçîÂä©ËôïÁêÜÔºåËÉΩ‰ΩøÁî®ÁöÑ Jekyll plugin Ëá™ÁÑ∂‰πüÊòØÂèóÂà∞ÈôêÂà∂„ÄÇ</p><p>Ë™™ÊòØÂèóÂà∞ÈôêÂà∂Ôºå‰ΩÜ‰ª•‰∏ÄËà¨‰ΩøÁî®ÊÉÖÂ¢ÉÊáâË©≤‰πüÂæàÂ§†‰∫Ü„ÄÇË´∏Â¶Ç RSS feed, sitemap, Open Graph metadataÁ≠âÁèæ‰ª£ blog ÂøÖÂÇôÁöÑÂäüËÉΩÈÉΩÊúâËá™Â∏∂„ÄÇËã•ÊÉ≥Áü•ÈÅìÊúâÈÇ£‰∫õ Jekyll plugin ÂèØÁî®ÔºåÂèØËá≥ <a href="https://pages.github.com/versions/">Dependency versions | GitHub Pages</a>Êü•Èñ±„ÄÇ</p><h3 id="Compare-Native-GitHub-Page-with-GitHub-Pages-and-Jekyll"><a href="#Compare-Native-GitHub-Page-with-GitHub-Pages-and-Jekyll" class="headerlink" title="Compare Native GitHub Page with GitHub Pages and Jekyll"></a>Compare Native GitHub Page with GitHub Pages and Jekyll</h3><p>Á∞°ÂñÆÊØîËºÉ‰∏äËø∞ÂÖ©Á®ÆÊñπÂºèÂ¶Ç‰∏ã</p><table><thead><tr><th></th><th>GitHub Page</th><th>GitHub Page with Jekyll</th></tr></thead><tbody><tr><td>SSG Tool</td><td>on your choice</td><td>only Jekyll</td></tr><tr><td>Deployment</td><td>push generated site</td><td>done by GitHub</td></tr><tr><td>Customization</td><td>any plugins of SSG</td><td>limited Jekyll plugin list</td></tr></tbody></table><h2 id="GitLab-Pages"><a href="#GitLab-Pages" class="headerlink" title="GitLab Pages"></a>GitLab Pages</h2><p><a href="https://about.gitlab.com/stages-devops-lifecycle/pages/">GitLab Pages</a>Ëàá GitHub Pages ‰∏ÄÊ®£ÔºåÊúâÂ∞á SSG Áî¢ÁîüÁöÑÁ∂≤È†Å host Âú®ÁâπÂÆöÁ∂≤ÂùÄÁöÑËÉΩÂäõ„ÄÇ‰ª• GitLab ÂÆòÊñπ host ÁöÑÁ´ôÂè∞‰æÜË™™ÔºåÁ∂≤Á´ôÊúÉÊîæÂú® <code>https://&lt;username&gt;.gitlab.io/&lt;project&gt;</code> ‰∏ã„ÄÇ(ÁßÅ‰∫∫ÊàñÂÖ¨Âè∏ host ÁöÑ GitLab instance Â∞±Ë¶ÅÁúãÂêÑËá™ÁöÑË®≠ÂÆö)</p><p>Ëàá GitHub ‰∏çÂêåÁöÑÊòØÔºåGitLab Pages ‰∏¶‰∏çÊòØÈÄèÈÅé push branch ÁöÑÊñπÂºèÈÉ®Â±¨Ôºå‰∏îÊ≤íÊúâÈáùÂ∞çÁâπÂÆö SSG Êèê‰æõÊõ¥ÈÄ≤‰∏ÄÊ≠•ÁöÑËá™ÂãïÈÉ®Â±¨ÂäüËÉΩ„ÄÇ</p><p>GitLab Pages ÁöÑ‰ΩøÁî®ÊñπÂºèÊòØÂü∫Êñº GitLab CI Pipeline ÁöÑÊû∂ÊßãË®≠Ë®àÁöÑ„ÄÇËã•ÊÉ≥Ë¶ÅÈÉ®Â±¨Á∂≤Á´ôÔºå‰∏ÄËà¨ÁöÑ‰ΩøÁî®ÊñπÂºèÊòØÂú® pipeline ÂÖßÁî¢ÁîüÁ∂≤È†ÅÔºåÊé•ËëóÂ∞áÁ∂≤È†ÅÂÖßÂÆπÊì∫ÊîæËá≥ÁÇ∫ÁâπÂÆö job (<code>pages</code>) ÁöÑÁâπÂÆöartifacts ÁõÆÈåÑ (<code>public</code>) ‰∏≠„ÄÇ ‰∏ÄÊó¶Êúâ pipeline jobs ÈÅîÊàêÊ≠§Ê¢ù‰ª∂„ÄÇ GitLab Â∞±ÊúÉÊääÁ∂≤È†ÅÂÖßÂÆπÈÉ®Â±¨Âà∞Â∞çÊáâÁöÑÁ∂≤ÂùÄ‰∏ã„ÄÇ</p><p>Á≠ÜËÄÖÂÄã‰∫∫‰ΩøÁî®ÁöÑ job ÊèèËø∞Ê™îÂ¶Ç‰∏ã:(Âõ†ÁÇ∫ GitHub Action Ëàá GitLab CI ÁöÑÊû∂ÊßãÂ∑ÆÁï∞ÔºåÂØ´Ëµ∑‰æÜÊØîËºÉÁ∞°ÊΩî)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .gitlab-ci.yml</span></span><br><span class="line"><span class="attr">pages:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">ruby:3.0.1</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">bundle</span> <span class="string">install</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">jekyll</span> <span class="string">build</span> <span class="string">--destination</span> <span class="string">public</span> <span class="string">--baseurl</span> <span class="string">&quot;$CI_PAGES_URL&quot;</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">public</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>Ëá≥ÊñºÂÖ∂‰ªñ GitHub Pages ÊúâÁöÑÂäüËÉΩÔºåÂ¶Ç custom domainÔºåËá™ÂãïÁî≥Ë´ã HTTPS ÊÜëË≠âÁ≠âÔºåGitLab Pages‰πüÈÉΩÊúâ„ÄÇ Ë®òÂæóÂéª project Ë®≠ÂÆöÈ†ÅÈù¢Ë®≠ÂÆöÂç≥ÂèØ„ÄÇ</p><p><img src="/assets/images/49f9611b-3d40-4425-beb6-317aeae0aa6e.png"></p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Âú® 2008 Âπ¥ GitHub Pages ÂâõÊé®Âá∫ÊôÇÔºå‰ΩøÁî®ËÄÖÈÉΩË¶ÅËá™Â∑±ÊâãÂãï push <code>gh-pages</code> branch„ÄÇÂæå‰æÜ GitLab Êé®Âá∫Âü∫Êñº GitLab CI ÁöÑ Pages ÊúçÂãô‰πãÂæåÔºåGitHub Pages‰ΩøÁî®È´îÈ©óÁõ∏ËºÉ‰πã‰∏ãÂèØË™™ÊòØÈùûÂ∏∏Á≥üÁ≥ï„ÄÇ</p><p>‰ΩÜÂæå‰æÜÈö®Ëëó GitHub Actions ÊúçÂãôÊé®Âá∫Ôºå‰ª•ÂèäÁ§æÁæ§Á∂≠Ë≠∑ÁöÑÈ´òÂìÅË≥™<a href="https://github.com/marketplace/actions/github-pages-action">Pages ÈÉ®Â±¨ Action</a> Âá∫Áèæ„ÄÇGitHub &#x2F; GitLab Pages ÁöÑ‰ΩøÁî®È´îÈ©óÂ∑≤Á∂ìËÆäÂæóÁõ∏Áï∂Êé•Ëøë„ÄÇÂÖ∂‰ªñÂÉèÊòØ custom domain ‰ª•Âèä HTTPS ÁöÑÊîØÊè¥‰πüÈÉΩÊòØÂÖçË≤ªÁöÑÂü∫Êú¨ÂäüËÉΩ„ÄÇ</p><p>Âü∫Êñº‰∏äËø∞ÂéüÂõ†ÔºåË®±Â§öÊó©ÊúüÁöÑ <a href="https://mjswensen.com/blog/github-pages-vs-gitlab-pages/">ÊØîËºÉÊñáÁ´†</a>ÂÖ∂ÂØ¶Â∑≤Á∂ìÊ≤í‰ªÄÈ∫ºÂèÉËÄÉÂÉπÂÄº„ÄÇ Ëã•ÁèæÂú®ÊÉ≥Êû∂Ë®≠Êñ∞ÁöÑ blog Á≠âÁ´ôÂè∞ÔºåÂè™Ë¶ÅÈÅ∏ÊìáËá™Â∑±ÁøíÊÖ£ÁöÑÂπ≥Âè∞Âç≥ÂèØ„ÄÇ</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://docs.github.com/en/pages">GitHub Pages Documentation - GitHub Docs</a></li><li><a href="https://docs.gitlab.com/ee/user/project/pages/">GitLab Pages | GitLab</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Á≠ÜËÄÖÊúÄËøëÊääÂÄã‰∫∫ blog ÁöÑÁî¢ÁîüÂ∑•ÂÖ∑Âæû GitHub Pages È†êË®≠ÁöÑ &lt;a href=&quot;https://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt;
ÊèõÊàê &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;ÔºåÊúâ‰∫Ü‰∏ÄÈªûÂøÉÂæó„ÄÇ ËÄå‰∏î‰∏çÂè™ GitHu</summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="github" scheme="https://blog.bitisle.net/tags/github/"/>
    
    <category term="blog" scheme="https://blog.bitisle.net/tags/blog/"/>
    
    <category term="gitlab" scheme="https://blog.bitisle.net/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>GitHub Âç≥Êó•Ëµ∑ÊîØÊè¥‰ΩøÁî® Security Key ÈÄ≤Ë°å Git Êìç‰Ωú</title>
    <link href="https://blog.bitisle.net/2021/05/11/github-ssh-fido-key.html"/>
    <id>https://blog.bitisle.net/2021/05/11/github-ssh-fido-key.html</id>
    <published>2021-05-11T00:00:00.000Z</published>
    <updated>2021-05-11T00:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>GitHub ÈñãÂßãÊîØÊè¥‰ΩøÁî® security key ÈÄ≤Ë°å Git Êìç‰ΩúÂï¶ÔºÅ</p><p>ÈÄôÊáâË©≤ÊòØÂêÑÂÆ∂ÁßëÊäÄÂ∑®È†≠Áï∂‰∏≠ÔºåÁ¨¨‰∏ÄÂÄãÊîØÊè¥ security key ÈÄ≤Ë°å SSH login ÁöÑÊúçÂãôÂêß„ÄÇÁ≠ÜËÄÖÊò®Â§© 5&#x2F;10 ÊâçÂú®ÂÖ¨Âè∏ÂÖßÂàÜ‰∫´Â¶Ç‰Ωï‰ΩøÁî® security key ‰æÜÂÅö SSH loginÔºåÊ≤íÊÉ≥Âà∞ Yubico Âíå GitHub ‰πüÂâõÂ•ΩÂú®Êò®Â§©‰∏ÄËµ∑ÂêåÊ≠•Êõ¥Êñ∞ blog ÊñáÁ´†ÔºåÈÄöÁü•Â§ßÂÆ∂ÈÄôÂÄãÊñ∞ÂäüËÉΩ„ÄÇÂñúÊ•µËÄåÊ≥£..</p><ul><li><a href="https://github.blog/2021-05-10-security-keys-supported-ssh-git-operations/">Security keys are now supported for SSH Git operations - The GitHub Blog</a></li><li><a href="https://www.yubico.com/blog/github-now-supports-ssh-security-keys/">GitHub now supports SSH security keys - Yubico</a></li></ul><p>‰ª•‰∏ãÁ∞°ÂñÆ‰ªãÁ¥πÂ¶Ç‰Ωï‰ΩøÁî®ÈÄôÂÄãÊñ∞ÂäüËÉΩ„ÄÇÁÇ∫‰∫ÜÊñπ‰æøËß£Ë™™ÂèäÈÅøÂÖçË™§ÊúÉÔºåÂæåËø∞ÂÖßÂÆπÂùá‰ª•Ê≠£ÂºèÂêçÁ®± authenticator ‰ª£Á®± security key„ÄÇ</p><h2 id="Â¶Ç‰Ωï‰ΩøÁî®"><a href="#Â¶Ç‰Ωï‰ΩøÁî®" class="headerlink" title="Â¶Ç‰Ωï‰ΩøÁî®"></a>Â¶Ç‰Ωï‰ΩøÁî®</h2><p>È¶ñÂÖàÁï∂ÁÑ∂Ë¶ÅÊúâ‰∏ÄÊää authenticatorÔºåÂ¶ÇÊûúÈÇÑÊ≤íÊúâÔºåË∂ïÂø´ÂéªË≤∑‰∏ÄÊääÂõâ„ÄÇ :D</p><p><strong>Á¨¨‰∏ÄÊ≠•</strong>ÔºåÂú® authenticator ÂÖßÁî¢ÁîüÊñ∞ÁöÑ key pair„ÄÇ</p><p>Áî¢Áîü key pair ÁöÑÊµÅÁ®ãÂíåÂÇ≥Áµ±ÊîæÂú®Ê™îÊ°àÁ≥ªÁµ±‰∏äÁöÑÂ∑Æ‰∏çÂ§öÔºåÂè™ÊòØ key type Ë¶ÅÊåáÂÆö‰ª£Ë°® authenticatorÁöÑ type„ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ecdsa-sk</span><br></pre></td></tr></table></figure><p>Áî¢ÁîüÁöÑÈÅéÁ®ãÔºåÊ†πÊìö‰∏çÂêåÁöÑ authenticatorÔºåÊúÉÊúâË¶ÅÊ±ÇÊåâ‰∏Ä‰∏ã ‰∏î&#x2F;Êàñ Ëº∏ÂÖ• PIN code È©óË≠âË∫´ÂàÜ„ÄÇÊ≠§Ê≠•È©üÊúÉÂú® authenticator ÂÖßÁî¢Áîü‰∏ÄÁµÑ key pairÔºå‰∏¶Â∞á public key ÂØ´Âà∞Ê™îÊ°àÁ≥ªÁµ±‰∏ä„ÄÇÂπ≥Â∏∏Êîæ private key ÁöÑÈÇ£ÂÄãÊ™îÊ°àÈÇÑÊòØÊúÉÁî¢ÁîüÔºå‰∏çÈÅéÈÄôÊ¨°Ë£°Èù¢ÊîæÁöÑÊúÉÊòØ‰∏ÄÂÄã key handle„ÄÇ</p><p><strong>Á¨¨‰∫åÊ≠•</strong>ÔºåÈÄèÈÅé GitHub ÁöÑ web UI ‰∏äÂÇ≥ public key</p><p>‰∏äÂÇ≥ÂÆå‰πãÂæåÔºåÊ≤íÊÑèÂ§ñÂ∞±ÂèØ‰ª•È†ÜÂà©‰ΩøÁî®‰∫ÜÔºåÂèØ‰ª•Ë©¶Ëëó clone ‰∏Ä‰∫õ project</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git@github.com:github/secure_headers.git</span><br><span class="line">Cloning into &#x27;secure_headers&#x27;...</span><br><span class="line">Confirm user presence for key ECDSA-SK SHA256:........</span><br><span class="line">User presence confirmed</span><br></pre></td></tr></table></figure><p>Ëã•Á¢∫Ë™ç OKÔºå‰πãÂæåÁöÑ Git Êìç‰ΩúÈÉΩÂèØ‰ª•ÈÄèÈÅéÈö®Ë∫´ÊîúÂ∏∂ÁöÑ authenticator ‰øùË≠∑ÔºåÂè™Ë¶ÅÊåâ‰∏Ä‰∏ã authenticator Âç≥ÂèØ„ÄÇ</p><p>Ë®≠ÂÆöÂÆå‰πãÂæåÔºå<strong>Ëã•Ê≤íÊúâÊãøÂá∫ authenticatorÔºåÂ∞±‰∏çËÉΩÈÄ≤Ë°å push &#x2F; pull Êìç‰Ωú„ÄÇ</strong>Âè™Ë¶ÅÁ¢∫‰øù authenticator ÈÇÑÂú®Ë∫´‰∏äÔºåÂ∞±ÂèØ‰ª•ÂÆâÂøÉÁù°Â§ßË¶∫„ÄÇ(ÂÜç‰πü‰∏çÁî®ÊìîÂøÉ private key ÊîæÂú®ÂÖ¨Âè∏ÈõªËÖ¶‰∏äÊúÉË¢´Êë∏Ëµ∞‰∫ÜÔºÅ)</p><h2 id="ÈÄ≤Èöé‰ΩøÁî®ÊñπÂºè"><a href="#ÈÄ≤Èöé‰ΩøÁî®ÊñπÂºè" class="headerlink" title="ÈÄ≤Èöé‰ΩøÁî®ÊñπÂºè"></a>ÈÄ≤Èöé‰ΩøÁî®ÊñπÂºè</h2><p>FIDO 2 authenticator ÂçöÂ§ßÁ≤æÊ∑±ÔºåÈô§‰∫Ü‰∏äËø∞ÁöÑÂü∫Êú¨‰ΩøÁî®ÊµÅÁ®ãÂ§ñÔºåÈÇÑÊúâ‰∫õÁ¥∞ÁØÄÂèØ‰ª•Ë®≠ÂÆö„ÄÇ</p><p>‰ª•‰∏ãÂàÜÂà•‰ªãÁ¥π‰∏âÂÄãÈÄ≤Èöé‰ΩøÁî®ÊäÄÂ∑ßÔºö</p><h3 id="Ë¶ÅÊ±ÇË∫´ÂàÜÈ©óË≠â-User-Verification-ÊâçËÉΩ‰ΩøÁî®-Authenticator"><a href="#Ë¶ÅÊ±ÇË∫´ÂàÜÈ©óË≠â-User-Verification-ÊâçËÉΩ‰ΩøÁî®-Authenticator" class="headerlink" title="Ë¶ÅÊ±ÇË∫´ÂàÜÈ©óË≠â (User Verification) ÊâçËÉΩ‰ΩøÁî® Authenticator"></a>Ë¶ÅÊ±ÇË∫´ÂàÜÈ©óË≠â (User Verification) ÊâçËÉΩ‰ΩøÁî® Authenticator</h3><p>Ê†πÊìöÊØèÂÄã‰∫∫Âπ≥Â∏∏‰øùÁÆ°Èë∞ÂåôÁøíÊÖ£ÁöÑÂ∑ÆÁï∞ÔºåÂèØËÉΩÊúâ‰∫∫ÊúÉÊìîÂøÉ authenticator ÁúüÁöÑË¢´Êë∏Ëµ∞„ÄÇ</p><p>‰ΩÜ authenticator ‰πüÊúâÊîØÊè¥‰∏ÄÂÆöË¶ÅÈ©óÁîöË∫´ÂàÜ (e.g. PIN code or ÊåáÁ¥ãËæ®Ë≠ò) ÂæåÊâçËÉΩ‰ΩøÁî®ÂÖßÈÉ®ÁöÑ key pair ÁöÑÂäüËÉΩ„ÄÇ</p><p>Ë¶ÅÂ¶Ç‰Ωï‰ΩøÁî®Âë¢Ôºü Âè™Ë¶ÅÂú®Áî¢Áîü key pair ÁöÑÈÅéÁ®ã‰∏≠Â§ö‰∏ã‰∏ÄÂÄã flag Âç≥ÂèØ„ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ecdsa-sk -O verify-required</span><br></pre></td></tr></table></figure><p>Ëã•‰πãÂæåË¶Å‰ΩøÁî®Áî±Ê≠§ÊñπÂºèÁî¢ÁîüÁöÑ key pairÔºåÈô§‰∫ÜÊâãÊåáÊåâ‰∏Ä‰∏ã authenticator ‰πãÂ§ñÔºåÈÇÑÊúÉË¶ÅÊ±Ç‰ΩøÁî®ËÄÖËº∏ÂÖ• PIN code ÊâçËÉΩÈ†ÜÂà©ÂÆåÊàêÊìç‰Ωú„ÄÇÂ¶ÇÊ≠§Âç≥‰Ωø authenticator Ë¢´ÂÅ∑Ëµ∞‰∫ÜÔºå‰πü‰∏çÁî®Â§™Á∑äÂºµ„ÄÇ</p><h3 id="ÂÖ®Ëá™Âãï‰ΩøÁî®-Authenticator-ÈÅøÂÖç-User-Presence-Check"><a href="#ÂÖ®Ëá™Âãï‰ΩøÁî®-Authenticator-ÈÅøÂÖç-User-Presence-Check" class="headerlink" title="ÂÖ®Ëá™Âãï‰ΩøÁî® Authenticator (ÈÅøÂÖç User Presence Check)"></a>ÂÖ®Ëá™Âãï‰ΩøÁî® Authenticator (ÈÅøÂÖç User Presence Check)</h3><p>Ëã•Êää authenticator Êèí‰∏äÈõªËÖ¶ÂæåÔºåÊÉ≥Ë¶ÅÈö®ÊôÇÈö®Âú∞ÈÉΩÈÄ≤Ë°å push &#x2F; pullÔºå‰ΩÜ‰∏çË¶ÅÊØèÊ¨°ÈÉΩÊâãÊåâ‰∏Ä‰∏ã authenticator„ÄÇÈÄôÁ®ÆËá™ÂãïÂåñÁöÑ‰ΩøÁî®ÊÉÖÂ¢É OpenSSH ÂÖ∂ÂØ¶‰πüÊòØÊúâÊîØÊè¥ÁöÑ„ÄÇ</p><p>‰ΩøÁî®ÁöÑÊñπÂºè‰πüÊòØÂú®Áî¢Áîü key pair ÊôÇÂ§öÂ∏∂‰∏ÄÂÄãÂèÉÊï∏„ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ecdsa-sk -O no-touch-required</span><br></pre></td></tr></table></figure><p>ÂêåÊôÇÂú®Â∞á public key ÈÉ®Â±¨Âà∞ÁõÆÊ®ôÊ©üÂô®‰∏äÊôÇÔºåÂú® public key Ë©≤Ë°åÂâçÈù¢Â§ö‰∏ã <code>no-touch-required</code>Âç≥ÂèØ„ÄÇ (Ë©≥ÊÉÖË´ãË¶ã <code>ssh-keygen(1)</code> Âèä <code>sshd(8)</code>)</p><p>‰ª•Ê≠§ÊñπÂßãÁî¢ÁîüÁöÑ key pair Âú®‰ΩøÁî®ÊôÇÂ∞±‰∏çÈúÄË¶ÅÊØèÊ¨°ÈÉΩÊâãÊåâ‰∏Ä‰∏ãÔºåÂèØ‰ª•ÂÖ®Ëá™Âãï‰ΩøÁî®„ÄÇ</p><p>‰∏çÈÅéÔºåÈõñÁÑ∂ OpenSSH ÊúâÊîØÊè¥Ê≠§Á®Æ‰ΩøÁî®ÊÉÖÂ¢ÉÔºå<strong>‰ΩÜÁõÆÂâç GitHub Á¶ÅÊ≠¢ÈÄôÁ®Æ‰ΩøÁî®ÊñπÂºè</strong>„ÄÇ</p><p>ÁØÄÈåÑËá™‰∏äËø∞ blog ÊñáÁ´†</p><blockquote><p>While we understand the appeal of removing the need for the taps,we determined our current approach to require presence and intentionis the best balance between usability and security.</p></blockquote><p>ÊâÄ‰ª•Âú® GitHub ‰∏äÔºåËã•ÊÉ≥Ë¶ÅÂÖ®Ëá™ÂãïÊìç‰ΩúÔºåÂè™ËÉΩÂõûÂéªÁî®‰∏ÄËà¨ÁöÑ SSH key Êàñ API token Âõâ„ÄÇ</p><h3 id="ÈÅøÂÖçÊâãÂãïË§áË£Ω-Key-Handle"><a href="#ÈÅøÂÖçÊâãÂãïË§áË£Ω-Key-Handle" class="headerlink" title="ÈÅøÂÖçÊâãÂãïË§áË£Ω Key Handle"></a>ÈÅøÂÖçÊâãÂãïË§áË£Ω Key Handle</h3><p>ÂâçÈù¢ÊúâÊèêÂà∞ÔºåÂéüÂÖàÊ™îÊ°àÁ≥ªÁµ±‰∏äÁî®‰æÜÊîæ private key ÁöÑÊ™îÊ°àÊúÉËÆäÊàêÊãø‰æÜÊì∫Êîæ key handle„ÄÇ</p><p>ÈÄôÊÑèÂë≥ËëóÔºåÁï∂ÊàëÂÄëÊÉ≥Âú®Êñ∞ÁöÑÊ©üÂô®‰∏äÈÄèÈÅé SSH ÈÄ≤Ë°å Git Êìç‰ΩúÊôÇÔºåÈô§‰∫ÜÊãøÂá∫ authenticator ‰πãÂ§ñÔºå‰πüÈúÄË¶ÅÊääÂéüÂÖàÁöÑ key handle Ê™îÊ°àË§áË£ΩÂà∞Êñ∞ÁöÑÊ©üÂô®‰∏ä„ÄÇ‰∏îËã• key handle Ê™îÊ°àÊéâ‰∫ÜÔºåË©≤ÁµÑ key pair Â∞±‰∏çËÉΩ‰ΩøÁî®‰∫Ü„ÄÇ</p><p>Ëã•Ë¶ÅÈÅøÂÖçÊ≠§ÂïèÈ°åÔºåÂ∞±Ë¶ÅÁî®‰∏ä authenticator ÁöÑÂè¶‰∏ÄÂÄãÈÄ≤ÈöéÂäüËÉΩdiscoverable credentials &#x2F; resident keys „ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ecdsa-sk -O resident</span><br></pre></td></tr></table></figure><p>‰ΩøÁî®Ê≠§È°ûÂûãÁöÑ key pair ÊôÇÔºåÊúÉÂú® authenticator ‰∏äÊ∂àËÄó‰∏Ä‰∫õÂÑ≤Â≠òÁ©∫Èñì„ÄÇ‰ΩÜÊèõ‰æÜÁöÑÂ•ΩËôïÊòØÔºå‰ΩøÁî®ËÄÖÂèØ‰ª•Âú®Êñ∞ÁöÑÊ©üÂô®‰∏äÔºåÊää key handle Âæû authenticator ÂÖßÊäΩÂá∫‰æÜ„ÄÇ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -K # extract discoverable credentials</span><br></pre></td></tr></table></figure><p>Â¶ÇÊ≠§Â∞±‰∏çÁî®ÊâãÂãïË§áË£ΩÊì∫Êîæ key handle ÁöÑ private key Ê™îÊ°à‰∫Ü„ÄÇ</p><p>‰ΩÜË¶ÅÊ≥®ÊÑèÁöÑÊòØÊ≠§È°ûÂûã key pair ÊúÉÊ∂àËÄó authenticator ÁöÑÁ©∫Èñì„ÄÇÊØèÊää authenticator ÂèØ‰ª•ÊîæÂ§öÂ∞ë key pair Ë¶ÅÂÜçËá™Ë°åÊü•Èñ±ÂÆòÊñπÊñá‰ª∂„ÄÇ</p><h2 id="ÁµêË™û"><a href="#ÁµêË™û" class="headerlink" title="ÁµêË™û"></a>ÁµêË™û</h2><p>‰ª•‰∏ä‰ªãÁ¥π‰∫ÜÂü∫Êú¨‰ΩøÁî®ÊÉÖÂ¢ÉÂèä‰∏âÁ®ÆÂèØËÉΩÁöÑÈÄ≤Èöé‰ΩøÁî®ÊñπÂºè„ÄÇ</p><p>Á≠ÜËÄÖÂú® 2014 Âπ¥Á¨¨‰∏ÄÊ¨°Ê≥®ÊÑèÂà∞ FIDO (U2F) Ê®ôÊ∫ñÔºåÁï∂ÊôÇÂ∞±Âú®ÊÉ≥ÂÉèÊ≤íÊúâÂØÜÁ¢ºÁöÑ‰∏ñÁïå„ÄÇÂ¶Ç‰ªäÔºåËóâÁî± FIDO 2 security key ÁöÑÊôÆÂèäÔºåÁï∂ÂàùÊâÄÊÉ≥ÁöÑÁæéÂ•ΩÈ°òÊôØ‰ºº‰πéÂú®ÊÖ¢ÊÖ¢Âú∞ÂØ¶Áèæ‰∏≠..</p><p>Â∏åÊúõÊú™‰æÜËÉΩÁúãÂà∞ security key ÈÅãÁî®Âú®Êõ¥Â§öÂ†¥ÊôØ‰∏äÔºÅ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;GitHub ÈñãÂßãÊîØÊè¥‰ΩøÁî® security key ÈÄ≤Ë°å Git Êìç‰ΩúÂï¶ÔºÅ&lt;/p&gt;
&lt;p&gt;ÈÄôÊáâË©≤ÊòØÂêÑÂÆ∂ÁßëÊäÄÂ∑®È†≠Áï∂‰∏≠ÔºåÁ¨¨‰∏ÄÂÄãÊîØÊè¥ security key ÈÄ≤Ë°å SSH login ÁöÑÊúçÂãôÂêß„ÄÇ
Á≠ÜËÄÖÊò®Â§© 5&amp;#x2F;10 ÊâçÂú®ÂÖ¨Âè∏ÂÖßÂàÜ‰∫´Â¶Ç‰Ωï‰ΩøÁî® security key </summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="github" scheme="https://blog.bitisle.net/tags/github/"/>
    
    <category term="fido" scheme="https://blog.bitisle.net/tags/fido/"/>
    
    <category term="git" scheme="https://blog.bitisle.net/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Âª∂Èï∑ÊàñÁ∏ÆÁü≠ GPG ÈáëÈë∞ÁöÑÈÅéÊúüÊôÇÈñì (Expiration Time)</title>
    <link href="https://blog.bitisle.net/2021/05/06/gpg-key-extend-expiration-date.html"/>
    <id>https://blog.bitisle.net/2021/05/06/gpg-key-extend-expiration-date.html</id>
    <published>2021-05-06T00:00:00.000Z</published>
    <updated>2021-05-06T00:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Á≠ÜËÄÖÂú® 2018 Âπ¥ÁöÑÊôÇÂÄôÈñã‰∫ÜÁ¨¨‰∏ÄÂÄãÁúüÁöÑÊúâÂú®Èï∑Êúü‰ΩøÁî®ÁöÑ GPG ÈáëÈë∞„ÄÇ</p><p>Âõ†ÁÇ∫Âπ¥Â∞ëËºïÁãÇ‰∏çÊáÇ‰∫ãÔºåÁï∂ÊôÇÁâπÂà•Êää primary key Ë®≠ÂÆöÊàêÊ∞∏ÈÅ†‰∏çÊúÉÈÅéÊúü„ÄÇ‰ΩÜÊºîÁÆóÊ≥ïÂèØËÉΩÂú®Êú™‰æÜË¢´ÁôºÁèæÊºèÊ¥ûÔºåÈõªËÖ¶ÁöÑÈÅãÁÆóËÉΩÂäõ‰πüÊúÉË∂ä‰æÜË∂äÂ•ΩÔºå‰∏ÄÊää‰∏çÊúÉÈÅéÊúüÁöÑ GPG ÈáëÈë∞ÊòØÂÖàÂ§©‰∏ä‰∏çÂêàÁêÜÁöÑÂ≠òÂú®„ÄÇËÄÉÈáèÂà∞Ê≠§ÂïèÈ°åÔºåÁ≠ÜËÄÖÂæå‰æÜÂèàÂÜç‰øÆÊ≠£‰∫ÜË©≤ÈáëÈë∞ÁöÑÈÅéÊúüÊôÇÈñìÔºå‰ª•ÂèäÊï¥ÁêÜÈÄôÁØáÁ≠ÜË®ò‚Ä¶</p><h2 id="GPG-Key-ÂèØ‰ª•Âª∂Â±ïÈÅéÊúüÊôÇÈñìÔºü"><a href="#GPG-Key-ÂèØ‰ª•Âª∂Â±ïÈÅéÊúüÊôÇÈñìÔºü" class="headerlink" title="GPG Key ÂèØ‰ª•Âª∂Â±ïÈÅéÊúüÊôÇÈñìÔºü"></a>GPG Key ÂèØ‰ª•Âª∂Â±ïÈÅéÊúüÊôÇÈñìÔºü</h2><p>ÊàëÊÉ≥ÈÄôÊáâË©≤ÊòØÁÜüÊÇâ X.509 ÊÜëË≠âÁîüÊÖãÁ≥ªÁöÑ‰∫∫ÊúÄÁÇ∫È©öË®ùÁöÑ‰∏Ä‰ª∂‰∫ãÊÉÖ‰∫Ü„ÄÇ</p><p>ÊàëÁôºÁèæÂπæ‰ΩçÂÖ¨Âè∏‰∏ªÁÆ°‰∏¶‰∏çÁü•ÈÅìÈÄô‰ª∂‰∫ãÊÉÖÔºå‰πü‰øÉ‰ΩøÊàëÂú®Á∂ìÈÅé‰∏ÄÊÆµÊôÇÈñìÂæåÂõû‰æÜÊï¥ÁêÜÈÄôÁØáÊñáÁ´†„ÄÇ‰∫ãÂØ¶‰∏äÔºåGPG key ‰∏çÂè™ÊòØÂèØ‰ª•Âª∂Â±ïÈÅéÊúüÊôÇÈñìÔºåÈÄô‰πüÊòØ‰∏ÄËà¨Êé®Ëñ¶ÁöÑÊúÄ‰Ω≥ÊÖ£‰æã„ÄÇ</p><blockquote><p>People think that they don‚Äôt want their keys to expire,but you actually do. Why? Because you can always extend your expiration date,even after it has expired!</p></blockquote><p>See: <a href="https://riseup.net/en/security/message-security/openpgp/best-practices#use-an-expiration-date-less-than-two-years">OpenPGP Best Practices - riseup.net</a></p><p>‰ΩøÁî®ËÄÖÊáâË©≤Ë®≠‰∏ÄÂÄãËºÉÁü≠ÁöÑÊúâÊïàÊôÇÈñìÔºå‰∏¶Âú®ÂæåÁ∫åÊúâÈúÄË¶ÅÊôÇÂª∂Â±ïÈÅéÊúüÊôÇÈñì„ÄÇ</p><p>GPG key ÂèØ‰ª•Ëá™Â∑±‰øÆÊîπÈáëÈë∞ÁöÑÈÅéÊúüÊôÇÈñìÔºåÊòØÂõ†ÁÇ∫ GPG key Âíå X.509ÊÜëË≠âÊúâËëóÊú¨Ë≥™‰∏äÁöÑÂçÄÂà•„ÄÇ</p><blockquote><p>GPG key ÁöÑÁî¢ÁîüÊòØÈÄèÈÅé primary key ÁöÑ self-signatureÔºåËÄå X.509 ÊÜëË≠âÁöÑÁ∞ΩÁΩ≤ÊòØÁî±ÂÖ¨Ê≠£ÁöÑÁ¨¨‰∏âÊñπ CA ÈÄ≤Ë°å„ÄÇ</p></blockquote><p>X.509 ÊÜëË≠âÁöÑÈÅéÊúüÊôÇÈñìÊòØ CA Âπ´‰Ω†Á∞ΩÁΩ≤ÊÜëË≠âÊôÇÊ±∫ÂÆöÔºåËá™ÁÑ∂ÁÑ°Ê≥ïÈö®ÊÑè‰øÆÊîπÔºåÂ§ßÂÆ∂‰πüÂæàÁøíÊÖ£ÈÄô‰ª∂‰∫ãÊÉÖÔºå‰ΩÜ GPG key Â∞±‰∏ç‰∏ÄÊ®£‰∫Ü„ÄÇGPG key ÁöÑÊúâÊïàÊôÇÈñìÊòØÈÄèÈÅé key ÁöÑ self-signature ÂÖßÊâÄË®òËºâÁöÑÊôÇÈñìÊ±∫ÂÆö„ÄÇÂè™Ë¶Å primary (private) key Ê≤íÊúâÈÅ∫Â§±ÔºåÊåÅÊúâËÄÖÈö®ÊôÇÂèØ‰ª•ÈáçÊñ∞Ëá™Á∞Ω‰∏¶‰øÆÊîπÊôÇÈñì„ÄÇ</p><p>Âè™Ë¶ÅË™çÁü•Âà∞ÂÖ©ËÄÖÊú¨Ë≥™‰∏äÁöÑÂ∑ÆÁï∞ÔºåÂèØ‰ª•‰øÆÊîπÈÅéÊúüÊôÇÈñìÈÄô‰ª∂‰∫ãÊÉÖ‰πüÂ∞±ÂæàÂ•ΩÁêÜËß£‰∫Ü„ÄÇ</p><h2 id="‰ªñ‰∫∫Â¶Ç‰ΩïË™çÂÆöÈÅéÊúüÊôÇÈñìÔºü"><a href="#‰ªñ‰∫∫Â¶Ç‰ΩïË™çÂÆöÈÅéÊúüÊôÇÈñìÔºü" class="headerlink" title="‰ªñ‰∫∫Â¶Ç‰ΩïË™çÂÆöÈÅéÊúüÊôÇÈñìÔºü"></a>‰ªñ‰∫∫Â¶Ç‰ΩïË™çÂÆöÈÅéÊúüÊôÇÈñìÔºü</h2><p>Êó¢ÁÑ∂ GPG key ÂèØ‰ª•Èö®ÊôÇÈáçÁ∞Ω‰øÆÊîπÈÅéÊúüÊôÇÈñìÔºåÈÇ£Â∞ç‰ªñ‰∫∫‰æÜË™™ÔºåË©≤Â¶Ç‰ΩïÂà§ÂÆöÊüêÊää key Á©∂Á´ü‰ªÄÈ∫ºÊôÇÂÄôÈÅéÊúüÂë¢Ôºü</p><p>Ë¶èÂâáÂæàÁ∞°ÂñÆ</p><blockquote><p>The latest self-signature takes precedence</p></blockquote><p>See: <a href="https://www.gnupg.org/gph/en/manual/c235.html">Key Management</a></p><p>Ëã•ÊòØÈÄèÈÅé <code>gpg</code> tool ‰øÆÊîπÈÅéÊúüÊôÇÈñìÔºåËàäÁöÑ self-signature ÊúÉË¢´Âà™Êéâ„ÄÇÂõ†ÁÇ∫Âè™Êúâ‰∏ÄÂÄã self-signatureÔºå‰øÆÊîπÂÆå‰πãÂæåÔºåÂè™Ë¶ÅÈáçÊñ∞Êää key export Áµ¶‰ªñ‰∫∫Ôºå‰ªñ‰∫∫Â∞±ÂèØ‰ª•Áü•ÈÅìÊñ∞ÁöÑÈÅéÊúüÊôÇÈñì„ÄÇ</p><p>Ëã•‰∏çÊòØÈÄèÈÅé‰ø°Ë≥¥ÁÆ°ÈÅìÁõ¥Êé•ÊääÊñ∞Á∞ΩÁöÑ key Áµ¶‰ªñ‰∫∫ÔºåËÄåÊòØÈÄèÈÅé GPG key serverÔºåÁãÄÊ≥ÅÊúÉÊúâÈªû‰∏ç‰∏ÄÊ®£„ÄÇ</p><p>Âü∫ÊñºÂÆâÂÖ®ËÄÉÈáèÔºåGPG key server ÊòØ‰∏çÂÖÅË®±ÈÉ®ÂàÜÊàñÂÆåÂÖ®Âà™Èô§ key ÁöÑÔºåMIT Âêç‰∏ãÁöÑ key serverÈÇÑÁâπÂà•ÂØ´‰∫Ü‰∏ÄÁØá <a href="https://pgp.mit.edu/faq.html">FAQ</a> ‰æÜË™™ÊòéÈÄô‰ª∂‰∫ã„ÄÇÂ∞çÊñº‰∏ÄÊääÂ∑≤Â≠òÂú®ÁöÑ keyÔºå‰ΩøÁî®ËÄÖÂè™ËÉΩÊé®Êñ∞ÁöÑ sub key ÊàñÊñ∞ÁöÑ signature ‰∏äÂéª„ÄÇ</p><p>Âõ†Ê≠§Ôºå‰ªñ‰∫∫ÈÄèÈÅé key server ÂèñÂæó key ÊôÇÔºå‰πüÊúÉÊãøÂà∞Â§öÂÄã signature„ÄÇÂ•ΩÂú® signature Êú¨Ë∫´‰πüÊúâÊôÇÊà≥ÔºåÊ†πÊìö‰∏äËø∞ ‚ÄúÂæåËÄÖÁÇ∫Ê∫ñ‚Äù ÁöÑË¶èÂâáÔºå‰ªñ‰∫∫Â∞±ÂèØ‰ª•Áü•ÈÅìÊ≠£Á¢∫ÁöÑÈÅéÊúüÊôÇÈñìÊòØ‰ΩïÊôÇ„ÄÇ</p><p>ÊúâËààË∂£ÁöÑÂèØ‰ª•Êü•ÁúãÁ≠ÜËÄÖÁöÑ GPG key ‰æÜÁ¢∫Ë™çÈÄôÂÄãË°åÁÇ∫</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver keys.gnupg.net --recv-keys C9756E05</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get key from key server</span></span><br><span class="line"></span><br><span class="line">gpg --export C9756E05 | gpg --list-packets</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">One signature has <span class="string">&quot;key expires after ...&quot;</span> <span class="keyword">while</span> another doesn<span class="string">&#x27;t</span></span></span><br><span class="line"></span><br><span class="line">gpg -k C9756E05</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Validate that the key indeed expires at some time</span></span></span><br></pre></td></tr></table></figure><p>ÊàñÊòØÂèØ‰ª•Áõ¥Êé•Âéª GnuPG ÂÆòÊñπÁöÑ key server Êü•Áúã:<a href="http://keys.gnupg.net/pks/lookup?op=vindex&fingerprint=on&search=0xC728B2BDC9756E05">Search results for ‚Äò0xc728b2bdc9756e05‚Äô</a></p><h2 id="ÁµêË™û"><a href="#ÁµêË™û" class="headerlink" title="ÁµêË™û"></a>ÁµêË™û</h2><p>ÁøªÈñ±Êñá‰ª∂Á†îÁ©∂ÁöÑÈÅéÁ®ãÔºåÊÖ¢ÊÖ¢ÊÑüÂèóÂà∞Âà∞ GPG ÈÄôÂÄãÊâ£Èô§ X.509 ‰πãÂ§ñÂîØ‰∏ÄÊàêÁÜüÁöÑ PKIÁîüÊÖãÁ≥ªÔºåÁ©∂Á´üÊúâÂ§öÈ∫ºÂÅâÂ§ß„ÄÇÂêåÊôÇ‰πüÁúãÂà∞ÂæàÂ§öÂÄºÂæóÁ¥∞ËÆÄÁöÑ guideline Êñá‰ª∂„ÄÇ</p><p>Ëã•ÊúâÊôÇÈñìÔºåÁúüÁöÑË©≤‰æÜÂ•ΩÂ•ΩÂê∏Êî∂Êï¥ÁêÜ„ÄÇ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Á≠ÜËÄÖÂú® 2018 Âπ¥ÁöÑÊôÇÂÄôÈñã‰∫ÜÁ¨¨‰∏ÄÂÄãÁúüÁöÑÊúâÂú®Èï∑Êúü‰ΩøÁî®ÁöÑ GPG ÈáëÈë∞„ÄÇ&lt;/p&gt;
&lt;p&gt;Âõ†ÁÇ∫Âπ¥Â∞ëËºïÁãÇ‰∏çÊáÇ‰∫ãÔºåÁï∂ÊôÇÁâπÂà•Êää primary key Ë®≠ÂÆöÊàêÊ∞∏ÈÅ†‰∏çÊúÉÈÅéÊúü„ÄÇ
‰ΩÜÊºîÁÆóÊ≥ïÂèØËÉΩÂú®Êú™‰æÜË¢´ÁôºÁèæÊºèÊ¥ûÔºåÈõªËÖ¶ÁöÑÈÅãÁÆóËÉΩÂäõ‰πüÊúÉË∂ä‰æÜË∂äÂ•ΩÔºå
‰∏ÄÊää‰∏çÊúÉÈÅéÊúüÁöÑ GPG ÈáëÈë∞ÊòØÂÖàÂ§©‰∏ä‰∏çÂêàÁêÜÁöÑÂ≠òÂú®„ÄÇ</summary>
      
    
    
    
    <category term="notes" scheme="https://blog.bitisle.net/categories/notes/"/>
    
    
    <category term="security" scheme="https://blog.bitisle.net/tags/security/"/>
    
    <category term="gnupg" scheme="https://blog.bitisle.net/tags/gnupg/"/>
    
  </entry>
  
</feed>
